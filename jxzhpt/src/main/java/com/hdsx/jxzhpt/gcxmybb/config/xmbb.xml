<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.xmbb">
	<select id="getptgxXzqh1" parameterType="xmbb" resultType="hashmap">
	select distinct(substr(t1.xzqhdm,0,4)) xzqhdm,substr(t1.xzqhmc,0,3) xzqhmc
	from PLAN_LX_GCGJ t1 left join PLAN_GCGJ t2 on t1.jhid=t2.id left join plan_zjxd t3 on t2.id=t3.xmid left join gcgl_cgs t4 on t2.id=t4.jhid
	where 1=1 and (t1.lxbm like 'G%' or t1.lxbm like 'S%') and t3.sfzj='0'
	<if test="gydw != null and  gydw != ''">
			and t1.gydwdm like '%'||trim(#{gydw})||'%'
	</if>
	<if test="xzqh != null and  xzqh != ''">
			and t1.xzqhdm like '%'||trim(#{xzqh})||'%'
	</if>
	<if test="jhxdnf != null and  jhxdnf != ''">
			and t3.xdnf in (${jhxdnf})
	</if>
	<if test="kgzt != null and  kgzt != ''">
			and t2.kgzt  like '%'||trim(#{kgzt})||'%'
	</if>
	<if test="jgzt != null and  jgzt != ''">
			and t2.jgzt  like '%'||trim(#{jgzt})||'%'
	</if>
	<if test="qxkg != null and  qxkg != ''">
			and t2.sfqxkg  like '%'||trim(#{qxkg})||'%'
	</if>
	<if test="ljbf != null and  ljbf != ''">
			and (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) ${ljbf}
	</if>
	<if test="wbf != null and  wbf != ''">
			and ((select sum(xdzj) from plan_zjxd where xmid=t2.id) - (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id)) ${wbf}
	</if>
	</select>
	<select id="getptgxXzqh2" parameterType="xmbb" resultType="hashmap">
	select distinct(substr(t1.xzqhdm,0,4)) xzqhdm,substr(t1.xzqhmc,0,3) xzqhmc
	from PLAN_LX_GCSJ t1 left join PLAN_GCSJ t2 on t1.jhid=t2.id left join plan_zjxd t3 on t2.id=t3.xmid left join gcgl_cgs t4 on t2.id=t4.jhid
	where 1=1 and (t1.lxbm like 'G%' or t1.lxbm like 'S%') and t3.sfzj='0'
	<if test="gydw != null and  gydw != ''">
			and t1.gydwdm like '%'||trim(#{gydw})||'%'
	</if>
	<if test="xzqh != null and  xzqh != ''">
			and t1.xzqhdm like '%'||trim(#{xzqh})||'%'
	</if>
	<if test="jhxdnf != null and  jhxdnf != ''">
			and t3.xdnf in (${jhxdnf})
	</if>
	<if test="kgzt != null and  kgzt != ''">
			and t2.kgzt  like '%'||trim(#{kgzt})||'%'
	</if>
	<if test="jgzt != null and  jgzt != ''">
			and t2.jgzt  like '%'||trim(#{jgzt})||'%'
	</if>
	<if test="qxkg != null and  qxkg != ''">
			and t2.sfqxkg  like '%'||trim(#{qxkg})||'%'
	</if>
	<if test="ljbf != null and  ljbf != ''">
			and (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) ${ljbf}
	</if>
	<if test="wbf != null and  wbf != ''">
			and ((select sum(xdzj) from plan_zjxd where xmid=t2.id) - (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id)) ${wbf}
	</if>
	</select>
	<select id="selectEx1" parameterType="xmbb" resultType="elist">
	select sum(t5.v_9) v_9,sum(t5.v_10) v_10,sum(t5.v_12) v_12,sum(t5.v_13) v_13,
	sum(t5.v_15) v_15,sum(t5.v_16) v_16,sum(t5.v_17) v_17,sum(t5.v_18) v_18
	from (
	select 
			t1.lxbm||t1.lxmc v_1,t1.xzqhmc v_2,t2.sbnf v_4,t1.qdzh v_5,t1.zdzh v_6,t1.yhlc v_7,t2.gsztz v_8,t2.PFZTZ v_9,
			(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_10,
			(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_12,
			t2.pfztz-(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_13,
			(case when kgzt='0' then '未开工' when kgzt='1' and jgzt='0' then '在建' when jgzt='1' then '竣工' end) v_14,
			t2.dc v_15,t2.jc v_16,(select (max(bywcdc)+max(bywcjc)+max(bywcmc))/3 from gcgl_gcgzgj where jhid=t2.id) v_17,
			(t1.yhlc-(select (max(bywcdc)+max(bywcjc)+max(bywcmc))/3 from gcgl_gcgzgj where jhid=t2.id)) v_18,
			to_char(t2.sjkgsj,'yyyy-mm-dd')v_19,t2.sfqxkg v_20,
			(select max(kgdl) from gcgl_gcgzgj where jhid=t2.id) v_21,t2.sjwgsj v_22,
			t2.yjwgsj v_23,t2.bz v_24,t2.jhxdwh v_25
				
	from PLAN_LX_GCGJ t1 left join PLAN_GCGJ t2 on t1.jhid=t2.id left join plan_zjxd t3 on t2.id=t3.xmid left join gcgl_cgs t4 on t2.id=t4.jhid
	where 1=1 and (t1.lxbm like 'G%' or t1.lxbm like 'S%')  and t3.sfzj='0'
	<if test="gydw != null and  gydw != ''">
			and t1.gydwdm like '%'||trim(#{gydw})||'%'
	</if>
	<if test="xzqh != null and  xzqh != ''">
			and t1.xzqhdm like '%'||trim(#{xzqh})||'%'
	</if>
	<if test="jhxdnf != null and  jhxdnf != ''">
			and t3.xdnf in (${jhxdnf})
	</if>
	<if test="kgzt != null and  kgzt != ''">
			and t2.kgzt  like '%'||trim(#{kgzt})||'%'
	</if>
	<if test="jgzt != null and  jgzt != ''">
			and t2.jgzt  like '%'||trim(#{jgzt})||'%'
	</if>
	<if test="qxkg != null and  qxkg != ''">
			and t2.sfqxkg  like '%'||trim(#{qxkg})||'%'
	</if>
	<if test="ljbf != null and  ljbf != ''">
			and (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) ${ljbf}
	</if>
	<if test="wbf != null and  wbf != ''">
			and ((select sum(xdzj) from plan_zjxd where xmid=t2.id) - (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id)) ${wbf}
	</if>) t5
	</select>
	<select id="selectelist1" parameterType="xmbb" resultType="elist">
	select 
			t1.lxbm||t1.lxmc v_1,t1.xzqhmc v_2,t2.sbnf v_4,t1.qdzh v_5,t1.zdzh v_6,t1.yhlc v_7,t2.gsztz v_8,t2.PFZTZ v_9,
			(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_10,'0' v_11,
			(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_12,
			t2.pfztz-(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_13,
			(case when kgzt='0' then '未开工' when kgzt='1' and jgzt='0' then '在建' when jgzt='1' then '竣工' end) v_14,
			t2.dc v_15,t2.jc v_16,(select (max(bywcdc)+max(bywcjc)+max(bywcmc))/3 from gcgl_gcgzgj where jhid=t2.id) v_17,
			(t1.yhlc-(select (max(bywcdc)+max(bywcjc)+max(bywcmc))/3 from gcgl_gcgzgj where jhid=t2.id)) v_18,
			to_char(t2.sjkgsj,'yyyy-mm-dd')v_19,t2.sfqxkg v_20,
			(select max(kgdl) from gcgl_gcgzgj where jhid=t2.id) v_21,to_char(t2.sjwgsj,'yyyy-mm-dd') v_22,
			to_char(t2.yjwgsj,'yyyy-mm-dd') v_23,t2.bz v_24,t2.jhxdwh v_25
				
	from PLAN_LX_GCGJ t1 left join PLAN_GCGJ t2 on t1.jhid=t2.id left join plan_zjxd t3 on t2.id=t3.xmid left join gcgl_cgs t4 on t2.id=t4.jhid
	where 1=1 and (t1.lxbm like 'G%' or t1.lxbm like 'S%')  and t3.sfzj='0'
	<if test="gydw != null and  gydw != ''">
			and t1.gydwdm like '%'||trim(#{gydw})||'%'
	</if>
	<if test="xzqh != null and  xzqh != ''">
			and t1.xzqhdm like '%'||trim(#{xzqh})||'%'
	</if>
	<if test="jhxdnf != null and  jhxdnf != ''">
			and t3.xdnf in (${jhxdnf})
	</if>
	<if test="kgzt != null and  kgzt != ''">
			and t2.kgzt  like '%'||trim(#{kgzt})||'%'
	</if>
	<if test="jgzt != null and  jgzt != ''">
			and t2.jgzt  like '%'||trim(#{jgzt})||'%'
	</if>
	<if test="qxkg != null and  qxkg != ''">
			and t2.sfqxkg  like '%'||trim(#{qxkg})||'%'
	</if>
	<if test="ljbf != null and  ljbf != ''">
			and (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) ${ljbf}
	</if>
	<if test="wbf != null and  wbf != ''">
			and ((select sum(xdzj) from plan_zjxd where xmid=t2.id) - (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id)) ${wbf}
	</if>
	</select>
	<select id="selectEx2" parameterType="xmbb" resultType="elist">
	select sum(t5.v_9) v_9,sum(t5.v_10) v_10,sum(t5.v_12) v_12,sum(t5.v_13) v_13,
	sum(t5.v_15) v_15,sum(t5.v_16) v_16,sum(t5.v_17) v_17,sum(t5.v_18) v_18
	from (
	select 
			t1.lxbm||t1.lxmc v_1,t1.xzqhmc v_2,t2.jhnf v_4,t1.qdzh v_5,t1.zdzh v_6,t1.xmlc v_7,t2.gsztz v_8,t2.PFTZ v_9,
			(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_10,
			(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_12,
			t2.pftz-(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_13,
			(case when kgzt='0' then '未开工' when kgzt='1' and jgzt='0' then '在建' when jgzt='1' then '竣工' end) v_14,
			t2.dc v_15,t2.jc v_16,(select (max(dcwcqk)+max(jcwcqk))/2 from gcgl_gcgzsj where jhid=t2.id) v_17,
			(t1.xmlc-(select (max(dcwcqk)+max(jcwcqk))/2 from gcgl_gcgzsj where jhid=t2.id)) v_18,
			to_char(t2.sjkgsj,'yyyy-mm-dd')v_19,t2.sfqxkg v_20,
			(select max(kgdl) from gcgl_gcgzgj where jhid=t2.id) v_21,t2.sjwgsj v_22,
			t2.yjwgsj v_23,t1.bz v_24,t2.jhxdwh v_25
				
	from PLAN_LX_GCSJ t1 left join PLAN_GCSJ t2 on t1.jhid=t2.id left join plan_zjxd t3 on t2.id=t3.xmid left join gcgl_cgs t4 on t2.id=t4.jhid
	where 1=1 and (t1.lxbm like 'G%' or t1.lxbm like 'S%')  and t3.sfzj='0'
	<if test="gydw != null and  gydw != ''">
			and t1.gydwdm like '%'||trim(#{gydw})||'%'
	</if>
	<if test="xzqh != null and  xzqh != ''">
			and t1.xzqhdm like '%'||trim(#{xzqh})||'%'
	</if>
	<if test="jhxdnf != null and  jhxdnf != ''">
			and t3.xdnf in (${jhxdnf})
	</if>
	<if test="kgzt != null and  kgzt != ''">
			and t2.kgzt  like '%'||trim(#{kgzt})||'%'
	</if>
	<if test="jgzt != null and  jgzt != ''">
			and t2.jgzt  like '%'||trim(#{jgzt})||'%'
	</if>
	<if test="qxkg != null and  qxkg != ''">
			and t2.sfqxkg  like '%'||trim(#{qxkg})||'%'
	</if>
	<if test="ljbf != null and  ljbf != ''">
			and (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) ${ljbf}
	</if>
	<if test="wbf != null and  wbf != ''">
			and ((select sum(xdzj) from plan_zjxd where xmid=t2.id) - (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id)) ${wbf}
	</if>) t5
	</select>
	<select id="selectelist2" parameterType="xmbb" resultType="elist">
	
	select 
			t1.lxbm||t1.lxmc v_1,t1.xzqhmc v_2,t2.jhnf v_4,t1.qdzh v_5,t1.zdzh v_6,t1.xmlc v_7,t2.gsztz v_8,t2.PFTZ v_9,
			(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_10,'0' v_11,
			(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_12,
			t2.pftz-(select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) v_13,
			(case when kgzt='0' then '未开工' when kgzt='1' and jgzt='0' then '在建' when jgzt='1' then '竣工' end) v_14,
			t2.dc v_15,t2.jc v_16,(select (max(dcwcqk)+max(jcwcqk))/2 from gcgl_gcgzsj where jhid=t2.id) v_17,
			(t1.xmlc-(select (max(dcwcqk)+max(jcwcqk))/2 from gcgl_gcgzsj where jhid=t2.id)) v_18,
			to_char(t2.sjkgsj,'yyyy-mm-dd')v_19,t2.sfqxkg v_20,
			(select max(kgdl) from gcgl_gcgzgj where jhid=t2.id) v_21,to_char(t2.sjwgsj,'yyyy-mm-dd') v_22,
			to_char(t2.yjwgsj,'yyyy-mm-dd') v_23,t1.bz v_24,t2.jhxdwh v_25
				
	from PLAN_LX_GCSJ t1 left join PLAN_GCSJ t2 on t1.jhid=t2.id left join plan_zjxd t3 on t2.id=t3.xmid left join gcgl_cgs t4 on t2.id=t4.jhid
	where 1=1 and (t1.lxbm like 'G%' or t1.lxbm like 'S%')  and t3.sfzj='0'
	<if test="gydw != null and  gydw != ''">
			and t1.gydwdm like '%'||trim(#{gydw})||'%'
	</if>
	<if test="xzqh != null and  xzqh != ''">
			and t1.xzqhdm like '%'||trim(#{xzqh})||'%'
	</if>
	<if test="jhxdnf != null and  jhxdnf != ''">
			and t3.xdnf in (${jhxdnf})
	</if>
	<if test="kgzt != null and  kgzt != ''">
			and t2.kgzt  like '%'||trim(#{kgzt})||'%'
	</if>
	<if test="jgzt != null and  jgzt != ''">
			and t2.jgzt  like '%'||trim(#{jgzt})||'%'
	</if>
	<if test="qxkg != null and  qxkg != ''">
			and t2.sfqxkg  like '%'||trim(#{qxkg})||'%'
	</if>
	<if test="ljbf != null and  ljbf != ''">
			and (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id) ${ljbf}
	</if>
	<if test="wbf != null and  wbf != ''">
			and ((select sum(xdzj) from plan_zjxd where xmid=t2.id) - (select sum(cgsdwzj) from gcgl_cgs where jhid=t2.id)) ${wbf}
	</if>
	</select>
</mapper>