<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.gcglabgc">

	<select id="selectAbgcYbByJhid" parameterType="gcglabgc" resultType="gcglabgc">
		select * from (
		select m.*,rownum rn from (
			select t1.*,t2.tbr,t2.tbsj,t2.tbyf,t2.cgsdwzj,t2.cscyj,t2.stz from GCGL_ABGC t1 left join GCGL_CGS t2 on t1.jhid=t2.jhid and t1.sbyf=t2.tbyf
			where 1=1 and t1.sfsj &lt;=#{sfsj}
		<if test="jhid != null and  jhid != ''">
			and t1.jhid =#{jhid}
		</if>
		order by to_number(substr(sbyf,0,4))desc,to_number(replace(sbyf,'-','')) desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectAbgcYbByJhidCount" parameterType="gcglabgc" resultType="int">
		select count(*) from GCGL_ABGC 
		where 1=1 and sfsj &lt;=#{sfsj}
		<if test="jhid != null and  jhid != ''">
			and jhid =#{jhid}
		</if>
	</select>
	<select id="selectAbgcYbByJhid1" parameterType="gcglabgc" resultType="gcglabgc">
		select * from (
		select m.*,rownum rn from (
			select t1.*,t2.tbr,t2.tbsj,t2.tbyf,t2.cgsdwzj,t2.cscyj,t2.stz from GCGL_ABGC t1 left join GCGL_CGS t2 on t1.jhid=t2.jhid and t1.sbyf=t2.tbyf
			where 1=1 and sfsj=7 
		<if test="jhid != null and  jhid != ''">
			and t1.jhid =#{jhid}
		</if>
		order by to_number(substr(sbyf,0,4))desc,to_number(replace(sbyf,'-','')) desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectAbgcYbByJhidCount1" parameterType="gcglabgc" resultType="int">
		select count(*) from GCGL_ABGC 
		where 1=1 and sfsj=7 
		<if test="jhid != null and  jhid != ''">
			and jhid =#{jhid}
		</if>
	</select>
	
	<!-- 添加月报 -->
	<insert id="insertAbgcYb" parameterType="gcglabgc">
		insert into GCGL_ABGC(id,jhid,wc_btz,wc_stz,wc_qttz,zjdw_btz,zjdw_stz,zjdw_qttz,bywc_c,bywc_gl,kgdl,qksm,sbsj,sbyf,shzt,sfsj,sfth,wcqk)
		values(sys_guid(),#{jhid},#{wc_btz},#{wc_stz},#{wc_qttz},#{zjdw_btz},#{zjdw_stz},#{zjdw_qttz},#{bywc_c},#{bywc_gl},#{kgdl},#{qksm},#{sbsj},#{sbyf},#{shzt},#{sfsj},'否',#{wcqk})
	</insert>
	<select id="queryYbByYf" parameterType="gcglabgc" resultType="gcglabgc">
		select * from GCGL_ABGC where sbyf=#{sbyf} and jhid=#{jhid}
	</select>
	<select id="queryYbByYf1" parameterType="gcglabgc" resultType="int">
		select count(*) from GCGL_ABGC where sbyf=#{sbyf} and jhid=#{jhid}
	</select>
	<!-- 修改月报 -->
	<update id="updateAbgcYb" parameterType="gcglabgc">
		update GCGL_ABGC set wc_btz=#{wc_btz},wc_stz=#{wc_stz},wc_qttz=#{wc_qttz},zjdw_btz=#{zjdw_btz},zjdw_stz=#{zjdw_stz},zjdw_qttz=#{zjdw_qttz},bywc_c=#{bywc_c},bywc_gl=#{bywc_gl},kgdl=#{kgdl},qksm=#{qksm},sbyf=#{sbyf},wcqk=#{wcqk}
		where id=#{id} and jhid=#{jhid}
	</update>
	<!-- 修改月报状态 -->
	<update id="sbWqgzYb" parameterType="gcglabgc">
		update GCGL_ABGC set sfsj=#{sfsj}
		<if test="sfsj == 7">
			, shzt='已审核' , xgcsyj='同意',shtime=sysdate
		</if>
		where id=#{id}
	</update>
	<!-- 删除月报 -->
	<delete id="deleteAbgcYb" parameterType="gcglabgc">
		delete from GCGL_ABGC where id=#{id}
	</delete>
	<!-- 审核月报 -->
	<update id="shAbgcYb" parameterType="gcglabgc">
		update GCGL_ABGC set shuser=#{shuser},shtime=#{shtime},zjje=#{zjje},xgcsyj=#{xgcsyj},shzt='已审核'
		where id=#{id} and jhid=#{jhid}
	</update>
	
		<!-- 添加车购税 -->
	<insert id="insertAbgcCgs" parameterType="gcglabgc">
		insert into GCGL_CGS(id<if test="jhid !=null">,jhid</if><if test="cgsdwzj !=null">,cgsdwzj</if><if test="tbr !=null">,tbr</if><if test="tbyf !=null">,tbyf</if><if test="tbsj !=null">,tbsj</if><if test="stz !=null">,stz</if><if test="cscyj !=null">,cscyj</if><if test="yhdk !=null">,yhdk</if><if test="gz !=null">,gz</if><if test="sz !=null">,sz</if>)
		values(sys_guid()<if test="jhid !=null">,#{jhid}</if><if test="cgsdwzj !=null">,#{cgsdwzj}</if><if test="tbr !=null">,#{tbr}</if><if test="tbyf !=null">,#{tbyf}</if><if test="tbsj !=null">,#{tbsj}</if><if test="stz !=null">,#{stz}</if><if test="cscyj !=null">,#{cscyj}</if><if test="yhdk !=null">,#{yhdk}</if><if test="gz !=null">,#{gz}</if><if test="sz !=null">,#{sz}</if>)
	</insert>
	<select id="queryCGSByYf" parameterType="gcglwqgz" resultType="gcglabgc">
		select * from GCGL_CGS where tbyf=#{tbyf} and jhid=#{jhid}
	</select>
		<!-- 查询cgs -->
	<select id="selectAbgcCgsList" parameterType="gcglabgc" resultType="gcglabgc">
		select * from (
		select m.*,rownum rn from (
			select t1.*,t2.sbsj,t2.sbyf from GCGL_CGS t1 left join GCGL_ABGC t2 on t1.jhid=t2.jhid and t1.tbyf=t2.sbyf
			where 1=1
		<if test="jhid != null and  jhid != ''">
			and t1.jhid =#{jhid}
		</if>
		order by to_number(substr(tbyf,0,4))desc,to_number(replace(tbyf,'-','')) desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectAbgcCgsListCount" parameterType="gcglabgc" resultType="int">
		select count(*) from GCGL_CGS 
		where 1=1
		<if test="jhid != null and  jhid != ''">
			and jhid =#{jhid}
		</if>
	</select>
	<!-- 删除cgs -->
	<delete id="deleteabgcCgs" parameterType="gcglabgc">
		delete from GCGL_CGS where id=#{id}
	</delete>
	<!-- 修改cgs -->
	<update id="updateAbgcCgs" parameterType="gcglabgc">
		update GCGL_CGS set cgsdwzj=#{cgsdwzj},tbyf=#{tbyf},stz=#{stz},cscyj=#{cscyj},tbsj=#{tbsj}
		where id=#{id} and jhid=#{jhid}
	</update>
	
	<!-- 上传 -->
	<update id="uploadWqgzFilesgxk" parameterType="gcglabgc">
		update PLAN_ABGC set SGXKWJ=#{tiaojian},SGXKWJFILE=#{sgxkwjfile}
		where ID=#{jhid}
	</update>
		<update id="uploadWqgzFilejgtc" parameterType="gcglabgc">
		update PLAN_ABGC set JGTCWJ=#{tiaojian},JGTCWJFILE=#{jgtcwjfile}
		where ID=#{jhid}
	</update>
		<update id="uploadWqgzFilejgys" parameterType="gcglabgc">
		update PLAN_ABGC set JGYSWJ=#{tiaojian},JGYSWJFILE=#{jgyswjfile}
		where ID=#{jhid}
	</update>
	<!-- 下载 -->
	<select id="downWqgzFile" parameterType="gcglabgc" resultType="gcglabgc">
		select ${tiaojian} tiaojian,${lxmc} sgxkwjfile from PLAN_ABGC where ID=#{jhid}
	</select>
	<update id="insertWqgzwwg" parameterType="gcglabgc">
		update PLAN_ABGC set WJGYY=#{wjgyy} where ID=#{jhid}
	</update>
	<update id="insertWqgzwg" parameterType="gcglabgc">
		update PLAN_ABGC set SJWGSJ=#{sjwgsj},JGZT=#{jgzt} where ID=#{jhid}
	</update>
	<update id="insertafwg" parameterType="gcglabgc">
		update PLAN_AF set SJWGSJ=#{sjwgsj},JGZT=#{jgzt} where ID=#{jhid}
	</update>
	<update id="insertWqgzkg" parameterType="gcglabgc">
		update PLAN_ABGC set xdsj=#{xdsj},jhxdwh=#{xdwh},kgzt=#{kgzt},sjkgsj=#{sjkgsj},yjwgsj=#{yjwgsj},sgdw=#{sgdw},jldw=#{jldw},jsdw=#{jsdw},htje=#{htje},gys=#{gys} where ID=#{jhid}
	</update>
	<update id="insertafkg" parameterType="gcglabgc">
		update PLAN_AF set xdsj=#{xdsj},jhxdwh=#{xdwh},kgzt=#{kgzt},sjkgsj=#{sjkgsj},yjwgsj=#{yjwgsj},sgdw=#{sgdw},jldw=#{jldw},jsdw=#{jsdw},htje=#{htje},gys=#{gys} where ID=#{jhid}
	</update>
	<select id="selectWqgzjhList" parameterType="gcglabgc" resultType="gcglabgc">
		select * from (
		select m.*,rownum rn from (
		select 
		t1.jhnf sbnf,t1.jhkgsj,t1.jhwgsj,t1.sjdw,t1.sjpfdw,t1.pfwh,t1.pfsj,t1.pfztz,t1.JHSYBBZJE jhsybzje,t1.JHSYDFZCZJ jhsydfzcje,t1.sfsqablbz,t1.ablbzsqwh,t1.gkbglj,t1.gkbgmc,t1.sjsgtlj,t1.sjsgtmc,t1.REMARKS jhbz,t1.xdsj,t1.jhxdwh xdwh,t1.sjkgsj,t1.id jhid,t1.id,
		t1.yjwgsj,t1.sgdw,t1.jldw,t1.jsdw,t1.gys,t1.htje,t1.sjwgsj,t1.kgzt,t1.jgzt,t1.wjgyy,t1.sgxkwj,t1.jgtcwj,t1.jgyswj,
		t3.gydw,t3.xzqhdm,t3.xzqhmc,t3.lxjsdj,t3.lxbm,t3.lxmc,t3.qdzh,t3.zdzh,t2.sczlc qzlc,t2.scyhlc yhlc,t3.gjxjnd,t3.yhnr,t3.xmnf,t3.xmtype,t3.bz,t3.tsdq,
		t2.tzgs,t2.spwh,t2.fapgdw,t2.fascdw,t2.faspsj,t2.jsxz,t2.jsnr,t2.scbz,nvl(xd.xdzj,0) xdzj,nvl(bf.bfzj,0) bfzj
		from PLAN_ABGC t1 left join SCK_ABGC  t2 on t1.SCKID=t2.SCKID left join XMK_ABGC t3 on t2.xmkid=t3.id 
		left join gcgl_jgys jg on t1.id=jg.jhid
		left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t1.id=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t1.id=bf.jhid
		where t1.spzt='1'
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
		<if test="kgzt != null and  kgzt != ''">
				and t1.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t1.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="lxmc != null and  lxmc != ''">
				and t3.lxmc like '%'||trim(#{lxmc})||'%'
		</if>
		<if test="shzt != null and  shzt != ''">
				and ${tiaojian} like '%'||trim(#{shzt})||'%'
		</if>
		<if test="xmnf != null and  xmnf != ''">
				and t1.jhnf in (${xmnf})
		</if>
		<if test="jgys != null and  jgys != ''">
				and decode(jg.id,null,'否','是') = #{jgys}
		</if>
		order by t1.jhnf
		) m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
	</select>
	<select id="selectafjhList" parameterType="gcglabgc" resultType="gcglabgc">
		select * from (
		select m.*,rownum rn from (
		select 
		t1.*,t3.gydw,t3.xzqh xzqhmc,t3.lxbm,t3.lxmc,t3.qdzh,t3.zdzh,t3.czzlc qzlc,t3.yhlc,t3.xjgjnd gjxjnd,t1.id jhid,t1.jhxdwh xdwh,t1.jhsybbzje jhsybzje,nvl(xd.xdzj,0) xdzj,nvl(bf.bfzj,0) bfzj
		from PLAN_AF t1 left join SCK_Aqsmfh  t3 on t1.SCKID=t3.ID
		left join gcgl_jgys jg on t1.id=jg.jhid
		left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t1.id=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t1.id=bf.jhid
		where t1.spzt='1'
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
		<if test="kgzt != null and  kgzt != ''">
				and t1.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t1.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="lxmc != null and  lxmc != ''">
				and t3.lxmc like '%'||trim(#{lxmc})||'%'
		</if>
		<if test="shzt != null and  shzt != ''">
				and ${tiaojian} like '%'||trim(#{shzt})||'%'
		</if>
		<if test="xmnf != null and  xmnf != ''">
				and t1.jhnf in (${xmnf})
		</if>
		<if test="jgys != null and  jgys != ''">
				and decode(jg.id,null,'否','是') = #{jgys}
		</if>
		order by t1.jhnf
		) m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
	</select>
	
	 <select id="selectWqgzjhListCount" parameterType="gcglabgc" resultType="int">
	 	select count(*) from PLAN_ABGC t1 left join SCK_ABGC  t2 on t1.SCKID=t2.SCKID left join XMK_ABGC t3 on t2.xmkid=t3.id 
	 	left join gcgl_jgys jg on t1.id=jg.jhid
	 	where 1=1 and spzt='1'
	<if test="gydw != null and  gydw != ''">
			${gydw}
	</if>
	<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
	<if test="kgzt != null and  kgzt != ''">
			and t1.kgzt like '%'||trim(#{kgzt})||'%'
	</if>
	<if test="jgzt != null and  jgzt != ''">
			and t1.jgzt like '%'||trim(#{jgzt})||'%'
	</if>
	<if test="lxmc != null and  lxmc != ''">
			and t3.lxmc like '%'||trim(#{lxmc})||'%'
	</if>
	<if test="shzt != null and  shzt != ''">
			and ${tiaojian} like '%'||trim(#{shzt})||'%'
	</if>
	<if test="xmnf != null and  xmnf != ''">
			and t1.jhnf in (${xmnf})
	</if>
	<if test="jgys != null and  jgys != ''">
			and decode(jg.id,null,'否','是') = #{jgys}
		</if>
	 </select>
	 <select id="selectabTJ" parameterType="gcglabgc" resultType="gcglwqgz">
	 	select count(*) sl,nvl(sum(t1.pfztz),0) pfztz,nvl(sum(t1.jhsybbzje),0) btz,nvl(sum(t1.jhsydfzczj),0) dftz,
    	nvl(sum(zbz),0) zbz,nvl(sum(jg.nsqsjjlzj),0) jlzj from PLAN_ABGC t1 left join SCK_ABGC  t2 on t1.SCKID=t2.SCKID left join XMK_ABGC t3 on t2.xmkid=t3.id 
    	left join(select xmid,sum(xdzj) zbz from plan_zjxd  group by xmid) zj on t1.id=zj.xmid
	 	left join gcgl_jgys jg on t1.id=jg.jhid
	 	where 1=1 and spzt='1'
		<if test="gydw != null and  gydw != ''">
				${gydw}
		</if>
		<if test="xzqhdm != null and  xzqhdm != ''">
				${xzqhdm}
		</if>
		<if test="jsdj != null and  jsdj != ''">
				and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
		</if>
		<if test="gldj != null and  gldj != ''">
				and t3.lxbm like trim(#{gldj})||'%'
		</if>
		<if test="tsdq != null and  tsdq != ''">
				and t3.tsdq like '%'||trim(#{tsdq})||'%'
		</if>
		<if test="kgzt != null and  kgzt != ''">
				and t1.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t1.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="lxmc != null and  lxmc != ''">
				and t3.lxmc like '%'||trim(#{lxmc})||'%'
		</if>
		<if test="shzt != null and  shzt != ''">
				and ${tiaojian} like '%'||trim(#{shzt})||'%'
		</if>
		<if test="xmnf != null and  xmnf != ''">
				and t1.jhnf in (${xmnf})
		</if>
		<if test="jgys != null and  jgys != ''">
			and decode(jg.id,null,'否','是') = #{jgys}
		</if>
	 </select>
	 
	 
	  <select id="selectafTJ" parameterType="gcglabgc" resultType="gcglwqgz">
	 	select count(*) sl,nvl(sum(t1.pfztz),0) pfztz,nvl(sum(t1.jhsybbzje),0) btz,nvl(sum(t1.jhsydfzczj),0) dftz,
    	nvl(sum(zbz),0) zbz,nvl(sum(jg.nsqsjjlzj),0) jlzj from PLAN_AF t1 left join SCK_AQSMFH  t3 on t1.SCKID=t3.ID  left join(select xmid,sum(xdzj) zbz from plan_zjxd  group by xmid) zj on t1.id=zj.xmid
	 	left join gcgl_jgys jg on t1.id=jg.jhid
	 	where 1=1 and spzt='1'
	 	<if test="jgys != null and  jgys != ''">
				and decode(jg.id,null,'否','是') = #{jgys}
		</if>
		<if test="gydw != null and  gydw != ''">
				${gydw}
		</if>
		<if test="xzqhdm != null and  xzqhdm != ''">
				${xzqhdm}
		</if>
		<if test="jsdj != null and  jsdj != ''">
				and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
		</if>
		<if test="gldj != null and  gldj != ''">
				and t3.lxbm like trim(#{gldj})||'%'
		</if>
		<if test="tsdq != null and  tsdq != ''">
				and t3.tsdq like '%'||trim(#{tsdq})||'%'
		</if>
		<if test="kgzt != null and  kgzt != ''">
				and t1.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t1.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="lxmc != null and  lxmc != ''">
				and t3.lxmc like '%'||trim(#{lxmc})||'%'
		</if>
		<if test="shzt != null and  shzt != ''">
				and ${tiaojian} like '%'||trim(#{shzt})||'%'
		</if>
		<if test="xmnf != null and  xmnf != ''">
				and t1.jhnf in (${xmnf})
		</if>
	 </select>
	  <select id="selectafjhListCount" parameterType="gcglabgc" resultType="int">
	 	select count(*) from PLAN_AF t1 left join SCK_AQSMFH  t3 on t1.SCKID=t3.ID 
	 	left join gcgl_jgys jg on t1.id=jg.jhid
	 	where 1=1 and spzt='1'
	 	<if test="jgys != null and  jgys != ''">
				and decode(jg.id,null,'否','是') = #{jgys}
		</if>
	<if test="gydw != null and  gydw != ''">
			${gydw}
	</if>
	<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
	<if test="kgzt != null and  kgzt != ''">
			and t1.kgzt like '%'||trim(#{kgzt})||'%'
	</if>
	<if test="jgzt != null and  jgzt != ''">
			and t1.jgzt like '%'||trim(#{jgzt})||'%'
	</if>
	<if test="lxmc != null and  lxmc != ''">
			and t3.lxmc like '%'||trim(#{lxmc})||'%'
	</if>
	<if test="shzt != null and  shzt != ''">
			and ${tiaojian} like '%'||trim(#{shzt})||'%'
	</if>
	<if test="xmnf != null and  xmnf != ''">
			and t1.jhnf in (${xmnf})
	</if>
	 </select>
	 
	 <select id="selectWqgzjhFile" parameterType="gcglabgc" resultType="gcglabgc">
	 	select sgxkwj,jgtcwj,jgyswj from PLAN_ABGC where ID=#{jhid}
	 </select>
	 <update id="updateSjZT" parameterType="gcglabgc" >
	 update PLAN_ABGC set sjzt=#{sjzt} where id=#{jhid}
	 </update>
	 <update id="updateXjZT" parameterType="gcglabgc" >
	 update PLAN_ABGC set xjzt=#{xjzt} where id=#{jhid}
	 </update>
	 <update id="updateSJSH" parameterType="gcglabgc" >
	 update PLAN_ABGC set sjsh=#{sjsh} where id=#{jhid}
	 </update>
	  <update id="updatezdyf" parameterType="gcglabgc" >
	 update PLAN_ABGC set zdyf=#{sbyf} where id=#{jhid}
	 </update>
	 <select id="selectnumbyyh" parameterType="gcglabgc" resultType="int">
	 	select count(*) from GCGL_ABGC 
		where jhid=#{jhid} and sfsj=#{yhtype} and shzt='未审核'
	 </select>
	 
	 
	 <select id="exportAbyb" parameterType="gcglabgc" resultType="elist">
			select 
			t1.ID v_0,t3.gydw v_1,t3.xzqhmc v_2,t3.lxbm v_3,t3.lxmc v_4,t3.qdzh v_5,t3.zdzh v_6,t1.pfztz v_7,JHSYBBZJE v_8,JHSYDFZCZJ v_9,0 v_10,0 v_11,'同意' v_12,#{tbyf} v_13,to_char(sysdate,'yyyy-mm-dd') v_14,#{tbr} v_15
			from PLAN_ABGC t1 left join SCK_ABGC  t2 on t1.SCKID=t2.SCKID left join XMK_ABGC t3 on t2.xmkid=t3.id left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t1.id=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t1.id=xdjh.jhid
		left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t1.id=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t1.id=xd.xmid
	    left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t1.id=bf.jhid
	 	where t1.spzt='1' 
	 		<if test="xmnf != null and  xmnf != ''">
			and xdjh.xdsj like '%'||trim(#{xmnf})||'%'
		</if>
		<if test="lxbm != null and  lxbm != ''">
			and t3.lxbm like '%'||trim(#{lxbm})||'%'
		</if>
		
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
			<if test="ljbfzt != null and  ljbfzt != ''">
				<if test="ljbfzt =='已全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
				</if>
				<if test="ljbfzt =='未全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
				</if>
			</if>
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
			order by t1.jhnf
	</select>
	<select id="exportAfyb" parameterType="gcglabgc" resultType="elist">
			select 
			t1.ID v_0,t3.gydw v_1,t3.xzqh v_2,t3.lxbm v_3,t3.lxmc v_4,t3.qdzh v_5,t3.zdzh v_6,t1.pfztz v_7,JHSYBBZJE v_8,JHSYDFZCZJ v_9,0 v_10,0 v_11,'同意' v_12,#{tbyf} v_13,to_char(sysdate,'yyyy-mm-dd') v_14,#{tbr} v_15
			from PLAN_AF t1 left join SCK_Aqsmfh  t3 on t1.SCKID=t3.ID left join 
		(select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t1.id=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t1.id=xdjh.jhid
		left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t1.id=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t1.id=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t1.id=bf.jhid
		where t1.spzt='1' 

		<if test="xmnf != null and  xmnf != ''">
			and xdjh.xdsj like '%'||trim(#{xmnf})||'%'
		</if>
		<if test="lxbm != null and  lxbm != ''">
			and t3.lxbm like '%'||trim(#{lxbm})||'%'
		</if>
		
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
			<if test="ljbfzt != null and  ljbfzt != ''">
				<if test="ljbfzt =='已全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
				</if>
				<if test="ljbfzt =='未全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
				</if>
			</if>
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
			order by t1.jhnf
	</select>
	
	
	 <select id="exportgjyb" parameterType="gcglabgc" resultType="elist">
		select 
		t.xmbm v_0,
		substr(t.xmbm,0,4) v_2,t.kgsj v_3,t.wgsj v_4,t.xmmc v_1,zj.ztz v_5,zj.btz v_6,0 v_7,0 v_8,0 v_9,0 v_10,'同意' v_11,#{tbyf} v_12,to_char(sysdate,'yyyy-mm-dd') v_13,#{tbr} v_14
		from JHSH_LMGZ t left join lxsh_lmgz lxsh on t.xmbm=lxsh.xmbm left join (select count(*) sl, xmid xmbm from lxsh_lx where jdbs='2' group by xmid) s on t.xmbm=s.xmbm left join 
		(select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t.xmbm=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t.xmbm=xdjh.jhid
			left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t.xmbm=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t.xmbm=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t.xmbm=bf.jhid
		left join (select sum(xdzj) ztz,sum(btzzj) btz,sum(stz),xmid from plan_zjxd group by xmid) zj on t.xmbm=zj.xmid
			where 1=1 
			<!-- <if test="xdsj != null and  xdsj != ''">
			and xdjh.xdsj like '%'||trim(#{xdsj})||'%'
		</if> -->
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
		<if test="kgzt != null and  kgzt != ''">
				and t.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="sbnf != null and  sbnf != ''">
				and xdjh.xdsj like '%'||trim(#{sbnf})||'%'
		</if>
		<if test="tsdq != null and  tsdq != ''">
				and lxsh.tsdq like '%'||trim(#{tsdq})||'%'
		</if>
		<if test="ljbfzt != null and  ljbfzt != ''">
				<if test="ljbfzt =='已全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
			</if>
			<if test="ljbfzt =='未全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
			</if>
		</if>
		<if test="xmmc != null and  xmmc != ''">
				and t.xmmc like '%'||trim(#{xmmc})||'%'
		</if>
		and t.xmbm in (
				select xmid from lxsh_lx where 1=1 
				<if test="gydw!='' and gydw!= null ">
				${gydw}
				</if>
				<if test="lxmc != null and  lxmc != ''">
					and lxmc like '%'||trim(#{lxmc})||'%'
				</if>
				<if test="lxbm != null and  lxbm != ''">
					and lxbm like '%'||trim(#{lxbm})||'%'
				</if>
				<if test="jsdj != null and  jsdj != ''">
					and xjsdj like '%'||trim(#{jsdj})||'%'
				</if>
				<if test="gldj != null and  gldj != ''">
						and lxbm like trim(#{gldj})||'%'
				</if>
				)
	</select>
	
	<select id="exportxjyb" parameterType="gcglabgc" resultType="elist">
		select 
		t.xmbm v_0,
		substr(t.xmbm,0,4) v_2,t.kgsj v_3,t.wgsj v_4,t.xmmc v_1,zj.ztz v_5,zj.btz v_6,0 v_7,0 v_8,0 v_9,0 v_10,'同意' v_11,#{tbyf} v_12,to_char(sysdate,'yyyy-mm-dd') v_13,#{tbr} v_14
		from JHSH_XJ t left join lxsh_xj lxsh on t.xmbm=lxsh.xmbm left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t.xmbm=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t.xmbm=xdjh.jhid
		left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t.xmbm=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t.xmbm=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t.xmbm=bf.jhid
		    left join (select sum(xdzj) ztz,sum(btzzj) btz,sum(stz),xmid from plan_zjxd group by xmid) zj on t.xmbm=zj.xmid
			where 1=1 
		<!-- 	<if test="xdsj != null and  xdsj != ''">
			and xdjh.xdsj like '%'||trim(#{xdsj})||'%'
		</if> -->
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
		<if test="kgzt != null and  kgzt != ''">
				and t.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="sbnf != null and  sbnf != ''">
				and xdjh.xdsj like '%'||trim(#{sbnf})||'%'
		</if>
		<if test="tsdq != null and  tsdq != ''">
				and lxsh.tsdq like '%'||trim(#{tsdq})||'%'
		</if>
		<if test="ljbfzt != null and  ljbfzt != ''">
			<if test="ljbfzt =='已全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
			</if>
			<if test="ljbfzt =='未全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
			</if>
		</if>
		<if test="xmmc != null and  xmmc != ''">
				and t.xmmc like '%'||trim(#{xmmc})||'%'
		</if>
		and t.xmbm in (
				select xmid from lxsh_lx where 1=1 
				<if test="gydw!='' and gydw!= null ">
				${gydw}
				</if>
				<if test="lxmc != null and  lxmc != ''">
					and lxmc like '%'||trim(#{lxmc})||'%'
				</if>
				<if test="lxbm != null and  lxbm != ''">
					and lxbm like '%'||trim(#{lxbm})||'%'
				</if>
				<if test="jsdj != null and  jsdj != ''">
					and xjsdj like '%'||trim(#{jsdj})||'%'
				</if>
				<if test="gldj != null and  gldj != ''">
						and lxbm like trim(#{gldj})||'%'
				</if>
			)
	</select>
	<select id="selectWqgzjhListid1" parameterType="gcglgcgzgj" resultType="gcglgcgzgj">
	
		select 
			distinct(t2.id) id
		from PLAN_LX_GCGJ t1 left join PLAN_GCGJ t2 on t1.jhid=t2.id
		where t2.spzt='1'
		<if test="gydw != null and  gydw != ''">
				${gydw}
		</if>
		<if test="kgzt != null and  kgzt != ''">
				and t2.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t2.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="lxmc != null and  lxmc != ''">
				and t1.lxmc like '%'||trim(#{lxmc})||'%'
		</if>
		<if test="shzt != null and  shzt != ''">
				and ${tiaojian} like '%'||trim(#{shzt})||'%'
		</if>
	</select>
	
	
	 <select id="exportsjyb" parameterType="gcglabgc" resultType="elist">
		select 
		t.xmbm v_0,
		substr(t.xmbm,0,4) v_2,t.kgsj v_3,t.wgsj v_4,t.xmmc v_1,zj.ztz v_5,zj.btz v_6,0 v_7,0 v_8,0 v_9,0 v_10,'同意' v_11,#{tbyf} v_12,to_char(sysdate,'yyyy-mm-dd') v_13,#{tbr} v_14
		from JHSH_SJGZ t left join lxsh_sjgz lxsh on t.xmbm=lxsh.xmbm left join (select count(*) sl, xmid xmbm from lxsh_lx where jdbs='2' group by xmid) s on t.xmbm=s.xmbm left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t.xmbm=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t.xmbm=xdjh.jhid
		left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t.xmbm=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t.xmbm=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t.xmbm=bf.jhid
		left join (select sum(xdzj) ztz,sum(btzzj) btz,sum(stz),xmid from plan_zjxd group by xmid) zj on t.xmbm=zj.xmid
			where 1=1 
			<!-- <if test="xdsj != null and  xdsj != ''">
			and xdjh.xdsj like '%'||trim(#{xdsj})||'%'
		</if> -->
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
		<if test="kgzt != null and  kgzt != ''">
				and t.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="sbnf != null and  sbnf != ''">
				and xdjh.xdsj like '%'||trim(#{sbnf})||'%'
		</if>
		<if test="tsdq != null and  tsdq != ''">
				and lxsh.tsdq like '%'||trim(#{tsdq})||'%'
		</if>
		<if test="ljbfzt != null and  ljbfzt != ''">
			<if test="ljbfzt =='已全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
			</if>
			<if test="ljbfzt =='未全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
			</if>
		</if>
		<if test="xmmc != null and  xmmc != ''">
				and t.xmmc like '%'||trim(#{xmmc})||'%'
		</if>
		and t.xmbm in (
				select xmid from lxsh_lx where 1=1 
				<if test="gydw!='' and gydw!= null ">
				${gydw}
				</if>
				<if test="lxmc != null and  lxmc != ''">
					and lxmc like '%'||trim(#{lxmc})||'%'
				</if>
				<if test="lxbm != null and  lxbm != ''">
					and lxbm like '%'||trim(#{lxbm})||'%'
				</if>
				<if test="jsdj != null and  jsdj != ''">
					and xjsdj like '%'||trim(#{jsdj})||'%'
				</if>
				<if test="gldj != null and  gldj != ''">
						and lxbm like trim(#{gldj})||'%'
				</if>
			)
	</select>
	
	<select id="exportgsdyb" parameterType="gcglabgc" resultType="elist">
		select 
	    t.xmbm v_0,
	    substr(t.xmbm,0,4) v_2,t.kgsj v_3,t.wgsj v_4,t.xmmc v_1,zj.ztz v_5,zj.btz v_6,0 v_7,0 v_8,0 v_9,0 v_10,'同意' v_11,#{tbyf} v_12,to_char(sysdate,'yyyy-mm-dd') v_13,#{tbr} v_14
	    from GSDGZ t left join (select xmid xmbm,min(lx.xzqhdm) xzqhdm,min(lx.gydw) gydw from lxsh_lx lx group by lx.xmid) lxsh on t.xmbm=lxsh.xmbm left join (select count(*) sl, xmid xmbm from lxsh_lx where jdbs='2' group by xmid) s on t.xmbm=s.xmbm left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t.xmbm=c.jhid
	    left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t.xmbm=xdjh.jhid
	    left join (select 
	      (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	        else '未全部拨付' end) ljbfzt,tb1.xmid
	      from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	      (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	      where tb1.xmid=tb2.jhid) tb3 on t.xmbm=tb3.xmid
	      left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t.xmbm=xd.xmid
	      left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t.xmbm=bf.jhid
	    left join (select sum(xdzj) ztz,sum(btzzj) btz,sum(stz),xmid from plan_zjxd group by xmid) zj on t.xmbm=zj.xmid
	      where 1=1 
			<!-- <if test="xdsj != null and  xdsj != ''">
			and xdjh.xdsj like '%'||trim(#{xdsj})||'%'
		</if> -->
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
		<if test="kgzt != null and  kgzt != ''">
				and t.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="sbnf != null and  sbnf != ''">
				and xdjh.xdsj like '%'||trim(#{sbnf})||'%'
		</if>
		<if test="tsdq != null and  tsdq != ''">
				and lxsh.tsdq like '%'||trim(#{tsdq})||'%'
		</if>
		<if test="ljbfzt != null and  ljbfzt != ''">
			<if test="ljbfzt =='已全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
			</if>
			<if test="ljbfzt =='未全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
			</if>
		</if>
		<if test="xmmc != null and  xmmc != ''">
				and t.xmmc like '%'||trim(#{xmmc})||'%'
		</if>
		<if test="xmlx1 != null and  xmlx1 != ''">
				${xmlx1}
		</if>
		and t.xmbm in (
				select xmid from lxsh_lx where 1=1 
				<if test="gydw!='' and gydw!= null ">
				${gydw}
				</if>
				<if test="lxmc != null and  lxmc != ''">
					and lxmc like '%'||trim(#{lxmc})||'%'
				</if>
				<if test="lxbm != null and  lxbm != ''">
					and lxbm like '%'||trim(#{lxbm})||'%'
				</if>
				<if test="jsdj != null and  jsdj != ''">
					and xjsdj like '%'||trim(#{jsdj})||'%'
				</if>
				<if test="gldj != null and  gldj != ''">
						and lxbm like trim(#{gldj})||'%'
				</if>
			)
	</select>
	
	 <select id="exporthsyb" parameterType="gcglabgc" resultType="elist">
			select 
			t2.id v_0,xzqhmc v_1,jhnf v_2,xmmc v_3,jsxz v_4,kgn v_5,wgn v_6,t2.ztz v_7,zytz v_8,dfta v_9,0 v_10,0 v_11,'同意' v_12,#{tbyf} v_13,to_char(sysdate,'yyyy-mm-dd') v_14,#{tbr} v_15
			from PLAN_HSLY t2 left join (select * from gcgl_cgs where tbyf=#{tbyf}) c on t2.id=c.jhid
			where 1=1 
<!-- 			<if test="jhnf != null and  jhnf != ''"> -->
<!-- 					and t2.jhnf like '%'||trim(#{jhnf})||'%' -->
<!-- 			</if> -->
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and xmmc like '%'||trim(#{lxmc})||'%'
			</if>
	</select>
	
	<select id="exportshyb" parameterType="gcglabgc" resultType="elist">
		select 
		t.xmbm v_0,
		substr(t.xmbm,0,4) v_2,t.jhkgsj v_3,t.jhwgsj v_4,t.xmmc v_1,zj.ztz v_5,zj.btz v_6,0 v_7,0 v_8,0 v_9,0 v_10,'同意' v_11,#{tbyf} v_12,to_char(sysdate,'yyyy-mm-dd') v_13,#{tbr} v_14
		from JHSH_SH t left join xmsq_sh lxsh on t.xmbm=lxsh.xmbm left join (select count(*) sl, xmid xmbm from lxsh_lx where jdbs='2' group by xmid) s on t.xmbm=s.xmbm  left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t.xmbm=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t.xmbm=xdjh.jhid
			left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t.xmbm=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t.xmbm=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t.xmbm=bf.jhid
		    left join (select sum(xdzj) ztz,sum(btzzj) btz,sum(stz),xmid from plan_zjxd group by xmid) zj on t.xmbm=zj.xmid	
			where 1=1 
			<!-- <if test="xdsj != null and  xdsj != ''">
			and xdjh.xdsj like '%'||trim(#{xdsj})||'%'
		</if> -->
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
		<if test="kgzt != null and  kgzt != ''">
				and t.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="sbnf != null and  sbnf != ''">
				and xdjh.xdsj like '%'||trim(#{sbnf})||'%'
		</if>
		<if test="tsdq != null and  tsdq != ''">
				and lxsh.tsdq like '%'||trim(#{tsdq})||'%'
		</if>
		<if test="ljbfzt != null and  ljbfzt != ''">
				<if test="ljbfzt =='已全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
			</if>
			<if test="ljbfzt =='未全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
			</if>
		</if>
		<if test="xmmc != null and  xmmc != ''">
				and t.xmmc like '%'||trim(#{xmmc})||'%'
		</if>
		and t.xmbm in (
				select xmid from lxsh_lx where 1=1 
				<if test="gydw!='' and gydw!= null ">
				${gydw}
				</if>
				<if test="lxmc != null and  lxmc != ''">
					and lxmc like '%'||trim(#{lxmc})||'%'
				</if>
				<if test="lxbm != null and  lxbm != ''">
					and lxbm like '%'||trim(#{lxbm})||'%'
				</if>
				<if test="jsdj != null and  jsdj != ''">
					and xjsdj like '%'||trim(#{jsdj})||'%'
				</if>
				<if test="gldj != null and  gldj != ''">
						and lxbm like trim(#{gldj})||'%'
				</if>
				
			)
	</select>
	
	<select id="exportyhyb" parameterType="gcglabgc" resultType="elist">
		select 
		t.xmbm v_0,
		substr(t.xmbm,0,4) v_2,t.jhkgsj v_3,t.jhwgsj v_4,t.xmmc v_1,zj.ztz v_5,zj.btz v_6,0 v_7,0 v_8,'同意' v_9,#{tbyf} v_10,to_char(sysdate,'yyyy-mm-dd') v_11,#{tbr} v_12
		from JHSH_YHDZX t left join xmsq_yhdzx lxsh on t.xmbm=lxsh.xmbm left join (select count(*) sl, xmid xmbm from lxsh_lx where jdbs='2' group by xmid) s on t.xmbm=s.xmbm  left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t.xmbm=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t.xmbm=xdjh.jhid
			left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t.xmbm=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t.xmbm=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t.xmbm=bf.jhid
		    left join (select sum(xdzj) ztz,sum(btzzj) btz,sum(stz),xmid from plan_zjxd group by xmid) zj on t.xmbm=zj.xmid
			where 1=1 
		<!-- 	<if test="xdsj != null and  xdsj != ''">
			and xdjh.xdsj like '%'||trim(#{xdsj})||'%'
		</if> -->
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
		<if test="kgzt != null and  kgzt != ''">
				and t.kgzt like '%'||trim(#{kgzt})||'%'
		</if>
		<if test="jgzt != null and  jgzt != ''">
				and t.jgzt like '%'||trim(#{jgzt})||'%'
		</if>
		<if test="sbnf != null and  sbnf != ''">
				and xdjh.xdsj like '%'||trim(#{sbnf})||'%'
		</if>
		<if test="tsdq != null and  tsdq != ''">
				and lxsh.tsdq like '%'||trim(#{tsdq})||'%'
		</if>
		<if test="ljbfzt != null and  ljbfzt != ''">
				<if test="ljbfzt =='已全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
			</if>
			<if test="ljbfzt =='未全部拨付'">
				and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
			</if>
		</if>
		<if test="xmmc != null and  xmmc != ''">
				and t.xmmc like '%'||trim(#{xmmc})||'%'
		</if>
		and t.xmbm in (
				select xmid from lxsh_lx where 1=1 
				<if test="gydw!='' and gydw!= null ">
				${gydw}
				</if>
				<if test="lxmc != null and  lxmc != ''">
					and lxmc like '%'||trim(#{lxmc})||'%'
				</if>
				<if test="lxbm != null and  lxbm != ''">
					and lxbm like '%'||trim(#{lxbm})||'%'
				</if>
				<if test="jsdj != null and  jsdj != ''">
					and xjsdj like '%'||trim(#{jsdj})||'%'
				</if>
				<if test="gldj != null and  gldj != ''">
						and lxbm like trim(#{gldj})||'%'
				</if>
			)
	</select>
	
	<select id="exportzhyb" parameterType="gcglabgc" resultType="elist">
			select 
			t1.ID v_0,t3.gydw v_1,t3.xzqhmc v_2,t3.lxbm v_3,t3.lxmc v_4,t3.qdzh v_5,t3.zdzh v_6,t1.pfztz v_7,JHSYBZJE v_8,JHSYDFZCJE v_9,0 v_10,0 v_11,'同意' v_12,#{tbyf} v_13,to_char(sysdate,'yyyy-mm-dd') v_14,#{tbr} v_15
			from PLAN_ZHFZ t1 left join SCK_ZHFZ  t2 on t1.SCKID=t2.SCKID left join XMK_ZHFZ t3 on t2.xmkid=t3.id left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t1.id=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t1.id=xdjh.jhid
			left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t1.id=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t1.id=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t1.id=bf.jhid
	 	where t1.spzt='1' 
	 		<!-- <if test="xdsj != null and  xdsj != ''">
			and xdjh.xdsj like '%'||trim(#{xdsj})||'%'
		</if> -->
		<if test="lxbm != null and  lxbm != ''">
			and t3.lxbm like '%'||trim(#{lxbm})||'%'
		</if>
				<if test="xmnf != null and  xmnf != ''">
				and xdjh.xdsj like '%'||trim(#{xmnf})||'%'
			</if>
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
			<if test="ljbfzt != null and  ljbfzt != ''">
					<if test="ljbfzt =='已全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
				</if>
				<if test="ljbfzt =='未全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
				</if>
			</if>
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
			order by t1.sbnf
	</select>
	
	<select id="exportwqyb" parameterType="gcglabgc" resultType="elist">
			select 
			t1.id v_0,t3.gydw v_1,t3.xzqhmc v_2,t3.qlbh v_3,t3.qlmc v_4,t3.jsdj v_5,t3.qlzxzh v_6,t1.pfztz v_7,JHSYBZJE v_8,JHSYDFZCJE v_9,0 v_10,0 v_11,'同意' v_12,#{tbyf} v_13,to_char(sysdate,'yyyy-mm-dd') v_14,#{tbr} v_15
			from PLAN_WQGZ t1 left join SCK_WQGZ  t2 on t1.SCKID=t2.SCKID left join XMK_WQGZ t3 on t2.xmkid=t3.id left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t1.id=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t1.id=xdjh.jhid
		left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t1.id=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t1.id=xd.xmid
	    left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t1.id=bf.jhid
	 	where t1.spzt='1' 
				<if test="xmnf != null and  xmnf != ''">
				and xdjh.xdsj like '%'||trim(#{xmnf})||'%'
			</if>
			<if test="sfylrbwqk != null and  sfylrbwqk != ''">
					and t1.sfylrbwqk = #{sfylrbwqk}
			</if>
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="gydwtj != null and  gydwtj != ''">
					${gydwtj}
			</if>
			<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="qlmc != null and  qlmc != ''">
					and t3.qlmc like '%'||trim(#{qlmc})||'%'
			</if>
			<if test="qlbh != null and  qlbh != ''">
			and t3.qlbh like '%'||trim(#{qlbh})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
			<if test="ljbfzt != null and  ljbfzt != ''">
					<if test="ljbfzt =='已全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
				</if>
				<if test="ljbfzt =='未全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
				</if>
			</if>
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
			order by t1.sbnf
	</select>
	<!--  -->
	 <select id="exportAbyb1" parameterType="gcglabgc" resultType="elist">
	select * from (
		select m.*,rownum rn from (
			select 
			t1.id v_0,t3.gydw v_1,t3.xzqhmc v_2,t3.lxbm v_3,t3.lxmc v_4,t3.qdzh v_5,t3.zdzh v_6,t3.qzlc v_7,t3.yhlc v_8,t3.gjxjnd v_9,t1.id v_10
			from PLAN_ABGC t1 left join SCK_ABGC  t2 on t1.SCKID=t2.SCKID left join XMK_ABGC t3 on t2.xmkid=t3.id 
			where t1.spzt='1'
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			)m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
	</select>
	<select id="selectabgcxx" parameterType="gcglabgc" resultType="gcglabgc">
	select t1.jhnf sbnf,t1.jhkgsj,t1.jhwgsj,t1.sjdw,t1.sjpfdw,t1.pfwh,t1.pfsj,t1.pfztz,t1.JHSYBBZJE jhsybzje,t1.JHSYDFZCZJ jhsydfzcje,t1.sfsqablbz,t1.ablbzsqwh,t1.gkbglj,t1.gkbgmc,t1.sjsgtlj,t1.sjsgtmc,t1.REMARKS jhbz,t1.xdsj,t1.jhxdwh xdwh,t1.sjkgsj,t1.ID jhid,t1.id,
	t1.yjwgsj yjjgsj,t1.sgdw,t1.jldw,t1.jsdw,t1.gys,t1.htje,t1.sjwgsj,t1.kgzt,t1.jgzt,t1.wjgyy,t1.sgxkwj,t1.jgtcwj,t1.jgyswj,
	t3.gydw,t3.xzqhdm,t3.xzqhmc,t3.lxjsdj,t3.lxbm,t3.lxmc,t3.qdzh,t3.zdzh,t2.sczlc qzlc,t2.scyhlc yhlc,t3.gjxjnd,t3.yhnr,t3.xmnf,t3.xmtype,t3.bz,t3.tsdq,
	t2.tzgs,t2.spwh,t2.fapgdw,t2.fascdw,t2.faspsj,t2.jsxz,t2.jsnr,t2.scbz
	from PLAN_ABGC t1 left join SCK_ABGC  t2 on t1.SCKID=t2.SCKID left join XMK_ABGC t3 on t2.xmkid=t3.id 
	where t1.id=#{jhid}
	</select>
	<!-- 拨付情况列表 -->
	<select id="selectWqgzjhList1" parameterType="gcglabgc" resultType="gcglabgc">
		select * from (
		select m.*,rownum rn from (
		select 
		t1.jhnf sbnf,t1.jhkgsj,t1.jhwgsj,t1.sjdw,t1.sjpfdw,t1.pfwh,t1.pfsj,t1.pfztz,t1.JHSYBBZJE jhsybzje,t1.JHSYDFZCZJ jhsydfzcje,t1.sfsqablbz,t1.ablbzsqwh,t1.gkbglj,t1.gkbgmc,t1.sjsgtlj,t1.sjsgtmc,t1.REMARKS jhbz,t1.xdsj,t1.sjkgsj,t1.ID jhid,t1.id,
		t1.yjwgsj,t1.sgdw,t1.jldw,t1.jsdw,t1.gys,t1.htje,t1.sjwgsj,t1.kgzt,t1.jgzt,t1.wjgyy,t1.sgxkwj,t1.jgtcwj,t1.jgyswj,
		t3.gydw,t3.xzqhdm,t3.xzqhmc,t3.lxjsdj,t3.lxbm,t3.lxmc,t3.qdzh,t3.zdzh,t2.sczlc qzlc,t2.scyhlc yhlc,t3.gjxjnd,t3.yhnr,t3.xmnf,t3.xmtype,t3.bz,t3.tsdq,
		t2.tzgs,t2.spwh,t2.fapgdw,t2.fascdw,t2.faspsj,t2.jsxz,t2.jsnr,t2.scbz,nvl(xd.xdzj,0) xdzj,nvl(bf.bfzj,0) bfzj
		from PLAN_ABGC t1 left join SCK_ABGC  t2 on t1.SCKID=t2.SCKID left join XMK_ABGC t3 on t2.xmkid=t3.id left join 
		(select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t1.id=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t1.id=xdjh.jhid
		left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t1.id=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t1.id=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t1.id=bf.jhid
		where t1.spzt='1' 

		<if test="xmnf != null and  xmnf != ''">
			${xmnf}
		</if>
		<if test="lxbm != null and  lxbm != ''">
			and t3.lxbm like '%'||trim(#{lxbm})||'%'
		</if>
		
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
			<if test="ljbfzt != null and  ljbfzt != ''">
				<if test="ljbfzt =='已全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
				</if>
				<if test="ljbfzt =='未全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
				</if>
			</if>
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
			order by t1.jhnf
			) m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
	</select>
	<select id="selectafjhList1" parameterType="gcglabgc" resultType="gcglabgc">
		select * from (
		select m.*,rownum rn from (
		select 
		t1.*,t3.gydw,t3.xzqh xzqhmc,t3.lxbm,t3.lxmc,t3.qdzh,t3.zdzh,t3.czzlc qzlc,t3.yhlc,t3.xjgjnd gjxjnd,t1.id jhid,t1.jhxdwh xdwh,t1.jhsybbzje jhsybzje,nvl(xd.xdzj,0) xdzj,nvl(bf.bfzj,0) bfzj
		from PLAN_AF t1 left join SCK_Aqsmfh  t3 on t1.SCKID=t3.ID left join 
		(select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t1.id=c.jhid
		left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t1.id=xdjh.jhid
		left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t1.id=tb3.xmid
	    left join (select xmid,sum(xdzj) xdzj from plan_zjxd group by xmid) xd on t1.id=xd.xmid
    	left join (select jhid,sum(cgsdwzj+stz+yhdk+gz+sz) bfzj from gcgl_cgs group by jhid) bf on t1.id=bf.jhid
		where t1.spzt='1' 

		<if test="xmnf != null and  xmnf != ''">
			${xmnf}
		</if>
		<if test="lxbm != null and  lxbm != ''">
			and t3.lxbm like '%'||trim(#{lxbm})||'%'
		</if>
		
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
			<if test="ljbfzt != null and  ljbfzt != ''">
				<if test="ljbfzt =='已全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
				</if>
				<if test="ljbfzt =='未全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
				</if>
			</if>
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
			order by t1.jhnf
			) m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
	</select>
	
	 <select id="selectWqgzjhListcount1" parameterType="gcglabgc" resultType="int">
	 	select count(*) from PLAN_ABGC t1 left join SCK_ABGC  t2 on t1.SCKID=t2.SCKID left join XMK_ABGC t3 on t2.xmkid=t3.id 
	 	left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t1.id=xdjh.jhid
	 	left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t1.id=c.jhid
	 	left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t1.id=tb3.xmid
	 	where t1.spzt='1' 
			<if test="xmnf != null and  xmnf != ''">
				${xmnf}
			</if>
			<if test="lxbm != null and  lxbm != ''">
				and t3.lxbm like '%'||trim(#{lxbm})||'%'
			</if>
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
				<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
			<if test="ljbfzt != null and  ljbfzt != ''">
					<if test="ljbfzt =='已全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
				</if>
				<if test="ljbfzt =='未全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
				</if>
			</if>
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
	 </select>
	  <select id="selectafjhListcount1" parameterType="gcglabgc" resultType="int">
	 	select count(*) from PLAN_AF t1 left join SCK_Aqsmfh  t3 on t1.SCKID=t3.ID 
	 	left join (select xmid jhid,WMSYS.WM_CONCAT(xdnf) xdsj from plan_zjxd group by xmid) xdjh on t1.id=xdjh.jhid
	 	left join (select max(jhid) jhid,sum(t.cgsdwzj) cgsdwzj,max(tbyf) tbyf,max(tbsj) tbsj,max(tbr) tbr,sum(stz) stz,max(cscyj) cscyj,sum(yhdk) yhdk,sum(gz) gz,sum(sz) sz from gcgl_cgs t  where tbyf=#{tbyf} group by jhid,t.tbyf) c on t1.id=c.jhid
	 	left join (select 
	    (case when tb1.ztz&lt;=tb2.ztz then '已全部拨付'
	      else '未全部拨付' end) ljbfzt,tb1.xmid
	    from(select sum(pz.xdzj) ztz,xmid from plan_zjxd pz group by pz.xmid) tb1, 
	    (select sum(gc.cgsdwzj+gc.stz) ztz,jhid from gcgl_cgs gc group by gc.jhid) tb2
	    where tb1.xmid=tb2.jhid) tb3 on t1.id=tb3.xmid
	 	where t1.spzt='1' 
			<if test="xmnf != null and  xmnf != ''">
				${xmnf}
			</if>
			<if test="lxbm != null and  lxbm != ''">
				and t3.lxbm like '%'||trim(#{lxbm})||'%'
			</if>
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
				<if test="xzqhdm != null and  xzqhdm != ''">
					${xzqhdm}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and t1.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and t1.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and t3.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="jsdj != null and  jsdj != ''">
					and t3.lxjsdj like '%'||trim(#{jsdj})||'%'
			</if>
			<if test="gldj != null and  gldj != ''">
					and t3.lxbm like trim(#{gldj})||'%'
			</if>
			<if test="tsdq != null and  tsdq != ''">
					and t3.tsdq like '%'||trim(#{tsdq})||'%'
			</if>
			<if test="ljbfzt != null and  ljbfzt != ''">
					<if test="ljbfzt =='已全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%'
				</if>
				<if test="ljbfzt =='未全部拨付'">
					and tb3.ljbfzt like '%'||trim(#{ljbfzt})||'%' or tb3.ljbfzt is null
				</if>
			</if>
			<if test="tiaojian != null and  tiaojian != ''">
				<if test="tiaojian =='未拨付'">
					and c.tbyf is null
				</if>
				<if test="tiaojian =='已拨付'">
					and c.tbyf is not null
				</if>
			</if>
	 </select>
	 
	  <!-- 查询最进展大月份 -->
	 <select id="querymaxybyf" parameterType="gcglabgc" resultType="gcglabgc">
	 	select max(sbyf) sbyf from gcgl_abgc where jhid=#{jhid}
	 </select>
	 
	  <select id="dcabgcExcelhj" parameterType="gcglabgc" resultType="elist">
	 	select
      	decode(count(*),0,'','合计') v_1, sum(v_12) v_12,sum(v_18) v_18,sum(v_19) v_19,sum(v_26) v_26,sum(v_27) v_27,sum(v_28) v_28,sum(v_29) v_29,
		 sum(v_30) v_30,sum(v_31) v_31,sum(v_32) v_32,sum(v_33) v_33,sum(v_34) v_34,sum(v_36) v_36,sum(v_37) v_37
		from(
		select 
		rownum v_0,
		(select name from xtgl_xzqh where id=substr(xm.xzqhdm,0,4)||'00') v_1,
		decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='罗霄山脉连片特困地区'),null,'否','是') v_2,
		decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='38个省领导定点联系县'),null,'否','是') v_3,
		decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='原中央苏区'),null,'否','是') v_4,
		decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='国家贫困县'),null,'否','是') v_5,
		xm.xzqhdm v_6,xm.xzqhmc v_7,xm.lxbm v_8,xm.lxmc v_9,sc.scqdzh v_10,sc.sczdzh v_11,sc.scyhlc v_12,sc.jsxz v_13,
		pl.xdsj v_14,pl.jhkgsj v_15,pl.jhwgsj v_16,pl.yjwgsj v_17,pl.pfztz v_18,pl.jhsybbzje v_19,
		pl.sjkgsj v_20,pl.sjwgsj v_21,pl.jsdw v_22,pl.sjdw v_23,pl.sgdw v_24,pl.jldw v_25,
		gc.wcgl v_26,gc1.wcgl v_27,(gc.btz+gc.stz+gc.qttz) v_28,gc.btz v_29,gc.qttz v_30,(gc1.btz+gc1.stz+gc1.qttz) v_31,
		decode(ys.yssj,null,0,sc.scyhlc) v_32,
		zjxd.btz v_33,gc.btz1 v_34,decode(zjxd.btz,null,0,0,0,(decode(gc.btz1,null,0,(round(gc.btz1/zjxd.btz*100,0))))) v_35,
		zjxd.qttz v_36,gc.qttz1 v_37,decode(zjxd.qttz,null,0,0,0,(decode(gc.qttz1,null,0,(round(gc.qttz1/zjxd.qttz*100,0))))) v_38,
		pl.remarks v_39
		from plan_abgc pl,sck_abgc sc,xmk_abgc xm,gcgl_jgys ys,
		(select t.jhid,sum(t.wc_btz) btz,sum(t.wc_stz) stz,sum(t.wc_qttz) qttz,sum(t.zjdw_btz) btz1,sum(t.zjdw_stz) stz1,sum(t.zjdw_qttz) qttz1,sum(t.bywc_gl) wcgl from gcgl_abgc t group by t.jhid) gc,
		(select sum(btzzj) btz,sum(stz) stz,(sum(xdzj)-sum(btzzj)-sum(stz)) qttz,xmid from plan_zjxd group by xmid) zjxd,
		(select t.jhid,sum(t.wc_btz) btz,sum(t.wc_stz) stz,sum(t.wc_qttz) qttz,sum(t.bywc_gl) wcgl from gcgl_abgc t where substr(t.sbyf,0,4)=to_char(sysdate,'yyyy') group by t.jhid) gc1
		where pl.sckid=sc.sckid and sc.xmkid=xm.id and pl.id=gc.jhid(+) and pl.id=gc1.jhid(+) and pl.id=ys.jhid(+) and pl.id=zjxd.xmid(+)
		and pl.spzt='1'
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and pl.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and pl.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and xm.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="shzt != null and  shzt != ''">
					and ${tiaojian} like '%'||trim(#{shzt})||'%'
			</if>
			<if test="xmnf != null and  xmnf != ''">
					and pl.jhnf like '%'||trim(#{xmnf})||'%'
			</if>
		)
	 </select>
	 
	 <select id="dcafgcExcelhj" parameterType="gcglabgc" resultType="elist">
	 	select
      	decode(count(*),0,'','合计') v_1, sum(v_12) v_12,sum(v_18) v_18,sum(v_19) v_19,sum(v_26) v_26,sum(v_27) v_27,sum(v_28) v_28,sum(v_29) v_29,
		 sum(v_30) v_30,sum(v_31) v_31,sum(v_32) v_32,sum(v_33) v_33,sum(v_34) v_34,sum(v_36) v_36,sum(v_37) v_37
		from(
		select 
		rownum v_0,
		(select name from xtgl_xzqh where id=substr(xm.xzqhdm,0,4)||'00') v_1,
		decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='罗霄山脉连片特困地区'),null,'否','是') v_2,
		decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='38个省领导定点联系县'),null,'否','是') v_3,
		decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='原中央苏区'),null,'否','是') v_4,
		decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='国家贫困县'),null,'否','是') v_5,
		xm.xzqhdm v_6,xm.xzqh v_7,xm.lxbm v_8,xm.lxmc v_9,xm.qdzh v_10,xm.zdzh v_11,xm.yhlc v_12,xm.jsxz v_13,
		pl.xdsj v_14,pl.jhkgsj v_15,pl.jhwgsj v_16,pl.yjwgsj v_17,pl.pfztz v_18,pl.jhsybbzje v_19,
		pl.sjkgsj v_20,pl.sjwgsj v_21,pl.jsdw v_22,pl.sjdw v_23,pl.sgdw v_24,pl.jldw v_25,
		gc.wcgl v_26,gc1.wcgl v_27,(gc.btz+gc.stz+gc.qttz) v_28,gc.btz v_29,gc.qttz v_30,(gc1.btz+gc1.stz+gc1.qttz) v_31,
		decode(ys.yssj,null,0,xm.yhlc) v_32,
		zjxd.btz v_33,gc.btz1 v_34,decode(zjxd.btz,null,0,0,0,(decode(gc.btz1,null,0,(round(gc.btz1/zjxd.btz*100,0))))) v_35,
		zjxd.qttz v_36,gc.qttz1 v_37,decode(zjxd.qttz,null,0,0,0,(decode(gc.qttz1,null,0,(round(gc.qttz1/zjxd.qttz*100,0))))) v_38,
		pl.remarks v_39
		from plan_af pl,sck_aqsmfh xm,gcgl_jgys ys,
		(select t.jhid,sum(t.wc_btz) btz,sum(t.wc_stz) stz,sum(t.wc_qttz) qttz,sum(t.zjdw_btz) btz1,sum(t.zjdw_stz) stz1,sum(t.zjdw_qttz) qttz1,sum(t.bywc_gl) wcgl from gcgl_abgc t group by t.jhid) gc,
		(select sum(btzzj) btz,sum(stz) stz,(sum(xdzj)-sum(btzzj)-sum(stz)) qttz,xmid from plan_zjxd group by xmid) zjxd,
		(select t.jhid,sum(t.wc_btz) btz,sum(t.wc_stz) stz,sum(t.wc_qttz) qttz,sum(t.bywc_gl) wcgl from gcgl_abgc t where substr(t.sbyf,0,4)=to_char(sysdate,'yyyy') group by t.jhid) gc1
		where pl.sckid=xm.id and pl.id=gc.jhid(+) and pl.id=gc1.jhid(+) and pl.id=ys.jhid(+) and pl.id=zjxd.xmid(+)
		and pl.spzt='1'
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and pl.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and pl.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and xm.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="shzt != null and  shzt != ''">
					and ${tiaojian} like '%'||trim(#{shzt})||'%'
			</if>
			<if test="xmnf != null and  xmnf != ''">
					and pl.jhnf like '%'||trim(#{xmnf})||'%'
			</if>
		)
	 </select>
	 
	 <select id="dcabgcExcel" parameterType="gcglabgc" resultType="elist">
	 	select 
			rownum v_0,
			(select name from xtgl_xzqh where id=substr(xm.xzqhdm,0,4)||'00') v_1,
			decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='罗霄山脉连片特困地区'),null,'否','是') v_2,
			decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='38个省领导定点联系县'),null,'否','是') v_3,
			decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='原中央苏区'),null,'否','是') v_4,
			decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='国家贫困县'),null,'否','是') v_5,
			xm.xzqhdm v_6,xm.xzqhmc v_7,xm.lxbm v_8,xm.lxmc v_9,sc.scqdzh v_10,sc.sczdzh v_11,sc.scyhlc v_12,sc.jsxz v_13,
			pl.xdsj v_14,pl.jhkgsj v_15,pl.jhwgsj v_16,pl.yjwgsj v_17,pl.pfztz v_18,pl.jhsybbzje v_19,
			pl.sjkgsj v_20,pl.sjwgsj v_21,pl.jsdw v_22,pl.sjdw v_23,pl.sgdw v_24,pl.jldw v_25,
			gc.wcgl v_26,gc1.wcgl v_27,(gc.btz+gc.stz+gc.qttz) v_28,gc.btz v_29,gc.qttz v_30,(gc1.btz+gc1.stz+gc1.qttz) v_31,
			decode(ys.yssj,null,0,sc.scyhlc) v_32,
			zjxd.btz v_33,gc.btz1 v_34,decode(zjxd.btz,null,0,0,0,(decode(gc.btz1,null,0,(round(gc.btz1/zjxd.btz*100,0))))) v_35,
			zjxd.qttz v_36,gc.qttz1 v_37,decode(zjxd.qttz,null,0,0,0,(decode(gc.qttz1,null,0,(round(gc.qttz1/zjxd.qttz*100,0))))) v_38,
			pl.remarks v_39
			from plan_abgc pl,sck_abgc sc,xmk_abgc xm,gcgl_jgys ys,
			(select t.jhid,sum(t.wc_btz) btz,sum(t.wc_stz) stz,sum(t.wc_qttz) qttz,sum(t.zjdw_btz) btz1,sum(t.zjdw_stz) stz1,sum(t.zjdw_qttz) qttz1,sum(t.bywc_gl) wcgl from gcgl_abgc t group by t.jhid) gc,
			(select sum(btzzj) btz,sum(stz) stz,(sum(xdzj)-sum(btzzj)-sum(stz)) qttz,xmid from plan_zjxd group by xmid) zjxd,
			(select t.jhid,sum(t.wc_btz) btz,sum(t.wc_stz) stz,sum(t.wc_qttz) qttz,sum(t.bywc_gl) wcgl from gcgl_abgc t where substr(t.sbyf,0,4)=to_char(sysdate,'yyyy') group by t.jhid) gc1
			where pl.sckid=sc.sckid and sc.xmkid=xm.id and pl.id=gc.jhid(+) and pl.id=gc1.jhid(+) and pl.id=ys.jhid(+) and pl.id=zjxd.xmid(+)
			and pl.spzt='1'
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and pl.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and pl.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and xm.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="shzt != null and  shzt != ''">
					and ${tiaojian} like '%'||trim(#{shzt})||'%'
			</if>
			<if test="xmnf != null and  xmnf != ''">
					and pl.jhnf like '%'||trim(#{xmnf})||'%'
			</if>
	 </select>
	  <select id="dcafgcExcel" parameterType="gcglabgc" resultType="elist">
	 	select 
			rownum v_0,
			(select name from xtgl_xzqh where id=substr(xm.xzqhdm,0,4)||'00') v_1,
			decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='罗霄山脉连片特困地区'),null,'否','是') v_2,
			decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='38个省领导定点联系县'),null,'否','是') v_3,
			decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='原中央苏区'),null,'否','是') v_4,
			decode((select t1.name from xtgl_tsdq t1 left join xtgl_xzqhtsdq t2 on t1.id=t2.parent where t2.xzqhdm=xm.xzqhdm and t1.name='国家贫困县'),null,'否','是') v_5,
			xm.xzqhdm v_6,xm.xzqh v_7,xm.lxbm v_8,xm.lxmc v_9,xm.qdzh v_10,xm.zdzh v_11,xm.yhlc v_12,xm.jsxz v_13,
			pl.xdsj v_14,pl.jhkgsj v_15,pl.jhwgsj v_16,pl.yjwgsj v_17,pl.pfztz v_18,pl.jhsybbzje v_19,
			pl.sjkgsj v_20,pl.sjwgsj v_21,pl.jsdw v_22,pl.sjdw v_23,pl.sgdw v_24,pl.jldw v_25,
			gc.wcgl v_26,gc1.wcgl v_27,(gc.btz+gc.stz+gc.qttz) v_28,gc.btz v_29,gc.qttz v_30,(gc1.btz+gc1.stz+gc1.qttz) v_31,
			decode(ys.yssj,null,0,xm.yhlc) v_32,
			zjxd.btz v_33,gc.btz1 v_34,decode(zjxd.btz,null,0,0,0,(decode(gc.btz1,null,0,(round(gc.btz1/zjxd.btz*100,0))))) v_35,
			zjxd.qttz v_36,gc.qttz1 v_37,decode(zjxd.qttz,null,0,0,0,(decode(gc.qttz1,null,0,(round(gc.qttz1/zjxd.qttz*100,0))))) v_38,
			pl.remarks v_39
			from plan_af pl,sck_aqsmfh xm,gcgl_jgys ys,
			(select t.jhid,sum(t.wc_btz) btz,sum(t.wc_stz) stz,sum(t.wc_qttz) qttz,sum(t.zjdw_btz) btz1,sum(t.zjdw_stz) stz1,sum(t.zjdw_qttz) qttz1,sum(t.bywc_gl) wcgl from gcgl_abgc t group by t.jhid) gc,
			(select sum(btzzj) btz,sum(stz) stz,(sum(xdzj)-sum(btzzj)-sum(stz)) qttz,xmid from plan_zjxd group by xmid) zjxd,
			(select t.jhid,sum(t.wc_btz) btz,sum(t.wc_stz) stz,sum(t.wc_qttz) qttz,sum(t.bywc_gl) wcgl from gcgl_abgc t where substr(t.sbyf,0,4)=to_char(sysdate,'yyyy') group by t.jhid) gc1
			where pl.sckid=xm.id and pl.id=gc.jhid(+) and pl.id=gc1.jhid(+) and pl.id=ys.jhid(+) and pl.id=zjxd.xmid(+)
			and pl.spzt='1'
			<if test="gydw != null and  gydw != ''">
					${gydw}
			</if>
			<if test="kgzt != null and  kgzt != ''">
					and pl.kgzt like '%'||trim(#{kgzt})||'%'
			</if>
			<if test="jgzt != null and  jgzt != ''">
					and pl.jgzt like '%'||trim(#{jgzt})||'%'
			</if>
			<if test="lxmc != null and  lxmc != ''">
					and xm.lxmc like '%'||trim(#{lxmc})||'%'
			</if>
			<if test="shzt != null and  shzt != ''">
					and ${tiaojian} like '%'||trim(#{shzt})||'%'
			</if>
			<if test="xmnf != null and  xmnf != ''">
					and pl.jhnf like '%'||trim(#{xmnf})||'%'
			</if>
	 </select>
</mapper>