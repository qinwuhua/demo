<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.gcglaqyb">

	<select id="selectaqyblist" parameterType="gcglaqyb" resultType="gcglaqyb">
		select * from (
		select m.*,rownum rn from (
			select * from GCGL_AQGLYBB 
			where 1=1
			<if test="reportmonth != null and  reportmonth != ''">
			and reportmonth like '%'||trim(#{reportmonth})||'%'
			</if>
			<if test="filename != null and  filename != ''">
			and filename like '%'||trim(#{filename})||'%'
			</if>
			<if test="sendingunits != null and  sendingunits != ''">
			${sendingunits}
			</if>
		order by to_number(substr(reportmonth,0,4))desc,to_number(replace(reportmonth,'-','')) desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectaqyblistCount" parameterType="gcglaqyb" resultType="int">
		select count(*) from GCGL_AQGLYBB 
		where 1=1
		<if test="reportmonth != null and  reportmonth != ''">
			and reportmonth like '%'||trim(#{reportmonth})||'%'
		</if>
		<if test="filename != null and  filename != ''">
			and filename like '%'||trim(#{filename})||'%'
		</if>
		<if test="sendingunits != null and  sendingunits != ''">
			${sendingunits}
		</if>
	</select>
	<update id="insertAqybb" parameterType="gcglaqyb">
		update GCGL_AQGLYBB set sendingunits=#{sendingunits},uploadpeople=#{uploadpeople},uploadtime=#{uploadtime},filename=#{filename},uploadepartment=#{uploadepartment},remark=#{remark},wenhao=#{wenhao},reportmonth=#{reportmonth},uploadpath=#{uploadpath}
		where id=#{id}
	</update>
	<update id="insertAqybb1" parameterType="gcglaqyb">
		update GCGL_AQGLYBB set sendingunits=#{sendingunits},filename=#{filename},remark=#{remark},wenhao=#{wenhao},reportmonth=#{reportmonth}
		where id=#{id}
	</update>
	<insert id="uploadAqybFile" parameterType="gcglaqyb" >
		insert into GCGL_AQGLYBB(id,ybfile,xspath)
		values(#{id},#{ybfile},#{xspath})
	</insert>
	<insert id="uploadAqybFile1" parameterType="gcglaqyb" >
		update GCGL_AQGLYBB set ybfile=#{ybfile},xspath=#{xspath} where id=#{id}
	</insert>
	<select id="selAllBm3" parameterType="String" resultType="treenode">
	  select distinct x.id ,x.name text,parent ,'open' state from xtgl_department x where  id like '%36%' order by to_number(id)
	</select>	
	<select id="selectAqybById" parameterType="gcglaqyb" resultType="gcglaqyb">
	  select * from GCGL_AQGLYBB where id=#{id}
	</select>
	<delete id="deleteAqybb" parameterType="gcglaqyb">
		delete from GCGL_AQGLYBB where id=#{id}
	</delete>
	
	<insert id="uploadMbglFile" parameterType="gcglaqyb" >
		insert into GCGL_AQGLMBGL(id,ybfile,xspath)
		values(#{id},#{ybfile},#{xspath})
	</insert>
	<insert id="uploadMbglFile1" parameterType="gcglaqyb" >
		update GCGL_AQGLMBGL set ybfile=#{ybfile},xspath=#{xspath} where id=#{id}
	</insert>
	<update id="insertMbgl" parameterType="gcglaqyb">
		update GCGL_AQGLMBGL set sendingunits=#{sendingunits},uploadpeople=#{uploadpeople},uploadtime=#{uploadtime},filename=#{filename},uploadepartment=#{uploadepartment},remark=#{remark},wenhao=#{wenhao},reportmonth=#{reportmonth},uploadpath=#{uploadpath}
		where id=#{id}
	</update>
	<update id="insertMbgl1" parameterType="gcglaqyb">
		update GCGL_AQGLMBGL set sendingunits=#{sendingunits},uploadpeople=#{uploadpeople},uploadtime=#{uploadtime},filename=#{filename},uploadepartment=#{uploadepartment},remark=#{remark},wenhao=#{wenhao},reportmonth=#{reportmonth},uploadpath=#{uploadpath}
		where id=#{id}
	</update>
	<select id="selectmbgllist" parameterType="gcglaqyb" resultType="gcglaqyb">
		select * from (
		select m.*,rownum rn from (
			select * from GCGL_AQGLMBGL 
			where 1=1
			<if test="reportmonth != null and  reportmonth != ''">
			and reportmonth like '%'||trim(#{reportmonth})||'%'
			</if>
			<if test="filename != null and  filename != ''">
			and filename like '%'||trim(#{filename})||'%'
			</if>
		order by to_number(substr(reportmonth,0,4))desc,to_number(replace(reportmonth,'-','')) desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectmbgllistCount" parameterType="gcglaqyb" resultType="int">
		select count(*) from GCGL_AQGLMBGL 
		where 1=1
		<if test="uploadepartment != null and  uploadepartment != ''">
		and uploadepartment like '%'||trim(#{uploadepartment})||'%'
		</if>
		<if test="reportmonth != null and  reportmonth != ''">
		and reportmonth like '%'||trim(#{reportmonth})||'%'
		</if>
	</select>
	<select id="selectMbglById" parameterType="gcglaqyb" resultType="gcglaqyb">
	  select * from GCGL_AQGLMBGL where id=#{id}
	</select>
	<delete id="deleteMbgl" parameterType="gcglaqyb">
		delete from GCGL_AQGLMBGL where id=#{id}
	</delete>
	
	<insert id="uploadTzFile" parameterType="gcgltz" >
		insert into GCGL_MESSAGETJFILE(id,tzid,tzfile,filename)
		values(#{id},#{tzid},#{tzfile},#{filename})
	</insert>
	<insert id="insertTz" parameterType="gcgltz" >
		insert into GCGL_MESSAGETJ(id,reportper,title,contens,tjdepartmentcode,reportperuid,fsdwmc,reporttime)
		values(#{id},#{reportper},#{title},#{contens},#{tjdepartmentcode},#{reportperuid},#{fsdwmc},#{reporttime})
	</insert>
	<insert id="insertTz1" parameterType="gcgltz" >
		update GCGL_MESSAGETJ set title=#{title},contens=#{contens},tjdepartmentcode=#{tjdepartmentcode}
		where id=#{id}
	</insert>
	<delete id="deleteTzfile" parameterType="gcgltz">
		delete from GCGL_MESSAGETJFILE where id=#{id}
	</delete>
	<select id="queryTzbyId" parameterType="gcgltz" resultType="gcgltz">
		select * from GCGL_MESSAGETJ where id=#{id}
	</select>
	<delete id="deleteTzfile1" parameterType="gcgltz">
		delete from GCGL_MESSAGETJFILE where tzid=#{tzid}
	</delete>
		<select id="selectxxtzlist" parameterType="gcgltz" resultType="gcgltz">
		select * from (
		select m.*,rownum rn from (
			select * from GCGL_MESSAGETJ 
			where 1=1
			<if test="reportperuid != null and  reportperuid != ''">
			and reportperuid like '%'||trim(#{reportperuid})||'%'
			</if>
			<if test="kssj != null  and kssj != ''">
					and reporttime >= #{kssj}
			</if>
			<if test="jssj != null and jssj != ''">
					<![CDATA[and reporttime <= #{jssj}]]>
			</if>
		order by reporttime desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectxxtzlistCount" parameterType="gcgltz" resultType="int">
		select count(*) from GCGL_MESSAGETJ 
			where 1=1
			<if test="reportperuid != null and  reportperuid != ''">
			and reportperuid like '%'||trim(#{reportperuid})||'%'
			</if>
			<if test="kssj != null  and kssj != ''">
					and reporttime >= #{kssj}
			</if>
			<if test="jssj != null and jssj != ''">
					<![CDATA[and reporttime <= #{jssj}]]>
			</if>
	</select>
	<select id="selectTzfile" parameterType="gcgltz" resultType="gcgltz">
		select id,filename,tzid from GCGL_MESSAGETJFILE where tzid=#{tzid}
	</select>
	<delete id="deleteTzByid" parameterType="gcgltz">
		delete from GCGL_MESSAGETJ where id=#{id}
	</delete>
	<update id="updateTzfszt" parameterType="gcgltz">
		update GCGL_MESSAGETJ set fszt='已发送' where id=#{id}
	</update>
	<select id="insertTzck" parameterType="gcgltz">
		insert into GCGL_MESSAGECK( id,reporttime,reportper,title,contens,tjdepartmentcode,reportperuid,fsdwmc)
		values(#{id},#{reporttime},#{reportper},#{title},#{contens},#{tjdepartmentcode},#{reportperuid},#{fsdwmc})
	</select>
	
	<select id="selectxxtzlist1" parameterType="gcgltz" resultType="gcgltz">
		select * from (
		select m.*,rownum rn from (
			select * from GCGL_MESSAGECK 
			where 1=1
			<if test="tjdepartmentcode != null and  tjdepartmentcode != ''">
			and tjdepartmentcode like '%'||trim(#{tjdepartmentcode})||'%'
			</if>
			<if test="kssj != null  and kssj != ''">
					and reporttime >= #{kssj}
			</if>
			<if test="jssj != null and jssj != ''">
					<![CDATA[and reporttime <= #{jssj}]]>
			</if>
			<if test="ckzt != null and  ckzt != ''">
			and ckzt like '%'||trim(#{ckzt})||'%'
			</if>
		order by reporttime desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectxxtzlistCount1" parameterType="gcgltz" resultType="int">
		select count(*) from GCGL_MESSAGECK 
			where 1=1
			<if test="tjdepartmentcode != null and  tjdepartmentcode != ''">
			and tjdepartmentcode like '%'||trim(#{tjdepartmentcode})||'%'
			</if>
			<if test="kssj != null  and kssj != ''">
					and reporttime >= #{kssj}
			</if>
			<if test="jssj != null and jssj != ''">
					<![CDATA[and reporttime <= #{jssj}]]>
			</if>
			<if test="ckzt != null and  ckzt != ''">
			and ckzt like '%'||trim(#{ckzt})||'%'
			</if>
	</select>
		<delete id="deleteTzByid1" parameterType="gcgltz">
		delete from GCGL_MESSAGECK where id=#{id}
	</delete>
	<update id="xgTzzt" parameterType="gcgltz">
		update GCGL_MESSAGECK set ckzt='已查看' where id=#{id}
	</update>
	<select id="selectxxtzById" resultType="gcgltz" parameterType="gcgltz">
		select * from GCGL_MESSAGETJFILE where id=#{id}
	</select>
	<select id="selecttzbytzid" resultType="gcgltz" parameterType="gcgltz">
		select id,filename,tzid from GCGL_MESSAGETJFILE where tzid=#{tzid}
	</select>
	<select id="selAllXzqh1" parameterType="String" resultType="treenode">
	  select distinct x.id ,x.name text,parent ,'open' state from XTGL_XZQH x where  id like '%'||${value}||'%' order by to_number(id)
	</select>	
	<select id="selAllUnit1" parameterType="String" resultType="treenode">
	  select distinct x.id ,x.name text,parent ,'open' state from XTGL_DEPARTMENT x where  id like '%'||${value}||'%' order by to_number(id)
	</select>	
	
	
	
	<select id="selectmbgllist1" parameterType="gcglaqyb" resultType="gcglaqyb">
		select * from (
		select m.*,rownum rn from (
			select * from GCGL_AQGLMBGL 
			where 1=1
			<if test="reportmonth != null and  reportmonth != ''">
			and reportmonth like '%'||trim(#{reportmonth})||'%'
			</if>
			<if test="filename != null and  filename != ''">
			and filename like '%'||trim(#{filename})||'%'
			</if>
			<if test="sendingunits != null and  sendingunits != ''">
			and sendingunits like '%'||trim(#{sendingunits})||'%'
			</if>
		order by to_number(substr(reportmonth,0,4))desc,to_number(replace(reportmonth,'-','')) desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectmbgllistCount1" parameterType="gcglaqyb" resultType="int">
		select count(*) from GCGL_AQGLMBGL 
		where 1=1
		<if test="uploadepartment != null and  uploadepartment != ''">
		and uploadepartment like '%'||trim(#{uploadepartment})||'%'
		</if>
		<if test="reportmonth != null and  reportmonth != ''">
		and reportmonth like '%'||trim(#{reportmonth})||'%'
		</if>
		<if test="sendingunits != null and  sendingunits != ''">
		and sendingunits like '%'||trim(#{sendingunits})||'%'
		</if>
	</select>
	<insert id="insertSgxk" parameterType="gcgl_jgys">
 		insert into plan_upload(filename,filedata,parentid,filetype)
 		 values(#{filename},#{filedata},#{jhid},'施工许可')
 	</insert>
 	<insert id="insertJgtc" parameterType="gcgl_jgys">
 		insert into plan_upload(filename,filedata,parentid,filetype)
 		 values(#{filename},#{filedata},#{jhid},'交工通车')
 	</insert>
 	<insert id="insertWgys" parameterType="gcgl_jgys">
 		insert into plan_upload(filename,filedata,parentid,filetype)
 		 values(#{filename},#{filedata},#{jhid},'完工验收')
 	</insert>
 	
 	<insert id="insertJGYS" parameterType="gcgl_jgys">
 		insert into gcgl_jgys(id,yssj,ysdw,ysyj,jhid)
 		 values(sys_guid(),#{yssj},#{ysdw},#{ysyj},#{jhid})
 	</insert>
 	<insert id="insertJGYS1" parameterType="gcgl_jgys">
 		insert into gcgl_jgys(id,yssj,ysdw,ysyj,jhid,nsqsjjlzj)
 		 values(sys_guid(),#{yssj},#{ysdw},#{ysyj},#{jhid},#{nsqsjjlzj})
 	</insert>
 	<insert id="updateJGYS" parameterType="gcgl_jgys">
 		update gcgl_jgys set yssj=#{yssj},ysdw=#{ysdw},ysyj=#{ysyj}
 		<if test="nsqsjjlzj != null and nsqsjjlzj != ''">,nsqsjjlzj=#{nsqsjjlzj}</if>
 		where jhid=#{jhid}
 	</insert>
 	<select id="queryJGYS" parameterType="gcgl_jgys" resultType="gcgl_jgys">
 		select * from gcgl_jgys where jhid=#{jhid}
 	</select>
 	<select id="loadWqgzwgzp" parameterType="gcgl_jgys" resultType="plan_upload">
 		select * from PLAN_UPLOAD where 1=1 and parentid=#{id} and filetype=#{name}
 	</select>
</mapper>