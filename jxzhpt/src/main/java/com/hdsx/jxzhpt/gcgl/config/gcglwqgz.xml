<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.gcglwqgz">

	<select id="selectWqgzYbByJhid" parameterType="gcglwqgz" resultType="gcglwqgz">
		select * from (
		select m.*,rownum rn from (
			select t1.*,t2.tbr,t2.tbsj,t2.tbyf,t2.cgsdwzj from GCGL_WQGZ t1 left join GCGL_CGS t2 on t1.jhid=t2.jhid and t1.sbyf=t2.tbyf
			where 1=1
		<if test="jhid != null and  jhid != ''">
			and t1.jhid =#{jhid}
		</if>
		order by to_number(substr(sbyf,0,4))desc,to_number(replace(sbyf,'-','')) desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectWqgzYbByJhidCount" parameterType="gcglwqgz" resultType="int">
		select count(*) from GCGL_WQGZ 
		where 1=1
		<if test="jhid != null and  jhid != ''">
			and jhid =#{jhid}
		</if>
	</select>
	<!-- 添加月报 -->
	<insert id="insertWqgzYb" parameterType="gcglwqgz">
		insert into GCGL_WQGZ(id,jhid,wc_btz,wc_stz,wc_qttz,zjdw_btz,zjdw_stz,zjdw_qttz,bywcmc,kgdl,qksm,wcqk,sbsj,sbyf,shzt)
		values(sys_guid(),#{jhid},#{wc_btz},#{wc_stz},#{wc_qttz},#{zjdw_btz},#{zjdw_stz},#{zjdw_qttz},#{bywcmc},#{kgdl},#{qksm},#{wcqk},#{sbsj},#{sbyf},#{shzt})
	</insert>
	<select id="queryYbByYf" parameterType="gcglwqgz" resultType="gcglwqgz">
		select * from GCGL_WQGZ where sbyf=#{sbyf} and jhid=#{jhid}
	</select>
	<!-- 修改月报 -->
	<update id="updateWqgzYb" parameterType="gcglwqgz">
		update GCGL_WQGZ set wc_btz=#{wc_btz},wc_stz=#{wc_stz},wc_qttz=#{wc_qttz},zjdw_btz=#{zjdw_btz},zjdw_stz=#{zjdw_stz},zjdw_qttz=#{zjdw_qttz},bywcmc=#{bywcmc},kgdl=#{kgdl},qksm=#{qksm},wcqk=#{wcqk}
		where id=#{id} and jhid=#{jhid}
	</update>
	<!-- 删除月报 -->
	<delete id="deleteWqgzYb" parameterType="gcglwqgz">
		delete from GCGL_WQGZ where id=#{id}
	</delete>
	<!-- 审核月报 -->
	<update id="shwqgzyb" parameterType="gcglwqgz">
		update GCGL_WQGZ set shuser=#{shuser},shtime=#{shtime},zjje=#{zjje},xgcsyj=#{xgcsyj},cscyj=#{cscyj},shzt='已审核'
		where id=#{id} and jhid=#{jhid}
	</update>
	
	<!-- 添加车购税 -->
	<insert id="insertWqgzCgs" parameterType="gcglwqgz">
		insert into GCGL_CGS(id,jhid,cgsdwzj,tbr,tbyf,tbsj)
		values(sys_guid(),#{jhid},#{cgsdwzj},#{tbr},#{tbyf},#{tbsj})
	</insert>
	<select id="queryCGSByYf" parameterType="gcglwqgz" resultType="gcglwqgz">
		select * from GCGL_CGS where tbyf=#{tbyf} and jhid=#{jhid}
	</select>
	<!-- 查询cgs -->
	<select id="selectWqgzCgsList" parameterType="gcglwqgz" resultType="gcglwqgz">
		select * from (
		select m.*,rownum rn from (
			select t1.*,t2.sbsj,t2.sbyf from GCGL_CGS t1 left join GCGL_WQGZ t2 on t1.jhid=t2.jhid and t1.tbyf=t2.sbyf
			where 1=1
		<if test="jhid != null and  jhid != ''">
			and t1.jhid =#{jhid}
		</if>
		order by to_number(substr(tbyf,0,4))desc,to_number(replace(tbyf,'-','')) desc
		)  m
			where <![CDATA[rownum<=(#{page} * #{rows})]]>
		) 
			where RN>((#{page} - 1) * #{rows})
		
	</select>
	<select id="selectWqgzCgsListCount" parameterType="gcglwqgz" resultType="int">
		select count(*) from GCGL_CGS 
		where 1=1
		<if test="jhid != null and  jhid != ''">
			and jhid =#{jhid}
		</if>
	</select>
</mapper>