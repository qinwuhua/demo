<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.xmsq">
	<select id="queryYhdzxNextXmbm" resultType="string">
		select NVL(max(substr(c.xmbm,11)),4000)+1 from xmsq_yhdzx c where c.xmbm like #{xmnf}||#{xzqhdm}||'%'
	</select>
	<select id="queryShNextXmbm" resultType="string">
		select NVL(max(substr(c.xmbm,11)),5000)+1 from xmsq_sh c where c.xmbm like #{xmnf}||#{xzqhdm}||'%'
	</select>
	
	<select id="queryAutoList" parameterType="xmsq" resultType="lx">
		select x.lxbm,x.lxmc,x.qdzh,x.zdzh,x.qzlc lc,x.qdmc,x.zdmc,x.yjsdj xjsdj,x.ylmlx from (
		select * from table(funlmkd(#{ylxbh},#{xzqhdm})) order by lxbm,qdzh) x
	</select>
	<select id="queryLsjl" parameterType="java.util.Map" resultType="int">
		<![CDATA[
		select c1_x.CON1+c1_y.CON2 + c2_x.CON1+c2_y.CON2 + c3_x.CON1+c3_y.CON2 + c4_x.CON1+c4_y.CON2 + c5_x.CON1+c5_y.CON2 from
			(select count(lx.id) CON1 from lxsh_lx lx,jhsh_sjgz sj 
		       where lx.xmid=sj.xmbm and lx.jdbs='2' and lx.lxbm like #{lxbm}||'%'
		       and (((to_number(lx.zdzh) >= ${qdzh} and ${qdzh} >= to_number(lx.qdzh)) or 
		       (to_number(lx.zdzh) >= ${zdzh} and ${zdzh} >= to_number(lx.qdzh))) or
		       (to_number(lx.qdzh) = ${qdzh} or to_number(lx.zdzh) = ${zdzh}))
		       and to_number(substr(lx.xmid,0,4))<to_number(substr(#{xmbm},0,4))) c1_x,
		   	(select count(*) CON2 from 
		       (select lx.lxbm,lx.qdzh,lx.zdzh,lx.jdbs,lx.xmid from lxsh_lx lx,jhsh_sjgz sj where lx.xmid=sj.xmbm and jdbs='2') j,
		       (select ylxbm,yqdzh,yzdzh from xtgl_lxsj 
		       where xlxbm like #{lxbm}||'%' and ((to_number(xzdzh) >= ${qdzh} and ${qdzh} >= to_number(xqdzh)) or 
		       (to_number(xzdzh) >= ${zdzh} and ${zdzh} >= to_number(xqdzh))) or
		       (to_number(xqdzh) = ${qdzh} or to_number(xzdzh) = ${zdzh})) k
		       where j.lxbm=k.ylxbm and j.jdbs='2' and to_number(substr(j.xmid,0,4))<to_number(substr(#{xmbm},0,4)) 
		       and j.qdzh<k.yzdzh and j.zdzh>k.yqdzh) c1_y,
		       
		   	(select count(lx.id) CON1 from lxsh_lx lx,jhsh_lmgz sj 
		       where lx.xmid=sj.xmbm and lx.jdbs='2' and lx.lxbm like #{lxbm}||'%'
		       and (((to_number(lx.zdzh) >= ${qdzh} and ${qdzh} >= to_number(lx.qdzh)) or 
		       (to_number(lx.zdzh) >= ${zdzh} and ${zdzh} >= to_number(lx.qdzh))) or
		       (to_number(lx.qdzh) = ${qdzh} or to_number(lx.zdzh) = ${zdzh}))
		       and to_number(substr(lx.xmid,0,4))<to_number(substr(#{xmbm},0,4))) c2_x,
		   	(select count(*) CON2 from 
		       (select lx.lxbm,lx.qdzh,lx.zdzh,lx.jdbs,lx.xmid from lxsh_lx lx,jhsh_lmgz sj where lx.xmid=sj.xmbm and jdbs='2') j,
		       (select ylxbm,yqdzh,yzdzh from xtgl_lxsj 
		       where xlxbm like #{lxbm}||'%' and ((to_number(xzdzh) >= ${qdzh} and ${qdzh} >= to_number(xqdzh)) or 
		       (to_number(xzdzh) >= ${zdzh} and ${zdzh} >= to_number(xqdzh))) or
		       (to_number(xqdzh) = ${qdzh} or to_number(xzdzh) = ${zdzh})) k
		       where j.lxbm=k.ylxbm and j.jdbs='2' and to_number(substr(j.xmid,0,4))<to_number(substr(#{xmbm},0,4)) 
		       and j.qdzh<k.yzdzh and j.zdzh>k.yqdzh) c2_y,
		       
		   	(select count(lx.id) CON1 from lxsh_lx lx,jhsh_xj sj 
		       where lx.xmid=sj.xmbm and lx.jdbs='2' and lx.lxbm like #{lxbm}||'%'
		       and (((to_number(lx.zdzh) >= ${qdzh} and ${qdzh} >= to_number(lx.qdzh)) or 
		       (to_number(lx.zdzh) >= ${zdzh} and ${zdzh} >= to_number(lx.qdzh))) or
		       (to_number(lx.qdzh) = ${qdzh} or to_number(lx.zdzh) = ${zdzh}))
		       and to_number(substr(lx.xmid,0,4))<to_number(substr(#{xmbm},0,4))) c3_x,
		   	(select count(*) CON2 from 
		       (select lx.lxbm,lx.qdzh,lx.zdzh,lx.jdbs,lx.xmid from lxsh_lx lx,jhsh_xj sj where lx.xmid=sj.xmbm and jdbs='2') j,
		       (select ylxbm,yqdzh,yzdzh from xtgl_lxsj 
		       where xlxbm like #{lxbm}||'%' and ((to_number(xzdzh) >= ${qdzh} and ${qdzh} >= to_number(xqdzh)) or 
		       (to_number(xzdzh) >= ${zdzh} and ${zdzh} >= to_number(xqdzh))) or
		       (to_number(xqdzh) = ${qdzh} or to_number(xzdzh) = ${zdzh})) k
		       where j.lxbm=k.ylxbm and j.jdbs='2' and to_number(substr(j.xmid,0,4))<to_number(substr(#{xmbm},0,4)) 
		       and j.qdzh<k.yzdzh and j.zdzh>k.yqdzh) c3_y,
		       
		   	(select count(lx.id) CON1 from lxsh_lx lx,jhsh_yhdzx sj 
		       where lx.xmid=sj.xmbm and lx.jdbs='2' and lx.lxbm like #{lxbm}||'%'
		       and (((to_number(lx.zdzh) >= ${qdzh} and ${qdzh} >= to_number(lx.qdzh)) or 
		       (to_number(lx.zdzh) >= ${zdzh} and ${zdzh} >= to_number(lx.qdzh))) or
		       (to_number(lx.qdzh) = ${qdzh} or to_number(lx.zdzh) = ${zdzh}))
		       and to_number(substr(lx.xmid,0,4))<to_number(substr(#{xmbm},0,4))) c4_x,
		   	(select count(*) CON2 from 
		       (select lx.lxbm,lx.qdzh,lx.zdzh,lx.jdbs,lx.xmid from lxsh_lx lx,jhsh_yhdzx sj where lx.xmid=sj.xmbm and jdbs='2') j,
		       (select ylxbm,yqdzh,yzdzh from xtgl_lxsj 
		       where xlxbm like #{lxbm}||'%' and ((to_number(xzdzh) >= ${qdzh} and ${qdzh} >= to_number(xqdzh)) or 
		       (to_number(xzdzh) >= ${zdzh} and ${zdzh} >= to_number(xqdzh))) or
		       (to_number(xqdzh) = ${qdzh} or to_number(xzdzh) = ${zdzh})) k
		       where j.lxbm=k.ylxbm and j.jdbs='2' and to_number(substr(j.xmid,0,4))<to_number(substr(#{xmbm},0,4)) 
		       and j.qdzh<k.yzdzh and j.zdzh>k.yqdzh) c4_y,
		       
		   	(select count(lx.id) CON1 from lxsh_lx lx,jhsh_sh sj 
		       where lx.xmid=sj.xmbm and lx.jdbs='2' and lx.lxbm like #{lxbm}||'%'
		       and (((to_number(lx.zdzh) >= ${qdzh} and ${qdzh} >= to_number(lx.qdzh)) or 
		       (to_number(lx.zdzh) >= ${zdzh} and ${zdzh} >= to_number(lx.qdzh))) or
		       (to_number(lx.qdzh) = ${qdzh} or to_number(lx.zdzh) = ${zdzh}))
		       and to_number(substr(lx.xmid,0,4))<to_number(substr(#{xmbm},0,4))) c5_x,
		   	(select count(*) CON2 from 
		       (select lx.lxbm,lx.qdzh,lx.zdzh,lx.jdbs,lx.xmid from lxsh_lx lx,jhsh_sh sj where lx.xmid=sj.xmbm and jdbs='2') j,
		       (select ylxbm,yqdzh,yzdzh from xtgl_lxsj 
		       where xlxbm like #{lxbm}||'%' and ((to_number(xzdzh) >= ${qdzh} and ${qdzh} >= to_number(xqdzh)) or 
		       (to_number(xzdzh) >= ${zdzh} and ${zdzh} >= to_number(xqdzh))) or
		       (to_number(xqdzh) = ${qdzh} or to_number(xzdzh) = ${zdzh})) k
		       where j.lxbm=k.ylxbm and j.jdbs='2' and to_number(substr(j.xmid,0,4))<to_number(substr(#{xmbm},0,4)) 
		       and j.qdzh<k.yzdzh and j.zdzh>k.yqdzh) c5_y
		]]>
	</select>
	<select id="queryTsdq" parameterType="xmsq" resultType="string">
		<![CDATA[SELECT DISTINCT X.NAME FROM XTGL_XZQHTSDQ T,XTGL_TSDQ X WHERE T.XZQHDM IN(
		select distinct substr(roadcode,-6) from gpsroad where substr(roadcode,1,length(roadcode)-6) =#{ylxbh}
		AND ROADSTART<=${zdzh} AND ROADENDS>=${qdzh}) AND X.ID=T.PARENT  AND X.NAME NOT LIKE '省直管试点县']]> 
	</select>
	
	<insert id="insertXmsqYhdzx" parameterType="java.util.List">
		insert into xmsq_yhdzx (
		<if test="xmbm!=null">xmbm</if>
		<if test="xmmc!=null">,xmmc</if>
		<if test="gcfl!=null">,gcfl</if>
		<if test="ghlxbh!=null">,ghlxbh</if>
		<if test="ylxbh!=null">,ylxbh</if>
		<if test="xzqh!=null">,xzqh</if>
		<if test="xzqhdm!=null">,xzqhdm</if>
		<if test="qdzh!=null">,qdzh</if>
		<if test="zdzh!=null">,zdzh</if>
		<if test="lc!=null">,lc</if>
		<if test="lmkd!=null">,lmkd</if>
		<if test="jsdj!=null">,jsdj</if>
		<if test="ntz!=null">,ntz</if>
		<if test="jhkgsj!=null">,jhkgsj</if>
		<if test="jhwgsj!=null">,jhwgsj</if>
		<if test="gq!=null">,gq</if>
		<if test="tsdq!=null">,TSDQ</if>
		<if test="gydw!=null">,gydw</if>
		<if test="gydwdm!=null">,gydwdm</if>
		<if test="jsfa!=null">,JSFA</if>
		<if test="lsjl!=null">,LSJL</if>
		<if test="qdmc!=null">,qdmc</if>
		<if test="zdmc!=null">,zdmc</if>
		<if test="lxmc!=null">,lxmc</if>
		<if test="bz!=null">,bz</if>) 
		values (
		<if test="xmbm!=null">#{xmbm}</if>
		<if test="xmmc!=null">,#{xmmc}</if>
		<if test="gcfl!=null">,#{gcfl}</if>
		<if test="ghlxbh!=null">,#{ghlxbh}</if>
		<if test="ylxbh!=null">,#{ylxbh}</if>
		<if test="xzqh!=null">,#{xzqh}</if>
		<if test="xzqhdm!=null">,#{xzqhdm}</if>
		<if test="qdzh!=null">,#{qdzh}</if>
		<if test="zdzh!=null">,#{zdzh}</if>
		<if test="lc!=null">,#{lc}</if>
		<if test="lmkd!=null">,#{lmkd}</if>
		<if test="jsdj!=null">,#{jsdj}</if>
		<if test="ntz!=null">,#{ntz}</if>
		<if test="jhkgsj!=null">,#{jhkgsj}</if>
		<if test="jhwgsj!=null">,#{jhwgsj}</if>
		<if test="gq!=null">,#{gq}</if>
		<if test="tsdq!=null">,#{tsdq}</if>
		<if test="gydw!=null">,#{gydw}</if>
		<if test="gydwdm!=null">,#{gydwdm}</if>
		<if test="jsfa!=null">,#{jsfa}</if>
		<if test="lsjl!=null">,#{lsjl}</if>
		<if test="qdmc!=null">,#{qdmc}</if>
		<if test="zdmc!=null">,#{zdmc}</if>
		<if test="lxmc!=null">,#{lxmc}</if>
		<if test="bz!=null">,#{bz}</if>)
	</insert>
	<insert id="insertXmsqSh" parameterType="java.util.List">
		insert into xmsq_sh (
		<if test="xmbm!=null">xmbm</if>
		<if test="xmmc!=null">,xmmc</if>
		<if test="gcfl!=null">,gcfl</if>
		<if test="ghlxbh!=null">,ghlxbh</if>
		<if test="ylxbh!=null">,ylxbh</if>
		<if test="xzqh!=null">,xzqh</if>
		<if test="xzqhdm!=null">,xzqhdm</if>
		<if test="qdzh!=null">,qdzh</if>
		<if test="zdzh!=null">,zdzh</if>
		<if test="lc!=null">,lc</if>
		<if test="lmkd!=null">,lmkd</if>
		<if test="jsdj!=null">,jsdj</if>
		<if test="ntz!=null">,ntz</if>
		<if test="jhkgsj!=null">,jhkgsj</if>
		<if test="jhwgsj!=null">,jhwgsj</if>
		<if test="gq!=null">,gq</if>
		<if test="tsdq!=null">,TSDQ</if>
		<if test="gydw!=null">,gydw</if>
		<if test="gydwdm!=null">,gydwdm</if>
		<if test="jsfa!=null">,JSFA</if>
		<if test="lsjl!=null">,LSJL</if>
		<if test="qdmc!=null">,qdmc</if>
		<if test="zdmc!=null">,zdmc</if>
		<if test="lxmc!=null">,lxmc</if>) 
		values (
		<if test="xmbm!=null">#{xmbm}</if>
		<if test="xmmc!=null">,#{xmmc}</if>
		<if test="gcfl!=null">,#{gcfl}</if>
		<if test="ghlxbh!=null">,#{ghlxbh}</if>
		<if test="ylxbh!=null">,#{ylxbh}</if>
		<if test="xzqh!=null">,#{xzqh}</if>
		<if test="xzqhdm!=null">,#{xzqhdm}</if>
		<if test="qdzh!=null">,#{qdzh}</if>
		<if test="zdzh!=null">,#{zdzh}</if>
		<if test="lc!=null">,#{lc}</if>
		<if test="lmkd!=null">,#{lmkd}</if>
		<if test="jsdj!=null">,#{jsdj}</if>
		<if test="ntz!=null">,#{ntz}</if>
		<if test="jhkgsj!=null">,#{jhkgsj}</if>
		<if test="jhwgsj!=null">,#{jhwgsj}</if>
		<if test="gq!=null">,#{gq}</if>
		<if test="tsdq!=null">,#{tsdq}</if>
		<if test="gydw!=null">,#{gydw}</if>
		<if test="gydwdm!=null">,#{gydwdm}</if>
		<if test="jsfa!=null">,#{jsfa}</if>
		<if test="lsjl!=null">,#{lsjl}</if>
		<if test="qdmc!=null">,#{qdmc}</if>
		<if test="zdmc!=null">,#{zdmc}</if>
		<if test="lxmc!=null">,#{lxmc}</if>)
	</insert>
	<insert id="insertLx" parameterType="lx">
		insert into lxsh_lx (
		<if test="xmid!=null">xmid</if><if test="lxbm!=null">,lxbm</if><if test="lxmc!=null">,lxmc</if>
		<if test="xzqh!=null">,xzqh</if><if test="xzqhdm!=null">,xzqhdm</if><if test="gydw!=null">,gydw</if>
		<if test="gydwdm!=null">,gydwdm</if><if test="qdzh!=null">,qdzh</if><if test="zdzh!=null">,zdzh</if>
		<if test="jsjsdj!=null">,jsjsdj</if><if test="lc!=null">,lc</if><if test="xjsdj!=null">,xjsdj</if>
		<if test="jsxz!=null">,jsxz</if><if test="qdmc!=null">,qdmc</if><if test="zdmc!=null">,zdmc</if>
		<if test="bzcs!=null">,bzcs</if><if test="sffirst!=null">,sffirst</if><if test="jdbs!=null">,jdbs</if>
		<if test="gpsqdzh!=null and gpsqdzh!=''">,gpsqdzh</if><if test="gpszdzh!=null and gpszdzh!=''">,gpszdzh</if><if test="jsfa!=null and jsfa!=''">,jsfa</if>
		<if test="yilc!=null">,yilc</if><if test="erlc!=null">,erlc</if><if test="sanlc!=null">,sanlc</if>
		<if test="silc!=null">,silc</if><if test="dwlc!=null">,dwlc</if><if test="wllc!=null">,wllc</if>)
		values(<if test="xmid!=null">#{xmid}</if><if test="lxbm!=null">,#{lxbm}</if><if test="lxmc!=null">,#{lxmc}</if>
		<if test="xzqh!=null">,#{xzqh}</if><if test="xzqhdm!=null">,#{xzqhdm}</if><if test="gydw!=null">,#{gydw}</if>
		<if test="gydwdm!=null">,#{gydwdm}</if><if test="qdzh!=null">,#{qdzh}</if><if test="zdzh!=null">,#{zdzh}</if>
		<if test="jsjsdj!=null">,#{jsjsdj}</if><if test="lc!=null">,#{lc}</if><if test="xjsdj!=null">,#{xjsdj}</if>
		<if test="jsxz!=null">,#{jsxz}</if><if test="qdmc!=null">,#{qdmc}</if><if test="zdmc!=null">,#{zdmc}</if>
		<if test="bzcs!=null">,#{bzcs}</if><if test="sffirst!=null">,#{sffirst}</if><if test="jdbs!=null">,#{jdbs}</if>
		<if test="gpsqdzh!=null and gpsqdzh!=''">,#{gpsqdzh}</if><if test="gpszdzh!=null and gpszdzh!=''">,#{gpszdzh}</if><if test="jsfa!=null and jsfa!=''">,#{jsfa}</if>
		<if test="yilc!=null">,#{yilc}</if><if test="erlc!=null">,#{erlc}</if><if test="sanlc!=null">,#{sanlc}</if>
		<if test="silc!=null">,#{silc}</if><if test="dwlc!=null">,#{dwlc}</if><if test="wllc!=null">,#{wllc}</if>)
	</insert>
	<delete id="deleteLxByXmbm" parameterType="xmsq">
		delete from lxsh_lx where xmid=#{xmbm}
	</delete>
	
	<select id="queryYhdzxXmsq" parameterType="xmsq" resultType="xmsq">
		select * from (
			select rownum num,t.* from (
				select x.xmbm, x.gcfl, x.ghlxbh, x.ylxbh, x.xzqh, x.xzqhdm, lmkd, jsdj, ntz, jhkgsj, jhwgsj, gq, tsdq, 
				x.gydw, x.gydwdm, x.jsfa, lsjl, sqzt, xmmc, l.qdzh, l.zdzh, l.qdmc, l.zdmc, l.lxmc, bz,x.lc ,sl.xmsl
				from xmsq_yhdzx x left join lxsh_lx l on x.xmbm=l.xmid 
				left join (select xmid,count(xmid) xmsl from lxsh_lx where jdbs='1' 
				<if test="xmsq.ghlxmc!='' and xmsq.ghlxmc!= null ">
					and ghlxmc=#{xmsq.ghlxmc}
				</if>
				<if test="xmsq.ghlxbm!='' and xmsq.ghlxbm!= null ">
					and ghlxbm=#{xmsq.ghlxbm}
				</if>group by xmid) sl on x.xmbm=sl.xmid
				where l.jdbs='1' and l.sffirst='1' 
				<if test="xmsq.gydwdm!=null and xmsq.gydwdm!=''">and ${xmsq.gydwdm}</if>
				<if test="xmsq.xzqhdm!=null and xmsq.xzqhdm!=''">and ${xmsq.xzqhdm}</if>
				<if test="xmsq.xmmc!=null and xmsq.xmmc!=''">and xmmc like '%'||#{xmsq.xmmc}||'%'</if>
				<if test="xmsq.jsdj!=null and xmsq.jsdj!=''">and ${xmsq.jsdj}</if>
				<if test="xmsq.sqzt>=0">and sqzt=${xmsq.sqzt}</if>
				<if test="xmsq.xmbm!=null and xmsq.xmbm!=''">and ${xmsq.xmbm}</if>
				<if test="xmsq.gcfl!=null and xmsq.gcfl!=''">and ${xmsq.gcfl}</if>
				<if test="xmsq.tsdq!=null and xmsq.tsdq!=''">${xmsq.tsdq}</if>
				<if test="xmsq.lsjl!=null and xmsq.lsjl!=''">and x.lsjl=#{xmsq.lsjl}</if>
				<if test="xmsq.wnxmk!=null and xmsq.wnxmk!=''">and x.wnxmk=#{xmsq.wnxmk}</if>
				<if test="xmsq.jsxz!=null and xmsq.jsxz!=''">and x.jsxz=#{xmsq.jsxz}</if>
				<if test="xmsq.ylxbh!=null and xmsq.ylxbh!=''">
					and x.xmbm in (select xmid from lxsh_lx lx where ${xmsq.ylxbh} and xmid like '%4___')
				</if>
				
				<if test="xmsq.ghlxbh!=null and xmsq.ghlxbh!=''">
					and x.xmbm in (select distinct xmid from lxsh_lx lx where lx.lxbm like '%'||#{xmsq.ghlxbh}||'%')
				</if>
				<if test="xmsq.lxmc !='' and xmsq.lxmc != null ">
					and lxmc like '%'||#{xmsq.lxmc}||'%'
				</if>
				order by x.sqzt desc,x.xmbm desc) t ) t2
		<if test="page!=null and page!='' and page!=0">
			where <![CDATA[ num>(${page}-1)*${rows} and num<=${page}*${rows}]]>
		</if>
	</select>
	<select id="queryShXmsq" parameterType="xmsq" resultType="xmsq">
		select * from (
			select rownum num,t.* from (
				select x.xmbm, x.gcfl, x.ghlxbh, x.ylxbh, x.xzqh, x.xzqhdm, lmkd, jsdj, ntz, jhkgsj, jhwgsj, gq, tsdq, 
				x.gydw, x.gydwdm, x.jsfa, lsjl, sqzt, xmmc, l.qdzh, l.zdzh, l.qdmc, l.zdmc, l.lxmc, bz,x.lc ,sl.xmsl
				from xmsq_sh x left join lxsh_lx l on x.xmbm=l.xmid 
				left join (select xmid,count(xmid) xmsl from lxsh_lx where jdbs='1' group by xmid) sl on x.xmbm=sl.xmid
				where l.jdbs='1' and l.sffirst='1' 
				<if test="xmsq.gydwdm!=null and xmsq.gydwdm!=''">
					and ${xmsq.gydwdm}
				</if>
				<if test="xmsq.xzqhdm!=null and xmsq.xzqhdm!=''">
					and ${xmsq.xzqhdm}
				</if>
				<if test="xmsq.xmmc!=null and xmsq.xmmc!=''">
					and xmmc like '%'||#{xmsq.xmmc}||'%'
				</if>
				<if test="xmsq.jsdj!=null and xmsq.jsdj!=''">
					and ${xmsq.jsdj}
				</if>
				<if test="xmsq.sqzt>=0">
					and sqzt=${xmsq.sqzt}
				</if>
				<if test="xmsq.xmbm!=null and xmsq.xmbm!=''">
					and ${xmsq.xmbm}
				</if>
				<if test="xmsq.gcfl!=null and xmsq.gcfl!=''">
					and ${xmsq.gcfl}
				</if>
				<if test="xmsq.tsdq!=null and xmsq.tsdq!=''">
					${xmsq.tsdq}
				</if>
				<if test="xmsq.lsjl!=null and xmsq.lsjl!=''">
					and x.lsjl=#{xmsq.lsjl}
				</if>
				<if test="xmsq.ylxbh!=null and xmsq.ylxbh!=''">
					and x.xmbm in (select xmid from lxsh_lx lx where ${xmsq.ylxbh} and xmid like '%5___')
				</if>
				<if test="xmsq.ghlxbh!=null and xmsq.ghlxbh!=''">
					and x.xmbm in (select distinct xmid from lxsh_lx lx where lx.lxbm like '%'||#{xmsq.ghlxbh}||'%')
				</if>
				<if test="xmsq.lxmc !='' and xmsq.lxmc != null ">
					and lxmc like '%'||#{xmsq.lxmc}||'%'
				</if>
				<if test="ghlxmc!='' and ghlxmc!= null ">
					and ghlxmc=#{ghlxmc}
				</if>
				<if test="ghlxbm!='' and ghlxbm!= null ">
					and ghlxbm=#{ghlxbm}
				</if>
				order by x.sqzt desc,x.xmbm desc) t ) t2
		<if test="page!=null and page!='' and page!=0">
			where <![CDATA[ num>(${page}-1)*${rows} and num<=${page}*${rows}]]>
		</if>
	</select>
	
	<select id="queryYhdzxCount" parameterType="xmsq" resultType="int">
		select count(x.xmbm) from xmsq_yhdzx x where 1=1
		<if test="gydwdm!=null and gydwdm!=''">
			and ${gydwdm}
		</if>
		<if test="xzqhdm!=null and xzqhdm!=''">
			and ${xzqhdm}
		</if>
		<if test="xmmc!=null and xmmc!=''">
			and xmmc like '%'||#{xmmc}||'%'
		</if>
		<if test="jsdj!=null and jsdj!=''">
			and ${jsdj}
		</if>
		<if test="sqzt>=0">
			and sqzt=${sqzt}
		</if>
		<if test="xmbm!=null and xmbm!=''">
			and ${xmbm}
		</if>
		<if test="gcfl!=null and gcfl!=''">
			and ${gcfl}
		</if>
		<if test="tsdq!=null and tsdq!=''">
			${tsdq}
		</if>
		<if test="lsjl!=null and lsjl!=''">
			and x.lsjl=#{lsjl}
		</if>
		<if test="ylxbh!=null and ylxbh!=''">
			and x.xmbm in (select xmid from lxsh_lx lx where ${ylxbh} and xmid like '%4___')
		</if>
		<if test="ghlxbh!=null and ghlxbh!=''">
			and xmbm in (select distinct xmid from lxsh_lx lx where lx.lxbm like '%'||#{ghlxbh}||'%')
		</if>
		<if test="lxmc !='' and lxmc != null ">
			and lxmc like '%'||#{lxmc}||'%'
		</if>
	</select>
	<select id="queryShCount" parameterType="xmsq" resultType="int">
		select count(x.xmbm) from xmsq_sh x 
		<!-- left join lxsh_lx l on x.xmbm=l.xmid -->
		<!-- select count(*)
		from (select xmbm,ntz from xmsq_sh x 
		        left join (select xmid
		from lxsh_lx where  xmid like '%5___' 
		<if test="ghlxmc!='' and ghlxmc!= null ">
			and l.ghlxmc=#{ghlxmc}
		</if>
		<if test="ghlxbm!='' and ghlxbm!= null ">
			and l.ghlxbm=#{ghlxbm}
		</if>
		 group by xmid) l 
					on x.xmbm=l.xmid ) c -->
		where 1=1
		<if test="gydwdm!=null and gydwdm!=''">
			and ${gydwdm}
		</if>
		<if test="xzqhdm!=null and xzqhdm!=''">
			and ${xzqhdm}
		</if>
		<if test="xmmc!=null and xmmc!=''">
			and xmmc like '%'||#{xmmc}||'%'
		</if>
		<if test="jsdj!=null and jsdj!=''">
			and ${jsdj}
		</if>
		<if test="sqzt>=0">
			and sqzt=${sqzt}
		</if>
		<if test="xmbm!=null and xmbm!=''">
			and ${xmbm}
		</if>
		<if test="gcfl!=null and gcfl!=''">
			and ${gcfl}
		</if>
		<if test="tsdq!=null and tsdq!=''">
			${tsdq}
		</if>
		<if test="lsjl!=null and lsjl!=''">
			and x.lsjl=#{lsjl}
		</if>
		<if test="ylxbh!=null and ylxbh!=''">
			and x.xmbm in (select xmid from lxsh_lx lx where ${ylxbh} and xmid like '%5___')
		</if>
		<if test="ghlxbh!=null and ghlxbh!=''">
			and xmbm in (select distinct xmid from lxsh_lx lx where lx.lxbm like '%'||#{ghlxbh}||'%')
		</if>
		<if test="lxmc !='' and lxmc != null ">
			and lxmc like '%'||#{lxmc}||'%'
		</if>
		
	</select>
	
	<delete id="deleteYhdzxByXmbm" parameterType="xmsq">
		delete from xmsq_yhdzx where xmbm=#{xmbm}
	</delete>
	<delete id="deleteShByXmbm" parameterType="xmsq">
		delete from xmsq_sh where xmbm=#{xmbm}
	</delete>
	
	<update id="updateYhdzxSqzt" parameterType="xmsq">
		update xmsq_yhdzx set sqzt=${sqzt} where xmbm=#{xmbm}
	</update>
	<update id="updateShSqzt" parameterType="xmsq">
		update xmsq_sh set sqzt=${sqzt} where xmbm=#{xmbm}
	</update>
	
	<insert id="insertJhshYhdzx" parameterType="xmsq">
		insert into jhsh_yhdzx (xmbm,xmmc,ylxbh,ghlxbh,gcfl,xzqh,xzqhdm,qdzh,zdzh,lc,jhkgsj,jhwgsj)
		select x.xmbm,x.xmmc,x.ylxbh,x.ghlxbh,x.gcfl,x.xzqh,x.xzqhdm,x.qdzh,x.zdzh,x.lc,x.jhkgsj,x.jhwgsj from xmsq_yhdzx x
		where x.xmbm in (${xmbm})
	</insert>
	<insert id="insertJhshSh" parameterType="xmsq">
		insert into jhsh_sh (xmbm,xmmc,ylxbh,ghlxbh,gcfl,xzqh,xzqhdm,qdzh,zdzh,lc,jhkgsj,jhwgsj)
		select x.xmbm,x.xmmc,x.ylxbh,x.ghlxbh,x.gcfl,x.xzqh,x.xzqhdm,x.qdzh,x.zdzh,x.lc,x.jhkgsj,x.jhwgsj from xmsq_sh x
		where x.xmbm in (${xmbm})
	</insert>
	
	<insert id="insertCbsjYhdzx" parameterType="xmsq">
		insert into cbsj_yhdzx c (xmmc,xmbm,jsdw,xzqh,qdzh,zdzh,jsjsdj,jsxz,kgsj,wgsj,gq,lc,jsfa)
		select x.xmmc,x.xmbm,null,x.xzqh,x.qdzh,x.zdzh,x.jsdj,x.gcfl,x.jhkgsj,x.jhwgsj,x.gq,x.lc,x.jsfa 
		from xmsq_yhdzx x where x.xmbm in (${xmbm})
	</insert>
	<insert id="insertCbsjSh" parameterType="xmsq">
		insert into kxxyj_sh(id,xmmc,xmbm,xzqh,xzqhdm,qdzh,zdzh,jsdj,jsxz,shzt)
		(select sys_guid(),x.xmmc,x.xmbm,x.xzqh,x.xzqhdm,x.qdzh,x.zdzh,x.jsdj,x.jsfa,0 
		from xmsq_sh x where x.xmbm in (${xmbm}))
	<!-- 
		insert into cbsj_sh c (xmmc,xmbm,jsdw,xzqh,qdzh,zdzh,jsjsdj,jsxz,kgsj,wgsj,gq,lc,jsfa)
		select x.xmmc,x.xmbm,null,x.xzqh,x.qdzh,x.zdzh,x.jsdj,x.gcfl,x.jhkgsj,x.jhwgsj,x.gq,x.lc,x.jsfa 
		from xmsq_sh x where x.xmbm in (${xmbm}) -->
	</insert>
	
	<select id="queryYhdzxByXmbm" parameterType="xmsq" resultType="xmsq">
		select x.*,l.gpsqdzh,l.gpszdzh,l.sffirst,l.yilc,l.erlc,l.sanlc,l.silc,l.dwlc,l.wllc 
		from xmsq_yhdzx x inner join lxsh_lx l on x.xmbm=l.xmid where xmbm=#{xmbm} and l.sffirst='1' and l.jdbs='1'
	</select>
	<select id="queryShByXmbm" parameterType="xmsq" resultType="xmsq">
		select x.*,l.gpsqdzh,l.gpszdzh,l.sffirst,l.yilc,l.erlc,l.sanlc,l.silc,l.dwlc,l.wllc
		from xmsq_sh x inner join lxsh_lx l on x.xmbm=l.xmid where xmbm=#{xmbm} and l.sffirst='1' and l.jdbs='1'
	</select>
	
	<update id="updateYhdzx" parameterType="xmsq">
		update xmsq_yhdzx set 
		<if test="xmbm!=null">xmbm=#{xmbm}</if>
		<if test="xmmc!=null">,xmmc=#{xmmc}</if>
		<if test="gcfl!=null">,gcfl=#{gcfl}</if>
		<if test="ghlxbh!=null">,ghlxbh=#{ghlxbh}</if>
		<if test="ylxbh!=null">,ylxbh=#{ylxbh}</if>
		<if test="xzqh!=null">,xzqh=#{xzqh}</if>
		<if test="xzqhdm!=null">,xzqhdm=#{xzqhdm}</if>
		<if test="qdzh!=null">,qdzh=#{qdzh}</if>
		<if test="zdzh!=null">,zdzh=#{zdzh}</if>
		<if test="qdmc!=null">,qdmc=#{qdmc}</if>
		<if test="zdmc!=null">,zdmc=#{zdmc}</if>
		<if test="lc!=null">,lc=#{lc}</if>
		<if test="lmkd!=null">,lmkd=#{lmkd}</if>
		<if test="jsdj!=null">,jsdj=#{jsdj}</if>
		<if test="ntz!=null">,ntz=#{ntz}</if>
		<if test="jhkgsj!=null">,jhkgsj=#{jhkgsj}</if>
		<if test="jhwgsj!=null">,jhwgsj=#{jhwgsj}</if>
		<if test="gq!=null">,gq=#{gq}</if>
		<if test="tsdq!=null">,TSDQ=#{tsdq}</if>
		<if test="gydw!=null">,gydw=#{gydw}</if>
		<if test="gydwdm!=null">,gydwdm=#{gydwdm}</if>
		<if test="jsfa!=null">,JSFA=#{jsfa}</if>
		<if test="bz!=null">,bz=#{bz}</if>
		where xmbm=#{xmbm}
	</update>
	<update id="updateSh" parameterType="xmsq">
		update xmsq_sh set 
		<if test="xmbm!=null">xmbm=#{xmbm}</if>
		<if test="xmmc!=null">,xmmc=#{xmmc}</if>
		<if test="gcfl!=null">,gcfl=#{gcfl}</if>
		<if test="ghlxbh!=null">,ghlxbh=#{ghlxbh}</if>
		<if test="ylxbh!=null">,ylxbh=#{ylxbh}</if>
		<if test="xzqh!=null">,xzqh=#{xzqh}</if>
		<if test="xzqhdm!=null">,xzqhdm=#{xzqhdm}</if>
		<if test="qdzh!=null">,qdzh=#{qdzh}</if>
		<if test="zdzh!=null">,zdzh=#{zdzh}</if>
		<if test="qdmc!=null">,qdmc=#{qdmc}</if>
		<if test="zdmc!=null">,zdmc=#{zdmc}</if>
		<if test="lc!=null">,lc=#{lc}</if>
		<if test="lmkd!=null">,lmkd=#{lmkd}</if>
		<if test="jsdj!=null">,jsdj=#{jsdj}</if>
		<if test="ntz!=null">,ntz=#{ntz}</if>
		<if test="jhkgsj!=null">,jhkgsj=#{jhkgsj}</if>
		<if test="jhwgsj!=null">,jhwgsj=#{jhwgsj}</if>
		<if test="gq!=null">,gq=#{gq}</if>
		<if test="tsdq!=null">,TSDQ=#{tsdq}</if>
		<if test="gydw!=null">,gydw=#{gydw}</if>
		<if test="gydwdm!=null">,gydwdm=#{gydwdm}</if>
		<if test="jsfa!=null">,JSFA=#{jsfa}</if>
		where xmbm=#{xmbm}
	</update>
	
	<select id="queryYhdzxExport" parameterType="xmsq" resultType="xmsq">
		select * from (
			select rownum num,t.* from (
				<!-- select x.* from xmsq_yhdzx x  -->
				select substr(x.xmbm,0,4) xmnf,x.xmbm,decode(l.sffirst,'1',x.xmmc,'')  xmmc,x.xzqh,x.gydw,x.lmkd,x.jsdj,x.ntz,x.jhkgsj,x.jhwgsj,x.gq,x.gcfl,x.jsfa,x.ghlxbh,x.xzqhdm,l.*
				from xmsq_yhdzx x,(select xmid,lxbm ylxbh,lxmc lxmc,qdzh qdzh,zdzh zdzh,qdmc qdmc,zdmc zdmc,
				lc lc,yilc,erlc,sanlc,silc,dwlc,wllc,sffirst from lxsh_lx where jdbs='1' ) l where 1=1 and x.xmbm(+)=l.xmid
				<if test="gydwdm!=null and gydwdm!=''">and ${gydwdm}</if>
				<if test="xzqhdm!=null and xzqhdm!=''">and ${xzqhdm}</if>
				<if test="xmmc!=null and xmmc!=''">and xmmc like '%'||#{xmmc}||'%'</if>
				<if test="jsdj!=null and jsdj!=''">and ${jsdj}</if>
				<if test="sqzt>=0">and sqzt=${sqzt}</if>
				<if test="xmbm!=null and xmbm!=''">and ${xmbm}</if>
				<if test="tsdq!=null and tsdq!=''">${tsdq}</if>
				<if test="lsjl!=null and lsjl!=''">and x.lsjl=#{lsjl}</if>
				<if test="ylxbh!=null and ylxbh!=''">
					and x.xmbm in (select xmid from lxsh_lx lx where ${ylxbh} and xmid like '%4___')
				</if>
				order by x.sqzt desc,x.xmbm desc,l.sffirst desc) t ) t2
	</select>
	<select id="queryShExport" parameterType="xmsq" resultType="xmsq">
		select * from (
			select rownum num,t.* from (
				select decode(l.sffirst,'1',substr(x.xmbm,0,4),substr(x.xmbm,0,4)) xmnf,decode(l.sffirst,'1',x.xmbm,'') xmbm,decode(l.sffirst,'1',x.xmmc,'') xmmc,decode(l.sffirst,'1',x.xzqh,x.xzqh) xzqh,decode(l.sffirst,'1',x.ghlxbh,x.ghlxbh) ghlxbh,decode(l.sffirst,'1',x.xzqhdm,x.xzqhdm)  xzqhdm,decode(l.sffirst,'1',x.gydw,x.gydw) gydw,decode(l.sffirst,'1',x.lmkd,x.lmkd)  lmkd,decode(l.sffirst,'1',x.jsdj,x.jsdj)  jsdj,decode(l.sffirst,'1',x.ntz,x.ntz)  ntz,decode(l.sffirst,'1',x.jhkgsj,x.jhkgsj)  jhkgsj,decode(l.sffirst,'1',x.jhwgsj,x.jhwgsj)  jhwgsj,decode(l.sffirst,'1',x.gq,x.gq)  gq,decode(l.sffirst,'1',x.gcfl,x.gcfl)  gcfl,decode(l.sffirst,'1',x.jsfa,x.jsfa)  jsfa,l.*
		        from xmsq_sh x,(select xmid,lxbm ylxbh,lxmc lxmc,qdzh qdzh,zdzh zdzh,qdmc qdmc,zdmc zdmc,
		        lc lc,yilc,erlc,sanlc,silc,dwlc,wllc,sffirst from lxsh_lx where jdbs='1'   ) l where 1=1 and x.xmbm(+)=l.xmid
				<if test="gydwdm!=null and gydwdm!=''">and ${gydwdm}</if>
				<if test="xzqhdm!=null and xzqhdm!=''">and ${xzqhdm}</if>
				<if test="xmmc!=null and xmmc!=''">and xmmc like '%'||#{xmmc}||'%'</if>
				<if test="jsdj!=null and jsdj!=''">and (jsdj=#{jsdj})</if>
				<if test="sqzt>=0">and sqzt=${sqzt}</if>
				<if test="xmbm!=null and xmbm!=''">and ${xmbm}</if>
				<if test="tsdq!=null and tsdq!=''">${tsdq}</if>
				<if test="lsjl!=null and lsjl!=''">and x.lsjl=#{lsjl}</if>
				<if test="ylxbh!=null and ylxbh!=''">
					and x.xmbm in (select xmid from lxsh_lx lx where ${ylxbh} and xmid like '%5___')
				</if>
				order by x.sqzt desc,x.xmbm desc ,l.sffirst desc) t ) t2
	</select>
	<select id="queryAllXzqh" parameterType="string" resultType="treenode">
		select distinct x.id ,x.name text,parent ,'open' state from XTGL_XZQH x where  id like '%'||${value}||'%' order by to_number(id)
	</select>
	<select id="queryAllGydw" parameterType="string" resultType="treenode">
		select distinct x.id ,x.name text,parent ,'open' state from XTGL_DEPARTMENT x where  id like '%'||#{value}||'%' order by to_number(id)
	</select>
	<select id="queryLjYhdzx" parameterType="xmsq" resultType="java.util.Map">
		select count(*) sl,sum(ntz) tz,sum(lc) lc,'0' sbz,'0' sjl,'0' bzcs,'0' dftz from (
			select xmbm,ntz,l.lc from xmsq_yhdzx x left join 
			(select xmid,(sum(nvl(yilc,0))+sum(nvl(erlc,0))+sum(nvl(sanlc,0))+sum(nvl(silc,0))+sum(nvl(dwlc,0))+sum(nvl(wllc,0))) lc from lxsh_lx where jdbs=#{jdbs} and xmid like '%4___' group by xmid) l on x.xmbm=l.xmid where 1=1
			<if test="gydwdm!=null and gydwdm!=''">and ${gydwdm}</if>
			<if test="xzqhdm!=null and xzqhdm!=''">and ${xzqhdm}</if>
			<if test="xmmc!=null and xmmc!=''">and xmmc like '%'||#{xmmc}||'%'</if>
			<if test="jsdj!=null and jsdj!=''">and ${jsdj}</if>
			<if test="sqzt>=0">and sqzt=${sqzt}</if>
			<if test="xmbm!=null and xmbm!=''">and ${xmbm}</if>
			<if test="gcfl!=null and gcfl!=''">and ${gcfl}</if>
			<if test="tsdq!=null and tsdq!=''">${tsdq}</if>
			<if test="lsjl!=null and lsjl!=''">and x.lsjl=#{lsjl}</if>
			<if test="ylxbh!=null and ylxbh!=''">
				and x.xmbm in (select xmid from lxsh_lx lx where ${ylxbh} and xmid like '%4___')
			</if>
			<if test="ghlxbh!=null and ghlxbh!=''">
				and xmbm in (select distinct xmid from lxsh_lx lx where lx.lxbm like '%'||#{ghlxbh}||'%')
			</if>
			<if test="lxmc !='' and lxmc != null ">
				and lxmc like '%'||#{lxmc}||'%'
			</if>
		)
	</select>
	<select id="queryLjSh" parameterType="xmsq" resultType="java.util.Map">
		select count(*) sl,sum(ntz) tz,sum(lc) lc,'0' sbz,'0' sjl,'0' bzcs,'0' dftz from (
			select xmbm,ntz,l.lc from xmsq_sh x left join 
			(select xmid,(sum(nvl(yilc,0))+sum(nvl(erlc,0))+sum(nvl(sanlc,0))+sum(nvl(silc,0))+sum(nvl(dwlc,0))+sum(nvl(wllc,0))) lc 
			from lxsh_lx where jdbs=#{jdbs} and xmid like '%5___' group by xmid) l 
			on x.xmbm=l.xmid where 1=1
			<if test="gydwdm!=null and gydwdm!=''">and ${gydwdm}</if>
			<if test="xzqhdm!=null and xzqhdm!=''">and ${xzqhdm}</if>
			<if test="xmmc!=null and xmmc!=''">and xmmc like '%'||#{xmmc}||'%'</if>
			<if test="jsdj!=null and jsdj!=''">and ${jsdj}</if>
			<if test="sqzt>=0">and sqzt=${sqzt}</if>
			<if test="xmbm!=null and xmbm!=''">and ${xmbm}</if>
			<if test="gcfl!=null and gcfl!=''">and ${gcfl}</if>
			<if test="tsdq!=null and tsdq!=''">${tsdq}</if>
			<if test="lsjl!=null and lsjl!=''">and x.lsjl=#{lsjl}</if>
			<if test="ghlxmc!='' and ghlxmc!= null ">and ghlxmc=#{ghlxmc}</if>
		<if test="ghlxbm!='' and ghlxbm!= null ">and ghlxbm=#{ghlxbm}</if>
			<if test="ylxbh!=null and ylxbh!=''">
				and x.xmbm in (select xmid from lxsh_lx lx where ${ylxbh} and xmid like '%5___')
			</if>
			<if test="ghlxbh!=null and ghlxbh!=''">
				and xmbm in (select distinct xmid from lxsh_lx lx where lx.lxbm like '%'||#{ghlxbh}||'%')
			</if>
			<if test="lxmc !='' and lxmc != null ">
				and lxmc like '%'||#{lxmc}||'%'
			</if>
		)
	</select>
	<select id="queryLxFromGpsroadByLevel" parameterType="java.util.Map" resultType="java.util.Map">
		select substr(roadcode,0,length(roadcode)-6) id,substr(roadcode,0,length(roadcode)-6) text
		<!-- ,min(g.roadstart),max(g.roadends) --> from gpsroad g where g.roadcode like #{level}||'%' 
		and substr(roadcode,length(roadcode)-5) like #{xzqhdm}||'%' 
		group by substr(roadcode,0,length(roadcode)-6) order by substr(roadcode,0,length(roadcode)-6)
	</select>
	
	<select id="queryYhzxXmsq" parameterType="xmsq" resultType="xmsq">
		select * from (
			select rownum num,t.* from (
				select * from xmsq_yhzx x
				where 1=1
				<if test="xmsq.gydwdm!=null and xmsq.gydwdm!=''">
					and ${xmsq.gydwdm}
				</if>
				<if test="xmsq.xzqhdm!=null and xmsq.xzqhdm!=''">
					and ${xmsq.xzqhdm}
				</if>
				<if test="xmsq.xmmc!=null and xmsq.xmmc!=''">
					and xmmc like '%'||'${xmsq.xmmc}'||'%'
				</if>
				<if test="xmsq.jb!=null and xmsq.jb!=''">
					and jb like '%'||${xmsq.jb}||'%'
				</if>
				<if test="xmsq.sqzt>=0">
					and sqzt=${xmsq.sqzt}
				</if>
				<if test="xmsq.xmbm!=null and xmsq.xmbm!=''">
					and ${xmsq.xmbm}
				</if>
				<if test="xmsq.jsxz!=null and xmsq.jsxz!=''">
					and jsxz like '%'||${xmsq.jsxz}||'%'
				</if>
				<if test="xmsq.ydbmc!=null and xmsq.ydbmc!=''">
					and ydbmc like '%'||'${xmsq.ydbmc}'||'%'
				</if>
				<if test="xmsq.lxmc !='' and xmsq.lxmc != null ">
					and lxmc like '%'||'${xmsq.lxmc}'||'%'
				</if>
				order by sqzt desc,xmbm desc) t ) t2
		<if test="page!=null and page!='' and page!=0">
			where <![CDATA[ num>(${page}-1)*${rows} and num<=${page}*${rows}]]>
		</if>
	</select>
	<select id="queryYhzxCount" parameterType="xmsq" resultType="int">
		select count(x.xmbm) from xmsq_yhzx x where 1=1
		<if test="gydwdm!=null and gydwdm!=''">
			and ${gydwdm}
		</if>
		<if test="xzqhdm!=null and xzqhdm!=''">
			and ${xzqhdm}
		</if>
		<if test="xmmc!=null and xmmc!=''">
			and xmmc like '%'||#{xmmc}||'%'
		</if>
		<if test="jb!=null and jb!=''">
			and jb like '%'||#{jb}||'%'
		</if>
		<if test="sqzt>=0">
			and sqzt=${sqzt}
		</if>
		<if test="xmbm!=null and xmbm!=''">
			and ${xmbm}
		</if>
		<if test="jsxz!=null and jsxz!=''">
			and jsxz like '%'||#{jsxz}||'%'
		</if>
		<if test="ydbmc!=null and ydbmc!=''">
			and ydbmc like '%'||#{ydbmc}||'%'
		</if>
		<if test="lxmc !='' and lxmc != null ">
			and lxmc like '%'||#{lxmc}||'%'
		</if>
	</select>
	
	<select id="queryYhzxNextXmbm" resultType="string">
		select NVL(max(substr(c.xmbm,11)),6000)+1 from xmsq_yhzx c where c.xmbm like #{xmnf}||#{xzqhdm}||'%'
	</select>
	
	<insert id="insertXmsqYhzx" parameterType="java.util.List">
		insert into xmsq_yhzx (
		<if test="xmbm!=null">xmbm</if>
		<if test="xmmc!=null">,xmmc</if>
		<if test="jb!=null">,jb</if>
		<if test="jsxz!=null">,jsxz</if>
		<if test="ydbmc!=null">,ydbmc</if>
		<if test="xzqh!=null">,xzqh</if>
		<if test="xzqhdm!=null">,xzqhdm</if>
		<if test="ztz!=null">,ztz</if>
		<if test="zbzzj!=null">,zbzzj</if>
		<if test="sbzzj!=null">,sbzzj</if>
		<if test="zddzjl!=null">,zddzjl</if>
		<if test="dfzc!=null">,dfzc</if>
		<if test="jhkgsj!=null">,jhkgsj</if>
		<if test="jhwgsj!=null">,jhwgsj</if>
		<if test="gydw!=null">,gydw</if>
		<if test="gydwdm!=null">,gydwdm</if>
		<if test="lxmc!=null">,lxmc</if>
		<if test="lxzh!=null">,lxzh</if>
		<if test="xmnf!=null">,xmnf</if>
		<if test="bz!=null">,bz</if>) 
		values (
		<if test="xmbm!=null">#{xmbm}</if>
		<if test="xmmc!=null">,#{xmmc}</if>
		<if test="jb!=null">,#{jb}</if>
		<if test="jsxz!=null">,#{jsxz}</if>
		<if test="ydbmc!=null">,#{ydbmc}</if>
		<if test="xzqh!=null">,#{xzqh}</if>
		<if test="xzqhdm!=null">,#{xzqhdm}</if>
		<if test="ztz!=null">,#{ztz}</if>
		<if test="zbzzj!=null">,#{zbzzj}</if>
		<if test="sbzzj!=null">,#{sbzzj}</if>
		<if test="zddzjl!=null">,#{zddzjl}</if>
		<if test="dfzc!=null">,#{dfzc}</if>
		<if test="jhkgsj!=null">,#{jhkgsj}</if>
		<if test="jhwgsj!=null">,#{jhwgsj}</if>
		<if test="gydw!=null">,#{gydw}</if>
		<if test="gydwdm!=null">,#{gydwdm}</if>
		<if test="lxmc!=null">,#{lxmc}</if>
		<if test="lxzh!=null">,#{lxzh}</if>
		<if test="xmnf!=null">,#{xmnf}</if>
		<if test="bz!=null">,#{bz}</if>)
	</insert>
	<update id="updateYhzx" parameterType="xmsq">
		update xmsq_yhzx set 
		<if test="xmbm!=null">xmbm=#{xmbm}</if>
		<if test="xmmc!=null">,xmmc=#{xmmc}</if>
		<if test="jb!=null">,jb=#{jb}</if>
		<if test="jsxz!=null">,jsxz=#{jsxz}</if>
		<if test="ydbmc!=null">,ydbmc=#{ydbmc}</if>
		<if test="xzqh!=null">,xzqh=#{xzqh}</if>
		<if test="xzqhdm!=null">,xzqhdm=#{xzqhdm}</if>
		<if test="ztz!=null">,ztz=#{ztz}</if>
		<if test="zbzzj!=null">,zbzzj=#{zbzzj}</if>
		<if test="sbzzj!=null">,sbzzj=#{sbzzj}</if>
		<if test="zddzjl!=null">,zddzjl=#{zddzjl}</if>
		<if test="dfzc!=null">,dfzc=#{dfzc}</if>
		<if test="jhkgsj!=null">,jhkgsj=#{jhkgsj}</if>
		<if test="jhwgsj!=null">,jhwgsj=#{jhwgsj}</if>
		<if test="gydw!=null">,gydw=#{gydw}</if>
		<if test="gydwdm!=null">,gydwdm=#{gydwdm}</if>
		<if test="lxmc!=null">,lxmc=#{lxmc}</if>
		<if test="lxzh!=null">,lxzh=#{lxzh}</if>
		<if test="xmnf!=null">,xmnf=#{xmnf}</if>
		<if test="bz!=null">,bz=#{bz}</if>
		where xmbm=#{xmbm}
	</update>
	
	<delete id="deleteYhzxByXmbm" parameterType="xmsq">
		delete from xmsq_yhzx where xmbm=#{xmbm}
	</delete>
	
	<select id="queryYhzxByXmbm" parameterType="xmsq" resultType="xmsq">
		select x.* from xmsq_yhzx x where xmbm=#{xmbm} 
	</select>
	
	<update id="updateYhzxSqzt" parameterType="xmsq">
		update xmsq_yhzx set sqzt=${sqzt} where xmbm=#{xmbm}
	</update>
	
	<select id="queryLjYhzx" parameterType="xmsq" resultType="java.util.Map">
		select count(*) bz,sum(ztz) ntz from xmsq_yhzx x where 1=1
			    <if test="gydwdm!=null and gydwdm!=''">
					and ${gydwdm}
				</if>
				<if test="xzqhdm!=null and xzqhdm!=''">
					and ${xzqhdm}
				</if>
				<if test="xmmc!=null and xmmc!=''">
					and xmmc like '%'||#{xmmc}||'%'
				</if>
				<if test="jb!=null and jb!=''">
					and jb like '%'||#{jb}||'%'
				</if>
				<if test="sqzt>=0">
					and sqzt=${sqzt}
				</if>
				<if test="xmbm!=null and xmbm!=''">
					and ${xmbm}
				</if>
				<if test="jsxz!=null and jsxz!=''">
					and jsxz like '%'||#{jsxz}||'%'
				</if>
				<if test="ydbmc!=null and ydbmc!=''">
					and ydbmc like '%'||#{ydbmc}||'%'
				</if>
				<if test="lxmc !='' and lxmc != null ">
					and lxmc like '%'||#{lxmc}||'%'
				</if>
				<if test="ghlxmc!='' and ghlxmc!= null ">and ghlxmc=#{ghlxmc}</if>
				<if test="ghlxbm!='' and ghlxbm!= null ">and ghlxbm=#{ghlxbm}</if>
	</select>
	
	<insert id="insertJhshYhzx" parameterType="xmsq">
		insert into jhsh_yhzx (xmbm,ztz,ZBZZJ,SBZZJ,ZDDZJL,DFZC,jhkgsj,jhwgsj)
		select x.xmbm,x.ztz,x.ZBZZJ,x.SBZZJ,x.ZDDZJL,x.DFZC,x.jhkgsj,x.jhwgsj
		from xmsq_yhzx x where x.xmbm in (${xmbm})
	</insert>
	
	<select id="queryYhzxExport" parameterType="xmsq" resultType="xmsq">
		select * from xmsq_yhzx x
				where 1=1
				<if test="gydwdm!=null and gydwdm!=''">
					and ${gydwdm}
				</if>
				<if test="xzqhdm!=null and xzqhdm!=''">
					and ${xzqhdm}
				</if>
				<if test="xmmc!=null and xmmc!=''">
					and xmmc like '%'||#{xmmc}||'%'
				</if>
				<if test="jb!=null and jb!=''">
					and jb like '%'||#{jb}||'%'
				</if>
				<if test="sqzt>=0">
					and sqzt=${sqzt}
				</if>
				<if test="xmbm!=null and xmbm!=''">
					and ${xmbm}
				</if>
				<if test="jsxz!=null and jsxz!=''">
					and jsxz like '%'||#{jsxz}||'%'
				</if>
				<if test="ydbmc!=null and ydbmc!=''">
					and ydbmc like '%'||#{ydbmc}||'%'
				</if>
				<if test="lxmc !='' and lxmc != null ">
					and lxmc like '%'||#{lxmc}||'%'
				</if>
	</select>
	
	<select id="queryYLx" parameterType="lx" resultType="lx">
		<![CDATA[select ylxbm ylxbm,(case when Xqdzh<${qdzh} then YQDZH+${qdzh}-XQDZH else yqdzh end) yqdzh,
		(case when ${zdzh}<Xzdzh then YZDZH-XZDZH+${zdzh} else yzdzh end ) yzdzh ,
		xlxbm as lxbm,(case when Xqdzh<${qdzh} then ${qdzh} else xqdzh end ) qdzh,
		(case when ${zdzh}<Xzdzh then ${zdzh} else xzdzh end) zdzh 
		from XTGL_LXSJ t where  t.xlxbm like #{lxbm} || '%' and 
		t.Xqdzh<${zdzh} and t.Xzdzh>${qdzh}]]>
	</select>
	<!-- <select id="queryLsjlList" parameterType="java.util.Map" resultType="lx">
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,j.gcfl xjsdj,decode(substr(l.xmid,11,1),'1',l.jsjsdj,l.xjsdj) jsjsdj from lxsh_lx l right join jhsh_yhdzx j on l.xmid=j.xmbm right join cbsj_yhdzx c on j.xmbm=c.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.qdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.zdzh)) or 
	    	(to_number(l.zdzh) >= ${lx.zdzh} and ${lx.zdzh} >= to_number(l.qdzh))
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_yhdzx jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
		union all
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,'' xjsdj,l.jsjsdj from lxsh_lx l right join jhsh_sh j on l.xmid=j.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.qdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.zdzh)) or 
	    	(to_number(l.zdzh) >= ${lx.zdzh} and ${lx.zdzh} >= to_number(l.qdzh))
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_sh jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
		union all
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,'' xjsdj,l.jsjsdj from lxsh_lx l right join jhsh_lmgz j on l.xmid=j.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.qdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.zdzh)) or 
	    	(to_number(l.zdzh) >= ${lx.zdzh} and ${lx.zdzh} >= to_number(l.qdzh))
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_lmgz jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
		union all
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,'' xjsdj,l.jsjsdj from lxsh_lx l right join jhsh_sjgz j on l.xmid=j.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.qdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.zdzh)) or 
	    	(to_number(l.zdzh) >= ${lx.zdzh} and ${lx.zdzh} >= to_number(l.qdzh))
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_sjgz jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
		union all
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,'' xjsdj,l.jsjsdj from lxsh_lx l right join jhsh_xj j on l.xmid=j.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.qdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.zdzh)) or 
	    	(to_number(l.zdzh) >= ${lx.zdzh} and ${lx.zdzh} >= to_number(l.qdzh))
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_xj jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
	</select> -->
	<select id="queryLsjlList" parameterType="java.util.Map" resultType="lx">
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,j.gcfl xjsdj,decode(substr(l.xmid,11,1),'1',l.jsjsdj,l.xjsdj) jsjsdj from lxsh_lx l right join jhsh_yhdzx j on l.xmid=j.xmbm right join cbsj_yhdzx c on j.xmbm=c.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.zdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.qdzh)) 
	    )
<!-- 	    to_number(l.qdzh)&lt;${lx.zdzh} and to_number(l.zdzh)>${lx.qdzh} -->
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_yhdzx jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
		union all
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,'' xjsdj,l.jsjsdj from lxsh_lx l right join jhsh_sh j on l.xmid=j.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.zdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.qdzh)) 
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_sh jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
		union all
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,'' xjsdj,l.jsjsdj from lxsh_lx l right join jhsh_lmgz j on l.xmid=j.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.zdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.qdzh)) 
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_lmgz jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
		union all
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,'' xjsdj,l.jsjsdj from lxsh_lx l right join jhsh_sjgz j on l.xmid=j.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.zdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.qdzh))
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_sjgz jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
		union all
		select l.xmid,j.xmmc,l.lxbm,l.lxmc,l.qdzh,l.zdzh,'' ylxbm,'' yqdzh, '' yzdzh,'' xjsdj,l.jsjsdj from lxsh_lx l right join jhsh_xj j on l.xmid=j.xmbm 
		where l.jdbs='2' and l.lxbm like '%'||#{lx.lxbm}||'%' and 
		(
			(to_number(l.zdzh) >= ${lx.qdzh} and ${lx.zdzh} >= to_number(l.qdzh)) 
	    )
	    
		<if test="lx.xmid!=null and lx.xmid!=''">and j.xmbm!=#{lx.xmid}</if>
		<foreach collection="ylx" item="item">
			union all
			<![CDATA[
			select lx.xmid,jh.xmmc,#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.qdzh} as qdzh,#{item.zdzh} as zdzh,
			lx.lxbm as ylxbm,
			case when to_number(lx.qdzh)<=${item.yqdzh} then to_char(${item.yqdzh}) else to_char(lx.qdzh) end yqdzh ,
			case when to_number(lx.zdzh)>=${item.yzdzh} then to_char(${item.yzdzh}) else to_char(lx.zdzh) end  yzdzh,
			lx.xjsdj as xjsdj,lx.jsjsdj as jsjsdj
			from lxsh_lx lx,jhsh_xj jh where jh.xmbm=lx.xmid and lx.lxbm like '%'||#{item.ylxbm}||'%'
	        and (((to_number(lx.zdzh) >= ${item.yqdzh} and ${item.yqdzh} >= to_number(lx.qdzh)) or 
		    (to_number(lx.zdzh) >= ${item.yzdzh} and ${item.yzdzh} >= to_number(lx.qdzh))) or
		    (to_number(lx.qdzh) = ${item.yqdzh} or to_number(lx.zdzh) = ${item.yzdzh}))
		    and (to_number(lx.qdzh) != ${item.yzdzh} and to_number(lx.zdzh) != ${item.yqdzh})
	        ]]>
		</foreach>
	</select>
</mapper>
