<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.lxsh">
	<select id="selectXmbm" parameterType="String" resultType="String">
		select max(substr(xmbm,-3)) from lxsh_sjgz where xmbm like ${value}||'%'
	</select>
	<select id="selectbzcs" parameterType="lxsh" resultType="lxsh">
		select bzzj bzys from PLAN_FLWBZBZ where xmlx=#{xmlx} and gldj=#{gldj} and jsdj=#{jsdj}
	</select>
	<select id="selectSFCF" parameterType="lxsh" resultType="lxsh">
		select * from LXSH_SJGZ where ghlxbh like '%'||#{ghlxbh}||'%' and qdzh like '%'||#{qdzh}||'%' and zdzh like '%'||#{zdzh}||'%' and xmnf=#{xmnf}
	</select>
	<insert id="insertSjgz" parameterType="lxsh">
		insert into LXSH_SJGZ( id,lxmc,xmmc,ghlxbh,lc,jsxz,qdzh,zdzh,qdmc,zdmc,jhkgn,jhwgn,jsjsdj,xjsdj,xmbm,tz,bzys,dfzc,tsdq,xzqh,gydw,xzqhdm,gydwdm,xmnf,sbthcd,tbbmbm)
		values(sys_guid(),#{lxmc},#{xmmc},#{ghlxbh},#{lc},#{jsxz},#{qdzh},#{zdzh},#{qdmc},#{zdmc},#{jhkgn},#{jhwgn},#{jsjsdj},#{xjsdj},#{xmbm},#{tz},#{bzys},#{dfzc},#{tsdq},#{xzqh},#{gydw},#{xzqhdm},#{gydwdm},#{xmnf},#{sbthcd},#{tbbmbm})
	</insert>
	<insert id="insertlx" parameterType="lxsh">
		insert into LXSH_LX(id,xmid,lxbm,lxmc,xzqh,xzqhdm,gydw,gydwdm,qdzh,zdzh,jsjsdj,lc,xjsdj,jsxz,qdmc,zdmc)
		values(sys_guid(),#{xmbm},#{ghlxbh},#{lxmc},#{xzqh},#{xzqhdm},#{gydw},#{gydwdm},#{qdzh},#{zdzh},#{jsjsdj},#{lc},#{xjsdj},#{jsxz},#{qdmc},#{zdmc})
	</insert>
	<select id="selectSjgzList" parameterType="lxsh" resultType="lxsh">
		select * from (
		select rownum num ,t.*  from LXSH_SJGZ t where 1=1
			and  sbthcd &lt;=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqh!='' and xzqh!= null ">
			${xzqh}
		</if>
		<if test="xmmc!='' and xmmc!= null ">
			and xmmc like '%'||#{xmmc}||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf like '%'||#{xmnf}||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and sbzt like '%'||#{sbzt}||'%'
		</if>
		<if test="tsdq!='' and tsdq!= null ">
			and tsdq like '%'||#{tsdq}||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			and xjsdj like '%'||#{xjsdj}||'%'
		</if>
		<if test="gldj!='' and gldj!= null ">
			and ghlxbm like '#{tsdq}||'%'
		</if>
		) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows}
		order by xmbm
	</select>
	<select id="selectSjgzListCount" parameterType="lxsh" resultType="int">
		select count(*) from LXSH_SJGZ where 1=1
		and  sbthcd &lt;=#{sbthcd}
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqh!='' and xzqh!= null ">
			${xzqh}
		</if>
		<if test="xmmc!='' and xmmc!= null ">
			and xmmc like '%'||#{xmmc}||'%'
		</if>
		<if test="xmnf!='' and xmnf!= null ">
			and xmnf like '%'||#{xmnf}||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and sbzt like '%'||#{sbzt}||'%'
		</if>
		<if test="tsdq!='' and tsdq!= null ">
			and tsdq like '%'||#{tsdq}||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			and xjsdj like '%'||#{xjsdj}||'%'
		</if>
		<if test="gldj!='' and gldj!= null ">
			and ghlxbm like '#{tsdq}||'%'
		</if>
	</select>
	<select id="selectSjgzlxList" parameterType="lxsh" resultType="lxsh">
		select * from (
		select rownum num ,t.id,xmid xmbm,lxbm ghlxbh,lxmc,xzqh,zdzh,qdzh,gydw,xzqhdm,gydwdm,jsjsdj,xjsdj,lc,jsxz,qdmc,zdmc  from LXSH_LX t where 1=1
		<if test="xmbm!='' and xmbm!= null ">
			and xmid like '%'||#{xmbm}||'%'
		</if>
		) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows}
	</select>
	<select id="selectSjgzlxListCount" parameterType="lxsh" resultType="int">
		select count(*) from LXSH_LX where 1=1
		<if test="xmbm!='' and xmbm!= null ">
			and xmid like '%'||#{xmbm}||'%'
		</if>
	</select>
	<update id="sbsjgzSbzt" parameterType="hashmap">
		update LXSH_SJGZ set sbzt=1,sbthcd=#{sbthcd} where id=#{id}
	</update>
	<update id="thSjgzSbzt" parameterType="hashmap">
		update LXSH_SJGZ set sbzt=0,sbthcd=#{sbthcd} where id=#{id}
	</update>
</mapper>