<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_zhfz">
	<resultMap type="plan_zhfz"  id="zhfz_jh">
		<id property="id" column="id" />
		<result property="sbnf" column="sbnf"/>
		<result property="sbzt" column="sbzt"/>
		<result property="spzt" column="spzt"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<result property="pfztz" column="pfztz"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="jgzt" column="jgzt"/>
		<result property="kgzt" column="kgzt"/>
		<result property="sfylsjl" column="sfylsjl"/>
		<association property="jckzhfz"  column="SCK_ZHFZ_ID"  resultMap="zhfz_lx"></association>
	</resultMap>
	<resultMap type="jckzhfz"  id="zhfz_lx">
		<id property="id" column="id" />
		<result property="gydw" column="gydw"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="lxbm" column="lxbm"/>
		<result property="lxmc" column="lxmc"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="yhlc" column="yhlc"/>
	</resultMap>
	<select id="queryZhfzList"  parameterType="java.util.Map"  resultMap="zhfz_jh">
		select * from 
			(
				select rownum as num,t.* from (
					select jh.sfylsjl,jh.kgzt,jh.jgzt,jh.jh_sbthcd,jh.id,jh.sbnf,jh.sbzt,jh.spzt,jh.jhkgsj,jh.jhwgsj,jh.pfztz,
					lx.gydw,lx.xzqhmc,lx.xzqhdm,lx.lxmc,lx.lxbm,lx.qdzh,lx.zdzh,lx.yhlc
				 	from plan_zhfz jh left join xmk_zhfz lx on jh.sckid=lx.id where 1=1
				 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 					and jh.sbnf=#{jh.sbnf}
	 				</if>
	 				<if test="jh.sbzt!=null and jh.sbzt!=''">
	 					and jh.sbzt=#{jh.sbzt}
	 				</if>
	 				<if test="jh.spzt!=null and jh.spzt!=''">
	 					and jh.spzt=#{jh.spzt}
	 				</if>
	 				<if test="lx.gydwdm!=null and lx.gydwdm!=''">
	 					and lx.gydwdm like #{lx.gydwdm}
	 				</if>
	 				<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 					and lx.xzqhdm like #{lx.xzqhdm}
	 				</if>
	 				<if test="lx.lxmc!=null and lx.lxmc!=''">
	 					and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 				</if>
	 				<if test="lx.lxbm!=null and lx.lxbm!=''">
	 					and lx.lxbm like #{lx.lxbm}||'%'
	 				</if>
	 				<if test="lx.lxjsdj!=null and lx.lxjsdj!=''">
	 					and lx.lxjsdj = #{lx.lxjsjd}
	 				</if>
				 	order by jh.sbzt,jh.spzt,jh.sbnf desc
			 	) t
			)
 			where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryZhfzCount"  parameterType="java.util.Map"  resultType="int">
		select count(*) from plan_zhfz jh left join xmk_zhfz lx on jh.sckid=lx.id where 1=1
		<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		and jh.sbzt=#{jh.sbzt}
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
	 	<if test="lx.gydwdm!=null and lx.gydwdm!=''">
	 		and lx.gydwdm like #{lx.gydwdm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and lx.xzqhdm like #{lx.xzqhdm}
	 	</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.lxjsdj!=null and lx.lxjsdj!=''">
	 		and lx.lxjsdj = #{lx.lxjsjd}
	 	</if>
	</select>
	<select id="queryZhfzNfs"  resultType="treenode">
		select distinct t.sbnf as text from PLAN_zhfz t order by t.sbnf
	</select>
	<select id="insertToSheet" parameterType="hashMap" resultType="sjbb">
		select xzqhdm v_0,xzqhmc v_1,sc.lxbm v_2,sc.lxmc v_3,sc.scqdzh v_4,sc.sczdzh v_5,sc.scyhlc v_6,sc.jsxz v_7,sc.jsnr v_8 from sck_zhfz sc,xmk_zhfz xm where sc.xmkid=xm.id and sck_sbzt='已上报'
	</select>
	<select id="exportExcel_jh" parameterType="hashMap" resultType="sjbb">
		select decode(jh.sbzt,0,'未上报',decode(jh.spzt,0,'上报待审批','已审批')) v_0,jh.sbnf v_1,to_char(jh.jhkgsj,'yyyy-mm-dd') v_2,to_char(jh.jhwgsj,'yyyy-mm-dd') v_3,lx.gydw v_4,lx.xzqhmc v_5,lx.lxbm v_6,lx.lxmc v_7,lx.qdzh v_8,lx.zdzh v_9,'' v_10,jh.pfztz v_11 
		from plan_zhfz jh left join xmk_zhfz lx on jh.sck_zhfz_id=lx.id where 1=1
		order by jh.sbnf desc
	</select>
	<select id="queryZhfzById" parameterType="string" resultType="plan_zhfz">
		select * from plan_zhfz jh where jh.id=#{id}
	</select>
	<delete id="dropZhfzById" parameterType="string">
		delete from plan_zhfz jh where jh.id=#{id}
	</delete>
	<update id="editZhfzById" parameterType="plan_zhfz">
		update plan_zhfz set sbnf=#{sbnf},jhkgsj=#{jhkgsj},jhwgsj=#{jhwgsj},xdsj=#{xdsj},
			jhxdwh=#{jhxdwh},sjdw=#{sjdw},sjpfdw=#{sjpfdw},pfwh=#{pfwh},pfztz=#{pfztz},
			jhsybzje=#{jhsybzje},jhsydfzcje=#{jhsydfzcje},sfsqablbz=#{sfsqablbz},ablbzsqwh=#{ablbzsqwh},
			bz=#{bz},pfsj=#{pfsj}
		where id=#{id}
	</update>
	<update id="editZhfzStatus" parameterType="plan_zhfz">
		update plan_zhfz set 
			<if test="sbbm!=null">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null">sbsj=#{sbsj},</if>
			<if test="sbzt!=null">sbzt=#{sbzt},</if>
			<if test="spbm!=null">spbm=#{spbm},</if>
			<if test="spbmdm!=null">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null">spsj=#{spsj},</if>
			<if test="spzt!=null">spzt=#{spzt},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>
</mapper>
