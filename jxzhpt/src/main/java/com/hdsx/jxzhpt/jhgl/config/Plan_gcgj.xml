<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_gcgj">
	<resultMap id="gcgj_lx" type="plan_gcgj">
		<id property="id" column="id" />
		<result property="fapgdw" column="fapgdw"/>
		<result property="fascdw" column="fascdw"/>
		<result property="faspsj" column="faspsj"/>
		<result property="spwh" column="spwh"/>
		<result property="tzgs" column="tzgs"/>
		<result property="jsxz" column="jsxz"/>
		<result property="jsnr" column="jsnr"/>
		<result property="sbnf" column="sbnf"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="xdsj" column="xdsj"/>
		<result property="xmmc" column="xmmc"/>
		<result property="yhlb" column="yhlb"/>
		<result property="sjdw" column="sjdw"/>
		<result property="sjpfdw" column="sjpfdw"/>
		<result property="sjlmlx" column="sjlmlx"/>
		<result property="dc" column="dc"/>
		<result property="jc" column="jc"/>
		<result property="mc" column="mc"/>
		<result property="lmkd" column="lmkd"/>
		<result property="pfwh" column="pfwh"/>
		<result property="pfsj" column="pfsj"/>
		<result property="pfztz" column="pfztz"/>
		<result property="jhsybzje" column="jhsybzje"/>
		<result property="jhsydfzcje" column="jhsydfzcje"/>
		<result property="sfsqablbz" column="sfsqablbz"/>
		<result property="ablbzsqwh" column="ablbzsqwh"/>
		<result property="sftqss" column="sftqss"/>
		<result property="jhxdwh" column="jhxdwh"/>
		<result property="gksjwh" column="gksjwh"/>
		<result property="sjpfwh" column="sjpfwh"/>
		<result property="sfgyhbm" column="sfgyhbm"/>
		<result property="gkbgmc" column="gkbgmc"/>
		<result property="sjsgtmc" column="sjsgtmc"/>
		<result property="sbzt" column="sbzt"/>
		<result property="spzt" column="spzt"/>
		<result property="bz" column="bz"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="sfylsjl" column="sfylsjl"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<collection property="plan_lx_gcgjs" column="jhid" javaType="ArrayList" ofType="plan_lx_gcgj" resultMap="lx"/>
	</resultMap>
	<resultMap id="lx" type="plan_lx_gcgj">
		<result property="gydw" column="gydw"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="lxmc" column="lxmc"/>
		<result property="lxbm" column="lxbm"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="yhlc" column="yhlc"/>
		<result property="jsdd" column="jsdd"/>
		<result property="qzlc" column="qzlc"/>
		<result property="gydw" column="gydw"/>
		<result property="xzqhdm" column="xzqhdm"/>
		<result property="yjsdj" column="yjsdj"/>
		<result property="ylmlx" column="ylmlx"/>
		<result property="bhnr" column="bhnr"/>
		<result property="jhid" column="jhid"/>
	</resultMap>
	
	<select id="queryGcgjList"  parameterType="java.util.Map" resultMap="gcgj_lx">
		select * from (
			select rownum as num,t.* from(
			select jh.xmmc,jh.jhsydfzcje,jh.JHSYBZJE,jh.sfylsjl,jh.jgzt,jh.kgzt,jh.jh_sbthcd,jh.id,jh.sbzt,jh.spzt,jh.sbnf,jh.jhkgsj,jh.jhwgsj,jh.pfztz,
			l.gydw,l.xzqhmc,l.lxmc,l.lxbm,l.qdzh,l.zdzh,l.yhlc 
			from PLAN_lx_GCGJ l right JOIN Plan_Gcgj jh on  l.jhid=jh.id
			where 1=1
			<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='')">
				and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
			</if>
			<if test="jh.sbnf!=null and jh.sbnf!=''">
				and jh.sbnf =#{jh.sbnf}
			</if>
			<if test="jh.sbzt!=null and jh.sbzt!=''">
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.spzt!=null and jh.spzt!=''">
				and jh.spzt=#{jh.spzt}
			</if>
				and jh.id in (
					select l.jhid from PLAN_lx_GCGJ l 
					where 1=1 
						<if test="l.gydwdm!=null and l.gydwdm!=''">
							and l.gydwdm like #{l.gydwdm}
						</if>
						<if test="l.xzqhdm!=null and l.xzqhdm!=''">
							and l.xzqhdm like #{l.xzqhdm}
						</if>
						<if test="l.lxmc!=null and l.lxmc!=''">
							and l.lxmc like '%'||#{l.lxmc}||'%'
						</if>
						<if test="l.yjsdj!=null and l.yjsdj!=''">
							and l.yjsdj=#{l.yjsdj}
						</if>
						<if test="l.lxbm!=null and l.lxbm!=''">
							and l.lxbm like #{l.lxbm}
						</if>
						<if test="l.tsdqbm!=null and l.tsdqbm!=''">
					     and l.xzqhdm in (
					     	select B.XZQHDM from BT_XZQHTSDQ b 
					     	WHERE and B.AREACODE=#{l.tsdqbm}
					     	 )
					     </if>
					     ) order by jh.sbzt,jh.spzt,jh.sbnf
					) t
			)
		where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryGcgjCount" resultType="int" parameterType="java.util.Map">
		select count(*) from PLAN_GCGJ jh where 1=1
			<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='')">
				and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
			</if>
			<if test="jh.sbnf!=null and jh.sbnf!=''">
				and jh.sbnf =#{jh.sbnf}
			</if>
			<if test="jh.sbzt!=null and jh.sbzt!=''">
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.spzt!=null and jh.spzt!=''">
				and jh.spzt=#{jh.spzt}
			</if>
				and jh.id in (
					select l.jhid from PLAN_lx_GCGJ l
					where 1=1 
						<if test="l.gydwdm!=null and l.gydwdm!=''">
							and l.gydwdm like '%'||#{l.gydwdm}||'%'
						</if>
						<if test="l.xzqhdm!=null and l.xzqhdm!=''">
							and l.xzqhdm like #{l.xzqhdm}
						</if>
						<if test="l.lxmc!=null and l.lxmc!=''">
							and l.lxmc like '%'||#{l.lxmc}||'%'
						</if>
						<if test="l.yjsdj!=null and l.yjsdj!=''">
							and l.yjsdj=#{l.yjsdj}
						</if>
						<if test="l.lxbm!=null and l.lxbm!=''">
							and l.lxbm like #{l.lxbm}
						</if>
						<if test="l.tsdqbm!=null and l.tsdqbm!=''">
					     and l.xzqhdm in (
					     	select B.XZQHDM from BT_XZQHTSDQ b 
					     	WHERE 1=1 
								and B.AREACODE=#{l.tsdqbm}
					     	 )
					    </if>
					     )
	</select>
	<select id="queryGcgjById" resultMap="gcgj_lx" parameterType="string">
		select jh.id,jh.fapgdw,jh.fascdw,jh.faspsj,jh.spwh,jh.tzgs,jh.jsxz,jh.jsnr,
       		jh.sbnf,jh.jhkgsj,jh.jhwgsj,jh.xdsj,jh.xmmc,jh.yhlb,jh.sjdw,jh.sjpfdw,
       		jh.sjlmlx,jh.dc,jh.jc,jh.mc,jh.lmkd,jh.pfwh,jh.pfsj,jh.pfztz,jh.jhsybzje,
       		jh.jhsydfzcje,jh.sfsqablbz,jh.ablbzsqwh,jh.sftqss,jh.jhxdwh,jh.gksjwh,
       		jh.sjpfwh,jh.sfgyhbm,jh.gkbgmc,jh.sjsgtmc,jh.bz,
       		l.lxmc,l.lxbm,l.jsdd,l.qdzh,l.zdzh,l.qzlc,l.gydw,l.xzqhdm,l.xzqhmc,
       		l.yjsdj,l.ylmlx,l.yhlc,l.bhnr
		from PLAN_lx_GCGJ l right JOIN Plan_Gcgj jh on l.jhid=jh.id 
		where jh.id=#{id}
	</select>
	<select id="queryGcgjNfs" resultType="treenode">
		 select distinct t.sbnf as text from PLAN_GCgJ t order by t.sbnf
	</select>
	<delete id="dropGcgjById" parameterType="java.util.List">
		delete from plan_gcgj jh where jh.id=#{id}
	</delete>
	<update id="editGcgjById" parameterType="plan_gcgj">
		update plan_gcgj set sbnf=#{sbnf},
			<if test="jhkgsj!=null and jhkgsj!=''">
				jhkgsj=#{jhkgsj},
			</if>
			<if test="jhwgsj!=null and jhwgsj!=''">
				jhwgsj=#{jhwgsj},
			</if>
			<if test="xdsj!=null and xdsj!=''">
				xdsj=#{xdsj},
			</if>
			<if test="pfsj!=null and pfsj!=''">
				pfsj=#{pfsj},
			</if>
			xmmc=#{xmmc},yhlb=#{yhlb},sjdw=#{sjdw},sjpfdw=#{sjpfdw},sjlmlx=#{sjlmlx},
			dc=#{dc},jc=#{jc},mc=#{mc},lmkd=#{lmkd},pfwh=#{pfwh},pfztz=#{pfztz},jhsybzje=#{jhsybzje},
			jhsydfzcje=#{jhsydfzcje},sfsqablbz=#{sfsqablbz},ablbzsqwh=#{ablbzsqwh},sftqss=#{sftqss},
			jhxdwh=#{jhxdwh},gksjwh=#{gksjwh},sjpfwh=#{sjpfwh},sfgyhbm=#{sfgyhbm},bz=#{bz},
			fapgdw=#{fapgdw},fascdw=#{fascdw},faspsj=#{faspsj},spwh=#{spwh},tzgs=#{tzgs},
			jsxz=#{jsxz},jsnr=#{jsnr}
		where id=#{id}
	</update>
	<update id="editGcgjStatus" parameterType="plan_gcgj">
		update plan_gcgj set 
			<if test="sbbm!=null">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null">sbsj=#{sbsj},</if>
			<if test="sbzt!=null">sbzt=#{sbzt},</if>
			<if test="spbm!=null">spbm=#{spbm},</if>
			<if test="spbmdm!=null">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null">spsj=#{spsj},</if>
			<if test="spzt!=null">spzt=#{spzt},</if>
			<if test="bcapzj!=null">bcapzj=#{bcapzj},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>

	<insert id="insertGcgj_jh" parameterType="hashMap">
		insert into plan_gcgj (id,fapgdw,fascdw,
			faspsj,spwh,tzgs,jsxz,jsnr,
			xmmc,lmkd,sftqss,sbnf,jhkgsj,
			jhwgsj,sjdw,sjpfdw,pfwh,pfsj,
			yhlb,sjlmlx,dc,jc,mc,
			pfztz,jhsybzje,jhsydfzcje,sfsqablbz,ablbzsqwh,
			sfgyhbm,gksjwh,sjpfwh,bz,sfylsjl)
		values (#{jhid},#{12},#{13},
			to_date(#{14},'yyyy-mm-dd'),#{15},#{16},#{17},#{18},
			#{19},#{20},#{21},#{22},to_date(#{23},'yyyy-mm-dd'),
			to_date(#{24},'yyyy-mm-dd'),#{25},#{26},#{27},to_date(#{28},'yyyy-mm-dd'),
			#{29},#{30},#{31},#{32},#{33},
			#{34},#{35},#{36},#{37},#{38},
			#{39},#{40},#{41},#{42},#{sfylsjl})
	</insert>
	<insert id="insertGcgj_lx" parameterType="hashMap">
		insert into plan_lx_gcgj (id,jhid,gydw,gydwdm,xzqhdm,xzqhmc,lxbm,
			lxmc,jsdd,bhnr,ylmlx,qdzh,zdzh,qzlc,yhlc,TBSJ,TBBMBH,yjsdj) 
		values(sys_guid(),#{jhid},#{0},(select id from XTGL_DEPARTMENT t where t.name = #{0}),#{1},#{2},#{3},
			#{4},#{5},#{6},#{7},#{8},#{9},#{10},#{11},#{tbsj},#{gydwdm},#{yjsdj})
	</insert>
	<select id="queryGPSBylxbm" parameterType="plan_lx_gcgj" resultType="int">
		select count(*) from JXJCK_2013.GPSROAD t 
		where t.roadcode=#{lxbm} and t.roadstart=#{qdzh} and t.roadends=#{zdzh}
	</select>
	<select id="queryGPSBylxbm2" parameterType="plan_lx_gcgj" resultType="plan_lx_gcgj">
		select  t.roadcode as lxbm,t.roadname as lxmc,
		TO_CHAR(t.roadlen,'FM9999999990.099') as qzlc,t.f114 as yjsdj
		 from JXJCK_2013.GPSROAD t where 
		t.roadcode=#{lxbm} and t.roadstart=#{qdzh} and t.roadends=#{zdzh} and t.f044=#{gydwdm}
	</select>
	<select id="querySumGcgj" resultMap="gcgj_lx" parameterType="java.util.Map">
		select count(id) as id,sum(pfztz) as pfztz,sum(jhsybzje) as jhsybzje,sum(jhsydfzcje) as jhsydfzcje
			,sum(qzlc) as qzlc,sum(yhlc) as yhlc from(
			select count(jh.id) as id,sum(lx.qzlc) as qzlc,sum(lx.yhlc) as yhlc,sum(jh.pfztz) as pfztz,
			sum(jh.jhsybzje) as jhsybzje,sum(jh.jhsydfzcje) as jhsydfzcje from plan_lx_gcgj lx right join plan_gcgj jh on (lx.jhid=jh.id)
			where 1=1
			<if test="lx.gydwdm!=null and lx.gydwdm!=''">
				and lx.gydwdm like #{lx.gydwdm}
			</if>
			<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='')">
				and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
			</if>
			<if test="jh.sbzt!=null and jh.sbzt!=''">
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.spzt!=null and jh.spzt!=''">
				and jh.spzt=#{jh.spzt}
			</if>
			group by jh.id)
	</select>
	<select id="queryJlBylx" parameterType="plan_lx_gcgj" resultType="int">
		select count(*) from plan_lx_gcgj lx right join plan_gcgj jh on (lx.jhid=jh.id) 
		where <![CDATA[ lx.lxbm=#{lxbm} and (lx.qdzh>=#{qdzh} or lx.zdzh<#{zdzh}) and jh.sbnf<#{jhid}]]>
	</select>
	<delete id="dropGcgjLxByJhid" parameterType="java.util.List">
		delete from plan_lx_gcgj where jhid=#{String}
	</delete>
	<update id="uploadGcgjFile" parameterType="plan_gcgj">
		update plan_gcgj jh set 
		<if test="gkbgmc!=null and gkbgmc!=''">
			jh.GKBGMC=#{gkbgmc},
		</if>
		<if test="gkbgwj!=null">
			jh.gkbgwj=#{gkbgwj}
		</if>
		<if test="sjsgtmc!=null and sjsgtmc!=''">
			jh.SJSGTMC=#{sjsgtmc},
		</if>
		<if test="sjsgtwj!=null">
			jh.sjsgtwj=#{sjsgtwj}
		</if>
		where jh.id=#{id}
	</update>
	<select id="queryGjwjById" parameterType="plan_gcgj" resultType="plan_gcgj">
		select j.gkbgmc,j.gkbgwj,j.sjsgtmc,j.sjsgtwj from plan_gcgj j where id=#{id}
	</select>
	<select id="queryJhExist" parameterType="plan_lx_gcgj" resultType="int">
		select count(*) from plan_lx_gcgj lx right join plan_gcgj jh on (lx.jhid=jh.id) 
		where lx.lxbm=#{lxbm} and lx.qdzh=#{qdzh} and lx.zdzh=#{zdzh} and jh.sbnf=#{jhid}
	</select>
	<select id="queryTsdqByXzqh" resultType="string" parameterType="string">
		select bt.areaname from bt_xzqhtsdq xz right join bt_specialarea bt on (xz.areacode=bt.areacode) where xz.xzqhdm=#{_parameter}
	</select>
	<select id="queryBzzj" resultType="flwbzbz" parameterType="flwbzbz">
		select * from plan_flwbzbz f where 
		f.xmlx=#{xmlx} and f.gldj=#{gldj} and f.jsdj=#{jsdj} 
		<if test="tsdq==null or tsdq==''">
			and f.tsdq is null
		</if>
		<if test="tsdq!=null and tsdq!=''">
			and f.tsqd =#{tsdq}
		</if>
	</select>
	<insert id="insertPlan_lx_Gcgj" parameterType="plan_lx_gcgj">
		insert into plan_lx_gcgj (id,lxmc,lxbm,xzqhdm,xzqhmc,jsdd,gydw,gydwdm,bhnr,
		qdzh,zdzh,qzlc,yhlc,ylmlx,yjsdj,jhid,tbsj,tbbmbh)
		values(sys_guid(),#{lxmc},#{lxbm},#{xzqhdm},#{xzqhmc},#{jsdd},#{gydw},#{gydwdm},#{bhnr},
		#{qdzh},#{zdzh},#{qzlc},#{yhlc},#{ylmlx},#{yjsdj},#{jhid},#{tbsj},#{tbbmbh})
	</insert>
</mapper>