<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.planwqgzsj">
	<select id="selectwqjhkgl" parameterType="planwqgzsj" resultType="planwqgzsj">
			select * from (
		select rownum num ,t.*,decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报')) sbzt2 from
		 (select t.*,xm.xzqhdm,xm.tbbmbm,xm.lxmc,xm.qlmc,xm.jsdj,xm.akjfl,xm.lxbm, 
		 xm.xzqhmc,xm.gydw,xm.qlbh
		 from plan_wqgz t join sck_wqgz sc on t.sckid=sc.sckid join xmk_wqgz xm on xmkid=xm.id where 1=1 
		 		<if test="sfylrbwqk!='' and sfylrbwqk!= null ">
 					and t.sfylrbwqk like '%'||(#{sfylrbwqk})||'%'
				</if>
 				<if test="tsdq!='' and tsdq!= null ">
 					and xm.tsdq like '%'||#{tsdq}||'%'
 				</if>) t where 1=1
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="qlmc!='' and qlmc!= null ">
			and qlmc like '%'||(#{qlmc})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			and jsdj like '%'||(#{jsdj})||'%'
		</if>
		<if test="akjfl!='' and akjfl!= null ">
			and akjfl like #{akjfl}||'%'
		</if>
		<if test="sfylsjl!='' and sfylsjl!= null ">
 			and sfylsjl like #{sfylsjl}||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like (#{lxbm})||'%'
		</if>
		<if test="sbnf!='' and sbnf!= null ">
			and sbnf like '%'||(#{sbnf})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报'))=#{sbzt}
		</if>
		<if test="shzt!='' and shzt!= null ">
			and decode(SPZT,0,'未审核',1,'已审核')=#{shzt}
		</if>
		) t1 where t1.num &lt;=(#{page} * #{rows}) and
		t1.num>(#{page}-1)*#{rows}
		order by decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报')),spzt desc
	</select>
	<select id="selectwqjhkglcount" parameterType="planwqgzsj" resultType="int">
		select count(*) from 
		(select t.*,xm.xzqhdm,xm.tbbmbm,xm.lxmc,xm.qlmc,xm.jsdj,xm.akjfl,xm.lxbm from plan_wqgz t join sck_wqgz sc on t.sckid=sc.sckid join xmk_wqgz xm on xmkid=xm.id where 1=1 
		 		<if test="sfylrbwqk!='' and sfylrbwqk!= null ">
 					and t.sfylrbwqk like '%'||(#{sfylrbwqk})||'%'
				</if>
 				<if test="tsdq!='' and tsdq!= null ">
 					and xm.tsdq like '%'||#{tsdq}||'%'
 				</if>) t where 1=1
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="qlmc!='' and qlmc!= null ">
			and qlmc like '%'||(#{qlmc})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			and jsdj like '%'||(#{jsdj})||'%'
		</if>
		<if test="akjfl!='' and akjfl!= null ">
			and akjfl like #{akjfl}||'%'
		</if>
		<if test="sfylsjl!='' and sfylsjl!= null ">
 			and sfylsjl like #{sfylsjl}||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like (#{lxbm})||'%'
		</if>
		<if test="sbnf!='' and sbnf!= null ">
			and sbnf like '%'||(#{sbnf})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报'))=#{sbzt}
		</if>
		<if test="shzt!='' and shzt!= null ">
			and decode(SPZT,0,'未审核',1,'已审核')=#{shzt}
		</if>
	</select>
		<select id="loadwqjhkglCount" parameterType="planwqgzsj" resultType="planwqgzsj">
		select count(*) sl,sum(pfztz) pfztz,decode(sfylrbwqk,'是',decode(sum(jhsybzje),null,0,sum(jhsybzje))) jhsybzje,sum(jhsydfzcje) jhsydfzcje,decode(sfylrbwqk,'否',decode(sum(shengbz),null,0,sum(shengbz))) shengbz from 
		(select t.*,xm.xzqhdm,xm.tbbmbm,xm.lxmc,xm.qlmc,xm.jsdj,xm.akjfl,xm.lxbm from plan_wqgz t join sck_wqgz sc on t.sckid=sc.sckid join xmk_wqgz xm on xmkid=xm.id where 1=1 
		 		<if test="sfylrbwqk!='' and sfylrbwqk!= null ">
 					and t.sfylrbwqk like '%'||(#{sfylrbwqk})||'%'
				</if>
 				<if test="tsdq!='' and tsdq!= null ">
 					and xm.tsdq like '%'||#{tsdq}||'%'
 				</if>) t where 1=1
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="qlmc!='' and qlmc!= null ">
			and qlmc like '%'||(#{qlmc})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			and jsdj like '%'||(#{jsdj})||'%'
		</if>
		<if test="akjfl!='' and akjfl!= null ">
			and akjfl like #{akjfl}||'%'
		</if>
		<if test="sfylsjl!='' and sfylsjl!= null ">
 			and sfylsjl like #{sfylsjl}||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like (#{lxbm})||'%'
		</if>
		<if test="sbnf!='' and sbnf!= null ">
			and sbnf like '%'||(#{sbnf})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报'))=#{sbzt}
		</if>
		<if test="shzt!='' and shzt!= null ">
			and decode(SPZT,0,'未审核',1,'已审核')=#{shzt}
		</if>
		group by sfylrbwqk
	</select>
	<select id="loadwqgzjhkbyid" parameterType="string" resultType="planwqgzsj">
		select * from plan_wqgz where id=#{value}
	</select>
	<select id="loadwqgzsckbyid" parameterType="string" resultType="planwqgzsj">
		select * from sck_wqgz where sckid=#{value}
	</select>
	<select id="loadwqgzxmkbyid" parameterType="string" resultType="planwqgzsj">
		select * from xmk_wqgz where id=#{value}
	</select>
	<select id="cxtiaojian" parameterType="string" resultType="planwqgzsj">
		select sckid,sc.jsxz,sc.sck_qlbh,scqlqk,scqlqc,xm.tsdq,xm.akjfl,sc.sfylrbwqk,sc.bzls from sck_wqgz sc left join xmk_wqgz xm on sc.xmkid=xm.id
		where sckid=#{value}
	</select>
	<select id="selectshibz" parameterType="planwqgzsj" resultType="wqbzbz">
		select * from xtgl_wqbzbz where 1=1 and bzjb='市级'
		<if test="sck_qlbh!='' and sck_qlbh!= null ">
			and jsdj like '%'||(substr(#{sck_qlbh},0,1))||'%'
		</if>
		<if test="akjfl!='' and akjfl!= null ">
			and qllx = #{akjfl}
		</if>
		<if test="jsxz!='' and jsxz!= null ">
			and jsxz = #{jsxz}
		</if>
	</select>
	<select id="selectshengbz" parameterType="planwqgzsj" resultType="wqbzbz">
		select * from xtgl_wqbzbz where 1=1 and bzjb='省级'
		<if test="sck_qlbh!='' and sck_qlbh!= null ">
			and jsdj like '%'||(substr(#{sck_qlbh},0,1))||'%'
		</if>
		<if test="akjfl!='' and akjfl!= null ">
			and qllx = #{akjfl}
		</if>
		<if test="jsxz!='' and jsxz!= null ">
			and jsxz = #{jsxz}
		</if>
	</select>
	<update id="editwqgzsj" parameterType="planwqgzsj">
		update plan_wqgz set sbnf=#{sbnf}
		<if test="jhkgsj!=null">,jhkgsj=#{jhkgsj}</if>
		<if test="jhwgsj!=null">,jhwgsj=#{jhwgsj}</if>
		<if test="sjdw!=null">,sjdw=#{sjdw}</if>
		<if test="sjpfdw!=null">,sjpfdw=#{sjpfdw}</if>
		<if test="pfwh!=null">,pfwh=#{pfwh}</if>
		<if test="pfsj!=null">,pfsj=#{pfsj}</if>
		<if test="sfsqablbz!=null">,sfsqablbz=#{sfsqablbz}</if>
		<if test="ablbzsqwh!=null">,ablbzsqwh=#{ablbzsqwh}</if>
		<if test="pfztz!=null">,pfztz=#{pfztz}</if>
		<if test="shengbz!=null">,shengbz=#{shengbz}</if>
		<if test="jhsydfzcje!=null">,jhsydfzcje=#{jhsydfzcje}</if>
		<if test="qlszxz!=null">,qlszxz=#{qlszxz}</if>
		<if test="qljsgm!=null">,qljsgm=#{qljsgm}</if>
		<if test="zyjsnr!=null">,zyjsnr=#{zyjsnr}</if>
		<if test="sfylrbwqk!=null">,sfylrbwqk=#{sfylrbwqk}</if>
		<if test="bz!=null">,bz=#{bz}</if>
		where id=#{id}
	</update>
	<select id="selectwqjhksb" parameterType="planwqgzsj" resultType="planwqgzsj">
			select * from (
		select rownum num ,t.*,decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报')) sbzt2 from
		 (select t.*,xm.xzqhdm,xm.tbbmbm,xm.lxmc,xm.qlmc,xm.jsdj,xm.akjfl,xm.lxbm, 
		 xm.xzqhmc,xm.gydw,xm.qlbh
		 from plan_wqgz t join sck_wqgz sc on t.sckid=sc.sckid join xmk_wqgz xm on xmkid=xm.id where 1=1 and t.jh_sbthcd>=#{sbthcd}
		 		<if test="sfylrbwqk!='' and sfylrbwqk!= null ">
 					and t.sfylrbwqk like '%'||(#{sfylrbwqk})||'%'
				</if>
 				<if test="tsdq!='' and tsdq!= null ">
 					and xm.tsdq like '%'||#{tsdq}||'%'
 				</if>) t where 1=1
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="qlmc!='' and qlmc!= null ">
			and qlmc like '%'||(#{qlmc})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			and jsdj like '%'||(#{jsdj})||'%'
		</if>
		<if test="akjfl!='' and akjfl!= null ">
			and akjfl like #{akjfl}||'%'
		</if>
		<if test="sfylsjl!='' and sfylsjl!= null ">
 			and sfylsjl like #{sfylsjl}||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like (#{lxbm})||'%'
		</if>
		<if test="sbnf!='' and sbnf!= null ">
			and sbnf like '%'||(#{sbnf})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报'))=#{sbzt}
		</if>
		<if test="shzt!='' and shzt!= null ">
			and decode(SPZT,0,'未审核',1,'已审核')=#{shzt}
		</if>
		) t1 where t1.num &lt;=(#{page} * #{rows}) and
		t1.num>(#{page}-1)*#{rows}
		order by decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报')),spzt desc
	</select>
	<select id="selectwqjhksbcount" parameterType="planwqgzsj" resultType="int">
		select count(*) from 
		(select t.*,xm.xzqhdm,xm.tbbmbm,xm.lxmc,xm.qlmc,xm.jsdj,xm.akjfl,xm.lxbm from plan_wqgz t join sck_wqgz sc on t.sckid=sc.sckid join xmk_wqgz xm on xmkid=xm.id where 1=1 and t.jh_sbthcd>=#{sbthcd} 
		 		<if test="sfylrbwqk!='' and sfylrbwqk!= null ">
 					and t.sfylrbwqk like '%'||(#{sfylrbwqk})||'%'
				</if>
 				<if test="tsdq!='' and tsdq!= null ">
 					and xm.tsdq like '%'||#{tsdq}||'%'
 				</if>) t where 1=1
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="qlmc!='' and qlmc!= null ">
			and qlmc like '%'||(#{qlmc})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			and jsdj like '%'||(#{jsdj})||'%'
		</if>
		<if test="akjfl!='' and akjfl!= null ">
			and akjfl like #{akjfl}||'%'
		</if>
		<if test="sfylsjl!='' and sfylsjl!= null ">
 			and sfylsjl like #{sfylsjl}||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like (#{lxbm})||'%'
		</if>
		<if test="sbnf!='' and sbnf!= null ">
			and sbnf like '%'||(#{sbnf})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报'))=#{sbzt}
		</if>
		<if test="shzt!='' and shzt!= null ">
			and decode(SPZT,0,'未审核',1,'已审核')=#{shzt}
		</if>
	</select>
	<select id="loadwqjhksbCount" parameterType="planwqgzsj" resultType="planwqgzsj">
		select count(*) sl,sum(pfztz) pfztz,decode(sfylrbwqk,'是',decode(sum(jhsybzje),null,0,sum(jhsybzje))) jhsybzje,sum(jhsydfzcje) jhsydfzcje,decode(sfylrbwqk,'否',decode(sum(shengbz),null,0,sum(shengbz))) shengbz,decode(sum(xdzj),null,0,sum(xdzj)) xdzj from 
		(select t.*,xm.xzqhdm,xm.tbbmbm,xm.lxmc,xm.qlmc,xm.jsdj,xm.akjfl,xm.lxbm,zj.xdzj from plan_wqgz t join sck_wqgz sc on t.sckid=sc.sckid join xmk_wqgz xm on xmkid=xm.id left join plan_zjxd zj on t.id=zj.xmid where 1=1  and t.jh_sbthcd>=#{sbthcd} 
		 		<if test="sfylrbwqk!='' and sfylrbwqk!= null ">
 					and t.sfylrbwqk like '%'||(#{sfylrbwqk})||'%'
				</if>
 				<if test="tsdq!='' and tsdq!= null ">
 					and xm.tsdq like '%'||#{tsdq}||'%'
 				</if>) t where 1=1
		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
		<if test="lxmc!='' and lxmc!= null ">
			and lxmc like '%'||(#{lxmc})||'%'
		</if>
		<if test="qlmc!='' and qlmc!= null ">
			and qlmc like '%'||(#{qlmc})||'%'
		</if>
		<if test="jsdj!='' and jsdj!= null ">
			and jsdj like '%'||(#{jsdj})||'%'
		</if>
		<if test="akjfl!='' and akjfl!= null ">
			and akjfl like #{akjfl}||'%'
		</if>
		<if test="sfylsjl!='' and sfylsjl!= null ">
 			and sfylsjl like #{sfylsjl}||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
			and lxbm like (#{lxbm})||'%'
		</if>
		<if test="sbnf!='' and sbnf!= null ">
			and sbnf like '%'||(#{sbnf})||'%'
		</if>
		<if test="sbzt!='' and sbzt!= null ">
			and decode(JH_SBTHCD,#{sbthcd},'未上报',decode(SBZT,0,'未上报',1,'已上报'))=#{sbzt}
		</if>
		<if test="shzt!='' and shzt!= null ">
			and decode(SPZT,0,'未审核',1,'已审核')=#{shzt}
		</if>
		group by sfylrbwqk
	</select>
	<update id="sbWqgzjh" parameterType="hashmap">
		update plan_wqgz set sbzt='1',sbsj=sysdate,sbbm=#{sbbm},jh_sbthcd=#{sbthcd}
		where id=#{id}
	</update>
	<update id="shtyWqgzsbById" parameterType="planwqgzsj">
		update plan_wqgz set sbzt='1',sbsj=sysdate,sbbm=#{sbbm},jh_sbthcd=#{sbthcd},shzt1='已审核',shyj1='同意'
		where id=#{id}
	</update>
	<update id="shbtyWqgzsbById" parameterType="planwqgzsj">
		update plan_wqgz set sbzt='0',sbsj=sysdate,sbbm=#{sbbm},jh_sbthcd=#{sbthcd},shzt1='未审核',shyj1=#{shyj1}
		where id=#{id}
	</update>
	<update id="shtyWqgzshById" parameterType="planwqgzsj">
		update plan_wqgz set spzt='1',spsj=sysdate,spbm=#{sbbm},jh_sbthcd=#{sbthcd},shzt='已审核',shyj='同意'
		where id=#{id}
	</update>
	<update id="shbtyWqgzshById" parameterType="planwqgzsj">
		update plan_wqgz set spzt='0',spsj=sysdate,spbm=#{sbbm},jh_sbthcd=#{sbthcd},shzt='未审核',shyj=#{shyj1}
		where id=#{id}
	</update>
</mapper>
