<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_zjxd">
	<select id="queryZjxdByXmId" parameterType="string" resultType="plan_zjxd">
		select * from plan_zjxd where xmid=#{id} order by xdnf
	</select>
	<select id="queryZjxdSumByXmid" parameterType="string" resultType="plan_zjxd">
		select count(z.xmid) as xmid,sum(z.xdzj) as xdzj from plan_zjxd z 
		where z.xmid=#{id} group by z.xmid
	</select>
	<select id="queryGydwmcById" parameterType="string" resultType="string">
		select name from xtgl_department where id=#{id}
	</select>
	<select id="queryZjxdCount" parameterType="string" resultType="int">
		select count(*) from plan_zjxd where xmid=#{id}
	</select>
	<select id="queryZjxdById" parameterType="string" resultType="plan_zjxd">
		select * from plan_zjxd where id=#{id}
	</select>
	<select id="queryZjxdExistById" parameterType="string" resultType="int">
		select count(*) from plan_zjxd where xmid=#{id}
	</select>
	<insert id="addZjxd" parameterType="plan_zjxd">
		insert into plan_zjxd (id,xmid,xdnf,xdzj,sfzj,tbdw,tbtime,btzzj,stz,jhxdwh) 
		values (SYS_GUID(),#{xmid},#{xdnf},#{xdzj},#{sfzj},#{tbdw},#{tbtime},#{btzzj},#{stz},#{jhxdwh})
	</insert>
	<insert id="insertBatch" parameterType="plan_zjxd">
		insert into plan_zjxd (id,xmid,xdnf,xdzj,sfzj,tbdw,tbtime,btzzj,stz,jhxdwh) 
		values (SYS_GUID(),#{xmid},#{xdnf},#{xdzj},#{sfzj},#{tbdw},#{tbtime},#{btzzj},#{stz},#{jhxdwh})
	</insert>
	<update id="editZjxd" parameterType="plan_zjxd">
		update plan_zjxd set 
			<if test="xdnf!=null and xdnf!=''">
				xdnf=#{xdnf},
			</if>
			<if test="xdzj!=null and xdzj!=''">
				xdzj=#{xdzj},
			</if>
			<if test="btzzj!=null and btzzj!=''">
				btzzj=#{btzzj},
			</if>
			<if test="stz!=null and stz!=''">
				stz=#{stz},
			</if>
			<if test="jhxdwh!=null and jhxdwh!=''">
				jhxdwh=#{jhxdwh},
			</if>
			<if test="sfzj!=null and sfzj!=''">
				sfzj=#{sfzj},
			</if>
			<if test="tbdw!=null and tbdw!=''">
				tbdw=#{tbdw},
			</if>
			<if test="tbtime!=null and tbtime!=''">
				tbtime=#{tbtime},
			</if>
			id=#{id}
		where id=#{id}
	</update>
	<delete id="dropZjxdById" parameterType="string">
		delete from plan_zjxd zj where zj.id=#{id}
	</delete>
	<insert id="insertZjzj" parameterType="plan_zjzj">
		insert into plan_zjzj (id,planid,nf,bbzje,ztz,stz) 
		values(sys_guid(),#{planId},#{nf},#{bbzje},#{ztz},#{stz})
	</insert>
	<select id="queryTsdqByXzqh" parameterType="treenode" resultType="treenode">
		select t.name as name from xtgl_xzqhtsdq s left join xtgl_tsdq t on s.parent=t.id where s.xzqhdm =#{id}
	</select>
</mapper>