<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_gcsj">
	<resultMap id="gcsj_jh" type="plan_gcsj">
		<id property="id" column="id" />
		<result property="jhnf" column="jhnf"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="sjdw" column="sjdw"/>
		<result property="sjpfdw" column="sjpfdw"/>
		<result property="pfwh" column="pfwh"/>
		<result property="pfsj" column="pfsj"/>
		<result property="ql" column="ql"/>
		<result property="ql_m" column="ql_m"/>
		<result property="sd" column="sd"/>
		<result property="sd_m" column="sd_m"/>
		<result property="hd" column="hd"/>
		<result property="ljtsf" column="ljtsf"/>
		<result property="dc" column="dc"/>
		<result property="jc" column="jc"/>
		<result property="lqlm" column="lqlm"/>
		<result property="snlm" column="snlm"/>
		<result property="gjhjsdj" column="gjhjsdj"/>
		<result property="pftz" column="pftz"/>
		<result property="jhsybbzje" column="jhsybbzje"/>
		<result property="jhsydfzczj" column="jhsydfzczj"/>
		<result property="sfsqablbz" column="sfsqablbz"/>
		<result property="ablbzsqwh" column="ablbzsqwh"/>
		<result property="remarks" column="remarks"/>
		<result property="tbsj" column="tbsj"/>
		<result property="tbbm" column="tbbm"/>
		<result property="sbzt" column="sbzt"/>
		<result property="sbbm" column="sbbm"/>
		<result property="sbsj" column="sbsj"/>
		<result property="spzt" column="spzt"/>
		<result property="spbm" column="spbm"/>
		<result property="spsj" column="spsj"/>
		<result property="xmwybh" column="xmwybh"/>
		<result property="xdsj" column="xdsj"/>
		<result property="gkbgmc" column="gkbgmc"/>
		<result property="gkbgwj" column="gkbgwj"/>
		<result property="sjsgtmc" column="sjsgtmc"/>
		<result property="sjsgtwj" column="sjsgtwj"/>
		<result property="sjkgsj" column="sjkgsj"/>
		<result property="sjwgsj" column="sjwgsj"/>
		<result property="sgdw" column="sgdw"/>
		<result property="jldw" column="jldw"/>
		<result property="htje" column="htje"/>
		<result property="sgxkwj" column="sgxkwj"/>
		<result property="jgtcwj" column="jgtcwj"/>
		<result property="jgyswj" column="jgyswj"/>
		<result property="wjsczt" column="wjsczt"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="wjgyy" column="wjgyy"/>
		<result property="yjwgsj" column="yjwgsj"/>
		<result property="xmmc" column="xmmc"/>
		<result property="jsjsbz" column="jsjsbz"/>
		<result property="sftqss" column="sftqss"/>
		<result property="jsdw" column="jsdw"/>
		<result property="jhxdwh" column="jhxdwh"/>
		<result property="gksjwh" column="gksjwh"/>
		<result property="sjpfwh" column="sjpfwh"/>
		<result property="wjzt" column="wjzt"/>
		<result property="wjsj" column="wjsj"/>
		<result property="gsztz" column="gsztz"/>
		<result property="sfqxkg" column="sfqxkg"/>
		<result property="fapgdw" column="fapgdw"/>
		<result property="fascdw" column="fascdw"/>
		<result property="faspsj" column="faspsj"/>
		<result property="spwh" column="spwh"/>
		<result property="tzgs" column="tzgs"/>
		<result property="jsxz" column="jsxz"/>
		<result property="jsnr" column="jsnr"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<result property="sfylsjl" column="sfylsjl"/>
		<result property="xmmc" column="xmmc"/>
		<collection property="plan_lx_gcsjs" column="jhid" javaType="ArrayList" ofType="plan_lx_gcsj" resultMap="gcsj_lx"/>
	</resultMap>
	<resultMap id="gcsj_lx" type="plan_lx_gcsj">
		<result property="jhid" column="jhid" />
		<result property="lxmc" column="lxmc"/>
		<result property="qzlc" column="qzlc"/>
		<result property="xmlc" column="xmlc"/>
		<result property="lxbm" column="lxbm"/>
		<result property="ylxbm" column="ylxbm"/>
		<result property="xzqhdm" column="xzqhdm"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="xqdzh" column="xqdzh"/>
		<result property="xzdzh" column="xzdzh"/>
		<result property="yqdzh" column="yqdzh"/>
		<result property="yzdzh" column="yzdzh"/>
		<result property="qzlc" column="qzlc"/>
		<result property="xmlc" column="xmlc"/>
		<result property="gydw" column="gydw"/>
		<result property="gydwbm" column="gydwbm"/>
		<result property="yjsdj" column="yjsdj"/>
		<result property="bhnr" column="bhnr"/>
		<result property="sczt" column="sczt"/>
		<result property="tbsj" column="tbsj"/>
		<result property="tbbmbh" column="tbbmbh"/>
		<result property="gydwdm" column="gydwdm"/>
		<result property="scbz" column="scbz"/>
		<result property="scbmbm" column="scbmbm"/>
		<result property="bz" column="bz"/>
		<result property="qdmc" column="qdmc"/>
		<result property="zdmc" column="zdmc"/>
		<result property="tsdq" column="tsdq"/>
		<result property="lyllqk" column="lyllqk"/>
		<result property="dlqlbm" column="dlqlbm"/>
		<result property="dlqlzxzh" column="dlqlzxzh"/>
	</resultMap>
	
	<select id="queryGcsjList" parameterType="java.util.Map" resultMap="gcsj_jh">
		select * from (
			select rownum as num,t.* from (
				select jh.xmmc,jh.sfylsjl,jh.jgzt,jh.kgzt,jh.jh_sbthcd,jh.id,jh.sbzt,jh.spzt,jh.jhnf,
				jh.jhkgsj,jh.jhwgsj,jh.pftz,jh.jhsybbzje,jh.JHSYDFZCZJ,
				lx.gydw,lx.xzqhdm,lx.xzqhmc,lx.lxbm,lx.lxmc,lx.qdzh,lx.zdzh,lx.xmlc
			 	from PLAN_GCSJ jh right join Plan_Lx_Gcsj lx on lx.jhid=jh.id
			 	where 1=1
			 	<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">
					and jh.jh_sbthcd=#{jh.jh_sbthcd}
				</if>
				<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
					and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
				</if>
			 	<if test="jh.jhnf!=null and jh.jhnf!=''">
					and jh.jhnf =#{jh.jhnf}
				</if>
				<if test="jh.sbzt!=null and jh.sbzt!=''">
					and jh.sbzt=#{jh.sbzt}
				</if>
				<if test="jh.spzt!=null and jh.spzt!=''">
					and jh.spzt=#{jh.spzt}
				</if>
				<if test="jh.kgzt!=null and jh.kgzt!=''">
		 			and jh.kgzt=#{jh.kgzt}
		 		</if>
		 		<if test="jh.jgzt!=null and jh.jgzt!=''">
		 			and jh.jgzt=#{jh.jgzt}
		 		</if>
		 		<if test="jh.sfylsjl!=null and jh.sfylsjl!=''">
		 			and jh.sfylsjl=#{jh.sfylsjl}
		 		</if>
		 		<if test="lx.gydwdm!=null and lx.gydwdm!=''">
					and ${lx.gydwdm}
				</if>
				<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
					and ${lx.xzqhdm}
				</if>
				<if test="lx.lxmc!=null and lx.lxmc!=''">
					and lx.lxmc like '%'||#{lx.lxmc}||'%'
				</if>
				<if test="lx.yjsdj!=null and lx.yjsdj!=''">
					and lx.yjsdj=#{lx.yjsdj}
				</if>
				<if test="lx.lxbm!=null and lx.lxbm!=''">
					and lx.lxbm like '%'||#{lx.lxbm}||'%'
				</if>
				<if test="lx.tsdqbm!=null and lx.tsdqbm!=''">
					and lx.xzqhdm in (select t.xzqhdm from xtgl_xzqhtsdq t where t.parent =#{lx.tsdqbm})
				</if>
				order by jh.jhnf desc,jh.jh_sbthcd
				) t  order by t.jhnf desc,t.jh_sbthcd
		 )
		 where  <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryGcsjList2" parameterType="java.util.Map" resultMap="gcsj_jh">
		select * from (
			select rownum as num,t.* from (
				select jh.xmmc,jh.sfylsjl,jh.jgzt,jh.kgzt,jh.jh_sbthcd,jh.id,jh.sbzt,jh.spzt,jh.jhnf,jh.jhkgsj,jh.jhwgsj,jh.pftz,
				lx.gydw,lx.xzqhmc,lx.lxbm,lx.lxmc,lx.qdzh,lx.zdzh,lx.xmlc,lx.qzlc
			 	from PLAN_GCSJ jh right join Plan_Lx_Gcsj lx on lx.jhid=jh.id
			 	where 1=1
			 	<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
					and jh.jh_sbthcd=#{jh.jh_sbthcd}
				</if>
			 	<if test="jh.jhnf!=null and jh.jhnf!=''">
					and jh.jhnf =#{jh.jhnf}
				</if>
				<if test="jh.kgzt!=null and jh.kgzt!=''">
		 			and jh.kgzt=#{jh.kgzt}
		 		</if>
		 		<if test="jh.jgzt!=null and jh.jgzt!=''">
		 			and jh.jgzt=#{jh.jgzt}
		 		</if>
		 		<if test="jh.sfylsjl!=null and jh.sfylsjl!=''">
		 			and jh.sfylsjl=#{jh.sfylsjl}
		 		</if>
		 		<if test="lx.gydwdm!=null and lx.gydwdm!=''">
					and ${lx.gydwdm}
				</if>
				<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
					and ${lx.xzqhdm}
				</if>
				<if test="lx.lxmc!=null and lx.lxmc!=''">
					and lx.lxmc like '%'||#{lx.lxmc}||'%'
				</if>
				<if test="lx.yjsdj!=null and lx.yjsdj!=''">
					and lx.yjsdj=#{lx.yjsdj}
				</if>
				<if test="lx.lxbm!=null and lx.lxbm!=''">
					and lx.lxbm like '%'||#{lx.lxbm}||'%'
				</if>
				<if test="lx.tsdqbm!=null and lx.tsdqbm!=''">
					and lx.xzqhdm in (select t.xzqhdm from xtgl_xzqhtsdq t where t.parent =#{lx.tsdqbm})
				</if>
				) t order by t.jhnf,t.jh_sbthcd
		 )
	</select>
	<select id="queryGcsjCount" resultType="int" parameterType="java.util.Map">
		select count(jh.id) from PLAN_GCSJ jh right join Plan_Lx_Gcsj lx on lx.jhid=jh.id
		 	where 1=1
		 	<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">
					and jh.jh_sbthcd=#{jh.jh_sbthcd}
				</if>
				<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
					and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
				</if>
			 	<if test="jh.jhnf!=null and jh.jhnf!=''">
					and jh.jhnf =#{jh.jhnf}
				</if>
				<if test="jh.sbzt!=null and jh.sbzt!=''">
					and jh.sbzt=#{jh.sbzt}
				</if>
				<if test="jh.spzt!=null and jh.spzt!=''">
					and jh.spzt=#{jh.spzt}
				</if>
				<if test="jh.kgzt!=null and jh.kgzt!=''">
		 			and jh.kgzt=#{jh.kgzt}
		 		</if>
		 		<if test="jh.jgzt!=null and jh.jgzt!=''">
		 			and jh.jgzt=#{jh.jgzt}
		 		</if>
		 		<if test="jh.sfylsjl!=null and jh.sfylsjl!=''">
		 			and jh.sfylsjl=#{jh.sfylsjl}
		 		</if>
		 		<if test="lx.gydwdm!=null and lx.gydwdm!=''">
					and ${lx.gydwdm}
				</if>
				<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
					and ${lx.xzqhdm}
				</if>
				<if test="lx.lxmc!=null and lx.lxmc!=''">
					and lx.lxmc like '%'||#{lx.lxmc}||'%'
				</if>
				<if test="lx.yjsdj!=null and lx.yjsdj!=''">
					and lx.yjsdj=#{lx.yjsdj}
				</if>
				<if test="lx.lxbm!=null and lx.lxbm!=''">
					and lx.lxbm like '%'||#{lx.lxbm}||'%'
				</if>
				<if test="lx.tsdqbm!=null and lx.tsdqbm!=''">
					and lx.xzqhdm in (select t.xzqhdm from xtgl_xzqhtsdq t where t.parent =#{lx.tsdqbm})
				</if>
	</select>
	<select id="queryGcsjSum" resultMap="gcsj_jh" parameterType="java.util.Map">
		select count(id) as id, sum(qzlc) as qzlc,sum(xmlc) as xmlc,sum(pftz) as pftz,
		sum(jhsybbzje) as jhsybbzje,sum(jhsydfzczj) as jhsydfzczj from (
			select count(jh.id) as id,sum(lx.qzlc) as qzlc,sum(lx.xmlc) as xmlc,
			sum(jh.pftz) as pftz,sum(jh.jhsybbzje) as jhsybbzje,sum(jh.jhsydfzczj) as jhsydfzczj
			from PLAN_GCSJ jh right join Plan_Lx_Gcsj lx on lx.jhid=jh.id
			where 1=1
			<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">
					and jh.jh_sbthcd=#{jh.jh_sbthcd}
				</if>
				<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
					and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
				</if>
			 	<if test="jh.jhnf!=null and jh.jhnf!=''">
					and jh.jhnf =#{jh.jhnf}
				</if>
				<if test="jh.sbzt!=null and jh.sbzt!=''">
					and jh.sbzt=#{jh.sbzt}
				</if>
				<if test="jh.spzt!=null and jh.spzt!=''">
					and jh.spzt=#{jh.spzt}
				</if>
				<if test="jh.kgzt!=null and jh.kgzt!=''">
		 			and jh.kgzt=#{jh.kgzt}
		 		</if>
		 		<if test="jh.jgzt!=null and jh.jgzt!=''">
		 			and jh.jgzt=#{jh.jgzt}
		 		</if>
		 		<if test="jh.sfylsjl!=null and jh.sfylsjl!=''">
		 			and jh.sfylsjl=#{jh.sfylsjl}
		 		</if>
		 		<if test="lx.gydwdm!=null and lx.gydwdm!=''">
					and ${lx.gydwdm}
				</if>
				<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
					and ${lx.xzqhdm}
				</if>
				<if test="lx.lxmc!=null and lx.lxmc!=''">
					and lx.lxmc like '%'||#{lx.lxmc}||'%'
				</if>
				<if test="lx.yjsdj!=null and lx.yjsdj!=''">
					and lx.yjsdj=#{lx.yjsdj}
				</if>
				<if test="lx.lxbm!=null and lx.lxbm!=''">
					and lx.lxbm like '%'||#{lx.lxbm}||'%'
				</if>
				<if test="lx.tsdqbm!=null and lx.tsdqbm!=''">
					and lx.xzqhdm in (select t.xzqhdm from xtgl_xzqhtsdq t where t.parent =#{lx.tsdqbm})
				</if>
			group by jh.id)
	</select>
	<select id="queryGcsjById" resultMap="gcsj_jh" parameterType="string">
		select jh.*,lx.lxmc,lx.lxbm,lx.yjsdj,lx.qdzh,lx.zdzh,lx.qzlc,lx.gydw,lx.xzqhdm,lx.xzqhmc,lx.xmlc,lx.bhnr,lx.tsdq,
		lx.qdmc,lx.zdmc,lx.lyllqk,lx.dlqlbm,lx.dlqlzxzh
		from PLAN_GCSJ jh right join Plan_Lx_Gcsj lx on lx.jhid=jh.id where jh.id=#{id}
	</select>
	<select id="querySumMessage" resultMap="gcsj_jh">
		select count(t.id) as id,sum(l.qzlc) as qzlc,sum(l.xmlc) as xmlc,sum(t.pftz) as pftz,sum(t.jhsybbzje) as jhsybbzje,sum(t.jhsydfzczj) as jhsydfzczj 
		from plan_gcsj t left join plan_lx_gcsj l on (t.id=l.jhid)
	</select>
	<select id="queryGcsjNfs" resultType="treenode">
		 select distinct jh.jhnf as text from PLAN_GCSJ jh order by jh.jhnf
	</select>
	<delete id="dropGcsjById" parameterType="string">
		delete from plan_gcsj jh where jh.id=#{id}
	</delete>
	<update id="editGcsjById" parameterType="plan_gcsj">
		update plan_gcsj set jhnf=#{jhnf}
		<if test="jhkgsj!=null and jhkgsj!=''">,jhkgsj=#{jhkgsj}</if>
		<if test="jhwgsj!=null and jhwgsj !=''">,jhwgsj=#{jhwgsj}</if>
		<if test="xdsj!=null and xdsj !=''">,xdsj=#{xdsj}</if>
		<if test="pfsj!=null and pfsj !=''">,pfsj=#{pfsj}</if>
		<if test="xmwybh!=null">,xmwybh=#{xmwybh}</if>
		<if test="xmmc!=null">,xmmc=#{xmmc}</if>
		<if test="sjdw!=null">,sjdw=#{sjdw}</if>
		<if test="sjpfdw!=null">,sjpfdw=#{sjpfdw}</if>
		<if test="jsjsbz!=null">,jsjsbz=#{jsjsbz}</if>
		<if test="ql!=null">,ql=#{ql}</if>
		<if test="ql_m!=null">,ql_m=#{ql_m}</if>
		<if test="sd!=null">,sd=#{sd}</if>
		<if test="sd_m!=null">,sd_m=#{sd_m}</if>
		<if test="hd!=null">,hd=#{hd}</if>
		<if test="ljtsf!=null">,ljtsf=#{ljtsf}</if>
		<if test="dc!=null">,dc=#{dc}</if>
		<if test="jc!=null">,jc=#{jc}</if>
		<if test="lqlm!=null">,lqlm=#{lqlm}</if>
		<if test="snlm!=null">,snlm=#{snlm}</if>
		<if test="gjhjsdj!=null">,gjhjsdj=#{gjhjsdj}</if>
		<if test="sftqss!=null">,sftqss=#{sftqss}</if>
		<if test="pfwh!=null">,pfwh=#{pfwh}</if>
		<if test="pftz!=null">,pftz=#{pftz}</if>
		<if test="jhsybbzje!=null">,jhsybbzje=#{jhsybbzje}</if>
		<if test="jhsydfzczj!=null">,jhsydfzczj=#{jhsydfzczj}</if>
		<if test="jhxdwh!=null">,jhxdwh=#{jhxdwh}</if>
		<if test="sfsqablbz!=null">,sfsqablbz=#{sfsqablbz}</if>
		<if test="ablbzsqwh!=null">,ablbzsqwh=#{ablbzsqwh}</if>
		<if test="gksjwh!=null">,gksjwh=#{gksjwh}</if>
		<if test="sjpfwh!=null">,sjpfwh=#{sjpfwh}</if>
		<if test="remarks!=null">,remarks=#{remarks}</if>
		where id=#{id}
	</update>
	<update id="editGcgjStatusBatch" parameterType="java.util.List">
		update plan_gcsj set 
			<if test="sbbm!=null">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null">sbsj=#{sbsj},</if>
			<if test="sbzt!=null">sbzt=#{sbzt},</if>
			<if test="spbm!=null">spbm=#{spbm},</if>
			<if test="spbmdm!=null">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null">spsj=#{spsj},</if>
			<if test="spzt!=null">spzt=#{spzt},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>
	<update id="editGcsjStatus" parameterType="plan_gcsj">
		update plan_gcsj set 
			<if test="sbbm!=null">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null">sbsj=#{sbsj},</if>
			<if test="sbzt!=null">sbzt=#{sbzt},</if>
			<if test="spbm!=null">spbm=#{spbm},</if>
			<if test="spbmdm!=null">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null">spsj=#{spsj},</if>
			<if test="spzt!=null">spzt=#{spzt},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>
	<insert id="insertGcsj_Jh" parameterType="hashMap">
		insert into plan_gcsj (id ,fapgdw,fascdw,faspsj,spwh,tzgs,jsxz,jsnr,
			xmwybh,xmmc,jsjsbz,sftqss,jhnf,
			jhkgsj,jhwgsj,sjdw,sjpfdw,pfwh,
			pfsj,ql,ql_m,sd,sd_m,
			hd,ljtsf,dc,jc,lqlm,snlm,
			gjhjsdj,pftz,jhsybbzje,jhsydfzczj,sfsqablbz,
			gndk,lywz,zyjsnr,xzscnl,
			ablbzsqwh,gksjwh,sjpfwh,remarks,
			sfylsjl,tbbm,jh_sbthcd <!---->) 
		values(#{jhid},#{17},#{18},to_date(#{19},'yyyy-mm-dd'),#{20},#{21},#{22},#{23},
			#{24},#{25},#{26},#{27},SUBSTR(#{28},0,4),
			to_date(#{29},'yyyy-mm-dd'),to_date(#{30},'yyyy-mm-dd'),#{31},#{32},#{33},
			to_date(#{34},'yyyy-mm-dd'),#{35},#{36},#{37},#{38},
			#{39},#{40},#{41},#{42},#{43},#{44},
			#{45},#{46},#{47},#{48},#{49},
			#{50},#{51},#{52},#{53},
			#{54},#{55},#{56},#{57},
			#{sfylsjl},#{tbbm},#{jh_sbthcd} <!---->)
	</insert>
	<insert id="insertGcsj_lx" parameterType="hashMap">
		insert into plan_lx_gcsj (id,jhid,gydw,gydwdm,xzqhdm,xzqhmc,lxbm,lxmc,
			yjsdj,bhnr,qdzh,qdmc,zdzh,zdmc,qzlc,xmlc,TBSJ,TBBMBH,sfxz,lyllqk,dlqlbm,dlqlzxzh)
		values(sys_guid(),#{jhid},#{0},(select id from XTGL_DEPARTMENT t where t.name = #{0}),#{1},#{2},#{3},#{4},
			#{5},#{6},#{7},#{8},#{9},#{10},#{11},#{12},#{tbsj},#{gydwdm},
			#{13},#{14},#{15},#{16})
	</insert>
	<select id="queryGPSBylxbm" parameterType="plan_lx_gcsj" resultType="plan_lx_gcsj">
		select * from (
			select g.roadname as lxmc,g.roadcode as lxbm,min(g.roadstart) as qdzh,max(g.roadends) as zdzh,
		    (max(g.roadends)-min(g.roadstart)) as qzlc,g.f114 as yjsdj
		    from  JXJCK_2013.GPSROAD g
		    where substr(roadcode,1,1) in('G','S','X') and roadcode like #{lxbm}||'%'
		    and roadcode like '%'||rtrim(#{xzqhdm},0)||'%'
			group by roadname,roadcode,g.f114) g1
    	where <![CDATA[ g1.qdzh<=#{qdzh} and g1.zdzh>=#{zdzh} and g1.yjsdj=#{yjsdj}]]>
	</select>
	<select id="queryJlBylx" parameterType="plan_lx_gcsj" resultType="int">
		SELECT C1.CON1+C2.CON2+shC1.CON1+shC2.CON2+sjC1.CON1+sjC2.Con2+yhC1.CON1+yhC2.CON2 FROM
		(select count(jh.id) CON1 from plan_lx_gcgj lx right join plan_gcgj jh on (lx.jhid=jh.id) 
		    where <![CDATA[lx.lxbm like #{lxbm}||'%' and (lx.qdzh<=${zdzh} or lx.zdzh>=${qdzh}) and jh.sbnf<#{jhid}]]>
		)C1,
		<![CDATA[(select count(*) CON2 from
		(select lx.lxbm,lx.qdzh,lx.zdzh from plan_lx_gcgj lx, plan_gcgj jh where lx.jhid=jh.id and jh.sbnf<#{jhid})  j,
		(select YLXBM,YQDZH,YZDZH from XTGL_LXSJ where XLXBM like #{lxbm}||'%' and XQDZH<=${zdzh} and XZDZH>=${qdzh}) k
		where j.lxbm=k.YLXBM and j.qdzh<k.YZDZH and j.zdzh>k.YQDZH) C2]]>,
		
		(select count(jh.id) CON1 from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id) 
		    where <![CDATA[lx.lxbm like #{lxbm}||'%' and (lx.qdzh<=${zdzh} or lx.zdzh>=${qdzh}) and jh.sbnf<#{jhid}]]>
		) shC1,
		<![CDATA[(select count(*) CON2 from
		(select lx.lxbm,lx.qdzh,lx.zdzh from plan_lx_shuih lx, plan_shuih jh where lx.jhid=jh.id and jh.sbnf<#{jhid})  j,
		(select YLXBM,YQDZH,YZDZH from XTGL_LXSJ where XLXBM like #{lxbm}||'%' and XQDZH<=${zdzh} and XZDZH>=${qdzh}) k
		where j.lxbm=k.YLXBM and j.qdzh<k.YZDZH and j.zdzh>k.YQDZH) shC2]]>,
		
		<![CDATA[(select count(jh.id) CON1 from plan_lx_gcsj lx right join plan_gcsj jh on (lx.jhid=jh.id) 
		    where lx.lxbm like #{lxbm}||'%' and (lx.qdzh<=${zdzh} and lx.zdzh>=${qdzh}) and jh.jhnf<#{jhid}
		) sjC1,
		(select count(*) CON2 from
		(select lx.lxbm,lx.qdzh,lx.zdzh from plan_lx_gcsj lx, plan_gcsj jh where lx.jhid=jh.id and jh.jhnf<#{jhid}) j,
		(select YLXBM,YQDZH,YZDZH from XTGL_LXSJ where XLXBM like #{lxbm}||'%' and XQDZH<=${zdzh} and XZDZH>=${qdzh}) k
		where j.lxbm=k.YLXBM and j.qdzh<k.YZDZH and j.zdzh>k.YQDZH) sjC2 ]]>,
		
		<![CDATA[(select count(jh.id) CON1 from plan_lx_yhdzx lx right join plan_yhdzx jh on (lx.jhid=jh.id) 
		    where lx.lxbm like 'G105'||'%' and (lx.qdzh<=1727.33 and lx.zdzh>=1721.756) and jh.sbnf<2015
		) yhC1,
		(select count(*) CON2 from
		(select lx.lxbm,lx.qdzh,lx.zdzh from plan_lx_yhdzx lx, plan_yhdzx jh where lx.jhid=jh.id and jh.sbnf<2015) j,
		(select YLXBM,YQDZH,YZDZH from XTGL_LXSJ where XLXBM like 'G105'||'%' and XQDZH<=1727.33 and XZDZH>=1721.756) k
		where j.lxbm=k.YLXBM and j.qdzh<k.YZDZH and j.zdzh>k.YQDZH) yhC2]]>
	</select>
	<delete id="dropGcsjLxByJhid" parameterType="java.util.List">
		delete from plan_lx_gcsj where jhid=#{String}
	</delete>
	<update id="uploadGcsjFile" parameterType="plan_gcsj">
		update plan_gcsj jh set 
		<if test="gkbgmc!=null and gkbgmc!=''">
			jh.GKBGMC=#{gkbgmc},
		</if>
		<if test="gkbgwj!=null">
			jh.gkbgwj=#{gkbgwj}
		</if>
		<if test="sjsgtmc!=null and sjsgtmc!=''">
			jh.SJSGTMC=#{sjsgtmc},
		</if>
		<if test="sjsgtwj!=null">
			jh.sjsgtwj=#{sjsgtwj}
		</if>
		where jh.id=#{id}
	</update>
	<select id="queryWjById" parameterType="plan_gcsj" resultType="plan_gcsj">
		select j.gkbgmc,j.gkbgwj,j.sjsgtmc,j.sjsgtwj from plan_gcsj j where id=#{id}
	</select>
	<select id="queryJhExist" parameterType="plan_lx_gcsj" resultType="int">
		select gj.gjCon+shuih.shCon+sj.sjCon+yh.yhCon from 
		(select count(*) gjCon from plan_lx_gcgj lx right join plan_gcgj jh on (lx.jhid=jh.id) 
		where lx.lxbm = #{lxbm} and <![CDATA[lx.qdzh<#{zdzh}]]> and lx.zdzh>#{qdzh}
		and jh.sbnf=#{jhid}) gj,
		(select count(*) shCon from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id) 
		where lx.lxbm=#{lxbm} and <![CDATA[lx.qdzh<=#{zdzh}]]> and lx.zdzh>=#{qdzh} 
		and jh.sbnf=#{jhid}) shuih,
		(select count(jh.id) sjCon from plan_lx_gcsj lx right join plan_gcsj jh on (lx.jhid=jh.id) 
		where lx.lxbm=#{lxbm} and <![CDATA[lx.qdzh<#{zdzh}]]> and lx.zdzh>#{qdzh}
		and jh.jhnf=#{jhid}) sj,
		(select count(jh.id) yhCon from plan_lx_yhdzx lx right join plan_yhdzx jh on (lx.jhid=jh.id) 
    	where lx.lxbm=#{lxbm} and <![CDATA[lx.qdzh<#{zdzh}]]> and lx.zdzh>#{qdzh}
    	and jh.sbnf=#{jhid}) yh
	</select>
	<select id="queryXjls" parameterType="java.util.Map" resultType="plan_lx_gcsj">
		select * from (
		select '路面升级' as id,jh.id as jhid,jh.jhnf as bz,jh.xmmc as scbz,
		lx.lxbm as lxbm,lx.lxmc as lxmc,to_number(lx.qdzh) as xqdzh,to_number(lx.zdzh) as xzdzh,
		'   ' as ylxbm,0.0 yqdzh,0.0 yzdzh,lx.yjsdj as yjsdj,jh.gjhjsdj as gjjsdj
		from plan_lx_gcsj lx right join plan_gcsj jh on (lx.jhid=jh.id) 
		where lx.lxbm like #{lx.lxbm}||'%' and lx.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' 
		<![CDATA[and lx.qdzh<=${lx.zdzh} and lx.zdzh>=${lx.qdzh}]]> 
		<if test="lx.jhid!=null and lx.jhid!=''">
			and jh.id!=#{lx.jhid}
		</if>
		<foreach collection="ls" item="item">   
			union all
			<![CDATA[select '路面升级' as id,jh.id as jhid,jh.jhnf as bz,jh.xmmc as scbz,
			#{item.lxbm} as lxbm,lx.lxmc as lxmc,#{item.xqdzh} as xqdzh,#{item.xzdzh} as xzdzh,
			lx.lxbm as ylxbm, 
			case when to_number(lx.qdzh)<=${item.yqdzh} then ${item.yqdzh} else to_number(lx.qdzh) end yqdzh ,
	        case when to_number(lx.zdzh)>=${item.yzdzh} then ${item.yzdzh} else to_number(lx.zdzh) end  yzdzh,
	        lx.yjsdj as yjsdj,jh.gjhjsdj as gjjsdj
	        from plan_lx_gcsj lx,plan_gcsj jh where jh.id=lx.jhid and lx.lxbm like substr(#{item.ylxbm},1,4)||'%' 
	        and lx.qdzh<${item.yzdzh} and lx.zdzh>${item.yqdzh}]]>
		</foreach>
		union all
		select '路面改建' as id,gj.id as jhid,gj.sbnf as bz,gj.xmmc as scbz,
		gjlx.lxbm as lxbm,gjlx.lxmc as lxmc,to_number(gjlx.qdzh) as xqdzh,to_number(gjlx.zdzh) as xzdzh,
		'' as ylxbm,0.0 yqdzh,0.0 yzdzh,
		gjlx.yjsdj as yjsdj,'' as gjjsdj
		from plan_lx_gcgj gjlx right join plan_gcgj gj  on (gjlx.jhid=gj.id) 
		where gjlx.lxbm like #{lx.lxbm}||'%' and gjlx.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' 
		<![CDATA[ and gjlx.qdzh<=${lx.zdzh} and gjlx.zdzh>=${lx.qdzh}]]> 
		<if test="lx.jhid!=null and lx.jhid!=''">
			and gj.id!=#{lx.jhid}
		</if>
		<foreach collection="ls" item="item">
			union all
			<![CDATA[select '路面改建' as id,gj.id as jhid,gj.sbnf as bz,gj.xmmc as scbz,
			#{item.lxbm} as lxbm,gjlx.lxmc as lxmc,#{item.xqdzh} as xqdzh,#{item.xzdzh} as xzdzh,
			gjlx.lxbm as ylxbm,
			case when to_number(gjlx.qdzh)<=${item.yqdzh} then ${item.yqdzh} else to_number(gjlx.qdzh) end yqdzh,
			case when to_number(gjlx.zdzh)>=${item.yzdzh} then ${item.yzdzh} else to_number(gjlx.zdzh) end  yzdzh,
			gjlx.yjsdj as yjsdj,'' as gjjsdj
			from plan_lx_gcgj gjlx right join plan_gcgj gj  on (gjlx.jhid=gj.id)
			where gjlx.lxbm like substr(#{item.ylxbm},1,4)||'%' and gjlx.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' 
			and gjlx.qdzh<${item.yzdzh} and gjlx.zdzh>${item.yqdzh}]]>
		</foreach>
		union all
		select '水毁项目' as id,sh.id as jhid,sh.sbnf as bz,sh.xmmc as scbz,
		shlx.lxbm as lxbm,shlx.lxmc as lxmc,to_number(shlx.qdzh) as xqdzh,to_number(shlx.zdzh) as xzdzh,
		'' as ylxbm,0.0 yqdzh,0.0 yzdzh,
		shlx.yjsdj as yjsdj,'' as gjjsdj
		from plan_lx_shuih shlx right join plan_shuih sh  on (shlx.jhid=sh.id) 
		where shlx.lxbm like #{lx.lxbm}||'%' and shlx.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' 
		<![CDATA[ and shlx.qdzh<=${lx.zdzh} and shlx.zdzh>=${lx.qdzh}]]> 
		<if test="lx.jhid!=null and lx.jhid!=''">
			and sh.id!=#{lx.jhid}
		</if>
		<foreach collection="ls" item="item">
			union all
			<![CDATA[select '水毁项目' as id,sh.id as jhid,sh.sbnf as bz,sh.xmmc as scbz,
			#{item.lxbm} as lxbm,shlx.lxmc as lxmc,#{item.xqdzh} as xqdzh,#{item.xzdzh} as xzdzh,
			shlx.lxbm as ylxbm,
			case when to_number(shlx.qdzh)<=${item.yqdzh} then ${item.yqdzh} else to_number(shlx.qdzh) end yqdzh,
			case when to_number(shlx.zdzh)>=${item.yzdzh} then ${item.yzdzh} else to_number(shlx.zdzh) end  yzdzh,
			shlx.yjsdj as yjsdj,'' as gjjsdj
			from plan_lx_shuih shlx right join plan_shuih sh  on (shlx.jhid=sh.id)
			where shlx.lxbm like substr(#{item.ylxbm},1,4)||'%' and shlx.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%'
			and shlx.qdzh<${item.yzdzh} and shlx.zdzh>${item.yqdzh}]]>
		</foreach>
		union all
		select '养护大中修' as id,yh.id as jhid,yh.sbnf as bz,yh.xmmc as scbz,
		yhlx.lxbm as lxbm,yhlx.lxmc as lxmc,to_number(yhlx.qdzh) as xqdzh,to_number(yhlx.zdzh) as xzdzh,
		'' as ylxbm,0.0 yqdzh,0.0 yzdzh,
		yhlx.yjsdj as yjsdj,'' as gjjsdj
		from plan_lx_yhdzx yhlx right join plan_yhdzx yh  on (yhlx.jhid=yh.id) 
		where yhlx.lxbm like #{lx.lxbm}||'%' and yhlx.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' 
		<![CDATA[ and yhlx.qdzh<=${lx.zdzh} and yhlx.zdzh>=${lx.qdzh}]]> 
		<if test="lx.jhid!=null and lx.jhid!=''">
			and yh.id!=#{lx.jhid}
		</if>
		<foreach collection="ls" item="item">
			union all
			<![CDATA[select '养护大中修' as id,yh.id as jhid,yh.sbnf as bz,yh.xmmc as scbz,
			#{item.lxbm} as lxbm,yhlx.lxmc as lxmc,#{item.xqdzh} as xqdzh,#{item.xzdzh} as xzdzh,
			yhlx.lxbm as ylxbm,
			case when to_number(yhlx.qdzh)<=${item.yqdzh} then ${item.yqdzh} else to_number(yhlx.qdzh) end yqdzh,
			case when to_number(yhlx.zdzh)>=${item.yzdzh} then ${item.yzdzh} else to_number(yhlx.zdzh) end yzdzh,
			yhlx.yjsdj as yjsdj,'' as gjjsdj
			from plan_lx_yhdzx yhlx right join plan_yhdzx yh  on (yhlx.jhid=yh.id)
			where yhlx.lxbm like substr(#{item.ylxbm},1,4)||'%' and yhlx.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%'
			and yhlx.qdzh<${item.yzdzh} and yhlx.zdzh>${item.yqdzh}]]>
		</foreach>
		union all
		select '安保工程' as id,a.id as jhid,a.jhnf as bz,axm.lxmc as scbz,
		axm.lxbm as lxbm,axm.lxmc as lxmc,to_number(axm.qdzh) as xqdzh,to_number(axm.zdzh) as xzdzh,
		'' as ylxbm,0.0 yqdzh,0.0 yzdzh,
		'' as yjsdj,'' as gjjsdj
		from xmk_abgc axm right join sck_abgc asck on axm.id=asck.xmkid right join plan_abgc a on asck.sckid=a.sckid
		where axm.lxbm like #{lx.lxbm}||'%' and axm.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' 
		and <![CDATA[ axm.qdzh<=${lx.zdzh} and axm.zdzh>=${lx.qdzh}]]> 
		<if test="lx.jhid!=null and lx.jhid!=''">
			and a.id!=#{lx.jhid}
		</if>
		<foreach collection="ls" item="item">
			union all
			<![CDATA[select '安保工程' as id,a.id as jhid,a.jhnf as bz,axm.lxmc as scbz,
			#{item.lxbm} as lxbm,axm.lxmc as lxmc,#{item.xqdzh} as xqdzh,#{item.xzdzh} as xzdzh,
			axm.lxbm as ylxbm,
			case when to_number(axm.qdzh)<=${item.yqdzh} then ${item.yqdzh} else to_number(axm.qdzh) end yqdzh,
			case when to_number(axm.zdzh)>=${item.yzdzh} then ${item.yzdzh} else to_number(axm.zdzh) end yzdzh,
			'' as yjsdj,'' as gjjsdj
			from xmk_abgc axm right join sck_abgc asck on axm.id=asck.xmkid right join plan_abgc a on asck.sckid=a.sckid
			where axm.lxbm like substr(#{item.ylxbm},1,4)||'%' and  axm.qdzh<${item.yzdzh} and axm.zdzh>${item.yqdzh}]]>
		</foreach>
		union all
		select '灾害防治' as id,z.id as jhid,z.sbnf as bz,zxm.lxmc as scbz,
		zxm.lxbm as lxbm,zxm.lxmc as lxmc,to_number(zxm.qdzh) as xqdzh,to_number(zxm.zdzh) as xzdzh,
		'' as ylxbm,0.0 yqdzh,0.0 yzdzh,
		'' as yjsdj,'' as gjjsdj
		from xmk_zhfz zxm right join sck_zhfz zsck on zxm.id=zsck.xmkid right join plan_zhfz z on zsck.sckid=z.sckid
		where zxm.lxbm like #{lx.lxbm}||'%' and zxm.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' and 
		<![CDATA[ zxm.qdzh<=#{lx.zdzh} and zxm.zdzh>=#{lx.qdzh}]]> 
		<if test="lx.jhid!=null and lx.jhid!=''">
			and z.id!=#{lx.jhid}
		</if>
		<foreach collection="ls" item="item">
			union all
			<![CDATA[select '灾害防治' as id,z.id as jhid,z.sbnf as bz,zxm.lxmc as scbz,
			#{item.lxbm} as lxbm,zxm.lxmc as lxmc,#{item.xqdzh} as xqdzh,#{item.xzdzh} as xzdzh,
			zxm.lxbm as ylxbm,
			case when to_number(zxm.qdzh)<=${item.yqdzh} then ${item.yqdzh} else to_number(zxm.qdzh) end yqdzh,
			case when to_number(zxm.zdzh)>=${item.yzdzh} then ${item.yzdzh} else to_number(zxm.zdzh) end yzdzh,
			'' as yjsdj,'' as gjjsdj
			from xmk_zhfz zxm right join sck_zhfz zsck on zxm.id=zsck.xmkid right join plan_zhfz z on zsck.sckid=z.sckid
			where zxm.lxbm like substr(#{item.ylxbm},1,4)||'%' and zxm.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' and 
			zxm.qdzh<${item.yzdzh} and zxm.zdzh>${item.yqdzh}]]>
		</foreach>
		) t order by t.bz
	</select>
	<!--  <select id="queryXjls" parameterType="java.util.Map" resultMap="gcsj_jh">
		select '灾害防治' as remarks,z.id,z.sbnf as jhnf,zxm.lxmc as xmmc,zxm.lxbm,zxm.lxmc,zxm.qdzh,zxm.zdzh from xmk_zhfz zxm right join sck_zhfz zsck on zxm.id=zsck.xmkid right join plan_zhfz z on zsck.sckid=z.sckid
		where ( (zxm.lxbm like #{lx.lxbm}||'%' and zxm.xzqhdm like rtrim(#{lx.xzqhdm},0)||'%' and <![CDATA[ zxm.qdzh<=#{lx.zdzh} and zxm.zdzh>=#{lx.qdzh}]]>)
		<foreach collection="ls" item="item">
			<![CDATA[ or (zxm.lxbm like substr(#{item.ylxbm},1,4)||'%' and zxm.qdzh<${item.yqdzh} and zxm.zdzh>${item.yzdzh})]]>
		</foreach>)  
	</select>-->
	<select id="queryTsdqByXzqh" resultType="string" parameterType="string">
		select bt.areaname from bt_xzqhtsdq xz right join bt_specialarea bt on (xz.areacode=bt.areacode) where xz.xzqhdm=#{_parameter}
	</select>
	<select id="queryBzzj" resultType="flwbzbz" parameterType="flwbzbz">
		select * from plan_flwbzbz f where 
		<if test="xmlx==null or xmlx==''">
			f.xmlx is null
		</if>
		<if test="xmlx!=null and xmlx!=''">
			f.xmlx=#{xmlx}
		</if>
		<if test="gldj==null or gldj==''">
			and f.gldj is null
		</if>
		<if test="gldj!=null and gldj!=''">
			and f.gldj=#{gldj}
		</if>
		<if test="jsdj==null or jsdj==''">
			and f.jsdj is null
		</if>
		<if test="jsdj!=null and jsdj!=''">
			and f.jsdj=#{jsdj}
		</if>
		<if test="tsdq==null or tsdq==''">
			and f.tsdq is null
		</if>
		<if test="tsdq!=null and tsdq!=''">
			and f.tsdq =#{tsdq}
		</if>
	</select>
	<select id="queryTjJeAndSl" resultType="treenode" parameterType="java.util.Map">
		select t.parent as id,xz.name as name,NVL(sum(t.je),0) as text,sum(sl) as parent from (
			select distinct xt.parent,lx.xzqhdm,lx.xzqhmc,jh.jhnf,jh.id,
				(select sum(jh1.jhsybbzje) from plan_gcsj jh1 left join plan_lx_gcsj lx1 on (jh1.id=lx1.jhid) right join xtgl_xzqh xt1 on (lx1.xzqhdm=xt1.id) 
			  	where jh1.jhnf=#{nf} and jh1.id=jh.id group by jh1.id) as je,
			  	(select count(jh1.id) from plan_gcsj jh1 where jh1.jhnf=#{nf} and jh1.id=jh.id) as sl
			from plan_gcsj jh left join plan_lx_gcsj lx on (jh.id=lx.jhid) right join xtgl_xzqh xt on (lx.xzqhdm=xt.id) order by xt.parent
		) t join xtgl_xzqh xz on(t.parent=xz.id) group by t.parent,xz.name order by t.parent
	</select>
	<select id="queryJhktj2"  resultType="treenode" parameterType="java.util.Map">
		select t.jhnf as id,sum(t.jhsybbzje) as text,count(t.jhsybbzje) as name from (
       		select distinct jh.id,lx.xzqhdm,jh.jhnf,jh.jhsybbzje 
       		from plan_gcsj jh left join plan_lx_gcsj lx on (jh.id=lx.jhid) where lx.xzqhdm like rtrim(#{xzqhdm},'0')||'%') t
		where t.jhnf>=#{start} and <![CDATA[t.jhnf<=#{end}]]> group by t.jhnf
	</select>
	<select id="queryJhktjt2" resultType="string" parameterType="java.util.Map">
		select NVL(sum(t.jhsybbzje),0) from (
       		select distinct jh.id,lx.xzqhdm,jh.jhnf,jh.jhsybbzje 
       		from plan_gcsj jh left join plan_lx_gcsj lx on (jh.id=lx.jhid) 
       		where lx.xzqhdm like #{xzqhdm} and jhnf=#{nf}) t
		group by t.jhnf
	</select>
	<select id="queryJhktjt3" resultType="treenode" parameterType="java.util.Map">
		select jhnf as name,sum(jhsybbzje) as text from (
		select distinct jh.id,jh.jhnf,jh.jhsybbzje from Plan_Gcsj jh left join plan_lx_gcsj lx on jh.id=lx.jhid
		where jh.jhnf>=#{start} and <![CDATA[jh.jhnf<=#{end}]]> and lx.xzqhdm like #{xzqhdm}) s group by s.jhnf
	</select>
	<select id="queryGcktj" resultType="treenode" parameterType="java.util.Map">
		select (r.kgzt+r.jgzt) as id,count(r.kgzt+r.jgzt) as name,sum(r.jhsybbzje) as text,sum(btz) as parent from (
           select jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybbzje,sum(nvl(gcgl.bywctze,0)) as btz
             from gcgl_gcgzsj gcgl right join (
                select distinct jh.id,jh.kgzt,jh.jgzt,jh.jhsybbzje from plan_lx_gcsj lx right join plan_gcsj jh on (lx.jhid=jh.id) 
                where lx.xzqhdm like #{xzqhdm} and jh.jhnf=#{nf} and jh.spzt='1' and jh.jh_sbthcd='6')
           jh_lx on (gcgl.jhid=jh_lx.id) group by jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybbzje
    	) r group by r.kgzt,r.jgzt order by r.kgzt,r.jgzt
	</select>
	<select id="queryGcktjt" resultType="treenode" parameterType="java.util.Map">
		select nvl(sum(r.jhsybbzje),0) as text,nvl(sum(btz),0) as parent from (
           select jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybbzje,sum(nvl(gcgl.bywctze,0)) as btz
             from gcgl_gcgzsj gcgl right join (
                select distinct jh.id,jh.kgzt,jh.jgzt,jh.jhsybbzje from plan_lx_gcsj lx right join plan_gcsj jh on (lx.jhid=jh.id) 
                where jh.spzt='1' and jh.jh_sbthcd='6'
                <if test="xzqhdm!=null and xzqhdm!=''">
                	and lx.xzqhdm like #{xzqhdm}
                </if>)
           jh_lx on (gcgl.jhid=jh_lx.id) group by jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybbzje
    	) r
	</select>
	<select id="queryGcktj2" resultType="treenode" parameterType="java.util.Map">
		select nvl(sum(r.bn),0) as id,count(r.bn) as name,nvl(sum(r.fbn),0) as text,count(r.fbn) as parent from (
			select distinct jh.id,jh.kgzt,jh.jgzt,
				(select sj.jhsybbzje from plan_gcsj sj where sj.jhnf=#{nf} and sj.id=jh.id) as bn,
				(select sj.jhsybbzje from plan_gcsj sj where #{nf}>sj.jhnf and sj.id=jh.id) as fbn
			from plan_lx_gcsj lx right join plan_gcsj jh on (lx.jhid=jh.id) 
			where jh.spzt='1' and jh.jh_sbthcd='6'
		and lx.xzqhdm like #{xzqhdm} order by jh.id) r
	</select>
	<insert id="insertGcsj" parameterType="plan_lx_gcsj">
		insert into plan_lx_gcsj (id,jhid
			<if test="gydw!=null">,gydw</if>
			<if test="gydwdm!=null">,gydwdm</if>
			<if test="xzqhdm!=null">,xzqhdm</if>
			<if test="xzqhmc!=null">,xzqhmc</if>
			<if test="lxbm!=null">,lxbm</if>
			<if test="lxmc!=null">,lxmc</if>
			<if test="yjsdj!=null">,yjsdj</if>
			<if test="bhnr!=null">,bhnr</if>
			<if test="qdzh!=null">,qdzh</if>
			<if test="qdmc!=null">,qdmc</if>
			<if test="zdzh!=null">,zdzh</if>
			<if test="zdmc!=null">,zdmc</if>
			<if test="qzlc!=null">,qzlc</if>
			<if test="xmlc!=null">,xmlc</if>
			<if test="tbsj!=null">,TBSJ</if>
			<if test="tbbmbh!=null">,TBBMBH</if>
			<if test="lyllqk!=null">,lyllqk</if>
			<if test="dlqlbm!=null">,dlqlbm</if>
			<if test="dlqlzxzh!=null">,dlqlzxzh</if>
			<if test="sfxz!=null">,sfxz</if>
			<if test="tsdq!=null">,tsdq</if>)
		values(sys_guid(),#{jhid}
			<if test="gydw!=null">,#{gydw}</if>
			<if test="gydwdm!=null">,#{gydwdm}</if>
			<if test="xzqhdm!=null">,#{xzqhdm}</if>
			<if test="xzqhmc!=null">,#{xzqhmc}</if>
			<if test="lxbm!=null">,#{lxbm}</if>
			<if test="lxmc!=null">,#{lxmc}</if>
			<if test="yjsdj!=null">,#{yjsdj}</if>
			<if test="bhnr!=null">,#{bhnr}</if>
			<if test="qdzh!=null">,#{qdzh}</if>
			<if test="qdmc!=null">,#{qdmc}</if>
			<if test="zdzh!=null">,#{zdzh}</if>
			<if test="zdmc!=null">,#{zdmc}</if>
			<if test="qzlc!=null">,#{qzlc}</if>
			<if test="xmlc!=null">,#{xmlc}</if>
			<if test="tbsj!=null">,to_date(#{tbsj},'yyyy-mm-dd')</if>
			<if test="tbbmbh!=null">,#{gydwdm}</if>
			<if test="lyllqk!=null">,#{lyllqk}</if>
			<if test="dlqlbm!=null">,#{dlqlbm}</if>
			<if test="dlqlzxzh!=null">,#{dlqlzxzh}</if>
			<if test="sfxz!=null">,#{sfxz}</if>
			<if test="tsdq!=null">,#{tsdq}</if>)
	</insert>
	<insert id="insertGcsjJh" parameterType="plan_gcsj">
		insert into plan_gcsj (id,
			<if test="fapgdw!=null">fapgdw,</if>
			<if test="fascdw!=null">fascdw,</if>
			<if test="faspsj!=null">faspsj,</if>
			<if test="spwh!=null">spwh,</if>
			<if test="tzgs!=null">tzgs,</if>
			<if test="jsxz!=null">jsxz,</if>
			<if test="jsnr!=null">jsnr,</if>
			<if test="xmwybh!=null">xmwybh,</if>
			<if test="xmmc!=null">xmmc,</if>
			<if test="jsjsbz!=null">jsjsbz,</if>
			<if test="sftqss!=null">sftqss,</if>
			<if test="jhnf!=null">jhnf,</if>
			<if test="jhkgsj!=null">jhkgsj,</if>
			<if test="jhwgsj!=null">jhwgsj,</if>
			<if test="sjdw!=null">sjdw,</if>
			<if test="sjpfdw!=null">sjpfdw,</if>
			<if test="pfwh!=null">pfwh,</if>
			<if test="pfsj!=null">pfsj,</if>
			<if test="ql!=null">ql,</if>
			<if test="ql_m!=null">ql_m,</if>
			<if test="sd!=null">sd,</if>
			<if test="sd_m!=null">sd_m,</if>
			<if test="hd!=null">hd,</if>
			<if test="ljtsf!=null">ljtsf,</if>
			<if test="dc!=null">dc,</if>
			<if test="jc!=null">jc,</if>
			<if test="lqlm!=null">lqlm,</if>
			<if test="snlm!=null">snlm,</if>
			<if test="gjhjsdj!=null">gjhjsdj,</if>
			<if test="pftz!=null">pftz,</if>
			<if test="jhsybbzje!=null">jhsybbzje,</if>
			<if test="jhsydfzczj!=null">jhsydfzczj,</if>
			<if test="sfsqablbz!=null">sfsqablbz,</if>
			<if test="ablbzsqwh!=null">ablbzsqwh,</if>
			<if test="gksjwh!=null">gksjwh,</if>
			<if test="sjpfwh!=null">sjpfwh,</if>
			<if test="remarks!=null">remarks,</if>
			<if test="sfylsjl!=null">sfylsjl</if>
			<if test="jh_sbthcd!=null">,jh_sbthcd</if>) 
		values(#{id},
			<if test="fapgdw!=null">#{fapgdw},</if>
			<if test="fascdw!=null">#{fascdw},</if>
			<if test="faspsj!=null">to_date(#{faspsj},'yyyy-mm-dd'),</if>
			<if test="spwh!=null">#{spwh},</if>
			<if test="tzgs!=null">#{tzgs},</if>
			<if test="jsxz!=null">#{jsxz},</if>
			<if test="jsnr!=null">#{jsnr},</if>
			<if test="xmwybh!=null">#{xmwybh},</if>
			<if test="xmmc!=null">#{xmmc},</if>
			<if test="jsjsbz!=null">#{jsjsbz},</if>
			<if test="sftqss!=null">#{sftqss},</if>
			<if test="jhnf!=null">#{jhnf},</if>
			<if test="jhkgsj!=null">#{jhkgsj},</if>
			<if test="jhwgsj!=null">#{jhwgsj},</if>
			<if test="sjdw!=null">#{sjdw},</if>
			<if test="sjpfdw!=null">#{sjpfdw},</if>
			<if test="pfwh!=null">#{pfwh},</if>
			<if test="pfsj!=null">#{pfsj},</if>
			<if test="ql!=null">#{ql},</if>
			<if test="ql_m!=null">#{ql_m},</if>
			<if test="sd!=null">#{sd},</if>
			<if test="sd_m!=null">#{sd_m},</if>
			<if test="hd!=null">#{hd},</if>
			<if test="ljtsf!=null">#{ljtsf},</if>
			<if test="dc!=null">#{dc},</if>
			<if test="jc!=null">#{jc},</if>
			<if test="lqlm!=null">#{lqlm},</if>
			<if test="snlm!=null">#{snlm},</if>
			<if test="gjhjsdj!=null">#{gjhjsdj},</if>
			<if test="pftz!=null">#{pftz},</if>
			<if test="jhsybbzje!=null">#{jhsybbzje},</if>
			<if test="jhsydfzczj!=null">#{jhsydfzczj},</if>
			<if test="sfsqablbz!=null">#{sfsqablbz},</if>
			<if test="ablbzsqwh!=null">#{ablbzsqwh},</if>
			<if test="gksjwh!=null">#{gksjwh},</if>
			<if test="sjpfwh!=null">#{sjpfwh},</if>
			<if test="remarks!=null">#{remarks},</if>
			<if test="sfylsjl!=null">#{sfylsjl}</if>
			<if test="jh_sbthcd!=null">,#{jh_sbthcd}</if>)
	</insert>
	<select id="sjAutoCompleteLxbm" parameterType="plan_lx_gcsj" resultType="plan_lx_gcsj">
		select g.roadname as lxmc,g.roadcode as lxbm,min(g.roadstart) as qdzh,max(g.roadends) as zdzh,
		(max(g.roadends)-min(g.roadstart)) as qzlc,g.f114 as yjsdj
		from  JXJCK_2013.GPSROAD g
		where substr(roadcode,1,1) in('G','S','X') and roadcode like #{lxbm}||'%'
		and roadcode like '%'||rtrim(#{xzqhdm},0)||'%'
		group by roadname,roadcode,g.f114
	</select>
	<select id="querySjzh" parameterType="plan_lx_gcsj" resultType="plan_lx_gcsj">
		<![CDATA[
		select ylxbm ylxbm,(case when Xqdzh<${qdzh} then YQDZH+${qdzh}-XQDZH else yqdzh end) yqdzh,
		(case when ${zdzh}<Xzdzh then YZDZH-XZDZH+${zdzh} else yzdzh end ) yzdzh ,
        xlxbm as lxbm,(case when Xqdzh<${qdzh} then ${qdzh} else xqdzh end ) xqdzh,
        (case when ${zdzh}<Xzdzh then ${zdzh} else xzdzh end) xzdzh 
  		from XTGL_LXSJ t where  t.xlxbm like substr(#{lxbm},1,4) || '%' and 
  		t.Xqdzh<${zdzh} and t.Xzdzh>${qdzh}]]>
	</select>
	<update id="editZjById" parameterType="plan_gcsj">
		update plan_gcsj jh set jh.pftz=#{pftz},jh.jhsybbzje=#{jhsybbzje},jh.jhsydfzczj=#{jhsydfzczj}
		where jh.id=#{id}
	</update>
</mapper>
