<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_gcsj">
	<resultMap id="gcsj_jh" type="plan_gcsj">
		<id property="id" column="id" />
		<result property="jhnf" column="jhnf"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="sjdw" column="sjdw"/>
		<result property="sjpfdw" column="sjpfdw"/>
		<result property="pfwh" column="pfwh"/>
		<result property="pfsj" column="pfsj"/>
		<result property="ql" column="ql"/>
		<result property="ql_m" column="ql_m"/>
		<result property="sd" column="sd"/>
		<result property="sd_m" column="sd_m"/>
		<result property="hd" column="hd"/>
		<result property="ljtsf" column="ljtsf"/>
		<result property="dc" column="dc"/>
		<result property="jc" column="jc"/>
		<result property="lqlm" column="lqlm"/>
		<result property="snlm" column="snlm"/>
		<result property="gjhjsdj" column="gjhjsdj"/>
		<result property="pftz" column="pftz"/>
		<result property="jhsybbzje" column="jhsybbzje"/>
		<result property="jhsydfzczj" column="jhsydfzczj"/>
		<result property="sfsqablbz" column="sfsqablbz"/>
		<result property="ablbzsqwh" column="ablbzsqwh"/>
		<result property="remarks" column="remarks"/>
		<result property="tbsj" column="tbsj"/>
		<result property="tbbm" column="tbbm"/>
		<result property="sbzt" column="sbzt"/>
		<result property="sbbm" column="sbbm"/>
		<result property="sbsj" column="sbsj"/>
		<result property="spzt" column="spzt"/>
		<result property="spbm" column="spbm"/>
		<result property="spsj" column="spsj"/>
		<result property="xmwybh" column="xmwybh"/>
		<result property="xdsj" column="xdsj"/>
		<result property="gkbgmc" column="gkbgmc"/>
		<result property="gkbglj" column="gkbglj"/>
		<result property="sjsgtmc" column="sjsgtmc"/>
		<result property="sjsgtlj" column="sjsgtlj"/>
		<result property="sjkgsj" column="sjkgsj"/>
		<result property="sjwgsj" column="sjwgsj"/>
		<result property="sgdw" column="sgdw"/>
		<result property="jldw" column="jldw"/>
		<result property="htje" column="htje"/>
		<result property="sgxkwj" column="sgxkwj"/>
		<result property="jgtcwj" column="jgtcwj"/>
		<result property="jgyswj" column="jgyswj"/>
		<result property="wjsczt" column="wjsczt"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="wjgyy" column="wjgyy"/>
		<result property="yjwgsj" column="yjwgsj"/>
		<result property="xmmc" column="xmmc"/>
		<result property="jsjsbz" column="jsjsbz"/>
		<result property="sftqss" column="sftqss"/>
		<result property="jsdw" column="jsdw"/>
		<result property="jhxdwh" column="jhxdwh"/>
		<result property="gksjwh" column="gksjwh"/>
		<result property="sjpfwh" column="sjpfwh"/>
		<result property="wjzt" column="wjzt"/>
		<result property="wjsj" column="wjsj"/>
		<result property="gsztz" column="gsztz"/>
		<result property="sfqxkg" column="sfqxkg"/>
		<result property="fapgdw" column="fapgdw"/>
		<result property="fascdw" column="fascdw"/>
		<result property="faspsj" column="faspsj"/>
		<result property="spwh" column="spwh"/>
		<result property="tzgs" column="tzgs"/>
		<result property="jsxz" column="jsxz"/>
		<result property="jsnr" column="jsnr"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<result property="sfylsjl" column="sfylsjl"/>
		<collection property="plan_lx_gcsjs" ofType="plan_lx_gcsj" resultMap="gcsj_lx"/>
	</resultMap>
	<resultMap id="gcsj_lx" type="plan_lx_gcsj">
		<id property="id" column="id" />
		<result property="lxmc" column="lxmc"/>
		<result property="lxbm" column="lxbm"/>
		<result property="xzqhdm" column="xzqhdm"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="qzlc" column="qzlc"/>
		<result property="xmlc" column="xmlc"/>
		<result property="gydw" column="gydw"/>
		<result property="gydwbm" column="gydwbm"/>
		<result property="yjsdj" column="yjsdj"/>
		<result property="bhnr" column="bhnr"/>
		<result property="sczt" column="sczt"/>
		<result property="tbsj" column="tbsj"/>
		<result property="tbbmbh" column="tbbmbh"/>
		<result property="gydwdm" column="gydwdm"/>
		<result property="scbz" column="scbz"/>
		<result property="scbmbm" column="scbmbm"/>
		<result property="bz" column="bz"/>
		<result property="jhid" column="jhid"/>
	</resultMap>
	
	<select id="queryGcsjList" parameterType="java.util.Map" resultMap="gcsj_jh">
		select * from (
			select rownum as num,t.* from (
				select jh.sfylsjl,jh.jgzt,jh.kgzt,jh.jh_sbthcd,jh.id,jh.sbzt,jh.spzt,jh.jhnf,jh.jhkgsj,jh.jhwgsj,jh.pftz,
				lx.gydw,lx.xzqhmc,lx.lxbm,lx.lxmc,lx.qdzh,lx.zdzh,lx.xmlc
			 	from PLAN_GCSJ jh right join Plan_Lx_Gcsj lx on lx.jhid=jh.id
			 	where 1=1
			 	<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='')">
					and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
				</if>
			 	<if test="jh.jhnf!=null and jh.jhnf!=''">
					and jh.jhnf =#{jh.jhnf}
				</if>
				<if test="jh.sbzt!=null and jh.sbzt!=''">
					and jh.sbzt=#{jh.sbzt}
				</if>
				<if test="jh.spzt!=null and jh.spzt!=''">
					and jh.spzt=#{jh.spzt}
				</if>
				and jh.id in (
						select lx.jhid from PLAN_lx_GCSJ lx 
						where 1=1 
							<if test="lx.gydwdm!=null and lx.gydwdm!=''">
								and lx.gydwdm like #{lx.gydwdm}
							</if>
							<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
								and lx.xzqhdm like #{lx.xzqhdm}
							</if>
							<if test="lx.lxmc!=null and lx.lxmc!=''">
								and lx.lxmc like '%'||#{lx.lxmc}||'%'
							</if>
							<if test="lx.yjsdj!=null and lx.yjsdj!=''">
								and lx.yjsdj=#{lx.yjsdj}
							</if>
							<if test="lx.lxbm!=null and lx.lxbm!=''">
								and lx.lxbm like 'S'||#{lx.lxbm}
							</if>
						    and lx.xzqhdm in (
						    	select b.XZQHDM from BT_XZQHTSDQ b 
						    	WHERE 1=1 
						    	<if test="lx.tsdqbm!=null and lx.tsdqbm!=''">
									b.AREACODE=#{lx.tsdqbm}
								</if>
						    	)
						    ) order by jh.sbzt,jh.spzt,jh.jhnf desc
				) t
		 )
		 where  <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryGcsjCount" resultType="int" parameterType="java.util.Map">
		select count(jh.id) from PLAN_GCSJ jh right join Plan_Lx_Gcsj lx on lx.jhid=jh.id
		 	where 1=1
		 	<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='')">
				and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
			</if>
		 	<if test="jh.jhnf!=null and jh.jhnf!=''">
				and jh.jhnf =#{jh.jhnf}
			</if>
			<if test="jh.sbzt!=null and jh.sbzt!=''">
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.spzt!=null and jh.spzt!=''">
				and jh.spzt=#{jh.spzt}
			</if>
			and jh.id in (
					select lx.jhid from PLAN_lx_GCSJ l 
					where 1=1 
						<if test="lx.gydwdm!=null and lx.gydwdm!=''">
							and lx.gydwdm like #{lx.gydwdm}
						</if>
						<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
							and lx.xzqhdm like #{lx.xzqhdm}
						</if>
						<if test="lx.lxmc!=null and lx.lxmc!=''">
							and lx.lxmc like '%'||#{lx.lxmc}||'%'
						</if>
						<if test="lx.yjsdj!=null and lx.yjsdj!=''">
							and lx.yjsdj=#{lx.yjsdj}
						</if>
						<if test="lx.lxbm!=null and lx.lxbm!=''">
							and lx.lxbm like 'S'||#{lx.lxbm}
						</if>
					    and lx.xzqhdm in (
					    	select B.XZQHDM from BT_XZQHTSDQ b 
					    	WHERE 1=1 
					    	<if test="lx.tsdqbm!=null and lx.tsdqbm!=''">
								B.AREACODE=#{lx.tsdqbm}
							</if>
					    	)
					    )
	</select>
	
	<select id="queryGcsjById" resultMap="gcsj_jh" parameterType="string">
		select jh.id,lx.lxmc,lx.lxbm,lx.yjsdj,lx.qdzh,lx.zdzh,lx.qzlc,lx.gydw,lx.xzqhdm,lx.xzqhmc,lx.xmlc,lx.bhnr,
		jh.fapgdw,jh.fascdw,jh.faspsj,jh.spwh,jh.tzgs,jh.jsxz,jh.jsnr,
		jh.jhnf,jh.jhkgsj,jh.jhwgsj,jh.jhxdwh,jh.xmwybh,jh.xmmc,jh.sjdw,jh.sjpfdw,jh.jsjsbz,jh.ql,jh.ql_m,
		jh.sd,jh.sd_m,jh.hd,jh.ljtsf,jh.dc,jh.jc,jh.lqlm,jh.snlm,jh.gjhjsdj,jh.sftqss,jh.pfwh,jh.pfsj,jh.pftz,
		jh.jhsybbzje,jh.jhsydfzczj,jh.jhxdwh,jh.sfsqablbz,jh.ablbzsqwh,jh.gksjwh,jh.sjpfwh,jh.gkbgmc,jh.gkbglj,jh.sjsgtmc,jh.sjsgtlj,jh.remarks
		from PLAN_GCSJ jh right join Plan_Lx_Gcsj lx on lx.jhid=jh.id where jh.id=#{id}
	</select>
	
	<select id="queryGcsjNfs" resultType="treenode">
		 select distinct jh.jhnf as text from PLAN_GCSJ jh order by jh.jhnf
	</select>
	<delete id="dropGcsjById" parameterType="string">
		delete from plan_gcsj jh where jh.id=#{id}
	</delete>
	<update id="editGcsjById" parameterType="plan_gcsj">
		update plan_gcsj set jhnf=#{jhnf},jhkgsj=#{jhkgsj},jhwgsj=#{jhwgsj},xdsj=#{xdsj},
		xmwybh=#{xmwybh},xmmc=#{xmmc},sjdw=#{sjdw},sjpfdw=#{sjpfdw},jsjsbz=#{jsjsbz},ql=#{ql},ql_m=#{ql_m},
		sd=#{sd},sd_m=#{sd_m},hd=#{hd},ljtsf=#{ljtsf},dc=#{dc},jc=#{jc},lqlm=#{lqlm},snlm=#{snlm},
		gjhjsdj=#{gjhjsdj},sftqss=#{sftqss},pfwh=#{pfwh},pfsj=#{pfsj},pftz=#{pftz},jhsybbzje=#{jhsybbzje},
		jhsydfzczj=#{jhsydfzczj},jhxdwh=#{jhxdwh},sfsqablbz=#{sfsqablbz},ablbzsqwh=#{ablbzsqwh},
		gksjwh=#{gksjwh},sjpfwh=#{sjpfwh},remarks=#{remarks}
		where id=#{id}
	</update>
	<update id="editGcsjStatus" parameterType="plan_gcsj">
		update plan_gcsj set 
			<if test="sbbm!=null">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null">sbsj=#{sbsj},</if>
			<if test="sbzt!=null">sbzt=#{sbzt},</if>
			<if test="spbm!=null">spbm=#{spbm},</if>
			<if test="spbmdm!=null">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null">spsj=#{spsj},</if>
			<if test="spzt!=null">spzt=#{spzt},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>

	<insert id="insertGcsj_Jh" parameterType="hashMap">
		insert into plan_gcsj (id,fapgdw,fascdw,faspsj,spwh,tzgs,jsxz,jsnr,
			xmwybh,xmmc,jsjsbz,sftqss,jhnf,
			jhkgsj,jhwgsj,sjdw,sjpfdw,pfwh,
			pfsj,ql,ql_m,sd,sd_m,
			hd,ljtsf,dc,jc,lqlm,snlm,
			gjhjsdj,pftz,jhsybbzje,jhsydfzczj,sfsqablbz,
			ablbzsqwh,gksjwh,sjpfwh,remarks) 
		values(#{jhid},#{11},#{12},to_date(#{13},'yyyy-mm-dd'),#{14},#{15},#{16},#{17},
			#{18},#{19},#{20},#{21},SUBSTR(#{22},0,4),
			to_date(#{23},'yyyy-mm-dd'),to_date(#{24},'yyyy-mm-dd'),#{25},#{26},#{27},
			to_date(#{28},'yyyy-mm-dd'),#{29},#{30},#{31},#{32},
			#{33},#{34},#{35},#{36},#{37},#{38},
			#{39},#{40},#{41},#{42},#{43},
			#{44},#{45},#{46},#{47})
	</insert>
	<insert id="insertGcsj_lx" parameterType="hashMap">
		insert into plan_lx_gcsj (id,jhid,gydw,gydwdm,xzqhdm,xzqhmc,lxbm,lxmc,
			yjsdj,bhnr,qdzh,zdzh,qzlc,xmlc)
		values(sys_guid(),#{jhid},#{0},#{gydwdm},#{1},#{2},#{3},#{4},
			#{5},#{6},#{7},#{8},#{9},#{10})
	</insert>
</mapper>