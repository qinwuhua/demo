<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_shuih">
	<resultMap type="plan_shuih" id="shuih_jh">
		<id property="id" column="id" />
		<result property="sbnf" column="sbnf"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<result property="xdsj" column="xdsj"/>
		<result property="xmmc" column="xmmc"/>
		<result property="yhlb" column="yhlb"/>
		<result property="sjdw" column="sjdw"/>
		<result property="sjpfdw" column="sjpfdw"/>
		<result property="dc" column="dc"/>
		<result property="jc" column="jc"/>
		<result property="mc" column="mc"/>
		<result property="lmkd" column="lmkd"/>
		<result property="pfwh" column="pfwh"/>
		<result property="pfsj" column="pfsj"/>
		<result property="pfztz" column="pfztz"/>
		<result property="jhsybzje" column="jhsybzje"/>
		<result property="jhsydfzcje" column="jhsydfzcje"/>
		<result property="sfsqablbz" column="sfsqablbz"/>
		<result property="ablbzsqwh" column="ablbzsqwh"/>
		<result property="sftqss" column="sftqss"/>
		<result property="jhxdwh" column="jhxdwh"/>
		<result property="gksjwh" column="gksjwh"/>
		<result property="sjpfwh" column="sjpfwh"/>
		<result property="sfgyhbm" column="sfgyhbm"/>
		<result property="jhbz" column="jhbz"/>
		<result property="sbzt" column="sbzt"/>
		<result property="spzt" column="spzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="kgzt" column="kgzt"/>
		<result property="gkbgmc" column="gkbgmc"/>
		<result property="sjsgtmc" column="sjsgtmc"/>
		<result property="sfylsjl" column="sfylsjl"/>
		<collection property="shuihs" ofType="plan_lx_shuih" resultMap="shuih_lx"/>
	</resultMap>
	<resultMap type="plan_lx_shuih" id="shuih_lx">
		<id property="id" column="id" />
		<result property="lxbm" column="lxbm"/>
		<result property="lxmc" column="lxmc"/>
		<result property="jsdd" column="jsdd"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="qzlc" column="qzlc"/>
		<result property="gydw" column="gydw"/>
		<result property="xzqhdm" column="xzqhdm"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="yjsdj" column="yjsdj"/>
		<result property="ylmlx" column="ylmlx"/>
		<result property="yhlc" column="yhlc"/>
		<result property="bhnr" column="bhnr"/>
	</resultMap>
	<select id="queryShuihList"  parameterType="java.util.Map" resultMap="shuih_jh">
		select * from (
			select rownum as num,t.* from (	
				select jh.xmmc,jh.jhsydfzcje,jh.JHSYBZJE,jh.sfylsjl,jh.kgzt,jh.jgzt,jh.jh_sbthcd,jh.id,jh.sbzt,jh.spzt,jh.sbnf,jh.jhkgsj,jh.jhwgsj,jh.pfztz,jh.xdsj,
	      		l.gydw,l.xzqhmc,l.lxmc,l.lxbm,l.qdzh,l.zdzh,l.yhlc 
	      		from PLAN_lx_shuih l right JOIN plan_shuih jh on  l.jhid=jh.id 
				where 1=1
				<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">	
			 		and jh.jh_sbthcd=#{jh.jh_sbthcd}
				</if>
				<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
					and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
				</if>
				<if test="jh.sbnf!=null and jh.sbnf!=''">
					and jh.sbnf =#{jh.sbnf}
				</if>
				<if test="jh.sbzt!=null and jh.sbzt!=''">
					and jh.sbzt=#{jh.sbzt}
				</if>
				<if test="jh.spzt!=null and jh.spzt!=''">
					and jh.spzt=#{jh.spzt}
				</if>
				<if test="jh.kgzt!=null and jh.kgzt!=''">
					and jh.kgzt=#{jh.kgzt}
	 			</if>
	 			<if test="jh.jgzt!=null and jh.jgzt!=''">
	 				and jh.jgzt=#{jh.jgzt}
	 			</if>
				<if test="l.gydwdm!=null and l.gydwdm!=''">
					and l.gydwdm like #{l.gydwdm}
				</if>
				<if test="l.xzqhdm!=null and l.xzqhdm!=''">
					and l.xzqhdm like #{l.xzqhdm}
				</if>
				<if test="l.lxmc!=null and l.lxmc!=''">
					and l.lxmc like '%'||#{l.lxmc}||'%'
				</if>
				<if test="l.yjsdj!=null and l.yjsdj!=''">
					and l.yjsdj=#{l.yjsdj}
				</if>
				<if test="l.lxbm!=null and l.lxbm!=''">
					and l.lxbm like #{l.lxbm}
				</if>
				<if test="l.tsdqbm!=null and l.tsdqbm!=''">
					and l.xzqhdm in (select t.xzqhdm from xtgl_xzqhtsdq t where t.parent =#{lx.tsdq})
				</if>
				order by jh.jh_sbthcd,jh.sbnf desc
				) t
			)
			where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryShuihList2"  parameterType="java.util.Map" resultMap="shuih_jh">
		select * from (
			select rownum as num,t.* from (	
				select jh.xmmc,jh.sfylsjl,jh.kgzt,jh.jgzt,jh.jh_sbthcd,jh.id,jh.sbzt,jh.spzt,jh.sbnf,jh.jhkgsj,jh.jhwgsj,jh.pfztz,jh.xdsj,
	      		l.gydw,l.xzqhmc,l.lxmc,l.lxbm,l.qdzh,l.zdzh,l.yhlc,l.qzlc
	      		from PLAN_lx_shuih l right JOIN plan_shuih jh on  l.jhid=jh.id 
				where 1=1
				<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">	
			 		and jh.jh_sbthcd=#{jh.jh_sbthcd}
				</if>
				<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
					and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
				</if>
				<if test="jh.sbnf!=null and jh.sbnf!=''">
					and jh.sbnf =#{jh.sbnf}
				</if>
				<if test="jh.sbzt!=null and jh.sbzt!=''">
					and jh.sbzt=#{jh.sbzt}
				</if>
				<if test="jh.spzt!=null and jh.spzt!=''">
					and jh.spzt=#{jh.spzt}
				</if>
				<if test="jh.kgzt!=null and jh.kgzt!=''">
					and jh.kgzt=#{jh.kgzt}
	 			</if>
	 			<if test="jh.jgzt!=null and jh.jgzt!=''">
	 				and jh.jgzt=#{jh.jgzt}
	 			</if>
				<if test="l.gydwdm!=null and l.gydwdm!=''">
					and l.gydwdm like #{l.gydwdm}
				</if>
				<if test="l.xzqhdm!=null and l.xzqhdm!=''">
					and l.xzqhdm like #{l.xzqhdm}
				</if>
				<if test="l.lxmc!=null and l.lxmc!=''">
					and l.lxmc like '%'||#{l.lxmc}||'%'
				</if>
				<if test="l.yjsdj!=null and l.yjsdj!=''">
					and l.yjsdj=#{l.yjsdj}
				</if>
				<if test="l.lxbm!=null and l.lxbm!=''">
					and l.lxbm like #{l.lxbm}
				</if>
				<if test="l.tsdqbm!=null and l.tsdqbm!=''">
					and l.xzqhdm in (select t.xzqhdm from xtgl_xzqhtsdq t where t.parent =#{lx.tsdq})
				</if>
				order by jh.jh_sbthcd,jh.sbnf desc
				) t)
	</select>
	<select id="queryShuihCount"  parameterType="java.util.Map"  resultType="int">
		select count(*) from PLAN_shuih jh where 1=1
		<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">	
	 		and jh.jh_sbthcd=#{jh.jh_sbthcd}
		</if>
		<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
			and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
		</if>
		<if test="jh.sbnf!=null and jh.sbnf!=''">
			and jh.sbnf =#{jh.sbnf}
		</if>
		<if test="jh.sbzt!=null and jh.sbzt!=''">
			and jh.sbzt=#{jh.sbzt}
		</if>
		<if test="jh.spzt!=null and jh.spzt!=''">
			and jh.spzt=#{jh.spzt}
		</if>
		<if test="jh.kgzt!=null and jh.kgzt!=''">
			and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
		and jh.id in (
			select l.jhid from PLAN_lx_shuih l
			where 1=1 
			<if test="l.gydwdm!=null and l.gydwdm!=''">
				and l.gydwdm like #{l.gydwdm}
			</if>
			<if test="l.xzqhdm!=null and l.xzqhdm!=''">
				and l.xzqhdm like #{l.xzqhdm}
			</if>
			<if test="l.lxmc!=null and l.lxmc!=''">
				and l.lxmc like '%'||#{l.lxmc}||'%'
			</if>
			<if test="l.yjsdj!=null and l.yjsdj!=''">
				and l.yjsdj=#{l.yjsdj}
			</if>
			<if test="l.lxbm!=null and l.lxbm!=''">
				and l.lxbm like #{l.lxbm}
			</if>
			<if test="l.tsdqbm!=null and l.tsdqbm!=''">
			and l.xzqhdm in (select t.xzqhdm from xtgl_xzqhtsdq t where t.parent =#{lx.tsdq})
			</if>)
	</select>
	<select id="queryShuihNfs"  resultType="treenode">
		select distinct t.jhnf as text from PLAN_abgc t order by t.jhnf
	</select>
	<select id="querySumShuih" resultMap="shuih_jh" parameterType="java.util.Map">
		select count(id) as id,sum(qzlc) as qzlc,sum(yhlc) as yhlc,sum(pfztz) as pfztz,
		sum(jhsybzje) as jhsybzje,sum(jhsydfzcje) as jhsydfzcje from (
			select count(jh.id) as id,sum(lx.qzlc) as qzlc,sum(lx.yhlc) as yhlc,sum(jh.pfztz) as pfztz,
			sum(jh.jhsybzje) as jhsybzje,sum(jh.jhsydfzcje) as jhsydfzcje
			from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id)
			where 1=1
			<if test="lx.gydwdm!=null and lx.gydwdm!=''">
				and lx.gydwdm like #{lx.gydwdm}
			</if>
			<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">	
		 		and jh.jh_sbthcd=#{jh.jh_sbthcd}
			</if>
			<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
				and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
			</if>
			<if test="jh.sbnf!=null and jh.sbnf!=''">
				and jh.sbnf =#{jh.sbnf}
			</if>
			<if test="jh.sbzt!=null and jh.sbzt!=''">
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.spzt!=null and jh.spzt!=''">
				and jh.spzt=#{jh.spzt}
			</if>
			<if test="jh.kgzt!=null and jh.kgzt!=''">
				and jh.kgzt=#{jh.kgzt}
			</if>
	 		<if test="jh.jgzt!=null and jh.jgzt!=''">
	 			and jh.jgzt=#{jh.jgzt}
	 		</if>
	 		<if test="lx.tsdqbm!=null and lx.tsdqbm!=''">
				and lx.xzqhdm in (select t.xzqhdm from xtgl_xzqhtsdq t where t.parent =#{lx.tsdq})
			</if>
			group by jh.id)
	</select>
	<select id="queryShuihById" parameterType="string" resultMap="shuih_jh">
		select * from plan_lx_shuih lx right join plan_shuih jh on lx.jhid=jh.id
		where jh.id=#{id}
	</select>
	<delete id="dropShuihById" parameterType="java.util.List">
		delete from plan_shuih jh where jh.id=#{id}
	</delete>
	<update id="editShuihById" parameterType="plan_shuih">
		update plan_shuih set sbnf=#{sbnf},
			<if test="jhkgsj!=null and jhkgsj!=''">
				jhkgsj=#{jhkgsj},
			</if>
			<if test="jhwgsj!=null and jhwgsj!=''">
				jhwgsj=#{jhwgsj},
			</if>
			<if test="xdsj!=null and xdsj!=''">
				xdsj=#{xdsj},
			</if>
			<if test="pfsj!=null and pfsj!=''">
				pfsj=#{pfsj},
			</if>
			xmmc=#{xmmc},yhlb=#{yhlb},sjdw=#{sjdw},sjpfdw=#{sjpfdw},sjlmlx=#{sjlmlx},
			dc=#{dc},jc=#{jc},mc=#{mc},lmkd=#{lmkd},pfwh=#{pfwh},pfztz=#{pfztz},jhsybzje=#{jhsybzje},
			jhsydfzcje=#{jhsydfzcje},sfsqablbz=#{sfsqablbz},ablbzsqwh=#{ablbzsqwh},sftqss=#{sftqss},
			jhxdwh=#{jhxdwh},gksjwh=#{gksjwh},sjpfwh=#{sjpfwh},sfgyhbm=#{sfgyhbm},jhbz=#{jhbz}
		where id=#{id}
	</update>
	<update id="editShuihStatus" parameterType="plan_shuih">
		update plan_shuih set 
			<if test="sbbm!=null">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null">sbsj=#{sbsj},</if>
			<if test="sbzt!=null">sbzt=#{sbzt},</if>
			<if test="spbm!=null">spbm=#{spbm},</if>
			<if test="spbmdm!=null">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null">spsj=#{spsj},</if>
			<if test="spzt!=null">spzt=#{spzt},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>
	<insert id="insertShuih_Jh" parameterType="hashMap">
		insert into plan_shuih (id,fapgdw,fascdw,
			faspsj,spwh,tzgs,jsxz,jsnr,
			xmmc,lmkd,sftqss,sbnf,jhkgsj,
			jhwgsj,sjdw,sjpfdw,pfwh,pfsj,
			yhlb,sjlmlx,dc,jc,mc,
			pfztz,jhsybzje,jhsydfzcje,sfsqablbz,ablbzsqwh,
			sfgyhbm,gksjwh,sjpfwh,jhbz,sfylsjl,tbbm)
		values (#{jhid},#{12},#{13},
			to_date(#{14},'yyyy-mm-dd'),#{15},#{16},#{17},#{18},
			#{19},#{20},#{21},#{22},to_date(#{23},'yyyy-mm-dd'),
			to_date(#{24},'yyyy-mm-dd'),#{25},#{26},#{27},to_date(#{28},'yyyy-mm-dd'),
			#{29},#{30},#{31},#{32},#{33},
			#{34},#{35},#{36},#{37},#{38},
			#{39},#{40},#{41},#{42},#{sfylsjl},#{tbbm})
	</insert>
	<insert id="insertShuih_Lx" parameterType="hashMap">
		insert into plan_lx_shuih (id,jhid,gydw,gydwdm,xzqhdm,xzqhmc,lxbm,
			lxmc,jsdd,bhnr,ylmlx,qdzh,zdzh,qzlc,yhlc,TBSJ,TBBMBH,yjsdj) 
		values(sys_guid(),#{jhid},#{0},(select id from XTGL_DEPARTMENT t where t.name = #{0}),#{1},#{2},#{3},
			#{4},#{5},#{6},#{7},#{8},#{9},#{10},#{11},#{tbsj},#{gydwdm},#{yjsdj})
	</insert>
	<select id="queryGPSBylxbm" parameterType="plan_lx_shuih" resultType="plan_lx_shuih">
		select  t.roadcode as lxbm,t.roadname as lxmc,
		TO_CHAR(t.roadlen,'FM9999999990.099') as qzlc,t.f114 as yjsdj from JXJCK_2013.GPSROAD t where 
		t.roadcode=#{lxbm} and <![CDATA[t.roadstart<=#{qdzh}]]> and t.roadends>=#{zdzh} and t.f044=#{gydwdm}
	</select>
	<select id="queryJlBylx" parameterType="plan_lx_shuih" resultType="int">
		SELECT C1.CON1+C2.CON2 FROM
		(select count(jh.id) CON1 from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id) 
		    where <![CDATA[lx.lxbm=#{lxbm} and (lx.qdzh<=${zdzh} or lx.zdzh>=${qdzh}) and jh.sbnf<#{jhid}]]>
		)C1,
		<![CDATA[(select count(*) CON2 from
		(select lx.lxbm,lx.qdzh,lx.zdzh from plan_lx_shuih lx, plan_shuih jh where lx.jhid=jh.id and jh.sbnf<#{jhid})  j,
		(select YLXBM,YQDZH,YZDZH from XTGL_LXSJ where XLXBM =#{lxbm} and XQDZH<=${zdzh} and XZDZH>=${qdzh}) k
		where j.lxbm=k.YLXBM and j.qdzh<k.YZDZH and j.zdzh>k.YQDZH) C2]]>
		<!-- select count(jh.id) from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id)
		where <![CDATA[ lx.lxbm=#{lxbm} and (lx.qdzh<=${zdzh} and lx.zdzh>=${qdzh}) and jh.sbnf<#{jhid}]]> -->
	</select>
	<delete id="dropShuihLxByJhid" parameterType="java.util.List">
		delete from plan_lx_shuih where jhid=#{String}
	</delete>
	<update id="uploadShuihFile" parameterType="plan_shuih">
		update plan_shuih jh set 
		<if test="gkbgmc!=null and gkbgmc!=''">
			jh.GKBGMC=#{gkbgmc},
		</if>
		<if test="gkbgwj!=null">
			jh.gkbgwj=#{gkbgwj}
		</if>
		<if test="sjsgtmc!=null and sjsgtmc!=''">
			jh.SJSGTMC=#{sjsgtmc},
		</if>
		<if test="sjsgtwj!=null">
			jh.sjsgtwj=#{sjsgtwj}
		</if>
		where jh.id=#{id}
	</update>
	<select id="queryShuihwjById" parameterType="plan_shuih" resultType="plan_shuih">
		select j.gkbgmc,j.gkbgwj,j.sjsgtmc,j.sjsgtwj from plan_shuih j where id=#{id}
	</select>
	<select id="queryJhExist" parameterType="plan_lx_shuih" resultType="int">
		select count(*) from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id) 
		where lx.lxbm=#{lxbm} and <![CDATA[lx.qdzh<=#{zdzh}]]> and lx.zdzh>=#{qdzh} 
		and jh.sbnf=#{jhid}
	</select>
	<select id="queryTsdqByXzqh" resultType="string" parameterType="string">
		select bt.areaname from bt_xzqhtsdq xz right join bt_specialarea bt on (xz.areacode=bt.areacode) where xz.xzqhdm=#{_parameter}
	</select>
	<select id="queryBzzj" resultType="flwbzbz" parameterType="flwbzbz">
		select * from plan_flwbzbz f where 
		<if test="xmlx==null or xmlx==''">
			f.xmlx is null
		</if>
		<if test="xmlx!=null and xmlx!=''">
			f.xmlx=#{xmlx}
		</if>
		<if test="gldj==null or gldj==''">
			and f.gldj is null
		</if>
		<if test="gldj!=null and gldj!=''">
			and f.gldj=#{gldj}
		</if>
		<if test="jsdj==null or jsdj==''">
			and f.jsdj is null
		</if>
		<if test="jsdj!=null and jsdj!=''">
			and f.jsdj=#{jsdj}
		</if>
		<if test="tsdq==null or tsdq==''">
			and f.tsdq is null
		</if>
		<if test="tsdq!=null and tsdq!=''">
			and f.tsdq =#{tsdq}
		</if>
	</select>
	<select id="queryTjJeAndSl" resultType="treenode" parameterType="java.util.Map">
		select t.parent as id,xz.name as name,NVL(sum(t.je),0) as text,sum(sl) as parent from (
      		select distinct xt.parent,lx.xzqhdm,lx.xzqhmc,jh.sbnf,jh.id,
        		(select sum(jh1.jhsybzje) from plan_shuih jh1 left join plan_lx_shuih lx1 on (jh1.id=lx1.jhid) right join xtgl_xzqh xt1 on (lx1.xzqhdm=xt1.id) 
        		where jh1.sbnf=#{nf} and jh1.id=jh.id group by jh1.id) as je,
        		(select count(jh1.id) from plan_shuih jh1 where jh1.sbnf=#{nf} and jh1.id=jh.id) as sl
      		from plan_shuih jh left join plan_lx_shuih lx on (jh.id=lx.jhid) right join xtgl_xzqh xt on (lx.xzqhdm=xt.id) order by xt.parent
    	) t join xtgl_xzqh xz on(t.parent=xz.id) group by t.parent,xz.name order by t.parent
	</select>
	<select id="queryJhktj2" resultType="treenode" parameterType="java.util.Map">
		select t.sbnf as id,sum(t.jhsybzje) as text,count(t.jhsybzje) as name from (
       		select distinct jh.id,lx.xzqhdm,jh.sbnf,jh.jhsybzje 
       		from  plan_gcgj jh left join plan_lx_gcgj lx on (jh.id=lx.jhid) where lx.xzqhdm like rtrim(#{xzqhdm},'0')||'%') t
		where t.sbnf>=#{start} and <![CDATA[t.sbnf<=#{end}]]> group by t.sbnf
	</select>
	<select id="queryJhktjt2" resultType="string" parameterType="java.util.Map">
		select NVL(sum(t.jhsybzje),0) from (
       		select distinct jh.id,lx.xzqhdm,jh.sbnf,jh.jhsybzje 
       		from  plan_gcgj jh left join plan_lx_gcgj lx on (jh.id=lx.jhid) 
       		where lx.xzqhdm like #{xzqhdm} and sbnf=#{nf}) t
		group by t.sbnf
	</select>
	<select id="queryJhktjt3" resultType="treenode" parameterType="java.util.Map">
		select sbnf as name,sum(jhsybzje) as text from (
		select distinct jh.id,jh.sbnf,jh.jhsybzje from PLAN_shuih jh left join plan_lx_shuih lx on jh.id=lx.jhid
		where jh.sbnf>=#{start} and <![CDATA[jh.sbnf<=#{end}]]> and lx.xzqhdm like #{xzqhdm}) s group by s.sbnf
	</select>
	<select id="queryGcktj" resultType="treenode" parameterType="java.util.Map">
		select (r.kgzt+r.jgzt) as id,count(r.kgzt+r.jgzt) as name,sum(r.jhsybzje) as text,sum(btz+qttz) as parent from (
       		select jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybzje,sum(nvl(gcgl.wc_btz,0)) as btz,sum(nvl(gcgl.wc_qttz,0)) as qttz 
       		from gcgl_sh gcgl right join (
            	select distinct jh.id,jh.kgzt,jh.jgzt,jh.jhsybzje from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id)
            	where lx.xzqhdm like #{xzqhdm} and jh.sbnf=#{nf} and jh.spzt='1' and jh.jh_sbthcd='6') 
       		jh_lx on (gcgl.jhid=jh_lx.id) group by jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybzje
		) r group by r.kgzt,r.jgzt order by r.kgzt,r.jgzt
	</select>
	<select id="queryGcktjt" resultType="treenode" parameterType="java.util.Map">
		select nvl(sum(r.jhsybzje),0) as text,nvl(sum(btz+qttz),0) as parent from (
       		select jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybzje,sum(nvl(gcgl.wc_btz,0)) as btz,sum(nvl(gcgl.wc_qttz,0)) as qttz 
       		from gcgl_sh gcgl right join (
            	select distinct jh.id,jh.kgzt,jh.jgzt,jh.jhsybzje from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id)
            	where jh.spzt='1' and jh.jh_sbthcd='6'
            	<if test="xzqhdm!=null and xzqhdm!=''">
            		and lx.xzqhdm like #{xzqhdm}
            	</if>
            	) 
       		jh_lx on (gcgl.jhid=jh_lx.id) group by jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybzje
		) r
	</select>
	<select id="queryGcktj2" resultType="treenode" parameterType="java.util.Map">
		select nvl(sum(r.bn),0) as id,count(r.bn) as name,nvl(sum(r.fbn),0) as text,count(r.fbn) as parent from (
	  		select distinct jh.id,jh.kgzt,jh.jgzt,
				(select sh.jhsybzje from plan_shuih sh where sh.sbnf=#{nf} and sh.id=jh.id) as bn,
			  	(select sh.jhsybzje from plan_shuih sh where #{nf}>sh.sbnf and sh.id=jh.id) as fbn
	  		from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id) 
		where jh.spzt='1' and jh.jh_sbthcd='6'and lx.xzqhdm like #{xzqhdm} order by jh.id) r
	</select>
	<insert id="insertShuihLx" parameterType="plan_lx_shuih">
		insert into plan_lx_shuih (id,jhid,gydw,gydwdm,
			xzqhdm,xzqhmc,lxbm,lxmc,jsdd,bhnr,ylmlx,
			qdzh,zdzh,qzlc,yhlc,TBSJ,TBBMBH,yjsdj) 
		values(sys_guid(),#{jhid},#{gydw},(select id from XTGL_DEPARTMENT t where t.name = #{gydw}),
			#{xzqhdm},#{xzqhmc},#{lxbm},#{lxmc},#{jsdd},#{bhnr},#{ylmlx},
			#{qdzh},#{zdzh},#{qzlc},#{yhlc},#{tbsj},#{tbbmbh},#{yjsdj})
	</insert>
	<insert id="insertShuihJh" parameterType="plan_shuih">
		insert into plan_shuih (id,fapgdw,fascdw,
			faspsj,spwh,tzgs,jsxz,jsnr,
			xmmc,lmkd,sftqss,sbnf,jhkgsj,
			jhwgsj,sjdw,sjpfdw,pfwh,pfsj,
			yhlb,sjlmlx,dc,jc,mc,
			pfztz,jhsybzje,jhsydfzcje,sfsqablbz,ablbzsqwh,
			sfgyhbm,gksjwh,sjpfwh,jhbz,sfylsjl,tbbm)
		values (#{id},#{fapgdw},#{fascdw},
			to_date(#{faspsj},'yyyy-mm-dd'),#{spwh},#{tzgs},#{jsxz},#{jsnr},
			#{xmmc},#{lmkd},#{sftqss},#{sbnf},#{jhkgsj},
			#{jhwgsj},#{sjdw},#{sjpfdw},#{pfwh},#{pfsj},
			#{yhlb},#{sjlmlx},#{dc},#{jc},#{mc},
			#{pfztz},#{jhsybzje},#{jhsydfzcje},#{sfsqablbz},#{ablbzsqwh},
			#{sfgyhbm},#{gksjwh},#{sjpfwh},#{jhbz},#{sfylsjl},#{tbbm})
	</insert>
	<select id="shAutoCompleteLxbm" parameterType="plan_lx_shuih" resultType="plan_lx_shuih">
		select g.roadname as lxmc,g.roadcode as lxbm,min(g.roadstart) as qdzh,max(g.roadends) as zdzh,
		(max(g.roadends)-min(g.roadstart)) as qzlc,g.f114 as yjsdj,g.f116 as ylmlx
		from  JXJCK_2013.GPSROAD g
		where substr(roadcode,1,1) in('G','S','X') and F048='1' and roadcode like #{lxbm}||'%'
		and roadcode like '%'||rtrim(#{xzqhdm},0)||'%'
		group by roadname,roadcode,g.f114,g.f116
	</select>
</mapper>
