<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_shuih">
	<resultMap type="plan_shuih" id="shuih_jh">
		<id property="id" column="id" />
		<result property="sbnf" column="sbnf"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<result property="xdsj" column="xdsj"/>
		<result property="xmmc" column="xmmc"/>
		<result property="yhlb" column="yhlb"/>
		<result property="sjdw" column="sjdw"/>
		<result property="sjpfdw" column="sjpfdw"/>
		<result property="dc" column="dc"/>
		<result property="jc" column="jc"/>
		<result property="mc" column="mc"/>
		<result property="lmkd" column="lmkd"/>
		<result property="pfwh" column="pfwh"/>
		<result property="pfsj" column="pfsj"/>
		<result property="pfztz" column="pfztz"/>
		<result property="jhsybzje" column="jhsybzje"/>
		<result property="jhsydfzcje" column="jhsydfzcje"/>
		<result property="sfsqablbz" column="sfsqablbz"/>
		<result property="ablbzsqwh" column="ablbzsqwh"/>
		<result property="sftqss" column="sftqss"/>
		<result property="jhxdwh" column="jhxdwh"/>
		<result property="gksjwh" column="gksjwh"/>
		<result property="sjpfwh" column="sjpfwh"/>
		<result property="sfgyhbm" column="sfgyhbm"/>
		<result property="jhbz" column="jhbz"/>
		<result property="sbzt" column="sbzt"/>
		<result property="spzt" column="spzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="kgzt" column="kgzt"/>
		<result property="sfylsjl" column="sfylsjl"/>
		<collection property="shuihs" ofType="plan_lx_shuih" resultMap="shuih_lx"/>
	</resultMap>
	<resultMap type="plan_lx_shuih" id="shuih_lx">
		<id property="id" column="id" />
		<result property="lxbm" column="lxbm"/>
		<result property="lxmc" column="lxmc"/>
		<result property="jsdd" column="jsdd"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="qzlc" column="qzlc"/>
		<result property="gydw" column="gydw"/>
		<result property="xzqhdm" column="xzqhdm"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="yjsdj" column="yjsdj"/>
		<result property="ylmlx" column="ylmlx"/>
		<result property="yhlc" column="yhlc"/>
		<result property="bhnr" column="bhnr"/>
		
	</resultMap>
	<select id="queryShuihList"  parameterType="java.util.Map" resultMap="shuih_jh">
		select * from (
			select rownum as num,t.* from (	
				select jh.sfylsjl,jh.kgzt,jh.jgzt,jh.jh_sbthcd,jh.id,jh.sbzt,jh.spzt,jh.sbnf,jh.jhkgsj,jh.jhwgsj,jh.pfztz,jh.xdsj,
	      		l.gydw,l.xzqhmc,l.lxmc,l.lxbm,l.qdzh,l.zdzh,l.yhlc 
	      		from PLAN_lx_shuih l right JOIN plan_shuih jh on  l.jhid=jh.id 
				where 1=1
				<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='')">
					and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
				</if>
				<if test="jh.sbnf!=null and jh.sbnf!=''">
					and jh.sbnf =#{jh.sbnf}
				</if>
				<if test="jh.sbzt!=null and jh.sbzt!=''">
					and jh.sbzt=#{jh.sbzt}
				</if>
				<if test="jh.spzt!=null and jh.spzt!=''">
					and jh.spzt=#{jh.spzt}
				</if>
					and jh.id in (
						select l.jhid from PLAN_lx_shuih l 
						where 1=1 
							<if test="l.gydwdm!=null and l.gydwdm!=''">
								and l.gydwdm like #{l.gydwdm}
							</if>
							<if test="l.xzqhdm!=null and l.xzqhdm!=''">
								and l.xzqhdm like #{l.xzqhdm}
							</if>
							<if test="l.lxmc!=null and l.lxmc!=''">
								and l.lxmc like '%'||#{l.lxmc}||'%'
							</if>
							<if test="l.yjsdj!=null and l.yjsdj!=''">
								and l.yjsdj=#{l.yjsdj}
							</if>
							<if test="l.lxbm!=null and l.lxbm!=''">
								and l.lxbm like #{l.lxbm}
							</if>
						     and l.xzqhdm in (
						     	select B.XZQHDM from BT_XZQHTSDQ b 
						     	WHERE 1=1 
						     	<if test="l.tsdqbm!=null and l.tsdqbm!=''">
									B.AREACODE=#{l.tsdqbm}
								</if>
						     	 )
						     ) order by jh.sbzt,jh.spzt,jh.sbnf desc
						) t
				)
			where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryShuihCount"  parameterType="java.util.Map"  resultType="int">
		select count(*) from PLAN_shuih jh where 1=1
		<if test="jh.sbnf!=null and jh.sbnf!=''">
				and jh.sbnf =#{jh.sbnf}
			</if>
			<if test="jh.sbzt!=null and jh.sbzt!=''">
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.spzt!=null and jh.spzt!=''">
				and jh.spzt=#{jh.spzt}
			</if>
				and jh.id in (
					select l.jhid from PLAN_lx_shuih l
					where 1=1 
						<if test="l.gydwdm!=null and l.gydwdm!=''">
								and l.gydwdm like #{l.gydwdm}
							</if>
							<if test="l.xzqhdm!=null and l.xzqhdm!=''">
								and l.xzqhdm like #{l.xzqhdm}
							</if>
						<if test="l.lxmc!=null and l.lxmc!=''">
							and l.lxmc like '%'||#{l.lxmc}||'%'
						</if>
						<if test="l.yjsdj!=null and l.yjsdj!=''">
							and l.yjsdj=#{l.yjsdj}
						</if>
						<if test="l.lxbm!=null and l.lxbm!=''">
							and l.lxbm like #{l.lxbm}
						</if>
					     and l.xzqhdm in (
					     	select B.XZQHDM from BT_XZQHTSDQ b 
					     	WHERE 1=1 
					     	<if test="l.tsdqbm!=null and l.tsdqbm!=''">
								B.AREACODE=#{l.tsdqbm}
							</if>
					     	 )
					     )
	</select>
	<select id="queryShuihNfs"  resultType="treenode">
		select distinct t.jhnf as text from PLAN_abgc t order by t.jhnf
	</select>
	<select id="querySumShuih" resultMap="shuih_jh">
		select count(jh.id) as id,sum(lx.qzlc) as qzlc,sum(lx.yhlc) as yhlc,sum(jh.pfztz) as pfztz,
		sum(jh.jhsybzje) as jhsybzje,sum(jh.jhsydfzcje) as jhsydfzcje
		from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id)
	</select>
	<select id="queryShuihById" parameterType="string" resultMap="shuih_jh">
		select * from plan_lx_shuih lx right join plan_shuih jh on lx.jhid=jh.id
		where jh.id=#{id}
	</select>
	<delete id="dropShuihById" parameterType="java.util.List">
		delete from plan_shuih jh where jh.id=#{id}
	</delete>
	<update id="editShuihById" parameterType="plan_shuih">
		update plan_shuih set sbnf=#{sbnf},
			<if test="jhkgsj!=null and jhkgsj!=''">
				jhkgsj=#{jhkgsj},
			</if>
			<if test="jhwgsj!=null and jhwgsj!=''">
				jhwgsj=#{jhwgsj},
			</if>
			<if test="xdsj!=null and xdsj!=''">
				xdsj=#{xdsj},
			</if>
			<if test="pfsj!=null and pfsj!=''">
				pfsj=#{pfsj},
			</if>
			xmmc=#{xmmc},yhlb=#{yhlb},sjdw=#{sjdw},sjpfdw=#{sjpfdw},sjlmlx=#{sjlmlx},
			dc=#{dc},jc=#{jc},mc=#{mc},lmkd=#{lmkd},pfwh=#{pfwh},pfztz=#{pfztz},jhsybzje=#{jhsybzje},
			jhsydfzcje=#{jhsydfzcje},sfsqablbz=#{sfsqablbz},ablbzsqwh=#{ablbzsqwh},sftqss=#{sftqss},
			jhxdwh=#{jhxdwh},gksjwh=#{gksjwh},sjpfwh=#{sjpfwh},sfgyhbm=#{sfgyhbm},jhbz=#{jhbz}
		where id=#{id}
	</update>
	<update id="editShuihStatus" parameterType="plan_shuih">
		update plan_shuih set 
			<if test="sbbm!=null">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null">sbsj=#{sbsj},</if>
			<if test="sbzt!=null">sbzt=#{sbzt},</if>
			<if test="spbm!=null">spbm=#{spbm},</if>
			<if test="spbmdm!=null">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null">spsj=#{spsj},</if>
			<if test="spzt!=null">spzt=#{spzt},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>
	<insert id="insertShuih_Jh" parameterType="hashMap">
		insert into plan_shuih (id,fapgdw,fascdw,
			faspsj,spwh,tzgs,jsxz,jsnr,
			xmmc,lmkd,sftqss,sbnf,jhkgsj,
			jhwgsj,sjdw,sjpfdw,pfwh,pfsj,
			yhlb,sjlmlx,dc,jc,mc,
			pfztz,jhsybzje,jhsydfzcje,sfsqablbz,ablbzsqwh,
			sfgyhbm,gksjwh,sjpfwh,jhbz,sfylsjl)
		values (#{jhid},#{12},#{13},
			to_date(#{14},'yyyy-mm-dd'),#{15},#{16},#{17},#{18},
			#{19},#{20},#{21},#{22},to_date(#{23},'yyyy-mm-dd'),
			to_date(#{24},'yyyy-mm-dd'),#{25},#{26},#{27},to_date(#{28},'yyyy-mm-dd'),
			#{29},#{30},#{31},#{32},#{33},
			#{34},#{35},#{36},#{37},#{38},
			#{39},#{40},#{41},#{42},#{sfylsjl})
	</insert>
	<insert id="insertShuih_Lx" parameterType="hashMap">
		insert into plan_lx_shuih (id,jhid,gydw,gydwdm,xzqhdm,xzqhmc,lxbm,
			lxmc,jsdd,bhnr,ylmlx,qdzh,
			zdzh,qzlc,yhlc) 
		values(sys_guid(),#{jhid},#{0},#{gydwdm},#{1},#{2},#{3},
			#{4},#{5},#{6},#{7},#{8},
			#{9},#{10},#{11})
	</insert>
	<select id="queryGPSBylxbm" parameterType="plan_lx_shuih" resultType="plan_lx_shuih">
		select  t.roadcode as lxbm,t.roadname as lxmc,
		TO_CHAR(t.roadlen,'FM9999999990.099') as qzlc from JXJCK_2013.GPSROAD t where 
		t.roadcode=#{lxbm} and t.roadstart=#{qdzh} and t.roadends=#{zdzh} and t.f044=#{gydwdm}
	</select>
	<select id="queryJlBylx" parameterType="plan_lx_shuih" resultType="int">
		select count(jh.id) from plan_lx_shuih lx right join plan_shuih jh on (lx.jhid=jh.id)
		where <![CDATA[ lx.lxbm=#{lxbm} and (lx.qdzh>=#{qdzh} or lx.zdzh<=#{zdzh})]]>
	</select>
	<delete id="dropShuihLxByJhid" parameterType="java.util.List">
		delete from plan_lx_shuih where jhid=#{String}
	</delete>
</mapper>