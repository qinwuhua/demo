<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_hsly">
	<insert id="insertHsly" parameterType="hashMap">
		insert into Plan_hsly (id,xmmc,jsxz,jsgmhj,jsgmy,jsgme,
			jsgms,jsgmf,jsgmdldq,kgn,wgn,jhnf,ztz,zytz,dfta,gndk,
			lywz,zyjsnr,xzscl,gkpfwh,sgtpfwh,TBBM,tbsj,XZQHDM,XZQHmc,gydwdm,gydwmc)
		values (sys_guid(),#{1},#{2},#{5},#{6},#{7},
			#{8},#{9},#{10},#{11},#{12},#{13},#{14},#{15},#{16},#{17},
			#{18},#{19},#{20},#{21},#{22},#{tbbm},#{tbsj},(select id from XTGL_XZQH where name =#{xzqhmc}),
			#{xzqhmc},#{4},#{3})
	</insert>
	<insert id="insertHsly2" parameterType="plan_hsly">
		insert into Plan_hsly (id
			<if test="xmmc!=null">,xmmc</if>
			<if test="jsxz!=null">,jsxz</if>
			<if test="jsgmhj!=null">,jsgmhj</if>
			<if test="jsgmy!=null">,jsgmy</if>
			<if test="jsgme">,jsgme</if>
			<if test="jsgms!=null">,jsgms</if>
			<if test="jsgmf!=null">,jsgmf</if>
			<if test="jsgmdldq!=null">,jsgmdldq</if>
			<if test="kgn!=null">,kgn</if>
			<if test="wgn!=null">,wgn</if>
			<if test="jhnf!=null">,jhnf</if>
			<if test="ztz!=null">,ztz</if>
			<if test="zytz!=null">,zytz</if>
			<if test="dfta!=null">,dfta</if>
			<if test="gndk!=null">,gndk</if>
			<if test="lywz!=null">,lywz</if>
			<if test="zyjsnr!=null">,zyjsnr</if>
			<if test="xzscl!=null">,xzscl</if>
			<if test="gkpfwh!=null">,gkpfwh</if>
			<if test="sgtpfwh!=null">,sgtpfwh</if>
			<if test="tbbm!=null">,TBBM</if>
			<if test="tbsj!=null">,tbsj</if>
			<if test="xzqhmc!=null">,XZQHDM</if>
			<if test="xzqhmc!=null">,XZQHmc</if>
			<if test="gydwdm!=null">,gydwdm</if>
			<if test="gydwmc!=null">,gydwmc</if>)
		values (sys_guid()
			<if test="xmmc!=null">,#{xmmc}</if>
			<if test="jsxz!=null">,#{jsxz}</if>
			<if test="jsgmhj!=null">,#{jsgmhj}</if>
			<if test="jsgmy!=null">,#{jsgmy}</if>
			<if test="jsgme">,#{jsgme}</if>
			<if test="jsgms!=null">,#{jsgms}</if>
			<if test="jsgmf!=null">,#{jsgmf}</if>
			<if test="jsgmdldq!=null">,#{jsgmdldq}</if>
			<if test="kgn!=null">,#{kgn}</if>
			<if test="wgn!=null">,#{wgn}</if>
			<if test="jhnf!=null">,#{jhnf}</if>
			<if test="ztz!=null">,#{ztz}</if>
			<if test="zytz!=null">,#{zytz}</if>
			<if test="dfta!=null">,#{dfta}</if>
			<if test="gndk!=null">,#{gndk}</if>
			<if test="lywz!=null">,#{lywz}</if>
			<if test="zyjsnr!=null">,#{zyjsnr}</if>
			<if test="xzscl!=null">,#{xzscl}</if>
			<if test="gkpfwh!=null">,#{gkpfwh}</if>
			<if test="sgtpfwh!=null">,#{sgtpfwh}</if>
			<if test="tbbm!=null">,#{tbbm}</if>
			<if test="tbsj!=null">,#{tbsj}</if>
			<if test="xzqhmc!=null">,substr(#{gydwdm},6)</if>
			<if test="xzqhmc!=null">,#{xzqhmc}</if>
			<if test="gydwdm!=null">,#{gydwdm}</if>
			<if test="gydwmc!=null">,#{gydwmc}</if>)
	</insert>
	<select id="queryHslyList" resultType="plan_hsly" parameterType="plan_hsly">
		select * from (	
			select rownum as num,t.* from (
				select * from plan_hsly where 1=1 
				<if test="hsly.xzqhdm!=null and hsly.xzqhdm!='' and hsly.xzqhdm!='36'">
					and ${hsly.xzqhdm}
				</if>
				<if test="hsly.jhnf!=null and hsly.jhnf!=''">
					and jhnf=#{hsly.jhnf}
				</if>
				<if test="hsly.xmmc!=null and hsly.xmmc!=''">
					and xmmc like '%'||#{hsly.xmmc}||'%'
				</if>
			) t
		) where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryHslyList2" resultType="plan_hsly" parameterType="plan_hsly">
		select * from plan_hsly where 1=1 and ${xzqhdm}
		<if test="jhnf!=null and jhnf!=''">
			and jhnf=#{jhnf}
		</if>
		<if test="xmmc!=null and xmmc!=''">
			and xmmc like '%'||#{xmmc}||'%'
		</if>
	</select>
	<select id="queryHslyCount" resultType="int" parameterType="plan_hsly">
		select count(*) from plan_hsly where 1=1 
		<if test="xzqhdm!=null and xzqhdm!='' and xzqhdm!='36'">
			and ${xzqhdm}
		</if>
		<if test="jhnf!=null and jhnf!=''">
			and jhnf=#{jhnf}
		</if>
		<if test="xmmc!=null and xmmc!=''">
			and xmmc like '%'||#{xmmc}||'%'
		</if>
	</select>
	<select id="queryHslyById" parameterType="string" resultType="plan_hsly">
		select * from plan_hsly where id=#{id}
	</select>
	<select id="queryHslyZjzj" parameterType="string" resultType="plan_hsly">
		select jhnf,ztz,zytzcgs as zytz,dfzc as dfta,gndk,lywz,zyjsnr,NVL(xzscnl,' ') as xzscl from PLAN_HSLYZJZJ t
		where t.PLANID=#{id}
	</select>
	<update id="editHsly" parameterType="plan_hsly">
		update plan_hsly set jhnf=#{jhnf},jsgmhj=#{jsgmhj},jsgmy=#{jsgmy},jsgme=#{jsgme},
			jsgms=#{jsgms},jsgmf=#{jsgmf},jsgmdldq=#{jsgmdldq},ztz=#{ztz},zytz=#{zytz},
			dfta=#{dfta},gndk=#{gndk},lywz=#{lywz},jsxz=#{jsxz},gkpfwh=#{gkpfwh},
			sgtpfwh=#{sgtpfwh},zyjsnr=#{zyjsnr},xzscl=#{xzscl}
		where id=#{id}
	</update>
	<delete id="dropHslyById" parameterType="java.util.List">
		delete from plan_hsly where id=#{id}
	</delete>
	<select id="querySumHsly" resultType="plan_hsly" parameterType="plan_hsly">
		select count(jh.id) as id,NVL(sum(jh.jsgmhj),'0') as jsgmhj,NVL(sum(jh.jsgmy),'0') as jsgmy,
       	NVL(sum(jh.jsgme),'0') as jsgme,NVL(sum(jh.jsgms),'0') as jsgms,NVL(sum(jh.jsgmf),'0') as jsgmf,
       	NVL(sum(jh.jsgmdldq),'0') as jsgmdldq,NVL(sum(jh.ztz),'0') as ztz,NVL(sum(jh.zytz),'0') as zytz
		from plan_hsly jh
		where 1=1
		<if test="xzqhdm!=null and xzqhdm!='' and xzqhdm!='36'">
			and ${xzqhdm}
		</if>
		<if test="jhnf!=null and jhnf!=''">
			and jhnf=#{jhnf}
		</if>
		<if test="xmmc!=null and xmmc!=''">
			and xmmc like '%'||#{xmmc}||'%'
		</if>
	</select>
	<update id="editHslyZj" parameterType="plan_hsly">
		update plan_hsly set ztz=#{ztz},zytz=#{zytz},dfta=#{dfta},gndk=#{gndk},lywz=#{lywz}
		where id=#{id}
	</update>
</mapper>
