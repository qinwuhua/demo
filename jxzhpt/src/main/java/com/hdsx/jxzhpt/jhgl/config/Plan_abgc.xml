<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_abgc">
	<resultMap type="plan_abgc"  id="abgc_jh">
		<id property="id" column="id" />
		<result property="xdsj" column="xdsj"/>
		<result property="jhnf" column="jhnf"/>
		<result property="sbzt" column="sbzt"/>
		<result property="spzt" column="spzt"/>
		<result property="jhwc_c" column="jhwc_c"/>
		<result property="sjdw" column="sjdw"/>
		<result property="sjpfdw" column="sjpfdw"/>
		<result property="pfwh" column="pfwh"/>
		<result property="pfsj" column="pfsj"/>
		<result property="jhsybbzje" column="jhsybbzje"/>
		<result property="jhsydfzczj" column="jhsydfzczj"/>
		<result property="jhxdwh" column="jhxdwh"/>
		<result property="sfsqablbz" column="sfsqablbz"/>
		<result property="ablbzsqwh" column="ablbzsqwh"/>
		<result property="pfztz" column="pfztz"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="sbbmdm" column="sbbmdm"/>
		<result property="spbmdm" column="spbmdm"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<association property="jckabgc"  resultMap="abgc_lx"></association>
	</resultMap>
	<resultMap type="jckabgc"  id="abgc_lx">
		<id property="id" column="id" />
		<result property="lxmc" column="lxmc"/>
		<result property="lxbm" column="lxbm"/>
		<result property="gydw" column="gydw"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="yhlc" column="yhlc"/>
	</resultMap>
	
	<select id="queryAbgcList"  parameterType="java.util.Map"  resultMap="abgc_jh">
		select * from 
			(
				select rownum as num,t.* from 
				(
					select  jh.id,jh.jhkgsj,jh.jhwgsj,jh.pfztz,jh.sbzt,jh.spzt,jh.jhnf,jh.jh_sbthcd,lx.gydw,lx.xzqhmc,lx.lxbm,lx.lxmc,lx.qdzh,lx.zdzh,lx.yhlc 
	    			from  Plan_Abgc jh left join Xmk_Abgc lx on jh.sckid=lx.id where 1=1 
				    <if test="jh.jhnf!=null and jh.jhnf!=''">
				 		and jh.jhnf=#{jh.jhnf}
				 	</if>
				 	<if test="jh.sbzt!=null and jh.sbzt!=''">
				 		and jh.sbzt=#{jh.sbzt}
				 	</if>
				 	<if test="jh.spzt!=null and jh.spzt!=''">
				 		and jh.spzt=#{jh.spzt}
				 	</if>
				 	<if test="lx.gydwdm!=null and lx.gydwdm!=''">
				 		and lx.gydwdm like #{lx.gydwdm}
				 	</if>
				 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
				 		and lx.xzqhdm like #{lx.xzqhdm}
				 	</if>
				 	<if test="lx.lxmc!=null and lx.lxmc!=''">
				 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
				 	</if>
				 	<if test="lx.lxbm!=null and lx.lxbm!=''">
				 		and lx.lxbm like #{lx.lxbm}||'%'
				 	</if>
				 	<if test="lx.lxjsdj!=null and lx.lxjsdj!=''">
				 		and lx.lxjsdj = #{lx.lxjsjd}
				 	</if>
	    			order by jh.sbzt,jh.spzt,jh.jhnf desc
	    		) t
    		)
    	where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryAbgcCount"  parameterType="java.util.Map"  resultType="int">
		select count(*) from Plan_Abgc jh left join Xmk_Abgc lx on jh.sckid=lx.id where 1=1
		<if test="jh.jhnf!=null and jh.jhnf!=''">
	 		and jh.jhnf=#{jh.jhnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		and jh.sbzt=#{jh.sbzt}
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
	 	<if test="lx.gydwdm!=null and lx.gydwdm!=''">
	 		and lx.gydwdm like #{lx.gydwdm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and lx.xzqhdm like #{lx.xzqhdm}
	 	</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.lxjsdj!=null and lx.lxjsdj!=''">
	 		and lx.lxjsdj = #{lx.lxjsjd}
	 	</if>
	</select>
	<select id="queryAbgcById"  parameterType="string"  resultMap="abgc_jh">
		select * from Plan_Abgc jh left join Xmk_Abgc lx on jh.sckid=lx.id where jh.id=#{id}
	</select>
	<select id="queryAbgcNfs" resultType="treenode">
		 select distinct t.jhnf as text from PLAN_abgc t order by t.jhnf
	</select>
	<delete id="dropAbgcById" parameterType="string">
		delete from plan_abgc jh where jh.id=#{id}
	</delete>
	<update id="editAbgcById" parameterType="plan_abgc">
		update plan_abgc set 
			<if test="jhnf!=null and jhnf!=''">
				jhnf=#{jhnf},
			</if>
			<if test="jhkgsj!=null and jhkgsj!=''">
				jhkgsj=#{jhkgsj},
			</if>
			<if test="jhwgsj!=null and jhwgsj!=''">
				jhwgsj=#{jhwgsj},
			</if>
			<if test="xdsj!=null and xdsj!=''">
				xdsj=#{xdsj},
			</if>
			<if test="pfsj!=null and pfsj!=''">
				pfsj=#{pfsj},
			</if>
			jhwc_c=#{jhwc_c},sjdw=#{sjdw},sjpfdw=#{sjpfdw},pfwh=#{pfwh},pfztz=#{pfztz},jhsybbzje=#{jhsybbzje},
			jhsydfzczj=#{jhsydfzczj},jhxdwh=#{jhxdwh},sfsqablbz=#{sfsqablbz},ablbzsqwh=#{ablbzsqwh},remarks=#{remarks}
		where id=#{id}
	</update>
	<update id="editStatus" parameterType="plan_abgc">
		update plan_abgc set 
			<if test="sbbm!=null">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null">sbsj=#{sbsj},</if>
			<if test="sbzt!=null">sbzt=#{sbzt},</if>
			<if test="spbm!=null">spbm=#{spbm},</if>
			<if test="spbmdm!=null">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null">spsj=#{spsj},</if>
			<if test="spzt!=null">spzt=#{spzt},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>
</mapper>