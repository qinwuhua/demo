<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_abgc">
	<resultMap type="plan_abgc"  id="abgc_jh">
		<id property="id" column="id" />
		<result property="sckid" column="sckid"/>
		<result property="xdsj" column="xdsj"/>
		<result property="jhnf" column="jhnf"/>
		<result property="sbzt" column="sbzt"/>
		<result property="spzt" column="spzt"/>
		<result property="jhwc_c" column="jhwc_c"/>
		<result property="sjdw" column="sjdw"/>
		<result property="sjpfdw" column="sjpfdw"/>
		<result property="pfwh" column="pfwh"/>
		<result property="pfsj" column="pfsj"/>
		<result property="jhsybbzje" column="jhsybbzje"/>
		<result property="jhsydfzczj" column="jhsydfzczj"/>
		<result property="jhxdwh" column="jhxdwh"/>
		<result property="sfsqablbz" column="sfsqablbz"/>
		<result property="ablbzsqwh" column="ablbzsqwh"/>
		<result property="pfztz" column="pfztz"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="sbbmdm" column="sbbmdm"/>
		<result property="spbmdm" column="spbmdm"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="sfylsjl" column="sfylsjl"/>
		<association property="jckabgc"  resultMap="abgc_lx"></association>
	</resultMap>
	<resultMap type="sckabgc"  id="abgc_lx">
		<result property="lxmc" column="lxmc"/>
		<result property="lxbm" column="lxbm"/>
		<result property="gydw" column="gydw"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="xzqhdm" column="xzqhdm"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="qzlc" column="qzlc"/>
		<result property="yhlc" column="yhlc"/>
	</resultMap>
	
	<select id="queryAbgcList"  parameterType="java.util.Map"  resultMap="abgc_jh">
		select * from 
			(
				select rownum as num,t.* from 
				(
					select * from plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
					left join xmk_abgc lx on (sc.xmkid=lx.id) where 1=1 
					<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">
						and jh.jh_sbthcd=#{jh.jh_sbthcd}
					</if>
				    <if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
						and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
					</if>
				    <if test="jh.jhnf!=null and jh.jhnf!=''">
				 		and jh.jhnf=#{jh.jhnf}
				 	</if>
				 	<if test="jh.sbzt!=null and jh.sbzt!=''">
				 		and jh.sbzt=#{jh.sbzt}
				 	</if>
				 	<if test="jh.spzt!=null and jh.spzt!=''">
				 		and jh.spzt=#{jh.spzt}
				 	</if>
				 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
				 		and lx.gydwbm like #{lx.gydwbm}
				 	</if>
				 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
				 		and lx.xzqhdm like #{lx.xzqhdm}
				 	</if>
				 	<if test="lx.lxmc!=null and lx.lxmc!=''">
				 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
				 	</if>
				 	<if test="lx.lxbm!=null and lx.lxbm!=''">
				 		and lx.lxbm like #{lx.lxbm}||'%'
				 	</if>
				 	<if test="lx.lxjsdj!=null and lx.lxjsdj!=''">
				 		and lx.lxjsdj = #{lx.lxjsjd}
				 	</if>
				 	<if test="lx.tsdq!=null and lx.tsdq!=''">
				 		and lx.xzqhdm in (select t.xzqhdm from BT_XZQHTSDQ t where t.areacode=#{lx.tsdq})
				 	</if>
	    			order by jh.sbzt,jh.spzt,jh.jhnf desc
	    		) t
    		)
    	where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryAbgcListByStatus" parameterType="java.util.Map" resultType="plan_abgc">
		select * from plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
		left join xmk_abgc lx on (sc.xmkid=lx.id) where 1=1 
		<if test="jh.jhnf!=null and jh.jhnf!=''">
			and jh.jhnf=#{jh.jhnf}
		</if>
		<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=1">
			and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
		</if>
		<if test="(jh.sbzt==null and jh.spzt==null) or (jh.sbzt=='' and jh.spzt=='') and jh.jh_sbthcd!=1">
			and jh.jh_sbthcd=#{jh.jh_sbthcd}
		</if>
		<if test="jh.sbzt!=null and jh.sbzt!=''">
			and jh.sbzt=#{jh.sbzt}
		</if>
		<if test="jh.spzt!=null and jh.spzt!=''">
			and jh.spzt=#{jh.spzt}
		</if>
		<if test="lx.gydwbm!=null and lx.gydwbm!=''">
			and lx.gydwbm like #{lx.gydwbm}
		</if>
	</select>
	<select id="queryAbgcCount"  parameterType="java.util.Map"  resultType="int">
		select count(*) from plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
					left join xmk_abgc lx on (sc.xmkid=lx.id) where 1=1 
				    <if test="(jh.jh_sbthcd!=null and jh.jh_sbthcd!='') and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">
						and jh.jh_sbthcd=#{jh.jh_sbthcd}
					</if>
				    <if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
						and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
					</if>
				    <if test="jh.jhnf!=null and jh.jhnf!=''">
				 		and jh.jhnf=#{jh.jhnf}
				 	</if>
				 	<if test="jh.sbzt!=null and jh.sbzt!=''">
				 		and jh.sbzt=#{jh.sbzt}
				 	</if>
				 	<if test="jh.spzt!=null and jh.spzt!=''">
				 		and jh.spzt=#{jh.spzt}
				 	</if>
				 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
				 		and lx.gydwbm like #{lx.gydwbm}
				 	</if>
				 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
				 		and lx.xzqhdm like #{lx.xzqhdm}
				 	</if>
				 	<if test="lx.lxmc!=null and lx.lxmc!=''">
				 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
				 	</if>
				 	<if test="lx.lxbm!=null and lx.lxbm!=''">
				 		and lx.lxbm like #{lx.lxbm}||'%'
				 	</if>
				 	<if test="lx.lxjsdj!=null and lx.lxjsdj!=''">
				 		and lx.lxjsdj = #{lx.lxjsjd}
				 	</if>
				 	<if test="lx.tsdq!=null and lx.tsdq!=''">
				 		and lx.xzqhdm in (select t.xzqhdm from BT_XZQHTSDQ t where t.areacode=#{lx.tsdq})
				 	</if>
	</select>
	<select id="queryAbgcById"  parameterType="string"  resultType="plan_abgc">
		<!-- select * from Plan_Abgc jh left join Xmk_Abgc lx on jh.sckid=lx.id where jh.id=#{id} -->
		select id,sckid,jhnf,jhkgsj,jhwgsj,sjdw,sjpfdw,pfwh, pfsj,pfztz,jhsybbzje,jhsydfzczj,sfsqablbz,ablbzsqwh, remarks, tbsj, tbbm, spzt,spbm,
	spsj,sbzt,sbbm,sbsj,xdsj,gkbgmc,gkbglj,sjsgtmc,sjsgtlj,sjkgsj,sjwgsj,sgdw, jldw, htje,sgxkwj,jgtcwj, jgyswj,wjsczt,kgzt,jgzt,wjgyy,
	yjwgsj, jhwc_c,jsdw,jhxdwh,xdzt,xfzt,xfsj,xfbm,wjzt,sfylsjl from Plan_Abgc jh where jh.id=#{id}
	</select>
	<select id="queryAbgcNfs" resultType="treenode">
		 select distinct t.jhnf as text from PLAN_abgc t order by t.jhnf
	</select>
	<select id="insertToSheet" parameterType="hashMap" resultType="sjbb">
		select xzqhdm      v_0,
		       xzqhmc      v_1,
		       sc.sck_lxbm v_2,
		       sc.sck_lxmc v_3,
		       sc.scqdzh   v_4,
		       sc.sczdzh   v_5,
		       sc.scyhlc   v_6,
		       sc.jsxz     v_7,
		       sc.jsnr     v_8,
		       jh.jhnf v_9,
		       jh.jhwc_c v_10,
		       to_char(jh.jhkgsj, 'yyyy-mm-dd') v_11,
		       to_char(jh.jhwgsj, 'yyyy-mm-dd') v_12,
		       to_char(jh.xdsj, 'yyyy-mm-dd') v_13,
		       jh.sjdw v_14,
		       jh.sjpfdw v_15,
		       jh.pfwh v_16,
		       to_char(jh.pfsj, 'yyyy-mm-dd') v_17,
		       jh.pfztz v_18,
		       jh.jhsybbzje v_19,
		       jh.jhsydfzczj v_20,
		       jh.sfsqablbz v_21,
		       jh.ablbzsqwh v_22,
		       jh.remarks v_23
		  from sck_abgc sc, xmk_abgc xm,plan_abgc jh
		 where sc.xmkid = xm.id and jh.sckid = sc.sckid
		   and sck_sbzt = '已上报'
		   and sc.lrjh = '已列入'
		   and jh.spzt='0'
		and sck_sbthcd &lt;=#{sck_sbthcd}  
		<if test="tbdw!=null and tbdw!=''">
		 	and scbmbm like #{tbdw}||'%'
	    </if>
	</select>
	<select id="exportExcel_jh" parameterType="hashMap" resultType="sjbb">
		select  decode(jh.sbzt,0,'未上报',decode(jh.spzt,0,'上报待审批','已审批')) v_0,jh.jhnf v_1,to_char(jh.jhkgsj,'yyyy-mm-dd') v_2,to_char(jh.jhwgsj,'yyyy-mm-dd') v_3,lx.gydw v_4,lx.xzqhmc v_5,lx.lxbm v_6,lx.lxmc v_7,lx.qdzh v_8,lx.zdzh v_9,lx.yhlc v_10,jh.pfztz v_11
		 from plan_abgc jh
  		left join sck_abgc sc on (jh.sckid = sc.sckid)
  		left join xmk_abgc lx on (sc.xmkid = lx.id) where 1=1 
		<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='')">
			and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
		</if>
	    <if test="jh.jhnf!=null and jh.jhnf!=''">
	 		and jh.jhnf=#{jh.jhnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		and jh.sbzt=#{jh.sbzt}
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and lx.gydwbm like #{lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and lx.xzqhdm like #{lx.xzqhdm}
	 	</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.lxjsdj!=null and lx.lxjsdj!=''">
	 		and lx.lxjsdj = #{lx.lxjsjd}
	 	</if>
		order by jh.jhnf desc
	</select>
	<delete id="dropAbgcById" parameterType="string">
		delete from plan_abgc jh where jh.id=#{id}
	</delete>
	<update id="editAbgcById" parameterType="plan_abgc">
		update plan_abgc set 
			<if test="jhnf!=null and jhnf!=''">
				jhnf=#{jhnf},
			</if>
			<if test="jhkgsj!=null and jhkgsj!=''">
				jhkgsj=#{jhkgsj},
			</if>
			<if test="jhwgsj!=null and jhwgsj!=''">
				jhwgsj=#{jhwgsj},
			</if>
			<if test="xdsj!=null and xdsj!=''">
				xdsj=#{xdsj},
			</if>
			<if test="pfsj!=null and pfsj!=''">
				pfsj=#{pfsj},
			</if>
			jhwc_c=#{jhwc_c},sjdw=#{sjdw},sjpfdw=#{sjpfdw},pfwh=#{pfwh},pfztz=#{pfztz},jhsybbzje=#{jhsybbzje},
			jhsydfzczj=#{jhsydfzczj},jhxdwh=#{jhxdwh},sfsqablbz=#{sfsqablbz},ablbzsqwh=#{ablbzsqwh},remarks=#{remarks}
		where id=#{id}
	</update>
	<update id="editAbgcSckBysckid" parameterType="plan_abgc">
		update SCK_ABGC set 
		scqdzh=#{jckabgc.scqdzh},sczdzh=#{jckabgc.sczdzh},sczlc=#{jckabgc.sczlc},scyhlc=#{jckabgc.scyhlc},
		fapgdw=#{jckabgc.fapgdw},fascdw=#{jckabgc.fascdw},spwh=#{jckabgc.spwh},tzgs=#{jckabgc.tzgs},
		faspsj=#{jckabgc.faspsj},jsxz=#{jckabgc.jsxz},jsnr=#{jckabgc.jsnr},scbz=#{jckabgc.scbz}
		where sckid=#{sckid}
	</update>
	<update id="editStatus" parameterType="plan_abgc">
		update plan_abgc set 
			<if test="sbbm!=null and sbbm!=''">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null and sbbmdm!=''">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null and sbsj!=''">sbsj=#{sbsj},</if>
			<if test="sbzt!=null and sbzt!=''">sbzt=#{sbzt},</if>
			<if test="spbm!=null and spbm!=''">spbm=#{spbm},</if>
			<if test="spbmdm!=null and spbmdm!=''">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null and spsj!=''">spsj=#{spsj},</if>
			<if test="spzt!=null and spzt!=''">spzt=#{spzt},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>
	<!-- <insert id="importAbgc_jh" parameterType="hashMap">
		insert into PLAN_ABGC(id,sckid,JHNF,jhkgsj,jhwgsj,xdsj,sjdw,sjpfdw,pfwh,pfsj,pfztz,JHSYBBZJE,JHSYDFZCZJ,sfsqablbz,ablbzsqwh,REMARKS,xdzt)
		values(sys_guid(),(select id from xmk_abgc where lxbm=#{2} and lxmc=#{3} and qdzh=#{4} and zdzh=#{5}),#{9},to_date(#{11},'yyyy-mm-dd'),to_date(#{12},'yyyy-mm-dd'),to_date(#{13},'yyyy-mm-dd'),
		#{14},#{15},#{16},to_date(#{17},'yyyy-mm-dd'),#{18},#{19},#{20},#{21},#{22},#{23},'0')
	</insert> -->
	<update id="importAbgc_jh" parameterType="hashMap">
		update PLAN_ABGC set JHNF=#{9},jhkgsj=to_date(#{11},'yyyy-mm-dd'),jhwgsj=to_date(#{12},'yyyy-mm-dd'),xdsj=to_date(#{13},'yyyy-mm-dd'),sjdw=#{14},sjpfdw=#{15},pfwh=#{16},pfsj=to_date(#{17},'yyyy-mm-dd'),pfztz=#{18},JHSYBBZJE=#{19},JHSYDFZCZJ=#{20},sfsqablbz=#{21},ablbzsqwh=#{22},REMARKS=#{23}
		where sckid = (select sckid from sck_abgc where sck_lxbm=#{2} and sck_lxmc=#{3} and scqdzh=#{4} and sczdzh=#{5})
	</update>
	<select id="querySumAbgc" resultMap="abgc_jh" parameterType="java.util.Map">
		select count(id) as id,sum(zlc) as qzlc,sum(yhlc) as yhlc,
		sum(pfztz) as pfztz,sum(jhsybbzje) as jhsybbzje,sum(jhsydfzczj) as jhsydfzczj from(
			select count(p.id) as id,sum(s.sczlc) as zlc,sum(s.scyhlc) as yhlc,
			sum(p.pfztz) as pfztz,sum(p.jhsybbzje) as jhsybbzje,sum(p.jhsydfzczj) as jhsydfzczj
			from xmk_abgc x right join sck_abgc s on (x.id=s.xmkid) right join plan_abgc p on (s.sckid=p.sckid)
			where 1=1
			<if test="x.gydwbm!=null and x.gydwbm!=''">
				and x.gydwbm like #{x.gydwbm}
			</if>
			<if test="(p.jh_sbthcd!=null and p.jh_sbthcd!='') and (p.sbzt==null or p.sbzt=='') and (p.spzt==null or p.spzt=='')">
				and jh.jh_sbthcd=#{jh.jh_sbthcd}
			</if>
		    <if test="(p.sbzt!=null or p.spzt!=null) and (p.sbzt!='' or p.spzt!='') and p.jh_sbthcd!=null and p.jh_sbthcd!=''">
				and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
			</if>
			<if test="p.sbzt!=null and p.sbzt!=''">
				and p.sbzt=#{p.sbzt}
			</if>
			<if test="p.spzt!=null and p.spzt!=''">
				and p.spzt=#{p.spzt}
			</if> group by p.id)
	</select>
	<update id="updateLrztBySckid" parameterType="java.util.List">
 		update sck_abgc set lrjh='未列入'  where sckid=#{String}
 	</update>
	<select id="lwBzbz" parameterType="bzbz" resultType="bzbz">
		select * from lwbzbz where xmlx=#{xmlx} 
		<if test="lx!=null and lx!=''">
		and lx=#{lx}
		</if>
	</select>
<!-- 	<update id="updateGkbg" parameterType="plan_abgc">
 		update plan_abgc set gkbgmc=#{gkbgmc},gkbgdata=#{gkbgdata} where id=#{id}
 	</update>  -->
 	
<!--  	<update id="updateSjsgt" parameterType="plan_abgc">
 		update plan_abgc set sjsgtmc=#{sjsgtmc},sjsgtdata=#{sjsgtdata} where id=#{id}
 	</update>  -->
 	<insert id="insertGkbg" parameterType="plan_upload">
 		insert into plan_upload(filename,filedata,parentid,filetype)
 		 values(#{filename},#{filedata},#{parentid},'工可报告')
 	</insert>
	<insert id="insertSjsgt" parameterType="plan_upload">
 		insert into plan_upload(filename,filedata,parentid,filetype)
 		 values(#{filename},#{filedata},#{parentid},'设计施工图')
 	</insert>
 	<select id="queryFjById"  parameterType="plan_upload"  resultType="plan_upload">
		select  * from plan_upload where id=#{id}
	</select>
	<select id="queryFjByParentId"  parameterType="plan_upload"  resultType="plan_upload">
		select  id,filename,parentid,filetype from plan_upload where parentid=#{id} order by filename desc
	</select>
	<delete id="deleteFile" parameterType="plan_upload" >
		delete from plan_upload where id=#{id}
	</delete>
	<select id="queryTsdq" resultType="treenode">
		select t.areacode as id,t.areaname as text from BT_SPECIALAREA t
	</select>
	<select id="queryJcktj" resultType="treenode">
		select t1.*,xz.name from (
	       	select t.parent as id,count(t.parent)-1 as text,NVL(sum(t.yhlc),'0') as parent
	       		from(
	            	select distinct xt.parent,jck.xzqhdm,jck.yhlc
	              	from xmk_abgc jck right join xtgl_xzqh xt on (jck.xzqhdm=xt.id) 
	              	order by xt.parent
	       		) t where t.parent is not null group by t.parent
		) t1 join xtgl_xzqh xz on (t1.id=xz.id) order by t1.id
	</select>
	<select id="queryJcktj1" resultType="treenode" parameterType="java.util.Map">
		select t.parent as id,xz.name as name,NVL(sum(t.je),0) as text,sum(t.sl) as parent from (
			select distinct xt.parent,jh.jhnf,
      		(select ab1.jhsybbzje from plan_abgc ab1 left join sck_abgc sc1 on 
      		(ab1.sckid=sc1.sckid) left join xmk_abgc lx1 on (sc1.xmkid=lx1.id) where ab1.jhnf=#{nf} and ab1.id=jh.id) as je,
      		(select count(jhsybbzje) from plan_abgc ab1 left join sck_abgc sc1 on 
          	(ab1.sckid=sc1.sckid) left join xmk_abgc lx1 on (sc1.xmkid=lx1.id) where ab1.jhnf=#{nf} and ab1.id=jh.id) as sl
      		from plan_abgc jh left join sck_abgc sc on 
      		(jh.sckid=sc.sckid) left join xmk_abgc lx on (sc.xmkid=lx.id) right join xtgl_xzqh xt on (lx.xzqhdm=xt.id)
      		where xt.parent is not null
    	) t join xtgl_xzqh xz on (t.parent=xz.id)
    	group by t.parent,xz.name order by t.parent
	</select>
	<select id="queryJhktj2" resultType="treenode" parameterType="java.util.Map">
		select t.jhnf as id,sum(t.jhsybbzje) as text,count(t.jhsybbzje) as name from (
			select distinct jh.id,jh.jhnf,jh.jhsybbzje from 
			plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
			left join xmk_abgc lx on (sc.xmkid=lx.id) 
			where lx.xzqhdm like rtrim(#{xzqhdm},'0')||'%' and jh.jhnf>=#{start} and <![CDATA[jh.jhnf<=#{end}]]>) t
		group by t.jhnf
	</select>
	<select id="queryJhktjt2" resultType="string" parameterType="java.util.Map">
		select NVL(sum(t.jhsybbzje),0) from (
			select distinct jh.id,jh.jhnf,jh.jhsybbzje from 
			plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
			left join xmk_abgc lx on (sc.xmkid=lx.id) 
			where lx.xzqhdm like #{xzqhdm} and jh.jhnf=#{nf}) t
		group by t.jhnf
	</select>
	<select id="queryJhktjt3" resultType="treenode" parameterType="java.util.Map">
		select jhnf as name,sum(jhsybbzje) as text from (
			select distinct jh.id,jh.jhnf,jh.jhsybbzje from plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
			left join xmk_abgc lx on (sc.xmkid=lx.id) 
			where lx.xzqhdm like #{xzqhdm} and jh.jhnf>=#{start} and <![CDATA[jh.jhnf<=#{end}]]>)
		group by jhnf
	</select>
	<select id="queryGcktj" resultType="treenode" parameterType="java.util.Map">
		select (r.kgzt+r.jgzt) as id,count(r.kgzt+r.jgzt) as name,sum(r.jhsybbzje) as text,sum(r.btz+r.qttz) as parent from (
			select jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybbzje,sum(nvl(gcgl.wc_btz,0)) as btz,sum(nvl(gcgl.wc_qttz,0)) as qttz from gcgl_abgc gcgl 
				right join (select jh.id,jh.kgzt,jh.jgzt,jh.jhsybbzje from  plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
    			left join xmk_abgc lx on (sc.xmkid=lx.id) where lx.xzqhdm like #{xzqhdm} and jh.jhnf=#{nf} and jh.spzt='1' and jh.jh_sbthcd='6') jh_lx on gcgl.jhid=jh_lx.id
    	group by jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybbzje) r group by r.kgzt,r.jgzt order by r.kgzt,r.jgzt
	</select>
	<select id="queryGcktjt" resultType="treenode" parameterType="java.util.Map">
		select nvl(sum(r.jhsybbzje),0) as text,nvl(sum(r.btz+r.qttz),0) as parent from (
			select jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybbzje,sum(nvl(gcgl.wc_btz,0)) as btz,sum(nvl(gcgl.wc_qttz,0)) as qttz from gcgl_abgc gcgl 
				right join (select jh.id,jh.kgzt,jh.jgzt,jh.jhsybbzje from  plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
    			left join xmk_abgc lx on (sc.xmkid=lx.id) 
    			where jh.spzt='1' and jh.jh_sbthcd='6'
    			<if test="xzqhdm!=null and xzqhdm!=''">
    				and lx.xzqhdm like #{xzqhdm}
    			</if>
    			) jh_lx on gcgl.jhid=jh_lx.id
    	group by jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybbzje) r
	</select>
	<select id="queryGcktj2" resultType="treenode" parameterType="java.util.Map">
		select nvl(sum(r.bn),0) as id,count(r.bn) as name,nvl(sum(r.fbn),0) as text,count(r.fbn) as parent from (
			select jh.id,jh.kgzt,jh.jgzt,
				(select a.jhsybbzje from plan_abgc a where a.jhnf=#{nf} and a.id=jh.id) as bn,
				(select a.jhsybbzje from plan_abgc a where #{nf}>a.jhnf and a.id=jh.id) as fbn 
			from plan_abgc jh left join sck_abgc sc on (jh.sckid=sc.sckid) 
			left join xmk_abgc lx on (sc.xmkid=lx.id) 
			where jh.spzt='1' and jh.jh_sbthcd='6'
		and lx.xzqhdm like #{xzqhdm}) r
	</select>
</mapper>
