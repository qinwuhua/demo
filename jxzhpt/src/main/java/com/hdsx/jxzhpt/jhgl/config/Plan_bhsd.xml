<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.plan_bhsd">
<resultMap type="plan_bhsd"  id="plan_bhsd">
		<id property="id" column="id" />
		<result property="sckid" column="sckid"/>
		<result property="sbnf" column="sbnf"/>
		<result property="sbzt" column="sbzt"/>
		<result property="spzt" column="spzt"/>
		<result property="jhkgsj" column="jhkgsj"/>
		<result property="jhwgsj" column="jhwgsj"/>
		<result property="pfztz" column="pfztz"/>
		<result property="jhsybzje" column="jhsybzje"/>
		<result property="jhsydfzcje" column="jhsydfzcje"/>
		<result property="qtzj" column="qtzj"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="sfylsjl" column="sfylsjl"/>
		<result property="jh_sbthcd" column="jh_sbthcd"/>
		<result property="jh_thyj" column="jh_thyj"/>
		<result property="tbbmbm" column="tbbmbm"/>
		<result property="jh_sdzt" column="jh_sdzt"/>
		<result property="xtType" column="xtType"/>
		<result property="gydw" column="gydw"/>
		<result property="gydwbm" column="gydwbm"/>
		<result property="xzqhmc" column="xzqhmc"/>
		<result property="xzqhdm" column="xzqhdm"/>
		<result property="lxbm" column="lxbm"/>
		<result property="lxmc" column="lxmc"/>
		<result property="sdmc" column="sdmc"/>
		<result property="sddm" column="sddm"/>
		<result property="sdzxzh" column="sdzxzh"/>
		<result property="acdfl" column="acdfl"/>
		<result property="tz_type" column="tz_type"/>
	</resultMap>
	
	<select id="queryBhsdList" parameterType="java.util.Map" resultMap="plan_bhsd">
		select * from 
			(
				select rownum as num,t.* from
				(
					select jh.id,jh.sckid,jh.jh_sbthcd,jh.sbnf,decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt) as sbzt,jh.spzt,jh.kgzt,jh.jgzt,
					jh.jhkgsj,jh.jhwgsj,jh.pfztz,lx.gydw,jh.jhsybzje,jh.jhsydfzcje,jh.qtzj,
					lx.gydwbm,lx.xzqhdm,lx.xzqhmc,lx.lxmc,lx.lxbm,lx.sdmc,lx.sddm,lx.sdzxzh ,jh.jh_thyj,lx.tbbmbm,jh.jh_sdzt
					from plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
					left join xmk_Bhsd lx on (sc.xmkid=lx.id) where 1=1
                    and jh.jh_sbthcd&lt;=#{jh.jh_sbthcd} 
                    <if test="jh.xtType!='' and jh.xtType!= null ">
						${jh.xtType}
					</if>
	 				<if test="jh.sbnf!=null and jh.sbnf!=''">
	 					and jh.sbnf=#{jh.sbnf}
	 				</if>
	 				
	 				<if test="jh.kgzt!=null and jh.kgzt!=''">
	 					and jh.kgzt=#{jh.kgzt}
	 				</if>
	 				<if test="jh.jgzt!=null and jh.jgzt!=''">
	 					and jh.jgzt=#{jh.jgzt}
	 				</if>
<!-- 	 				<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 				 	</if> -->
	 				<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 					and ${lx.gydwbm}
	 				</if>
	 				<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 					and ${lx.xzqhdm}
	 				</if>
	 				<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
					   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
					</if>
	 				<if test="lx.lxmc!=null and lx.lxmc!=''">
	 					and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 				</if>
	 				<if test="lx.lxbm!=null and lx.lxbm!=''">
	 					and lx.lxbm like #{lx.lxbm}||'%'
	 				</if>
	 				<if test="lx.jsdj!=null and lx.jsdj!=''">
	 					and lx.jsdj = #{lx.jsdj}
	 				</if>
	 				<if test="lx.sdmc!=null and lx.sdmc!=''">
	 					and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 				</if>
	 				<if test="lx.sddm!=null and lx.sddm!=''">
	 					and lx.sddm like '%'||#{lx.sddm}||'%'
	 				</if>
	 				<if test="lx.acdfl!=null and lx.acdfl!=''">
	 					and lx.acdfl={lx.akjfl}
	 				</if>
	 				<if test="jh.sbzt!=null and jh.sbzt!=''">
	 					<if test='jh.shFlag=="1"'>
					 	and jh.sbzt=#{jh.sbzt}
					 	</if>
					 	<if test="jh.shFlag==null or jh.shFlag==''">
					 	and decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt)=#{jh.sbzt}
					 	</if>
	 				</if>
	 				<if test="jh.spzt!=null and jh.spzt!=''">
	 					and jh.spzt=#{jh.spzt}
	 				</if>
	 				<if test="jh.jh_sdzt!=null and jh.jh_sdzt!=''">
	 					and jh.jh_sdzt=#{jh.jh_sdzt}
	 				</if>
	 				order by jh.sbnf desc,jh.jh_sbthcd
	 			) t 
	 			where 1=1
	 			order by t.sbnf desc,t.jh_sbthcd
 			)
 		where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	
	<!-- 此方法仅用于导出危桥资金下达Excel的查询 -->
	<select id="queryBhsdList2" parameterType="java.util.Map" resultMap="plan_bhsd">
		select * from 
			(
				select rownum as num,t.* from
				(
					select * from plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
					left join xmk_Bhsd lx on (sc.xmkid=lx.id) where 1=1
					<if test="jh.sbnf!=null and jh.sbnf!=''">
	 					and jh.sbnf=#{jh.sbnf}
	 				</if>
	 				<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
						and jh.jh_sbthcd=#{jh.jh_sbthcd}
					</if>
	 				<if test="jh.kgzt!=null and jh.kgzt!=''">
	 					and jh.kgzt=#{jh.kgzt}
	 				</if>
	 				<if test="jh.jgzt!=null and jh.jgzt!=''">
	 					and jh.jgzt=#{jh.jgzt}
	 				</if>
	 				<if test="jh.sfylsjl!=null and jh.sfylsjl!=''">
			 			and sc.bzls=#{jh.sfylsjl}
				 	</if>
	 				<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 					and ${lx.gydwbm}
	 				</if>
	 				<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 					and ${lx.xzqhdm}
	 				</if>
	 				<if test="lx.lxmc!=null and lx.lxmc!=''">
	 					and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 				</if>
	 				<if test="lx.lxbm!=null and lx.lxbm!=''">
	 					and lx.lxbm like #{lx.lxbm}||'%'
	 				</if>
	 				<if test="lx.jsdj!=null and lx.jsdj!=''">
	 					and lx.jsdj = #{lx.jsjd}
	 				</if>
	 				<if test="lx.sdmc!=null and lx.sdmc!=''">
	 					and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 				</if>
	 				<if test="lx.acdfl!=null and lx.acdfl!=''">
	 					and lx.acdfl=#{lx.acdfl}||'%'
	 				</if>
	 				order by jh.sbzt,jh.spzt,jh.sbnf desc
	 			) t
 			)
	</select>
	
	<select id="queryBhsdByStatus" parameterType="java.util.Map" resultType="plan_bhsd">
		select * from plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
		left join xmk_Bhsd lx on (sc.xmkid=lx.id) where 1=1
		<if test="jh.jh_sbthcd!=null and jh.jh_sbthcd!='' and (jh.sbzt==null or jh.sbzt=='') and (jh.spzt==null or jh.spzt=='')">
			and jh.jh_sbthcd=#{jh.jh_sbthcd}
		</if>
		<if test="(jh.sbzt!=null or jh.spzt!=null) and (jh.sbzt!='' or jh.spzt!='') and jh.jh_sbthcd!=null and jh.jh_sbthcd!=''">
			and (jh.jh_sbthcd=#{jh.jh_sbthcd} or jh.jh_sbthcd=#{jh.jh_sbthcd}+2)
		</if>
		<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		and jh.sbzt=#{jh.sbzt}
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	</select>
	
	<select id="queryBhsdCount"  parameterType="java.util.Map"  resultType="int">
		select count(*) from plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
		left join xmk_Bhsd lx on (sc.xmkid=lx.id) where 1=1
		and jh.jh_sbthcd &lt;=#{jh.jh_sbthcd}
        <if test="jh.xtType!='' and jh.xtType!= null ">
			${jh.xtType}
		</if>
	 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		<if test='jh.shFlag=="1"'>
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.shFlag==null or jh.shFlag==''">
				and decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt)=#{jh.sbzt}
			</if>
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
	 	<if test="jh.kgzt!=null and jh.kgzt!=''">
	 		and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
<!-- 	 	<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 		</if> -->
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and ${lx.xzqhdm}
	 	</if>
	 	<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
		   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
		</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.jsdj!=null and lx.jsdj!=''">
	 		and lx.jsdj = #{lx.jsdj}
	 	</if>
	 	<if test="lx.sdmc!=null and lx.sdmc!=''">
	 		and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 	</if>
	 	<if test="lx.sddm!=null and lx.sddm!=''">
	 		and lx.sddm like '%'||#{lx.sddm}||'%'
	 	</if>
	 	<if test="lx.acdfl!=null and lx.acdfl!=''">
	 		and lx.acdfl=#{lx.acdfl}
	 	</if>
	 	<if test="jh.jh_sdzt!=null and jh.jh_sdzt!=''">
	 		and jh.jh_sdzt=#{jh.jh_sdzt}
	 	</if>
	</select>
	
	<select id="querySumBhsd" parameterType="java.util.Map" resultType="plan_bhsd">
		select count(id) as id,sum(pfztz) as pfztz,sum(jhsybzje) as jhsybzje,
		sum(jhsydfzcje) as jhsydfzcje from (
			select count(jh.id) as id,sum(jh.pfztz) as pfztz,sum(jh.jhsybzje) as jhsybzje,
			sum(jh.jhsydfzcje) as jhsydfzcje 
			from xmk_Bhsd lx right join sck_Bhsd sc on (lx.id=sc.xmkid) 
			right join plan_bhsd jh on (sc.sckid=jh.sckid)
			where 1=1
         and jh.jh_sbthcd&lt;=#{jh.jh_sbthcd} 
         
        <if test="jh.xtType!='' and jh.xtType!= null ">
			${jh.xtType}
		</if>
	 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
		 	<if test='jh.shFlag=="1"'>
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.shFlag==null or jh.shFlag==''">
				and decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt)=#{jh.sbzt}
			</if>
        </if>
	 	<if test="jh.kgzt!=null and jh.kgzt!=''">
	 		and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
	 	<if test="jh.jh_sdzt!=null and jh.jh_sdzt!=''">
	 		and jh.jh_sdzt=#{jh.jh_sdzt}
	 	</if>
<!-- 	 	<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 		</if> -->
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and ${lx.xzqhdm}
	 	</if>
	 	<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
		   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
		</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.jsdj!=null and lx.jsdj!=''">
	 		and lx.jsdj = #{lx.jsdj}
	 	</if>
	 	<if test="lx.sdmc!=null and lx.sdmc!=''">
	 		and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 	</if>
	 	<if test="lx.sddm!=null and lx.sddm!=''">
	 		and lx.sddm like '%'||#{lx.sddm}||'%'
	 	</if>
	 	<if test="lx.acdfl!=null and lx.acdfl!=''">
	 		and lx.acdfl=#{lx.acdfl}
	 	</if> 
	 	group by jh.id)
	</select>
	
	<select id="queryBhsdNfs"  resultType="treenode">
		select distinct t.sbnf as text from plan_bhsd t order by t.sbnf
	</select>
	
	<select id="queryBhsdById" parameterType="string" resultType="plan_bhsd">
		select 	*
<!-- 		id,sckid,sbnf,jhkgsj,jhwgsj, sjdw,sjpfdw,pfwh, pfsj,pfztz, jhsybzje, jhsydfzcje, sfsqablbz,ablbzsqwh, bz,tbsj, -->
<!-- 	 tbbm,spzt,spbm,spsj,sbzt, sbbm, sbsj, xdsj,gkbgmc,gkbglj,sjsgtmc,sjsgtlj,sjkgsj,sjwgsj,sgdw,jldw,htje,sgxkwj, -->
<!-- 	jgtcwj,jgyswj,wjsczt,kgzt,jgzt,yjjgsj,wjgyy, jsdw, jhxdwh, xdzt, xfzt,xfsj,xfbm,wjzt,wjsj,gys, sbbmdm,spbmdm,sfylsjl, -->
<!-- 	cz,rys,jhsycgs,gmsptzj -->
	from plan_bhsd jh where jh.id=#{id}
	</select>
	
	<select id="insertToSheet" parameterType="hashMap" resultType="sjbb">
		select xzqhdm v_0,
		       xzqhmc v_1,
		       sc.sck_lxbm v_2,
		       xm.lxmc v_3,
		       sc.sck_qlbh v_4,
		       xm.qlmc v_5,
		       sc.sck_qlzxzh v_6,
		       sc.sck_jsxz v_7,
		       sc.jsnr v_8,
		       jh.sbnf v_9,
		       to_char(jh.jhkgsj, 'yyyy-mm-dd') v_10,
		       to_char(jh.jhwgsj, 'yyyy-mm-dd') v_11,
		       to_char(jh.xdsj, 'yyyy-mm-dd') v_12,
		       jh.sjdw v_13,
		       jh.sjpfdw v_14,
		       jh.pfwh v_15,
		       to_char(jh.pfsj, 'yyyy-mm-dd') v_16,
		       jh.pfztz v_17,
		       jh.jhsybzje v_18,
		       jh.jhsydfzcje v_19,
		       jh.sfsqablbz v_20,
		       jh.ablbzsqwh v_21,
		       jh.bz v_22
		  from sck_Bhsd sc, xmk_Bhsd xm, plan_bhsd jh
		  where sc.xmkid = xm.id
	  	  and jh.sckid = sc.sckid
		  and sck_sbzt = '已上报'
		  and jh.spzt='0'
		  and sck_sbthcd &lt;=#{sck_sbthcd} 
		  <if test="tbdw!=null and tbdw!=''">
		 	 and scbmbm like #{tbdw}||'%'
		  </if>
	</select>
	
	<select id="exportExcel_jh" parameterType="hashMap" resultType="sjbb">
		select 
		(case when jh_thyj is not null then decode(decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt),'0','未上报(退回)','已上报')
		when  jh_thyj!='' then decode(decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt),'0','未上报(退回)','已上报') 
		else decode(decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt),'0','未上报','已上报') end) v_0,
		jh.sbnf v_1,to_char(jh.jhkgsj,'yyyy-mm-dd') v_2,to_char(jh.jhwgsj,'yyyy-mm-dd') v_3,lx.gydw v_4,
		lx.xzqhmc v_5,lx.lxbm v_6,lx.lxmc v_7,lx.sddm v_8,lx.sdmc v_9,jh.pfztz v_10 
		from plan_bhsd jh
		left join sck_Bhsd sc on (jh.sckid = sc.sckid)
		left join xmk_Bhsd lx on (sc.xmkid = lx.id) where 1=1
            and jh.jh_sbthcd &lt;=#{jh.jh_sbthcd} 
            
<!--         <if test="jh.xtType!='' and jh.xtType!= null "> -->
<!-- 						${jh.xtType} -->
<!-- 		</if> -->
	 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
		 	<if test='jh.shFlag=="1"'>
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.shFlag==null or jh.shFlag==''">
				and decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt)=#{jh.sbzt}
			</if>
        </if>
	 	<if test="jh.kgzt!=null and jh.kgzt!=''">
	 		and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
<!-- 	 	<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 		</if> -->
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and ${lx.xzqhdm}
	 	</if>
	 	<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
		   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
		</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.jsdj!=null and lx.jsdj!=''">
	 		and lx.jsdj = #{lx.jsdj}
	 	</if>
	 	<if test="lx.sdmc!=null and lx.sdmc!=''">
	 		and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 	</if>
	 	<if test="lx.sddm!=null and lx.sddm!=''">
	 		and lx.sddm like '%'||#{lx.sddm}||'%'
	 	</if>
	 	<if test="lx.acdfl!=null and lx.acdfl!=''">
	 		and lx.acdfl=#{lx.acdfl}
	 	</if>
		order by jh.sbnf desc
	</select>
	
	<select id="exportExcel_jh_sh" parameterType="hashMap" resultType="sjbb">
		select decode(jh.spzt,null,'未审批','','为审批','0','未审批','已审批') v_0,
		jh.sbnf v_1,to_char(jh.jhkgsj,'yyyy-mm-dd') v_2,to_char(jh.jhwgsj,'yyyy-mm-dd') v_3,lx.gydw v_4,
		lx.xzqhmc v_5,lx.lxbm v_6,lx.lxmc v_7,lx.sddm v_8,lx.sdmc v_9,jh.pfztz v_10 
		from plan_bhsd jh
		left join sck_Bhsd sc on (jh.sckid = sc.sckid)
		left join xmk_Bhsd lx on (sc.xmkid = lx.id) where 1=1
            and jh.jh_sbthcd &lt;=#{jh.jh_sbthcd} 
            
<!--         <if test="jh.xtType!='' and jh.xtType!= null "> -->
<!-- 				${jh.xtType} -->
<!-- 		</if> -->
	 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		and jh.sbzt=#{jh.sbzt}
	 	</if>
	 	<if test="jh.kgzt!=null and jh.kgzt!=''">
	 		and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
<!-- 	 	<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 		</if> -->
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and ${lx.xzqhdm}
	 	</if>
	 	<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
		   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
		</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.jsdj!=null and lx.jsdj!=''">
	 		and lx.jsdj = #{lx.jsdj}
	 	</if>
	 	<if test="lx.sdmc!=null and lx.sdmc!=''">
	 		and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 	</if>
	 	<if test="lx.sddm!=null and lx.sddm!=''">
	 		and lx.sddm like '%'||#{lx.sddm}||'%'
	 	</if>
	 	<if test="lx.acdfl!=null and lx.acdfl!=''">
	 		and lx.acdfl=#{lx.acdfl}
	 	</if>
		order by jh.sbnf desc
	</select>
	
	<select id="exportExcel_jh_sd" parameterType="hashMap" resultType="sjbb">
		select decode(jh.jh_sdzt,0,'未审定','已审定') v_0,
		jh.sbnf v_1,to_char(jh.jhkgsj,'yyyy-mm-dd') v_2,to_char(jh.jhwgsj,'yyyy-mm-dd') v_3,lx.gydw v_4,
		lx.xzqhmc v_5,lx.lxbm v_6,lx.lxmc v_7,lx.sddm v_8,lx.sdmc v_9,jh.pfztz v_10 
		from plan_bhsd jh
		left join sck_Bhsd sc on (jh.sckid = sc.sckid)
		left join xmk_Bhsd lx on (sc.xmkid = lx.id) where 1=1
            and jh.jh_sbthcd &lt;=#{jh.jh_sbthcd} 
            
        <if test="jh.xtType!='' and jh.xtType!= null ">
				${jh.xtType}
		</if>
	 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		and jh.sbzt=#{jh.sbzt}
	 	</if>
	 	<if test="jh.kgzt!=null and jh.kgzt!=''">
	 		and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
	 	<if test="jh.jh_sdzt!=null and jh.jh_sdzt!=''">
	 		and jh.jh_sdzt=#{jh.jh_sdzt}
	 	</if>
<!-- 	 	<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 		</if> -->
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and ${lx.xzqhdm}
	 	</if>
	 	<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
		   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
		</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.jsdj!=null and lx.jsdj!=''">
	 		and lx.jsdj = #{lx.jsdj}
	 	</if>
	 	<if test="lx.sdmc!=null and lx.sdmc!=''">
	 		and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 	</if>
	 	<if test="lx.sddm!=null and lx.sddm!=''">
	 		and lx.sddm like '%'||#{lx.sddm}||'%'
	 	</if>
	 	<if test="lx.acdfl!=null and lx.acdfl!=''">
	 		and lx.acdfl=#{lx.acdfl}
	 	</if>
		order by jh.sbnf desc
	</select>
	
	<delete id="dropBhsdById" parameterType="string">
		delete from plan_bhsd jh where jh.id=#{id}
	</delete>
	
	<update id="editBhsdById" parameterType="plan_bhsd">
		update plan_bhsd set sbnf=#{sbnf}
		<if test="jhkgsj!=null and jhkgsj!=''">,jhkgsj=#{jhkgsj}</if>
		<if test="jhwgsj!=null and jhwgsj!=''">,jhwgsj=#{jhwgsj}</if>
		<if test="xdsj!=null and xdsj!=''">,xdsj=#{xdsj}</if>
		<if test="pfsj!=null and pfsj!=''">,pfsj=#{pfsj}</if>
		<if test="jhxdwh!=null">,jhxdwh=#{jhxdwh}</if>
		<if test="sjdw!=null">,sjdw=#{sjdw}</if>
		<if test="sjpfdw!=null">,sjpfdw=#{sjpfdw}</if>
		<if test="pfwh!=null">,pfwh=#{pfwh}</if>
		<if test="pfztz!=null">,pfztz=#{pfztz}</if>
		<if test="jhsybzje!=null">,jhsybzje=#{jhsybzje}</if>
		<if test="jhsydfzcje!=null">,jhsydfzcje=#{jhsydfzcje}</if>
		<if test="qtzj!=null">,qtzj=#{qtzj}</if>
		<if test="bz!=null">,bz=#{bz}</if>
		where id=#{id}
	</update>
	
	<update id="editBhsdSckxx" parameterType="sckbhsd">
		update SCK_Bhsd set sckid=#{sckid}
		<if test="sck_sdcd!=null">,sck_sdcd=#{sck_sdcd}</if>
		<if test="sck_sdkd!=null">,sck_sdkd=#{sck_sdkd}</if>
		<if test="sck_sdgd!=null">,sck_sdgd=#{sck_sdgd}</if>
		<if test="spdw!=null">,spdw=#{spdw}</if>
		<if test="sjdw!=null">,sjdw=#{sjdw}</if>
		<if test="spwh!=null">,spwh=#{spwh}</if>
		<if test="tzgs!=null">,tzgs=#{tzgs}</if>
		<if test="sck_jsxz!=null">,sck_jsxz=#{sck_jsxz}</if>
		<if test="zyjsnr!=null">,zyjsnr=#{zyjsnr}</if>
		<if test="scbz!=null">,scbz=#{scbz}</if>
		where sckid=#{sckid}
	</update>
	
	<update id="editBhsdStatus" parameterType="plan_bhsd">
		update plan_bhsd set 
			<if test="sbbm!=null and sbbm!=''">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null and sbbmdm!=''">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null and sbsj!=''">sbsj=#{sbsj},</if>
			<if test="sbzt!=null and sbzt!=''">sbzt=#{sbzt},</if>
			<if test="spbm!=null and spbm!=''">spbm=#{spbm},</if>
			<if test="spbmdm!=null and spbmdm!=''">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null and spsj!=''">spsj=#{spsj},</if>
			<if test="spzt!=null and spzt!=''">spzt=#{spzt},</if>
			<if test="jh_thyj!=null">jh_thyj=#{jh_thyj},</if>
			jh_sbthcd=#{jh_sbthcd}
		where id=#{id}
	</update>
	
	<update id="xgJhBhsdSp" parameterType="plan_bhsd">
		update plan_bhsd set 
			<if test="sbbm!=null and sbbm!=''">sbbm=#{sbbm},</if>
			<if test="sbbmdm!=null and sbbmdm!=''">sbbmdm=#{sbbmdm},</if>
			<if test="sbsj!=null and sbsj!=''">sbsj=#{sbsj},</if>
			<if test="sbzt!=null and sbzt!=''">sbzt=#{sbzt},</if>
			<if test="spbm!=null and spbm!=''">spbm=#{spbm},</if>
			<if test="spbmdm!=null and spbmdm!=''">spbmdm=#{spbmdm},</if>
			<if test="spsj!=null and spsj!=''">spsj=#{spsj},</if>
			<if test="spzt!=null and spzt!=''">spzt=#{spzt},</if>
			<if test="jh_thyj!=null">jh_thyj=#{jh_thyj},</if>
			jh_sbthcd=jh_sbthcd
		where id=#{id}
	</update>
	
	<update id="xgJhBhsdSd" parameterType="plan_bhsd">
		update plan_bhsd set jh_sdzt=#{jh_sdzt} where id=#{id}
	</update>
	
	<update id="importBhsd_jh" parameterType="hashMap">
		update plan_bhsd set sbnf=#{9},jhkgsj=to_date(#{10},'yyyy-mm-dd'),jhwgsj=to_date(#{11},'yyyy-mm-dd'),xdsj=to_date(#{12},'yyyy-mm-dd'),sjdw=#{13},sjpfdw=#{14},pfwh=#{15},pfsj=to_date(#{16},'yyyy-mm-dd'),pfztz=#{17},jhsybzje=#{18},jhsydfzcje=#{19},sfsqablbz=#{20},ablbzsqwh=#{21},bz=#{22}
		where sckid = (select sckid from sck_Bhsd where sck_lxbm=#{2}  and sck_qlbh=#{4} and sck_qlzxzh=#{6})
	</update>
	
	<update id="updateLrztBySckid" parameterType="java.util.List">
 		update sck_Bhsd set lrjh='未列入',sck_sdzt='0'  where sckid=#{String}
 	</update>
 	
 	<select id="queryjckbhsd" parameterType="String" resultType="plan_bhsd">
		select * from xmk_Bhsd where sddm=#{String}
	</select>
	
	<insert id="insertbhFile" parameterType="plan_upload">
		insert into plan_upload(id,filename,filedata,parentid,filetype) 
		values(sys_guid(),#{filename},#{filedata},#{parentid},#{filetype})
	</insert>
	
 	<select id="queryBhsdFjById" parameterType="string" resultType="plan_bhsd">
		select gkbgmc,gkbgdata,sjsgtmc,sjsgtdata from plan_bhsd jh where jh.id=#{id}
	</select>
	
	<select id="queryJcktj" resultType="treenode">
		select substr(xm.xzqhdm,0,length(${id})) as id,count(xm.xzqhdm),sum(xm.qlqc) 
		from plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) left join xmk_Bhsd xm 
		on (sc.xmkid=xm.id) left join  xtgl_xzqh xt on (xm.xzqhdm=xt.id)
		where xm.xzqhdm like ${id}||'%' group by substr(xm.xzqhdm,0,length(${id}))
	</select>
	
	<select id="queryJcktj1" resultType="treenode" parameterType="java.util.Map">
		select t.parent as id,xz.name as name,NVL(sum(t.je),0) as text,sum(t.sl) as parent from (
			select distinct xt.parent,jh.sbnf,jhsybzje,
      		(select jhsybzje from plan_bhsd ab1 left join sck_Bhsd sc1 on 
      		(ab1.sckid=sc1.sckid) left join xmk_Bhsd lx1 on (sc1.xmkid=lx1.id) where ab1.sbnf=#{nf} and ab1.id=jh.id) as je,
      		(select count(jhsybzje) from plan_bhsd ab1 left join sck_Bhsd sc1 on 
			(ab1.sckid=sc1.sckid) left join xmk_Bhsd lx1 on (sc1.xmkid=lx1.id) where ab1.sbnf=#{nf} and ab1.id=jh.id) as sl
			from plan_bhsd jh left join sck_Bhsd sc on 
			(jh.sckid=sc.sckid) left join xmk_Bhsd lx on (sc.xmkid=lx.id) right join xtgl_xzqh xt on (lx.xzqhdm=xt.id)
			where xt.parent is not null
		) t join xtgl_xzqh xz on (t.parent=xz.id)
		group by t.parent,xz.name order by t.parent
	</select>
	
	<select id="queryJhktj2" resultType="treenode" parameterType="java.util.Map">
		select t.sbnf as id,sum(t.jhsybzje) as text,count(t.jhsybzje) as name from (
		select distinct jh.id,jh.sbnf,jh.jhsybzje from 
		plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
		left join xmk_Bhsd lx on (sc.xmkid=lx.id) 
		where lx.xzqhdm like rtrim(#{xzqhdm},'0')||'%' and jh.sbnf>=#{start} and <![CDATA[jh.sbnf<=#{end}]]>) t
		group by t.sbnf
	</select>
	
	<select id="queryJhktjt2" resultType="treenode" parameterType="java.util.Map">
		select NVL(sum(t.jhsybzje),0) from (
		select distinct jh.id,jh.sbnf,jh.jhsybzje from 
		plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
		left join xmk_Bhsd lx on (sc.xmkid=lx.id) 
		where lx.xzqhdm like #{xzqhdm} and jh.sbnf=#{nf}) t
		group by t.sbnf
	</select>
	
	<select id="queryJhktjt3" resultType="treenode" parameterType="java.util.Map">
		select sbnf as name,sum(jhsybzje) as text from (
			select distinct jh.id,jh.sbnf,jh.jhsybzje 
			from plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
    		left join xmk_Bhsd lx on (sc.xmkid=lx.id) 
    		where jh.sbnf>=#{start} and <![CDATA[jh.sbnf<=#{end}]]> and lx.xzqhdm like #{xzqhdm}) 
    		group by sbnf
	</select>
	
	<select id="queryGcktj" resultType="treenode" parameterType="java.util.Map">
		select (r.kgzt+r.jgzt) as id,count(r.kgzt+r.jgzt) as name,sum(r.jhsybzje) as text,sum(r.btz+r.qttz) as parent from (
			select jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybzje,sum(nvl(gcgl.wc_btz,0)) as btz,sum(nvl(gcgl.wc_qttz,0)) as qttz from gcgl_Bhsd gcgl 
				right join (select jh.id,jh.kgzt,jh.jgzt,jh.jhsybzje from  plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
    			left join xmk_Bhsd lx on (sc.xmkid=lx.id) where lx.xzqhdm like #{xzqhdm} and jh.sbnf=#{nf} and jh.spzt='1' and jh.jh_sbthcd='6') jh_lx on gcgl.jhid=jh_lx.id
    	group by jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybzje) r group by r.kgzt,r.jgzt order by r.kgzt,r.jgzt
	</select>
	
	<select id="queryGcktjt" resultType="treenode" parameterType="java.util.Map">
		select nvl(sum(r.jhsybzje),0) as text,nvl(sum(r.btz+r.qttz),0) as parent from (
			select jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybzje,sum(nvl(gcgl.wc_btz,0)) as btz,sum(nvl(gcgl.wc_qttz,0)) as qttz from gcgl_Bhsd gcgl 
				right join (select jh.id,jh.kgzt,jh.jgzt,jh.jhsybzje from  plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
    			left join xmk_Bhsd lx on (sc.xmkid=lx.id) 
    			where jh.spzt='1' and jh.jh_sbthcd='6' 
    			<if test="xzqhdm!=null and xzqhdm!=''">
    				and lx.xzqhdm like #{xzqhdm}
    			</if>) jh_lx on gcgl.jhid=jh_lx.id
    	group by jh_lx.id,jh_lx.kgzt,jh_lx.jgzt,jh_lx.jhsybzje) r
	</select>
	
	<select id="queryGcktj2" resultType="treenode" parameterType="java.util.Map">
		select nvl(sum(r.bn),0) as id,count(r.bn) as name,nvl(sum(r.fbn),0) as text,count(r.fbn) as parent from (
			select jh.id,jh.kgzt,jh.jgzt,
				(select a.jhsybzje from plan_bhsd a where a.sbnf=#{nf} and a.id=jh.id) as bn,
				(select a.jhsybzje from plan_bhsd a where #{nf}>a.sbnf and a.id=jh.id) as fbn 
			from plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
			left join xmk_Bhsd lx on (sc.xmkid=lx.id) 
			where jh.spzt='1' and jh.jh_sbthcd='6'
		and lx.xzqhdm like #{xzqhdm}) r
	</select>
	
	<select id="queryBhLs" parameterType="jckbhsd" resultMap="plan_bhsd">
		select jh.id,jh.sbnf,lx.qlmc,lx.qlzxzh from plan_bhsd jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
    	left join xmk_Bhsd lx on (sc.xmkid=lx.id) where (lx.qlbh=#{qlbh} or
    	(lx.lxbm=#{lxbm} and lx.qlzxzh=#{qlzxzh})) and jh.id!=#{id}
	</select>
	
	<update id="editZjById" parameterType="plan_bhsd">
		update plan_bhsd jh set jh.pfztz=#{pfztz},jh.jhsybzje=#{jhsybzje},jh.jhsydfzcje=#{jhsydfzcje}
		where jh.id=#{id}
	</update>
	
	<update id="xgJhkBhsdTH" parameterType="hashmap">
		update plan_bhsd set jh_sbthcd=(jh_sbthcd+2),jh_thyj=#{jh_thyj} where id =#{id}
	</update>
	
	 <update id="tzBhsd" parameterType="plan_bhsd">
		update plan_bhsd set tz_type=#{tz_type},tz_time=sysdate where id=#{id}
	 </update>
	 <select id="querytzbyid" parameterType="plan_bhsd" resultType="plan_bhsd">
	 	select * from plan_bhsd_tz where id=#{id}
	 </select>
	 <insert id="bhsdTztj" parameterType="plan_bhsd">
	 	insert into plan_bhsd_tz select * from plan_bhsd where id=#{id}
	 </insert>
	 <update id="bhsdTzxg" parameterType="plan_bhsd" >
	 	update plan_bhsd_tz set tz_type=#{tz_type} where id=#{id}
	 </update>
	 <delete id="bhsdTzqx" parameterType="plan_bhsd">
	 	delete from  plan_bhsd where id=#{id}
	 </delete>
	 <insert id="bhsdTzth" parameterType="plan_bhsd">
	 	insert into plan_bhsd select * from plan_bhsd_tz where id=#{id}
	 </insert>
	 <delete id="deleteTzbhsd" parameterType="plan_bhsd">
	 	delete from  plan_bhsd_tz where id=#{id}
	 </delete>
	 
	 <select id="queryBhsdListTz" parameterType="java.util.Map" resultMap="plan_bhsd">
		select * from 
			(
				select rownum as num,t.* from
				(
					select jh.id,jh.sckid,jh.jh_sbthcd,jh.sbnf,decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt) as sbzt,jh.spzt,jh.kgzt,jh.jgzt,
					jh.jhkgsj,jh.jhwgsj,jh.pfztz,lx.gydw,jh.jhsybzje,jh.jhsydfzcje,jh.qtzj,
					lx.gydwbm,lx.xzqhdm,lx.xzqhmc,lx.lxmc,lx.lxbm,lx.sdmc,lx.sddm,lx.sdzxzh ,jh.jh_thyj,lx.tbbmbm,jh.jh_sdzt,
					jh.tz_type,jh.tz_time
					from plan_bhsd_tz jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
					left join xmk_Bhsd lx on (sc.xmkid=lx.id) where 1=1
                    and jh.jh_sbthcd&lt;=#{jh.jh_sbthcd} 
                    <if test="jh.xtType!='' and jh.xtType!= null ">
						${jh.xtType}
					</if>
	 				<if test="jh.sbnf!=null and jh.sbnf!=''">
	 					and jh.sbnf=#{jh.sbnf}
	 				</if>
	 				
	 				<if test="jh.kgzt!=null and jh.kgzt!=''">
	 					and jh.kgzt=#{jh.kgzt}
	 				</if>
	 				<if test="jh.jgzt!=null and jh.jgzt!=''">
	 					and jh.jgzt=#{jh.jgzt}
	 				</if>
<!-- 	 				<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 				 	</if> -->
	 				<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 					and ${lx.gydwbm}
	 				</if>
	 				<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 					and ${lx.xzqhdm}
	 				</if>
	 				<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
					   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
					</if>
	 				<if test="lx.lxmc!=null and lx.lxmc!=''">
	 					and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 				</if>
	 				<if test="lx.lxbm!=null and lx.lxbm!=''">
	 					and lx.lxbm like #{lx.lxbm}||'%'
	 				</if>
	 				<if test="lx.jsdj!=null and lx.jsdj!=''">
	 					and lx.jsdj = #{lx.jsdj}
	 				</if>
	 				<if test="lx.sdmc!=null and lx.sdmc!=''">
	 					and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 				</if>
	 				<if test="lx.sddm!=null and lx.sddm!=''">
	 					and lx.sddm like '%'||#{lx.sddm}||'%'
	 				</if>
	 				<if test="lx.acdfl!=null and lx.acdfl!=''">
	 					and lx.acdfl={lx.akjfl}
	 				</if>
	 				<if test="jh.sbzt!=null and jh.sbzt!=''">
	 					<if test='jh.shFlag=="1"'>
					 	and jh.sbzt=#{jh.sbzt}
					 	</if>
					 	<if test="jh.shFlag==null or jh.shFlag==''">
					 	and decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt)=#{jh.sbzt}
					 	</if>
	 				</if>
	 				<if test="jh.spzt!=null and jh.spzt!=''">
	 					and jh.spzt=#{jh.spzt}
	 				</if>
	 				<if test="jh.jh_sdzt!=null and jh.jh_sdzt!=''">
	 					and jh.jh_sdzt=#{jh.jh_sdzt}
	 				</if>
	 				<if test="jh.tz_type!=null and jh.tz_type!=''">
	 					and jh.tz_type=#{jh.tz_type}
	 				</if>
	 				order by jh.sbnf desc,jh.jh_sbthcd
	 			) t 
	 			where 1=1
	 			order by t.sbnf desc,t.jh_sbthcd
 			)
 		where <![CDATA[ num <= (#{page} * #{rows})]]> and num>(#{page}-1)*#{rows}
	</select>
	<select id="queryBhsdCountTz"  parameterType="java.util.Map"  resultType="int">
		select count(*) from plan_bhsd_tz jh left join sck_Bhsd sc on (jh.sckid=sc.sckid) 
		left join xmk_Bhsd lx on (sc.xmkid=lx.id) where 1=1
		and jh.jh_sbthcd &lt;=#{jh.jh_sbthcd}
        <if test="jh.xtType!='' and jh.xtType!= null ">
			${jh.xtType}
		</if>
	 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		<if test='jh.shFlag=="1"'>
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.shFlag==null or jh.shFlag==''">
				and decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt)=#{jh.sbzt}
			</if>
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
	 	<if test="jh.kgzt!=null and jh.kgzt!=''">
	 		and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
<!-- 	 	<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 		</if> -->
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and ${lx.xzqhdm}
	 	</if>
	 	<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
		   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
		</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.jsdj!=null and lx.jsdj!=''">
	 		and lx.jsdj = #{lx.jsdj}
	 	</if>
	 	<if test="lx.sdmc!=null and lx.sdmc!=''">
	 		and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 	</if>
	 	<if test="lx.sddm!=null and lx.sddm!=''">
	 		and lx.sddm like '%'||#{lx.sddm}||'%'
	 	</if>
	 	<if test="lx.acdfl!=null and lx.acdfl!=''">
	 		and lx.acdfl=#{lx.acdfl}
	 	</if>
	 	<if test="jh.jh_sdzt!=null and jh.jh_sdzt!=''">
	 		and jh.jh_sdzt=#{jh.jh_sdzt}
	 	</if>
	 	<if test="jh.tz_type!=null and jh.tz_type!=''">
	 		and jh.tz_type=#{jh.tz_type}
	 	</if>
	</select>
	
	<select id="querySumBhsdTz" parameterType="java.util.Map" resultType="plan_bhsd">
		select count(id) as id,sum(pfztz) as pfztz,sum(jhsybzje) as jhsybzje,
		sum(jhsydfzcje) as jhsydfzcje from (
			select count(jh.id) as id,sum(jh.pfztz) as pfztz,sum(jh.jhsybzje) as jhsybzje,
			sum(jh.jhsydfzcje) as jhsydfzcje 
			from xmk_Bhsd lx right join sck_Bhsd sc on (lx.id=sc.xmkid) 
			right join plan_bhsd_tz jh on (sc.sckid=jh.sckid)
			where 1=1
         and jh.jh_sbthcd&lt;=#{jh.jh_sbthcd} 
         
        <if test="jh.xtType!='' and jh.xtType!= null ">
			${jh.xtType}
		</if>
	 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
		 	<if test='jh.shFlag=="1"'>
				and jh.sbzt=#{jh.sbzt}
			</if>
			<if test="jh.shFlag==null or jh.shFlag==''">
				and decode(jh.jh_sbthcd,#{jh.jh_sbthcd},'0',jh.sbzt)=#{jh.sbzt}
			</if>
        </if>
	 	<if test="jh.kgzt!=null and jh.kgzt!=''">
	 		and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
	 	<if test="jh.spzt!=null and jh.spzt!=''">
	 		and jh.spzt=#{jh.spzt}
	 	</if>
	 	<if test="jh.jh_sdzt!=null and jh.jh_sdzt!=''">
	 		and jh.jh_sdzt=#{jh.jh_sdzt}
	 	</if>
<!-- 	 	<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 		</if> -->
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and ${lx.xzqhdm}
	 	</if>
	 	<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
		   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
		</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.jsdj!=null and lx.jsdj!=''">
	 		and lx.jsdj = #{lx.jsdj}
	 	</if>
	 	<if test="lx.sdmc!=null and lx.sdmc!=''">
	 		and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 	</if>
	 	<if test="lx.sddm!=null and lx.sddm!=''">
	 		and lx.sddm like '%'||#{lx.sddm}||'%'
	 	</if>
	 	<if test="lx.acdfl!=null and lx.acdfl!=''">
	 		and lx.acdfl=#{lx.acdfl}
	 	</if> 
	 	<if test="jh.tz_type!=null and jh.tz_type!=''">
	 		and jh.tz_type=#{jh.tz_type}
	 	</if>
	 	group by jh.id)
	</select>

	
	<select id="queryBhsdtzById" parameterType="string" resultType="plan_bhsd">
		select 	* from plan_bhsd_tz jh where jh.id=#{id}
	</select>
	
	<select id="exportExcel_jh_tz" parameterType="hashMap" resultType="sjbb">
		select 
		jh.sbnf v_0,to_char(jh.jhkgsj,'yyyy-mm-dd') v_1,to_char(jh.jhwgsj,'yyyy-mm-dd') v_2,lx.gydw v_3,
		lx.xzqhmc v_4,lx.lxbm v_5,lx.lxmc v_6,lx.sddm v_7,lx.sdmc v_8,jh.pfztz v_9 
		from plan_bhsd_tz jh
		left join sck_Bhsd sc on (jh.sckid = sc.sckid)
		left join xmk_Bhsd lx on (sc.xmkid = lx.id) where 1=1
            and jh.jh_sbthcd &lt;=#{jh.jh_sbthcd} 
            
        <if test="jh.xtType!='' and jh.xtType!= null ">
				${jh.xtType}
		</if>
	 	<if test="jh.sbnf!=null and jh.sbnf!=''">
	 		and jh.sbnf=#{jh.sbnf}
	 	</if>
	 	<if test="jh.sbzt!=null and jh.sbzt!=''">
	 		and jh.sbzt=#{jh.sbzt}
	 	</if>
	 	<if test="jh.kgzt!=null and jh.kgzt!=''">
	 		and jh.kgzt=#{jh.kgzt}
	 	</if>
	 	<if test="jh.jgzt!=null and jh.jgzt!=''">
	 		and jh.jgzt=#{jh.jgzt}
	 	</if>
	 	<if test="jh.jh_sdzt!=null and jh.jh_sdzt!=''">
	 		and jh.jh_sdzt=#{jh.jh_sdzt}
	 	</if>
<!-- 	 	<if test="jh.sfylsjl!=null and jh.sfylsjl!=''"> -->
<!-- 			and sc.bzls=#{jh.sfylsjl} -->
<!-- 		</if> -->
	 	<if test="lx.gydwbm!=null and lx.gydwbm!=''">
	 		and ${lx.gydwbm}
	 	</if>
	 	<if test="lx.xzqhdm!=null and lx.xzqhdm!=''">
	 		and ${lx.xzqhdm}
	 	</if>
	 	<if test="lx.tbbmbm!='' and lx.tbbmbm!= null ">
		   and lx.tbbmbm like '%'||(#{lx.tbbmbm})||'%'
		</if>
	 	<if test="lx.lxmc!=null and lx.lxmc!=''">
	 		and lx.lxmc like '%'||#{lx.lxmc}||'%'
	 	</if>
	 	<if test="lx.lxbm!=null and lx.lxbm!=''">
	 		and lx.lxbm like #{lx.lxbm}||'%'
	 	</if>
	 	<if test="lx.jsdj!=null and lx.jsdj!=''">
	 		and lx.jsdj = #{lx.jsdj}
	 	</if>
	 	<if test="lx.sdmc!=null and lx.sdmc!=''">
	 		and lx.sdmc like '%'||#{lx.sdmc}||'%'
	 	</if>
	 	<if test="lx.sddm!=null and lx.sddm!=''">
	 		and lx.sddm like '%'||#{lx.sddm}||'%'
	 	</if>
	 	<if test="lx.acdfl!=null and lx.acdfl!=''">
	 		and lx.acdfl=#{lx.acdfl}
	 	</if>
	 	<if test="jh.tz_type!=null and jh.tz_type!=''">
	 		and jh.tz_type=#{jh.tz_type}
	 	</if>
		order by jh.sbnf desc
	</select>
</mapper>
