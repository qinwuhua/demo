<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.gcbb">
	<resultMap id="gjjd" type="gcgjjd">
		<id property="jhid" column="jhid" />
		<result property="sfgyhbm" column="sfgyhbm"/>
		<result property="jsdd" column="jsdd"/>
		<result property="lxbm" column="lxbm"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="yhlc" column="yhlc"/>
		<result property="yhlb" column="yhlb"/>
		<result property="sjkgsj" column="sjkgsj"/>
		<result property="sjwgsj" column="sjwgsj"/>
		<result property="ylmlx" column="ylmlx"/>
		<result property="sjlmlx" column="sjlmlx"/>
		<result property="dc" column="dc"/>
		<result property="bywcdc" column="bywcdc"/>
		<result property="bnwcdc" column="bnwcdc"/>
		<result property="zjwcdc" column="zjwcdc"/>
		<result property="jc" column="jc"/>
		<result property="bywcjc" column="bywcjc"/>
		<result property="bnwcjc" column="bnwcjc"/>
		<result property="zjwcjc" column="zjwcjc"/>
		<result property="mc" column="mc"/>
		<result property="bywcmc" column="bywcmc"/>
		<result property="bnwcmc" column="bnwcmc"/>
		<result property="zjwcmc" column="zjwcmc"/>
		<result property="pfztz" column="pfztz"/>
		<result property="gys" column="gys"/>
		<result property="bywcje" column="bywcje"/>
		<result property="bnwcje" column="bnwcje"/>
		<result property="zjwcje" column="zjwcje"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="xmmc" column="xmmc"/>
		<result property="bz" column="bz"/>
		<collection property="gjjdlx" column="jhid" javaType="ArrayList" ofType="plan_lx_gcgj" resultMap="gjjd_lx"/>
		<collection property="shjdlx" column="jhid" javaType="ArrayList" ofType="plan_lx_shuih" resultMap="shjd_lx"/>
	</resultMap>
	<resultMap id="gjjd_lx" type="plan_lx_gcgj">
		<result property="jhid" column="jhid"/>
		<result property="jsdd" column="jsdd"/>
		<result property="lxbm" column="lxbm"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="yhlc" column="yhlc"/>
		<result property="ylmlx" column="ylmlx"/>
	</resultMap>
	<resultMap id="shjd_lx" type="plan_lx_shuih">
		<result property="jhid" column="jhid"/>
		<result property="jsdd" column="jsdd"/>
		<result property="lxbm" column="lxbm"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="yhlc" column="yhlc"/>
		<result property="ylmlx" column="ylmlx"/>
	</resultMap>
	<select id="selGcgjJdbb" parameterType="xmbb" resultType="gcgjjd">
		select gj.id as jhid,
		gj.sfgyhbm as sfgyhbm,gj.yhlb as yhlb,gj.sjkgsj as sjkgsj,gj.sjwgsj as sjwgsj,gj.sjlmlx as sjlmlx,
		NVL(gj.dc,0) as dc,
		NVL((select gjgc.bywcdc from gcgl_gcgzgj gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=gj.id),0) bywcdc,
		NVL((select sum(gjgc.bywcdc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.id and 
		to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcdc ]]>,
		NVL((select sum(gjgc.bywcdc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(gj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjwcdc,
		NVL(gj.jc,0) as jc,
		NVL((select gjgc.bywcjc from gcgl_gcgzgj gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=gj.id),0) bywcjc,
		NVL((select sum(gjgc.bywcjc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.id and 
		to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcjc ]]>,
		NVL((select sum(gjgc.bywcjc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(gj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjwcjc,
		NVL(gj.mc,0) as mc,
		NVL((select gjgc.bywcmc from gcgl_gcgzgj gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=gj.id),0) bywcmc,
		NVL((select sum(gjgc.bywcmc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.id and 
		to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcmc ]]>,
		NVL((select sum(gjgc.bywcmc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(gj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjwcmc,
		NVL(gj.pfztz,0) as pfztz,NVL(gj.gsztz,0) as gys,
		NVL((select gjgc.wc_btz+gjgc.wc_stz+gjgc.wc_qttz from gcgl_gcgzgj gjgc where to_date(gjgc.sbyf,'yyyy-mm') = to_date(#{ybny},'yyyy-mm') and gjgc.jhid=gj.id),0) as bywcje,
		NVL((select sum(gjgc.wc_btz)+sum(gjgc.wc_stz)+sum(gjgc.wc_qttz) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.id and 
		to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcje ]]>,
		NVL((select sum(gjgc.wc_btz)+sum(gjgc.wc_stz)+sum(gjgc.wc_qttz) from gcgl_gcgzgj gjgc where to_date(#{ybny},'yyyy-mm') >= to_date(to_char(gj.sjkgsj,'yyyy-mm'),'yyyy-mm') and gjgc.jhid=gj.id),0) as zjwcje,
		gj.kgzt as kgzt,gj.jgzt as jgzt,gj.xmmc as xmmc,gj.bz as bz,lx.*
		from plan_gcgj gj,(select l.jhid,replace(WMSYS.WM_CONCAT(to_char(l.jsdd)),',','、') as jsdd,replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,
		replace(WMSYS.WM_CONCAT(to_char(l.qdzh)),',','、') as qdzh,replace(WMSYS.WM_CONCAT(to_char(l.zdzh)),',','、') as zdzh,
		replace(WMSYS.WM_CONCAT(to_char(l.yhlc)),',','、') as yhlc,replace(WMSYS.WM_CONCAT(to_char(l.ylmlx)),',','、') as ylmlx 
		from plan_lx_gcgj l where 1=1 and ${xzqh} and ${gydw} group by l.jhid) lx
		where gj.id=lx.jhid and gj.jh_sbthcd=6 and gj.sbnf=#{sbnf}
		<if test="tiaojian!=null and tiaojian!=''">
			and lx.lxbm like #{tiaojian}||'%'
		</if>
	</select>
	<select id="selShuihJdbb" parameterType="xmbb" resultType="gcgjjd">
		select sh.xmmc,sh.id as jhid,sh.sfgyhbm as sfgyhbm,sh.yhlb as yhlb,sh.sjkgsj as sjkgsj,
		sh.sjwgsj as sjwgsj,sh.sjlmlx as sjlmlx,
		NVL(sh.dc,0) as dc,
		NVL((select gjgc.bywcdc from gcgl_sh gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=sh.id),0) bywcdc,
		NVL((select sum(gjgc.bywcdc) from gcgl_sh gjgc where gjgc.jhid=sh.id and 
		to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcdc ]]>,
		NVL((select sum(gjgc.bywcdc) from gcgl_sh gjgc where gjgc.jhid=sh.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sh.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjwcdc,
		NVL(sh.jc,0) as jc,
		NVL((select gjgc.bywcjc from gcgl_sh gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=sh.id),0) bywcjc,
		NVL((select sum(gjgc.bywcjc) from gcgl_sh gjgc where gjgc.jhid=sh.id and 
		to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcjc ]]>,
		NVL((select sum(gjgc.bywcjc) from gcgl_sh gjgc where gjgc.jhid=sh.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sh.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjwcjc,
		NVL(sh.mc,0) as mc,
		NVL((select gjgc.bywcmc from gcgl_sh gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=sh.id),0) bywcmc,
		NVL((select sum(gjgc.bywcmc) from gcgl_sh gjgc where gjgc.jhid=sh.id and 
		to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcmc ]]>,
		NVL((select sum(gjgc.bywcmc) from gcgl_sh gjgc where gjgc.jhid=sh.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sh.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjwcmc,
		NVL(sh.pfztz,0) as pfztz,NVL(sh.gsztz,0) as gys,
		NVL((select gjgc.wc_btz+gjgc.wc_stz+gjgc.wc_qttz from gcgl_sh gjgc where to_date(gjgc.sbyf,'yyyy-mm') = to_date(#{ybny},'yyyy-mm') and gjgc.jhid=sh.id),0) as bywcje,
		NVL((select sum(gjgc.wc_btz)+sum(gjgc.wc_stz)+sum(gjgc.wc_qttz) from gcgl_sh gjgc where gjgc.jhid=sh.id and 
		to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcje ]]>,
		NVL((select sum(gjgc.wc_btz)+sum(gjgc.wc_stz)+sum(gjgc.wc_qttz) from gcgl_sh gjgc where to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sh.sjkgsj,'yyyy-mm'),'yyyy-mm') and gjgc.jhid=sh.id),0) as zjwcje,
		sh.kgzt as kgzt,sh.jgzt as jgzt,lx.*
		from plan_shuih sh,(select l.jhid,replace(WMSYS.WM_CONCAT(to_char(l.jsdd)),',','、') as jsdd,replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,
		replace(WMSYS.WM_CONCAT(to_char(l.qdzh)),',','、') as qdzh,replace(WMSYS.WM_CONCAT(to_char(l.zdzh)),',','、') as zdzh,replace(WMSYS.WM_CONCAT(to_char(l.yhlc)),',','、') as yhlc,
		replace(WMSYS.WM_CONCAT(to_char(l.ylmlx)),',','、') as ylmlx from plan_lx_shuih l where 1=1 ${xzqh} ${gydw} group by l.jhid) lx
		where sh.id=lx.jhid and sh.jh_sbthcd=6 and sh.sbnf=#{sbnf}
		<if test="tiaojian!=null and tiaojian!=''">
			and lx.lxbm like #{tiaojian}||'%'
		</if>
	</select>
	<select id="selYhdzxJdbb" parameterType="xmbb" resultType="gcgjjd">
		select lx.*,yh.xmmc as xmmc,yh.sfgk as sfgyhbm,yh.classify as yhlb,yh.sjkgsj as sjkgsj,yh.sjwgsj as sjwgsj,
		NVL(yh.dianceng,0) as dc,
		NVL((select gcyh.bywcdc from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and to_date(gcyh.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) bywcdc,
		NVL((select sum(gcyh.bywcdc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and 
		to_date(#{ybny},'yyyy-mm') >= to_date(gcyh.sbyf,'yyyy-mm') and to_date(gcyh.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')),0) bnwcdc,
		NVL((select sum(gcyh.bywcdc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(yh.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) zjwcdc,
		NVL(yh.jiceng,0) as jc,
		NVL((select gcyh.bywcjc from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and to_date(gcyh.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) bywcjc,
		NVL((select sum(gcyh.bywcjc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and 
		to_date(#{ybny},'yyyy-mm') >= to_date(gcyh.sbyf,'yyyy-mm') and to_date(gcyh.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')),0) bnwcjc,
		NVL((select sum(gcyh.bywcjc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(yh.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) zjwcjc,
		NVL(yh.surface,0) as mc,
		NVL((select gcyh.bywcmc from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and to_date(gcyh.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) bywcmc,
		NVL((select sum(gcyh.bywcmc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and 
		to_date(#{ybny},'yyyy-mm') >= to_date(gcyh.sbyf,'yyyy-mm') and to_date(gcyh.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')),0) bnwcmc,
		NVL((select sum(gcyh.bywcmc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(yh.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) zjwcmc,
		NVL(yh.totalinvest,0) as pfztz,NVL(yh.gys,0) as gys,
		NVL((select gcyh.wc_btz+gcyh.wc_stz+gcyh.wc_qttz from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and to_date(gcyh.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bywcje,
		NVL((select sum(gcyh.wc_btz)+sum(gcyh.wc_stz)+sum(gcyh.wc_qttz) from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and 
		to_date(#{ybny},'yyyy-mm') >= to_date(gcyh.sbyf,'yyyy-mm') and to_date(gcyh.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')),0) as bnwcje,
		NVL((select  sum(gcyh.wc_btz)+sum(gcyh.wc_stz)+sum(gcyh.wc_qttz) from gcgl_yhdzx gcyh where gcyh.jhid=yh.id and 
		to_date(#{ybny},'yyyy-mm') >= to_date(to_char(yh.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) zjwcje
		from (select l.jhid,replace(WMSYS.WM_CONCAT(to_char(l.xzqhmc)),',','、') as jsdd,
		replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,replace(WMSYS.WM_CONCAT(to_char(l.qdzh)),',','、') as qdzh,
		replace(WMSYS.WM_CONCAT(to_char(l.zdzh)),',','、') as zdzh,replace(WMSYS.WM_CONCAT(to_char(l.hdlc)),',','、') as yhlc,
		replace(WMSYS.WM_CONCAT(to_char(l.ylmlx)),',','、') as ylmlx
		from plan_lx_yhdzx l where 1=1 and ${xzqh} and ${gydw} <if test="lxmc!=null and lxmc!=''"> and l.lxbm like '%'||#{lxmc}||'%'</if>
		group by l.jhid) 
		lx right join plan_yhdzx yh on lx.jhid=yh.id 
		where yh.jh_sbthcd=6 and yh.sbnf=#{sbnf}
		<if test="xmmc!=null and xmmc!=''">and yh.xmmc like #{xmmc}||'%'</if>
		<if test="lxmc!=null and lxmc!=''"> and lx.lxbm like '%'||#{lxmc}||'%'</if>
	</select>
	<select id="selGcsjJdbb" parameterType="xmbb" resultType="gcsjjd">
		select sj.id as jhid,sj.jhnf as jhnf,sj.jsjsbz as jsjsbz,sj.sjkgsj as sjkgsj,
		sj.pftz as pftz,sj.ljtsf as ljtsf,sj.ql as ql,sj.ql_m as ql_m,sj.hd as hd,sj.sd as sd,
		sj.sd_m as sd_m,sj.dc as dc,sj.jc as jc,sj.lqlm as lqlm,sj.snlm as snlm,
		NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bywcje,
		NVL((select sum(gcsj.ljtsfwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bywcljtsf,
		NVL((select sum(gcsj.qlwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byqlwcqk_z,
		NVL((select sum(gcsj.qlwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byqlwcqk_ym,
		NVL((select sum(gcsj.hdwcqk_m) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byhdwcqk_m,
		NVL((select sum(gcsj.sdwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysdwcqk_z,
		NVL((select sum(gcsj.sdwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysdwcqk_ym,
		NVL((select sum(gcsj.dcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bydcwcqk,
		NVL((select sum(gcsj.jcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byjcwcqk,
		NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bylqlmwcqk,
		NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysnlmwcqk,
		NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjwcje,
		NVL((select sum(gcsj.ljtsfwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjwcljtsf,
		NVL((select sum(gcsj.qlwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjqlwcqk_z,
		NVL((select sum(gcsj.qlwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjqlwcqk_ym,
		NVL((select sum(gcsj.hdwcqk_m) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjhdwcqk_m,
		NVL((select sum(gcsj.sdwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjsdwcqk_z,
		NVL((select sum(gcsj.sdwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjsdwcqk_ym,
		NVL((select sum(gcsj.dcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjdcwcqk,
		NVL((select sum(gcsj.jcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjjcwcqk,
		NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjlqlmwcqk,
		NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')),0) as zjsnlmwcqk,
		NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm') and to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')>=to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')),0) as bnwcje,
		NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')>=to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')),0) as bnlqlmwcqk,
		NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and to_date(to_char(sj.sjkgsj,'yyyy-mm'),'yyyy-mm')>=to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')),0) as bnsnlmwcqk,
		sj.remarks as bz,sj.xmmc as xmmc,lx.*
		from plan_gcsj sj inner join (select l.jhid, replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,
     	replace(WMSYS.WM_CONCAT(to_char(l.xmlc)),',','、') as xmlc,
     	replace(WMSYS.WM_CONCAT(to_char(l.yjsdj)),',','、') as yjsdj from plan_lx_gcsj l where ${gydw} and ${xzqh} group by l.jhid) lx on sj.id=lx.jhid 
     	where sj.jhnf=#{sbnf} and sj.jh_sbthcd=6
     	<if test="xmmc!=null and xmmc!=''">sj.xmmc like '%'||#{xmmc}||'%'</if>
     	<if test="lxmc!=null and lxmc!=''">lx.lxbm like '%'||#{lxmc}||'%'</if>
	</select>
	<resultMap type="gcbb5" id="gcbb5Map">
		<result property="xmmc" column="xmmc"/>
		<result property="jhnf" column="jhnf"/>
		<result property="jsxz" column="jsxz"/>
		<result property="pfztz" column="pfztz"/>
		<result property="cgs" column="cgs"/>
		<result property="dfpt" column="dfpt"/>
		<result property="bndjhtz" column="bndjhtz"/>
		<result property="bnzycgs" column="bnzycgs"/>
		<result property="bndsslc" column="bndsslc"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="kgsj" column="kgsj"/>
		<result property="jgsj" column="jgsj"/>
		<result property="bnzycgs1" column="bnzycgs1"/>
		<result property="bnqtzj" column="bnqtzj"/>
		<result property="bnwctz" column="bnwctz"/>
		<result property="bnwcgzl" column="bnwcgzl"/>
		<result property="zjwctz" column="zjwctz"/>
		<result property="zjwcgzl" column="zjwcgzl"/>
		<result property="ssdctc" column="ssdctc"/>
		<result property="jsjsbz" column="jsjsbz"/>
		<result property="bnlqlmwcqk" column="bnlqlmwcqk"/>
		<result property="bnsnlmwcqk" column="bnsnlmwcqk"/>
		<result property="zjlqlmwcqk" column="zjlqlmwcqk"/>
		<result property="zjsnlmwcqk" column="zjsnlmwcqk"/>
		<collection property="gcgjlx" column="jhid" javaType="ArrayList" ofType="plan_lx_gcgj" resultMap="gjmap5"/>
		<collection property="gcshlx" column="jhid" javaType="ArrayList" ofType="plan_lx_shuih" resultMap="shmap5"/>
		<collection property="gcsjlx" column="jhid" javaType="ArrayList" ofType="plan_lx_gcsj" resultMap="sjmap5"/>
	</resultMap>
	<resultMap type="plan_lx_gcgj" id="gjmap5">
		<result property="jhid" column="jhid"/>
		<result property="lxbm" column="gjlxbm"/>
		<result property="jsdd" column="gjjsdd"/>
		<result property="qdzh" column="gjqdzh"/>
		<result property="zdzh" column="gjzdzh"/>
		<result property="yhlc" column="gjyhlc"/>
		<result property="yjsdj" column="gjyjsdj"/>
		<result property="ylmlx" column="gjylmlx"/>
	</resultMap>
	<resultMap type="plan_lx_shuih" id="shmap5">
		<result property="jhid" column="jhid"/>
		<result property="jsdd" column="shjsdd"/>
		<result property="lxbm" column="shlxbm"/>
		<result property="qdzh" column="shqdzh"/>
		<result property="zdzh" column="shzdzh"/>
		<result property="yhlc" column="shyhlc"/>
		<result property="yjsdj" column="shyjsdj"/>
		<result property="ylmlx" column="shylmlx"/>
	</resultMap>
	<resultMap type="plan_lx_gcsj" id="sjmap5">
		<result property="xzqhmc" column="sjxzqhmc"/>
		<result property="lxbm" column="sjlxbm"/>
		<result property="qdzh" column="sjqdzh"/>
		<result property="zdzh" column="sjzdzh"/>
		<result property="xmlc" column="sjyhlc"/>
		<result property="yjsdj" column="sjyjsdj"/>
	</resultMap>
	<select id="selGcbb5_1" parameterType="xmbb" resultType="gcbb5">
		select gj.xmmc as xmmc,gj.sbnf as jhnf,'改建' as jsxz,gj.pfztz as pfztz,gj.jhsybzje as cgs,(gj.pfztz-gj.jhsybzje) as dfpt,
		(select zj.xdzj from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=gj.id) as bndjhtz,
		(select zj.btzzj from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=gj.id) as bnzycgs,
		(select sum(gcgj.bywcmc) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.id and to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcgj.sbyf,'yyyy-mm'),'yyyy')) as bndsslc,
		gj.kgzt as kgzt,gj.jgzt as jgzt,to_char(gj.sjkgsj,'yyyy-mm-dd') as kgsj,to_char(gj.sjwgsj,'yyyy-mm-dd') as jgsj,
		(select sum(c.cgsdwzj) from gcgl_cgs c where c.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(c.tbyf,'yyyy-mm') and to_date(c.tbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnzycgs1,
		(select sum(gcgj.zjdw_qttz) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm') and to_date(gcgj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnqtzj,
		(select sum(gcgj.wc_btz)+sum(gcgj.wc_stz)+sum(gcgj.wc_qttz) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm') and to_date(gcgj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnwctz,
		(select sum(gcgj.bywcmc) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm') and to_date(gcgj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnwcgzl,
		(select sum(gcgj.wc_btz)+sum(gcgj.wc_stz)+sum(gcgj.wc_qttz) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm')) as zjwctz,
		(select sum(gcgj.wc_btz)+sum(gcgj.wc_stz)+sum(gcgj.wc_qttz) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm')) as zjwctz,
		(select sum(gcgj.bywcmc) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm') and to_date(gcgj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as zjwcgzl,
		lx.* from plan_gcgj gj left join (select l.jhid,replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,
		replace(WMSYS.WM_CONCAT(to_char(l.jsdd)),',','、') as jsdd,replace(WMSYS.WM_CONCAT(to_char(l.qdzh)),',','、') as qdzh,
    	replace(WMSYS.WM_CONCAT(to_char(l.zdzh)),',','、') as zdzh,NVL(replace(WMSYS.WM_CONCAT(to_char(l.yhlc)),',','、'),0) as yhlc,
    	NVL(replace(WMSYS.WM_CONCAT(to_char(l.yjsdj)),',','、'),' ') as yjsdj,
    	NVL(replace(WMSYS.WM_CONCAT(to_char(l.ylmlx)),',','、'),' ') as ylmlx from plan_lx_gcgj l where ${gydw} and ${xzqh} 
    	group by l.jhid) lx on gj.id=lx.jhid 
    	where gj.jh_sbthcd=6 and gj.sbnf=#{sbnf}
    	<if test="lxmc!=null and lxmc!=''">and lx.lxbm like '%'||#{lxmc}||'%'</if>
    	<if test="xmmc!=null and xmmc!=''">and gj.xmmc like '%'||#{xmmc}||'%'</if>
    	<!-- and gj.tbbm like rtrim(#{gydw},0)||'%' and gj.tbbm like '%'||rtrim(#{xzqh},0)||'%'  -->
	</select>
	<select id="selGcbb5_2" parameterType="xmbb" resultType="gcbb5">
		select gj.id,gj.xmmc as xmmc,gj.sbnf as jhnf,'水毁' as jsxz,gj.pfztz as pfztz,gj.jhsybzje as cgs,(gj.pfztz-gj.jhsybzje) as dfpt,
	    (select zj.xdzj from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=gj.id) as bndjhtz,
	    (select zj.btzzj from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=gj.id) as bnzycgs,
	    (select sum(gcsh.bywcmc) from gcgl_sh gcsh where gcsh.jhid=gj.id and
	    to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcsh.sbyf,'yyyy-mm'),'yyyy')) as bndsslc,
	    gj.kgzt as kgzt,gj.jgzt as jgzt,to_char(gj.sjkgsj,'yyyy-mm-dd') as kgsj,to_char(gj.sjwgsj,'yyyy-mm-dd') as jgsj,
	    (select sum(c.cgsdwzj) from gcgl_cgs c where c.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(c.tbyf,'yyyy-mm') 
	    and to_date(c.tbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnzycgs1,
	    (select sum(gcsh.zjdw_qttz) from gcgl_sh gcsh where gcsh.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm') 
	    and to_date(gcsh.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnqtzj,
	    (select sum(gcsh.wc_btz)+sum(gcsh.wc_stz)+sum(gcsh.wc_qttz) from gcgl_sh gcsh where gcsh.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm') 
	    and to_date(gcsh.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnwctz,
	    (select sum(gcsh.bywcmc) from gcgl_sh gcsh where gcsh.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm') 
	    and to_date(gcsh.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnwcgzl,
	    (select sum(gcsh.wc_btz)+sum(gcsh.wc_stz)+sum(gcsh.wc_qttz) from gcgl_sh gcsh where gcsh.jhid=gj.id and 
	    to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm')) as zjwctz,
	    (select sum(gcsh.bywcmc) from gcgl_sh gcsh where gcsh.jhid=gj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm') 
	    and to_date(gcsh.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as zjwcgzl,lx.*
	    from plan_shuih gj left join (select sl.jhid,replace(WMSYS.WM_CONCAT(to_char(sl.lxbm)),',','、') as lxbm,
	    replace(WMSYS.WM_CONCAT(to_char(sl.jsdd)),',','、') as jsdd,
      	replace(WMSYS.WM_CONCAT(to_char(sl.qdzh)),',','、') as qdzh,replace(WMSYS.WM_CONCAT(to_char(sl.zdzh)),',','、') as zdzh,
      	NVL(replace(WMSYS.WM_CONCAT(to_char(sl.yhlc)),',','、'),0) as yhlc,NVL(replace(WMSYS.WM_CONCAT(to_char(sl.yjsdj)),',','、'),' ') as yjsdj,
      	NVL(replace(WMSYS.WM_CONCAT(to_char(sl.ylmlx)),',','、'),' ') as ylmlx from plan_lx_shuih sl where ${gydw} and ${xzqh}
      	group by sl.jhid) lx on gj.id=lx.jhid 
      	where gj.jh_sbthcd=6 and gj.sbnf=#{sbnf}
      	<if test="lxmc!=null and lxmc!=''">and lx.lxbm like '%'||#{lxmc}||'%'</if>
      	<if test="xmmc!=null and xmmc!=''">and gj.xmmc like '%'||#{xmmc}||'%'</if>
	</select>
	<select id="selGcbb5_3" parameterType="xmbb" resultType="gcbb5">
		select sj.xmmc as xmmc,sj.jhnf as jhnf,'升级' as jsxz,sj.jsjsbz as jsjsbz,sj.pftz as pfztz,sj.jhsybbzje as cgs,(sj.pftz-sj.jhsybbzje) as dfpt,
		(select zj.xdzj from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=sj.id) as bndjhtz,
		(select zj.btzzj from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=sj.id) as bnzycgs,
		(select sum(gcsj.lqlmwcqk)+sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and
		to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcsj.sbyf,'yyyy-mm'),'yyyy')) as bndsslc,
		(select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and
		to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcsj.sbyf,'yyyy-mm'),'yyyy')) as bnlqlmwcqk,
		(select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and
		to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcsj.sbyf,'yyyy-mm'),'yyyy')) as bnsnlmwcqk,
		sj.kgzt as kgzt,sj.jgzt as jgzt,to_char(sj.sjkgsj,'yyyy-mm-dd') as kgsj,to_char(sj.sjwgsj,'yyyy-mm-dd') as jgsj,
		(select sum(c.cgsdwzj) from gcgl_cgs c where c.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(c.tbyf,'yyyy-mm') 
		and to_date(c.tbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnzycgs1,
		(select sum(gcsj.dfbz) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
		and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bndfpt,
		(select sum(gcsj.yhdk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
		and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnyhdk,
		(select sum(gcsj.qtzj) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
		and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnqtzj,
		(select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
		and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnwctz,
		(select sum(gcsj.bywcgzl) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
		and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as bnwcgzl,
		(select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and 
		to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm')) as zjwctz,
		(select sum(gcsj.bywcgzl) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.id and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
		and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(to_char(sysdate,'yyyy')||'-1','yyyy-mm')) as zjwcgzl,lx.*
		from plan_gcsj sj left join (select sjl.jhid,replace(WMSYS.WM_CONCAT(to_char(sjl.lxbm)),',','、') as lxbm,
		NVL(replace(WMSYS.WM_CONCAT(to_char(sjl.xzqhmc)),',','、'),' ') as jsdd,
	    replace(WMSYS.WM_CONCAT(to_char(sjl.qdzh)),',','、') as qdzh,replace(WMSYS.WM_CONCAT(to_char(sjl.zdzh)),',','、') as zdzh,
	    NVL(replace(WMSYS.WM_CONCAT(to_char(sjl.xmlc)),',','、'),0) as yhlc,NVL(replace(WMSYS.WM_CONCAT(to_char(sjl.yjsdj)),',','、'),' ') as yjsdj,
	    '' as ylmlx from plan_lx_gcsj sjl where ${gydw} and ${xzqh}
	    group by sjl.jhid) lx on sj.id=lx.jhid 
	    where sj.jh_sbthcd=6 and sj.jhnf=#{sbnf}
	    <if test="lxmc!=null and lxmc!=''">and lx.lxbm like '%'||#{lxmc}||'%'</if>
	    <if test="xmmc!=null and xmmc!=''">and sj.xmmc like '%'||#{xmmc}||'%'</if>
	    <!-- and sj.tbbm like rtrim(#{gydw},0)||'%' and sj.tbbm like '%'||rtrim(#{xzqh},0)||'%'  -->
	</select>
</mapper>