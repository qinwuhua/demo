<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.gcbb">
	<resultMap id="gjjd" type="gcgjjd">
		<id property="jhid" column="jhid" />
		<result property="sfgyhbm" column="sfgyhbm"/>
		<result property="jsdd" column="jsdd"/>
		<result property="lxbm" column="lxbm"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="yhlc" column="yhlc"/>
		<result property="yhlb" column="yhlb"/>
		<result property="sjkgsj" column="sjkgsj"/>
		<result property="sjwgsj" column="sjwgsj"/>
		<result property="ylmlx" column="ylmlx"/>
		<result property="sjlmlx" column="sjlmlx"/>
		<result property="dc" column="dc"/>
		<result property="bywcdc" column="bywcdc"/>
		<result property="bnwcdc" column="bnwcdc"/>
		<result property="zjwcdc" column="zjwcdc"/>
		<result property="jc" column="jc"/>
		<result property="bywcjc" column="bywcjc"/>
		<result property="bnwcjc" column="bnwcjc"/>
		<result property="zjwcjc" column="zjwcjc"/>
		<result property="mc" column="mc"/>
		<result property="bywcmc" column="bywcmc"/>
		<result property="bnwcmc" column="bnwcmc"/>
		<result property="zjwcmc" column="zjwcmc"/>
		<result property="pfztz" column="pfztz"/>
		<result property="gys" column="gys"/>
		<result property="bywcje" column="bywcje"/>
		<result property="bnwcje" column="bnwcje"/>
		<result property="zjwcje" column="zjwcje"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="xmmc" column="xmmc"/>
		<result property="bz" column="bz"/>
		<collection property="gjjdlx" column="jhid" javaType="ArrayList" ofType="plan_lx_gcgj" resultMap="gjjd_lx"/>
		<collection property="shjdlx" column="jhid" javaType="ArrayList" ofType="plan_lx_shuih" resultMap="shjd_lx"/>
	</resultMap>
	<resultMap id="gjjd_lx" type="plan_lx_gcgj">
		<result property="jhid" column="jhid"/>
		<result property="jsdd" column="jsdd"/>
		<result property="lxbm" column="lxbm"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="yhlc" column="yhlc"/>
		<result property="ylmlx" column="ylmlx"/>
	</resultMap>
	<resultMap id="shjd_lx" type="plan_lx_shuih">
		<result property="jhid" column="jhid"/>
		<result property="jsdd" column="jsdd"/>
		<result property="lxbm" column="lxbm"/>
		<result property="qdzh" column="qdzh"/>
		<result property="zdzh" column="zdzh"/>
		<result property="yhlc" column="yhlc"/>
		<result property="ylmlx" column="ylmlx"/>
	</resultMap>
	<select id="selGcgjJdbb" parameterType="xmbb" resultType="gcgjjd">
		select gj.xmbm as jhid,
	    gj.sfgk as sfgyhbm,' ' as yhlb,gj.sjkgsj as sjkgsj,gj.sjwgsj as sjwgsj,' ' as sjlmlx,
	    ' ' as dc,
	    NVL((select gjgc.bywcdc from gcgl_gcgzgj gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=gj.xmbm),0) bywcdc,
	    NVL((select sum(gjgc.bywcdc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.xmbm and 
	    to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcdc ]]>,
	    NVL((select sum(gjgc.bywcdc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.xmbm),0) as zjwcdc,
	    ' ' as jc,
	    NVL((select gjgc.bywcjc from gcgl_gcgzgj gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=gj.xmbm),0) bywcjc,
	    NVL((select sum(gjgc.bywcjc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.xmbm and 
	    to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcjc ]]>,
	    NVL((select sum(gjgc.bywcjc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.xmbm),0) as zjwcjc,
	    ' ' as mc,
	    NVL((select gjgc.bywcmc from gcgl_gcgzgj gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=gj.xmbm),0) bywcmc,
	    NVL((select sum(gjgc.bywcmc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.xmbm and 
	    to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcmc ]]>,
	    NVL((select sum(gjgc.bywcmc) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.xmbm),0) as zjwcmc,
	    NVL(gj.pfztz,0) as pfztz,NVL(gj.gys,0) as gys,
	    NVL((select gjgc.wc_btz+gjgc.wc_stz+gjgc.wc_qttz from gcgl_gcgzgj gjgc where to_date(gjgc.sbyf,'yyyy-mm') = to_date(#{ybny},'yyyy-mm') and gjgc.jhid=gj.xmbm),0) as bywcje,
	    NVL((select sum(gjgc.wc_btz)+sum(gjgc.wc_stz)+sum(gjgc.wc_qttz) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.xmbm and 
	    to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcje ]]>,
	    NVL((select sum(gjgc.wc_btz)+sum(gjgc.wc_stz)+sum(gjgc.wc_qttz) from gcgl_gcgzgj gjgc where gjgc.jhid=gj.xmbm),0) as zjwcje,
	    gj.kgzt as kgzt,gj.jgzt as jgzt,gj.xmmc as xmmc,' ' as bz,lx.*
	    from jhsh_lmgz gj,(select l.xmid jhid,replace(WMSYS.WM_CONCAT(to_char(l.xzqh)),',','、') as jsdd,replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,
	    replace(WMSYS.WM_CONCAT(to_char(l.qdzh)),',','、') as qdzh,replace(WMSYS.WM_CONCAT(to_char(l.zdzh)),',','、') as zdzh,
	    replace(WMSYS.WM_CONCAT(to_char(l.lc)),',','、') as yhlc,' ' as ylmlx 
	    from lxsh_lx l where 1=1 and jdbs='2' ${xzqh} ${gydw} group by l.xmid) lx
	    where gj.xmbm=lx.jhid and gj.xmbm like #{sbnf}||'%'
		<if test="tiaojian!=null and tiaojian!=''">
			and lx.lxbm like #{tiaojian}||'%'
		</if>
		<if test="xmmc!=null and xmmc!=''">and gj.xmmc like '%'||#{xmmc}||'%'</if>
		<if test="lxmc!=null and lxmc!=''"> and lx.lxmc like '%'||#{lxmc}||'%'</if>
	</select>
	<select id="selShuihJdbb" parameterType="xmbb" resultType="gcgjjd">
		select sh.xmmc,sh.xmbm as jhid,sh.sfgk as sfgyhbm,sh.gcfl as yhlb,sh.sjkgsj as sjkgsj,
	    sh.sjwgsj as sjwgsj,' ' sjlmlx,
	    ' ' as dc,
	    NVL((select gjgc.bywcdc from gcgl_sh gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=sh.xmbm),0) bywcdc,
	    NVL((select sum(gjgc.bywcdc) from gcgl_sh gjgc where gjgc.jhid=sh.xmbm and 
	    to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcdc ]]>,
	    NVL((select sum(gjgc.bywcdc) from gcgl_sh gjgc where gjgc.jhid=sh.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(decode(substr(substr(sjkgsj, 0, 7),-1),'-',substr(sjkgsj, 0, 6),substr(sjkgsj, 0, 7)),'yyyy-mm')),0) as zjwcdc,
	    ' ' as jc,
	    NVL((select gjgc.bywcjc from gcgl_sh gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=sh.xmbm),0) bywcjc,
	    NVL((select sum(gjgc.bywcjc) from gcgl_sh gjgc where gjgc.jhid=sh.xmbm and 
	    to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcjc ]]>,
	    NVL((select sum(gjgc.bywcjc) from gcgl_sh gjgc where gjgc.jhid=sh.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(decode(substr(substr(sjkgsj, 0, 7),-1),'-',substr(sjkgsj, 0, 6),substr(sjkgsj, 0, 7)),'yyyy-mm')),0) as zjwcjc,
	    NVL(sh.lc,0) as mc,
	    NVL((select gjgc.bywcmc from gcgl_sh gjgc where to_date(gjgc.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and gjgc.jhid=sh.xmbm),0) bywcmc,
	    NVL((select sum(gjgc.bywcmc) from gcgl_sh gjgc where gjgc.jhid=sh.xmbm and 
	    to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcmc ]]>,
	    NVL((select sum(gjgc.bywcmc) from gcgl_sh gjgc where gjgc.jhid=sh.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(decode(substr(substr(sjkgsj, 0, 7),-1),'-',substr(sjkgsj, 0, 6),substr(sjkgsj, 0, 7)),'yyyy-mm')),0) as zjwcmc,
	    NVL(sh.pfztz,0) as pfztz,NVL(sh.gys,0) as gys,
	    NVL((select gjgc.wc_btz+gjgc.wc_stz+gjgc.wc_qttz from gcgl_sh gjgc where to_date(gjgc.sbyf,'yyyy-mm') = to_date(#{ybny},'yyyy-mm') and gjgc.jhid=sh.xmbm),0) as bywcje,
	    NVL((select sum(gjgc.wc_btz)+sum(gjgc.wc_stz)+sum(gjgc.wc_qttz) from gcgl_sh gjgc where gjgc.jhid=sh.xmbm and 
	    to_date(gjgc.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm') and <![CDATA[ to_date(gjgc.sbyf,'yyyy-mm') <= to_date(#{ybny},'yyyy-mm')),0) as bnwcje ]]>,
	    NVL((select sum(gjgc.wc_btz)+sum(gjgc.wc_stz)+sum(gjgc.wc_qttz) from gcgl_sh gjgc where to_date(#{ybny},'yyyy-mm') >= to_date(decode(substr(substr(sjkgsj, 0, 7),-1),'-',substr(sjkgsj, 0, 6),substr(sjkgsj, 0, 7)),'yyyy-mm') and gjgc.jhid=sh.xmbm),0) as zjwcje,
	    sh.kgzt as kgzt,sh.jgzt as jgzt,lx.*
	    from jhsh_sh sh,(select l.xmid jhid,replace(WMSYS.WM_CONCAT(to_char(l.xzqh)),',','、') as jsdd,replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,
	    replace(WMSYS.WM_CONCAT(to_char(l.qdzh)),',','、') as qdzh,replace(WMSYS.WM_CONCAT(to_char(l.zdzh)),',','、') as zdzh,replace(WMSYS.WM_CONCAT(to_char(l.lc)),',','、') as yhlc,
	    ' ' as ylmlx from lxsh_lx l where 1=1 and l.jdbs='2' ${xzqh} ${gydw} group by l.xmid) lx,xmsq_sh xmsq
	    where sh.xmbm=lx.jhid and sh.xmbm like #{sbnf}||'%' and sh.xmbm=xmsq.xmbm
		<if test="tiaojian!=null and tiaojian!=''">
			and lx.lxbm like #{tiaojian}||'%'
		</if>
		<if test="xmmc!=null and xmmc!=''">and sh.xmmc like '%'||#{xmmc}||'%'</if>
		<if test="lxmc!=null and lxmc!=''"> and lx.lxmc like '%'||#{lxmc}||'%'</if>
	</select>
	<select id="selYhdzxJdbb" parameterType="xmbb" resultType="gcgjjd">
		select lx.*,yh.xmmc as xmmc,yh.sfgk as sfgyhbm,yh.gcfl as yhlb,yh.sjkgsj as sjkgsj,yh.sjwgsj as sjwgsj,<!-- ,' ' sjlmlx,' ' ylmlx, -->
	    ' ' as dc,
	    NVL((select gcyh.bywcdc from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and to_date(gcyh.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) bywcdc,
	    NVL((select sum(gcyh.bywcdc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and 
	    to_date(#{ybny},'yyyy-mm') >= to_date(gcyh.sbyf,'yyyy-mm') and to_date(gcyh.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) bnwcdc,
	    NVL((select max(gcyh.bywcdc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(decode(substr(substr(sjkgsj, 0, 7),-1),'-',substr(sjkgsj, 0, 6),substr(sjkgsj, 0, 7)),'yyyy-mm')),0) zjwcdc,
	    NVL(yh.jcsl,0) as jc,
	    NVL((select gcyh.bywcjc from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and to_date(gcyh.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) bywcjc,
	    NVL((select max(gcyh.bywcjc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and 
	    to_date(#{ybny},'yyyy-mm') >= to_date(gcyh.sbyf,'yyyy-mm') and to_date(gcyh.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) bnwcjc,
	    NVL((select max(gcyh.bywcjc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(decode(substr(substr(sjkgsj, 0, 7),-1),'-',substr(sjkgsj, 0, 6),substr(sjkgsj, 0, 7)),'yyyy-mm')),0) zjwcjc,
	    NVL(yh.mcsl,0) as mc,
	    NVL((select gcyh.bywcmc from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and to_date(gcyh.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) bywcmc,
	    NVL((select max(gcyh.bywcmc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and 
	    to_date(#{ybny},'yyyy-mm') >= to_date(gcyh.sbyf,'yyyy-mm') and to_date(gcyh.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) bnwcmc,
	    NVL((select max(gcyh.bywcmc) from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(decode(substr(substr(sjkgsj, 0, 7),-1),'-',substr(sjkgsj, 0, 6),substr(sjkgsj, 0, 7)),'yyyy-mm')),0) zjwcmc,
	    NVL(yh.ztz,0) as pfztz,NVL(yh.gys,0) as gys,
	    NVL((select gcyh.wc_btz+gcyh.wc_stz+gcyh.wc_qttz from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and to_date(gcyh.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bywcje,
	    NVL((select sum(gcyh.wc_btz)+sum(gcyh.wc_stz)+sum(gcyh.wc_qttz) from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and 
	    to_date(#{ybny},'yyyy-mm') >= to_date(gcyh.sbyf,'yyyy-mm') and to_date(gcyh.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnwcje,
	    NVL((select  sum(gcyh.wc_btz)+sum(gcyh.wc_stz)+sum(gcyh.wc_qttz) from gcgl_yhdzx gcyh where gcyh.jhid=yh.xmbm and 
	    to_date(#{ybny},'yyyy-mm') >= to_date(decode(substr(substr(sjkgsj, 0, 7),-1),'-',substr(sjkgsj, 0, 6),substr(sjkgsj, 0, 7)),'yyyy-mm')),0) zjwcje,yh.kgzt as kgzt,yh.jgzt as jgzt
	    from (select l.xmid jhid,replace(WMSYS.WM_CONCAT(to_char(l.xzqh)),',','、') as jsdd,
	    replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,replace(WMSYS.WM_CONCAT(to_char(l.qdzh)),',','、') as qdzh,
	    replace(WMSYS.WM_CONCAT(to_char(l.zdzh)),',','、') as zdzh,replace(WMSYS.WM_CONCAT(to_char(l.lc)),',','、') as yhlc,
	    ' ' as ylmlx
	    from lxsh_lx l where 1=1 and jdbs='2' ${xzqh} ${gydw} <if test="lxmc!=null and lxmc!=''"> and l.lxbm like '%'||#{lxmc}||'%'</if>
	    group by l.xmid) 
	    lx right join jhsh_yhdzx yh on lx.jhid=yh.xmbm 
	    where  yh.xmbm like #{sbnf}||'%'
		<if test="tiaojian!=null and tiaojian!=''">
			and lx.lxbm like #{tiaojian}||'%'
		</if>
		<if test="xmmc!=null and xmmc!=''">and yh.xmmc like '%'||#{xmmc}||'%'</if>
		<if test="lxmc!=null and lxmc!=''"> and lx.lxmc like '%'||#{lxmc}||'%'</if>
	</select>
	<select id="selGcsjJdbb" parameterType="xmbb" resultType="elist">
		select ${sql} from(
		select  rank() over(order by tab.jhid) xh,tab.* from(
			select substr(sj.xmbm,0,4) as jhnf,sj.sjkgsj as sjkgsj,
	    sj.pfztz as pftz,' ' as ljtsf,cbsj.ql as ql,cbsj.ql_ym as ql_m,cbsj.hd as hd,cbsj.sd as sd,
	    cbsj.sd_ym as sd_m,cbsj.dc as dc,cbsj.jc as jc,' ' as lqlm,' ' as snlm,
	    NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bywcje,
	    NVL((select sum(gcsj.ljtsfwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bywcljtsf,
	    NVL((select sum(gcsj.qlwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byqlwcqk_z,
	    NVL((select sum(gcsj.qlwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byqlwcqk_ym,
	    NVL((select sum(gcsj.hdwcqk_m) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byhdwcqk_m,
	    NVL((select sum(gcsj.sdwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysdwcqk_z,
	    NVL((select sum(gcsj.sdwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysdwcqk_ym,
	    NVL((select sum(gcsj.dcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bydcwcqk,
	    NVL((select sum(gcsj.jcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byjcwcqk,
	    NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bylqlmwcqk,
	    NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysnlmwcqk,
	    NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjwcje,
	    NVL((select sum(gcsj.ljtsfwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjwcljtsf,
	    NVL((select sum(gcsj.qlwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjqlwcqk_z,
	    NVL((select sum(gcsj.qlwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjqlwcqk_ym,
	    NVL((select sum(gcsj.hdwcqk_m) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjhdwcqk_m,
	    NVL((select sum(gcsj.sdwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjsdwcqk_z,
	    NVL((select sum(gcsj.sdwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjsdwcqk_ym,
	    NVL((select sum(gcsj.dcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjdcwcqk,
	    NVL((select sum(gcsj.jcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjjcwcqk,
	    NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjlqlmwcqk,
	    NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjsnlmwcqk,
	    NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm') and to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')>=to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnwcje,
	    NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')>=to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnlqlmwcqk,
	    NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')>=to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnsnlmwcqk,
	    ' ' as bz,sj.xmmc as xmmc,lx.*
	    from jhsh_sjgz sj inner join (select l.xmid jhid, replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,
	      replace(WMSYS.WM_CONCAT(to_char(l.lc)),',','、') as xmlc,
	      replace(WMSYS.WM_CONCAT(to_char(l.xjsdj)),',','、') as yjsdj,replace(WMSYS.WM_CONCAT(to_char(l.jsjsdj)),',','、') as jsjsbz from lxsh_lx l where 1=1 and jdbs='2' ${gydw} ${xzqh} group by l.xmid) lx on sj.xmbm=lx.jhid left join cbsj_sjgz cbsj on sj.xmbm=cbsj.xmbm
     	<if test="tiaojian!=null and tiaojian!=''">
     	 and ${tiaojian}
	    </if>
	    <if test="sbnf!=null and sbnf!=''">
	      and ${sbnf}
	    </if>
     	<if test="xmmc!=null and xmmc!=''">sj.xmmc like '%'||#{xmmc}||'%'</if>
     	<if test="lxmc!=null and lxmc!=''">lx.lxmc like '%'||#{lxmc}||'%'</if>
     	union all
     	select substr(sj.xmbm,0,4) as jhnf,sj.sjkgsj as sjkgsj,
      sj.pfztz as pftz,' ' as ljtsf,cbsj.ql as ql,cbsj.ql_ym as ql_m,cbsj.hd as hd,cbsj.sd as sd,
      cbsj.sd_ym as sd_m,cbsj.dc as dc,cbsj.jc as jc,' ' as lqlm,' ' as snlm,
      NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bywcje,
      NVL((select sum(gcsj.ljtsfwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bywcljtsf,
      NVL((select sum(gcsj.qlwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byqlwcqk_z,
      NVL((select sum(gcsj.qlwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byqlwcqk_ym,
      NVL((select sum(gcsj.hdwcqk_m) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byhdwcqk_m,
      NVL((select sum(gcsj.sdwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysdwcqk_z,
      NVL((select sum(gcsj.sdwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysdwcqk_ym,
      NVL((select sum(gcsj.dcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bydcwcqk,
      NVL((select sum(gcsj.jcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as byjcwcqk,
      NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bylqlmwcqk,
      NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm')),0) as bysnlmwcqk,
      NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjwcje,
      NVL((select sum(gcsj.ljtsfwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjwcljtsf,
      NVL((select sum(gcsj.qlwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjqlwcqk_z,
      NVL((select sum(gcsj.qlwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjqlwcqk_ym,
      NVL((select sum(gcsj.hdwcqk_m) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjhdwcqk_m,
      NVL((select sum(gcsj.sdwcqk_z) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjsdwcqk_z,
      NVL((select sum(gcsj.sdwcqk_ym) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjsdwcqk_ym,
      NVL((select sum(gcsj.dcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjdcwcqk,
      NVL((select sum(gcsj.jcwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjjcwcqk,
      NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjlqlmwcqk,
      NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')),0) as zjsnlmwcqk,
      NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm') and to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')>=to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnwcje,
      NVL((select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')>=to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnlqlmwcqk,
      NVL((select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(gcsj.sbyf,'yyyy-mm')=to_date(#{ybny},'yyyy-mm') and to_date(substr(sj.sjkgsj,0,instr(sj.sjkgsj,'-',-1)-1),'yyyy-mm')>=to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnsnlmwcqk,
      ' ' as bz,sj.xmmc as xmmc,lx.*
      from jhsh_xj sj inner join (select l.xmid jhid, replace(WMSYS.WM_CONCAT(to_char(l.xjlxbm)),',','、') as lxbm,
        replace(WMSYS.WM_CONCAT(to_char(l.lc)),',','、') as xmlc,
        replace(WMSYS.WM_CONCAT(to_char(l.xjsdj)),',','、') as yjsdj,replace(WMSYS.WM_CONCAT(to_char(l.jsjsdj)),',','、') as jsjsbz from lxsh_lx l where 1=1 and jdbs='2' ${gydw} ${xzqh} group by l.xmid) lx on sj.xmbm=lx.jhid left join cbsj_xj cbsj on sj.xmbm=cbsj.xmbm
      	<if test="tiaojian!=null and tiaojian!=''">
     	 and ${tiaojian}
	    </if>
	    <if test="sbnf!=null and sbnf!=''">
	      and ${sbnf}
	    </if>
      	<if test="xmmc!=null and xmmc!=''">sj.xmmc like '%'||#{xmmc}||'%'</if>
      	<if test="lxmc!=null and lxmc!=''">lx.lxmc like '%'||#{lxmc}||'%'</if>
		)tab
			
		)
		
	</select>
	<resultMap type="gcbb5" id="gcbb5Map">
		<result property="xmmc" column="xmmc"/>
		<result property="jhnf" column="jhnf"/>
		<result property="jsxz" column="jsxz"/>
		<result property="pfztz" column="pfztz"/>
		<result property="cgs" column="cgs"/>
		<result property="dfpt" column="dfpt"/>
		<result property="bndjhtz" column="bndjhtz"/>
		<result property="bnzycgs" column="bnzycgs"/>
		<result property="bndsslc" column="bndsslc"/>
		<result property="kgzt" column="kgzt"/>
		<result property="jgzt" column="jgzt"/>
		<result property="kgsj" column="kgsj"/>
		<result property="jgsj" column="jgsj"/>
		<result property="bnzycgs1" column="bnzycgs1"/>
		<result property="bnqtzj" column="bnqtzj"/>
		<result property="bnwctz" column="bnwctz"/>
		<result property="bnwcgzl" column="bnwcgzl"/>
		<result property="zjwctz" column="zjwctz"/>
		<result property="zjwcgzl" column="zjwcgzl"/>
		<result property="ssdctc" column="ssdctc"/>
		<result property="jsjsbz" column="jsjsbz"/>
		<result property="bnlqlmwcqk" column="bnlqlmwcqk"/>
		<result property="bnsnlmwcqk" column="bnsnlmwcqk"/>
		<result property="zjlqlmwcqk" column="zjlqlmwcqk"/>
		<result property="zjsnlmwcqk" column="zjsnlmwcqk"/>
		<collection property="gcgjlx" column="jhid" javaType="ArrayList" ofType="plan_lx_gcgj" resultMap="gjmap5"/>
		<collection property="gcshlx" column="jhid" javaType="ArrayList" ofType="plan_lx_shuih" resultMap="shmap5"/>
		<collection property="gcsjlx" column="jhid" javaType="ArrayList" ofType="plan_lx_gcsj" resultMap="sjmap5"/>
	</resultMap>
	<resultMap type="plan_lx_gcgj" id="gjmap5">
		<result property="jhid" column="jhid"/>
		<result property="lxbm" column="gjlxbm"/>
		<result property="jsdd" column="gjjsdd"/>
		<result property="qdzh" column="gjqdzh"/>
		<result property="zdzh" column="gjzdzh"/>
		<result property="yhlc" column="gjyhlc"/>
		<result property="yjsdj" column="gjyjsdj"/>
		<result property="ylmlx" column="gjylmlx"/>
	</resultMap>
	<resultMap type="plan_lx_shuih" id="shmap5">
		<result property="jhid" column="jhid"/>
		<result property="jsdd" column="shjsdd"/>
		<result property="lxbm" column="shlxbm"/>
		<result property="qdzh" column="shqdzh"/>
		<result property="zdzh" column="shzdzh"/>
		<result property="yhlc" column="shyhlc"/>
		<result property="yjsdj" column="shyjsdj"/>
		<result property="ylmlx" column="shylmlx"/>
	</resultMap>
	<resultMap type="plan_lx_gcsj" id="sjmap5">
		<result property="xzqhmc" column="sjxzqhmc"/>
		<result property="lxbm" column="sjlxbm"/>
		<result property="qdzh" column="sjqdzh"/>
		<result property="zdzh" column="sjzdzh"/>
		<result property="xmlc" column="sjyhlc"/>
		<result property="yjsdj" column="sjyjsdj"/>
	</resultMap>
	<select id="selGcbb5_1" parameterType="xmbb" resultType="gcbb5">
		select gj.xmmc as xmmc,substr(gj.xmbm,0,4) as jhnf,'路面改造' as jsxz,decode(gj.pfztz,'',0,null,0,gj.pfztz) as pfztz,gj.bbzzj as cgs,gj.sbzzj as dfpt,
	    (select sum(zj.xdzj) from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=gj.xmbm) as bndjhtz,
	    (select sum(zj.btzzj) from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=gj.xmbm) as bnzycgs,
	    NVL((select sum(gcgj.bywcmc) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.xmbm and to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcgj.sbyf,'yyyy-mm'),'yyyy')),0) as bndsslc,
	    gj.kgzt as kgzt,gj.jgzt as jgzt,gj.sjkgsj as kgsj,gj.sjwgsj as jgsj,
	    (select sum(c.cgsdwzj) from gcgl_cgs c where c.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(c.tbyf,'yyyy-mm') and to_date(c.tbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnzycgs1,
	    (select sum(gcgj.zjdw_qttz) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm') and to_date(gcgj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnqtzj,
	    (select sum(gcgj.wc_btz)+sum(gcgj.wc_stz)+sum(gcgj.wc_qttz) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm') and to_date(gcgj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnwctz,
	    NVL((select sum(gcgj.bywcmc) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm') and to_date(gcgj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnwcgzl,
	    NVL((select sum(gcgj.wc_btz)+sum(gcgj.wc_stz)+sum(gcgj.wc_qttz) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm')),0) as zjwctz,
	    (select sum(gcgj.wc_btz)+sum(gcgj.wc_stz)+sum(gcgj.wc_qttz) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm')) as zjwctz,
	    NVL((select sum(gcgj.bywcmc) from gcgl_gcgzgj gcgj where gcgj.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcgj.sbyf,'yyyy-mm') and to_date(gcgj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as zjwcgzl,
	    lx.* from jhsh_lmgz gj left join (select l.xmid jhid,replace(WMSYS.WM_CONCAT(to_char(l.lxbm)),',','、') as lxbm,
	    replace(WMSYS.WM_CONCAT(to_char(l.xzqh)),',','、') as jsdd,replace(WMSYS.WM_CONCAT(to_char(l.qdzh)),',','、') as qdzh,
	      replace(WMSYS.WM_CONCAT(to_char(l.zdzh)),',','、') as zdzh,NVL(replace(WMSYS.WM_CONCAT(to_char(l.lc)),',','、'),0) as yhlc,
	      NVL(replace(WMSYS.WM_CONCAT(to_char(l.xjsdj)),',','、'),' ') as yjsdj,
	      ' ' as ylmlx from lxsh_lx l where 1=1 and jdbs='2' ${gydw} ${xzqh} 
	      group by l.xmid) lx on gj.xmbm=lx.jhid 
	      where 1=1 
	      
	      and gj.xmbm like #{sbnf}||'%'
    	<if test="tiaojian!=null and tiaojian!=''">
			and lx.lxbm like '%'||#{tiaojian}||'%'
		</if>
    	<if test="lxmc!=null and lxmc!=''">and lx.lxbm like '%'||#{lxmc}||'%'</if>
    	<if test="xmmc!=null and xmmc!=''">and gj.xmmc like '%'||#{xmmc}||'%'</if>
    	<!-- and gj.tbbm like rtrim(#{gydw},0)||'%' and gj.tbbm like '%'||rtrim(#{xzqh},0)||'%'  -->
	</select>
	<select id="selGcbb5_2" parameterType="xmbb" resultType="gcbb5">
		  select gj.xmbm,gj.xmmc as xmmc,substr(gj.xmbm,0,4) as jhnf,'灾毁重建' as jsxz,decode(gj.pfztz,'',0,null,0,gj.pfztz) as pfztz,gj.bbzzj as cgs,gj.sbzzj as dfpt,
        (select sum(zj.xdzj) from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=gj.xmbm) as bndjhtz,
        (select sum(zj.btzzj) from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=gj.xmbm) as bnzycgs,
        NVL((select sum(gcsh.bywcmc) from gcgl_sh gcsh where gcsh.jhid=gj.xmbm and
        to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcsh.sbyf,'yyyy-mm'),'yyyy')),0) as bndsslc,
        gj.kgzt as kgzt,gj.jgzt as jgzt,gj.sjkgsj as kgsj,gj.sjwgsj as jgsj,
        (select sum(c.cgsdwzj) from gcgl_cgs c where c.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(c.tbyf,'yyyy-mm') 
        and to_date(c.tbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnzycgs1,
        (select sum(gcsh.zjdw_qttz) from gcgl_sh gcsh where gcsh.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm') 
        and to_date(gcsh.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnqtzj,
        (select sum(gcsh.wc_btz)+sum(gcsh.wc_stz)+sum(gcsh.wc_qttz) from gcgl_sh gcsh where gcsh.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm') 
        and to_date(gcsh.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnwctz,
        NVL((select sum(gcsh.bywcmc) from gcgl_sh gcsh where gcsh.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm') 
        and to_date(gcsh.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnwcgzl,
        (select sum(gcsh.wc_btz)+sum(gcsh.wc_stz)+sum(gcsh.wc_qttz) from gcgl_sh gcsh where gcsh.jhid=gj.xmbm and 
        to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm')) as zjwctz,
        NVL((select sum(gcsh.bywcmc) from gcgl_sh gcsh where gcsh.jhid=gj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsh.sbyf,'yyyy-mm') 
        and to_date(gcsh.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as zjwcgzl,lx.*
        from jhsh_sh gj left join (select sl.xmid jhid,replace(WMSYS.WM_CONCAT(to_char(sl.lxbm)),',','、') as lxbm,
        replace(WMSYS.WM_CONCAT(to_char(sl.xzqh)),',','、') as jsdd,
        replace(WMSYS.WM_CONCAT(to_char(sl.qdzh)),',','、') as qdzh,replace(WMSYS.WM_CONCAT(to_char(sl.zdzh)),',','、') as zdzh,
        NVL(replace(WMSYS.WM_CONCAT(to_char(sl.lc)),',','、'),0) as yhlc,NVL(replace(WMSYS.WM_CONCAT(to_char(sl.xjsdj)),',','、'),' ') as yjsdj,
        ' ' as ylmlx from lxsh_lx sl where 1=1 and jdbs='2' ${gydw} ${xzqh} 
        group by sl.xmid) lx on gj.xmbm=lx.jhid 
        where 1=1 and gj.xmbm like #{sbnf}||'%'
      	<if test="tiaojian!=null and tiaojian!=''">
			and lx.lxbm like '%'||#{tiaojian}||'%'
		</if>
      	<if test="lxmc!=null and lxmc!=''">and lx.lxbm like '%'||#{lxmc}||'%'</if>
      	<if test="xmmc!=null and xmmc!=''">and gj.xmmc like '%'||#{xmmc}||'%'</if>
	</select>
	<select id="selGcbb5_3" parameterType="xmbb" resultType="gcbb5">
		select sj.xmmc as xmmc,substr(sj.xmbm,0,4) as jhnf,'升级改造' as jsxz,' ' as jsjsbz,decode(sj.pfztz,'',0,null,0,sj.pfztz) as pfztz,sj.bbzzj as cgs,sj.sbzzj as dfpt,
	    (select sum(zj.xdzj) from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=sj.xmbm) as bndjhtz,
	    (select sum(zj.btzzj) from plan_zjxd zj where zj.xdnf=to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') and zj.xmid=sj.xmbm) as bnzycgs,
	    NVL((select sum(gcsj.lqlmwcqk)+sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and
	    to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcsj.sbyf,'yyyy-mm'),'yyyy')),0) as bndsslc,
	    (select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and
	    to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcsj.sbyf,'yyyy-mm'),'yyyy')) as bnlqlmwcqk,
	    (select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and
	    to_char(to_date(#{ybny},'yyyy-mm'),'yyyy') = to_char(to_date(gcsj.sbyf,'yyyy-mm'),'yyyy')) as bnsnlmwcqk,
	    (select sum(gcsj.lqlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm')) as zjlqlmwcqk,
	    (select sum(gcsj.snlmwcqk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm')) as zjsnlmwcqk,
	    sj.kgzt as kgzt,sj.jgzt as jgzt,sj.sjkgsj as kgsj,sj.sjwgsj as jgsj,
	    (select sum(c.cgsdwzj) from gcgl_cgs c where c.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(c.tbyf,'yyyy-mm') 
	    and to_date(c.tbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnzycgs1,
	    (select sum(gcsj.dfbz) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
	    and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bndfpt,
	    (select sum(gcsj.yhdk) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
	    and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnyhdk,
	    (select sum(gcsj.qtzj) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
	    and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnqtzj,
	    (select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
	    and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')) as bnwctz,
	    NVL((select sum(gcsj.bywcgzl) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
	    and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as bnwcgzl,
	    NVL((select sum(gcsj.bywctze) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and 
	    to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm')),0) as zjwctz,
	    NVL((select sum(gcsj.bywcgzl) from gcgl_gcgzsj gcsj where gcsj.jhid=sj.xmbm and to_date(#{ybny},'yyyy-mm') >= to_date(gcsj.sbyf,'yyyy-mm') 
	    and to_date(gcsj.sbyf,'yyyy-mm') >= to_date(substr(#{ybny},0,4)||'-1','yyyy-mm')),0) as zjwcgzl,lx.*
	    from jhsh_sjgz sj left join (select sjl.xmid jhid,replace(WMSYS.WM_CONCAT(to_char(sjl.lxbm)),',','、') as lxbm,
	    NVL(replace(WMSYS.WM_CONCAT(to_char(sjl.xzqh)),',','、'),' ') as jsdd,
	    replace(WMSYS.WM_CONCAT(to_char(sjl.qdzh)),',','、') as qdzh,replace(WMSYS.WM_CONCAT(to_char(sjl.zdzh)),',','、') as zdzh,
	    NVL(replace(WMSYS.WM_CONCAT(to_char(sjl.lc)),',','、'),0) as yhlc,NVL(replace(WMSYS.WM_CONCAT(to_char(sjl.xjsdj)),',','、'),' ') as yjsdj,
	    ' ' as ylmlx from lxsh_lx sjl where 1=1 and jdbs='2' ${gydw} ${xzqh} 
	    group by sjl.xmid) lx on sj.xmbm=lx.jhid 
	    where 1=1 and sj.xmbm like #{sbnf}||'%'
	    <if test="tiaojian!=null and tiaojian!=''">
			and lx.lxbm like '%'||#{tiaojian}||'%'
		</if>
	    <if test="lxmc!=null and lxmc!=''">and lx.lxbm like '%'||#{lxmc}||'%'</if>
	    <if test="xmmc!=null and xmmc!=''">and sj.xmmc like '%'||#{xmmc}||'%'</if>
	    <!-- and sj.tbbm like rtrim(#{gydw},0)||'%' and sj.tbbm like '%'||rtrim(#{xzqh},0)||'%'  -->
	</select>
</mapper>
