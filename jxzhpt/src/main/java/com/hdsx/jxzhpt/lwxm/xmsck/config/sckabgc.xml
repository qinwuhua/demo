<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.sckabgc">
<insert id="insertSckabgc"  parameterType="sckabgc">
	insert into sck_abgc(sckid,xmkid,scqdzh,sczdzh,sczlc,scyhlc,tzgs,spwh,fapgdw,fascdw,faspsj,jsxz,jsnr,scbz,scbmbm,sck_sbzt,sck_shzt,sck_lxbm,sck_lxmc,sck_sbthcd,lrjh,bzls)
		values(sys_guid(),#{xmkid},#{scqdzh},#{sczdzh},#{sczlc},#{scyhlc},#{tzgs},#{spwh},#{fapgdw},#{fascdw},#{faspsj},#{jsxz},#{jsnr},#{scbz},
		#{scbmbm},'未上报','未审核',#{lxbm},#{lxmc},#{sck_sbthcd},'未列入',#{bzls})
</insert>
<insert id="lrjhSckabgc"  parameterType="java.util.List">
	insert into plan_abgc(sckid,xdzt) values(#{String},'未下达')
</insert>
 <insert id="xglrjhSckabgc"  parameterType="java.util.List">
	update sck_abgc set lrjh='已列入'  where sckid=#{String}
</insert>
 
 <select id="selectSckabgc" parameterType="hashmap" resultType="sckabgc">
 	select * from (
 		select rownum num ,t.*,decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt) sck_sbzt2 from 
 			(select * from sck_abgc t join xmk_abgc on xmkid=xmk_abgc.id) t where 1=1
 			and  sck_sbthcd &lt;=#{sck_sbthcd}
  		<if test="gydw!='' and gydw!= null "  >
 			and tbbmbm in(select id from xtgl_department where id like #{gydw}||'%' or parent like #{gydw}||'%')
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm in(select id from xtgl_xzqh
 			where id=#{xzqhmc} or parent=#{xzqhmc})
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sck_sbzt2,sck_shzt,bzls
 </select>
  <select id="selectAbgcCount" parameterType="hashmap" resultType="int">
 		select count(*) from (select * from sck_abgc t join xmk_abgc on xmkid=xmk_abgc.id) t where 1=1
 			and  sck_sbthcd &lt;=#{sck_sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and scbmbm in(select id from xtgl_department where id like #{gydw}||'%' or parent like #{gydw}||'%')
 		</if>
  		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm in(select id from xtgl_xzqh
 			where id=#{xzqhmc} or parent=#{xzqhmc})
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sck_sbthcd,#{sck_sbthcd},'未上报',sck_sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 </select>
 <select id="selectSckabgcById" parameterType="sckabgc" resultType="sckabgc">
 	select * from sck_abgc t join xmk_abgc on xmkid=xmk_abgc.id where sckid=#{sckid}
 </select>
 <update id="updateSckabgc" parameterType="sckabgc" >
 	update sck_abgc set scqdzh=#{scqdzh},sczdzh=#{sczdzh},sczlc=#{sczlc},scyhlc=#{scyhlc},tzgs=#{tzgs},spwh=#{spwh},
 	fapgdw=#{fapgdw},fascdw=#{fascdw},faspsj=#{faspsj},jsxz=#{jsxz},jsnr=#{jsnr},scbz=#{scbz}
 	where sckid=#{sckid}
 </update>
 
 <delete id="deleteSckAbgc" parameterType="java.util.List" >
 	delete from sck_abgc where sckid =#{String}
 </delete>
 
 <update id="xgSckAbgcSbzt" parameterType="hashmap" >
 	update sck_abgc set sck_sbzt='已上报', sck_sbsj=sysdate,sck_sbbm=#{sck_sbbm},
 		sck_sbthcd=#{sck_sbthcd} where sckid =#{sckid}
 </update>
 
  <update id="xgSckAbgcShzt" parameterType="hashmap" >
 	update sck_abgc set sck_shzt='已审核',sck_shsj=sysdate,sck_shbm=#{sck_shbm} where sckid=#{sckid}
 </update>

 <update id="xgSckAbgcTH" parameterType="java.util.List">
	update sck_abgc set sck_sbthcd=(sck_sbthcd+2) where sckid =#{String}
</update>
 
  <select id="selectSckShabgc" parameterType="hashmap" resultType="sckabgc">
 	select * from (
 		select rownum num ,t.* from (select * from sck_abgc t join xmk_abgc on xmkid=xmk_abgc.id) t 
 		where sck_sbzt='已上报' and sck_sbthcd=7
			and sck_sbthcd>=#{sck_sbthcd}
  		<if test="gydw!='' and gydw!= null "  >
 			and scbmbm in(select id from xtgl_department where id like #{gydw}||'%' or parent like #{gydw}||'%')
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm in(select id from xtgl_xzqh
 			where id=#{xzqhmc} or parent=#{xzqhmc})
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and sck_shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sck_shzt desc
 </select>
  <select id="selectAbgcShCount" parameterType="hashmap" resultType="int">
 		select count(*) from (select * from sck_abgc t join xmk_abgc on xmkid=xmk_abgc.id)
 		 where sck_sbzt='已上报' and sck_sbthcd=7
			and sck_sbthcd>=#{sck_sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and scbmbm in(select id from xtgl_department where id like #{gydw}||'%' or parent like #{gydw}||'%')
 		</if>
  		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm in(select id from xtgl_xzqh
 			where id=#{xzqhmc} or parent=#{xzqhmc})
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and sck_shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 		<if test="bzls!='' and bzls!= null ">
 			and bzls like #{bzls}||'%'
 		</if>
 </select>
 <select id="onceSckAbgc" parameterType="sckabgc" resultType="int">
		select count(*) from sck_abgc where lrjh='未列入'
		<if test="lxbm!='' and lxbm!= null ">
			and sck_lxbm=#{lxbm}
		</if>
		<if test="qdzh!='' and qdzh!= null ">
			and to_number(sczdzh)>=to_number(#{qdzh})
		</if>
		<if test="zdzh!='' and zdzh!= null ">
			and to_number(scqdzh) &lt;=to_number(#{zdzh})
		</if>
	</select>
<select id="bzAbgc" parameterType="sckabgc" resultType="int">
		select count(*) from sck_abgc where lrjh='已列入'
		<if test="lxbm!='' and lxbm!= null ">
			and sck_lxbm=#{lxbm}
		</if>
		<if test="qdzh!='' and qdzh!= null ">
			and to_number(sczdzh)>=to_number(#{qdzh})
		</if>
		<if test="zdzh!='' and zdzh!= null ">
			and to_number(scqdzh) &lt;=to_number(#{zdzh})
		</if>
	</select>
	<select id="daoRuabgcsh" parameterType="sckabgc" resultType="sckabgc">
 		select * from xmk_abgc where shzt='已审核'
 		<if test="gydwbm!='' and gydwbm!= null ">
			and tbbmbm in(select id from xtgl_department where id like #{gydwbm}||'%' or parent like #{gydwbm}||'%') 
		</if>
 		<if test="lxbm!='' and lxbm!= null ">
			and lxbm=#{lxbm}
		</if>
		<if test="qdzh!='' and qdzh!= null ">
			and to_number(qdzh) &lt;=to_number(#{qdzh})
		</if>
		<if test="zdzh!='' and zdzh!= null ">
			and to_number(zdzh) >=to_number(#{zdzh})
		</if>
 </select>	
	
 <select id="exportExcel_abgc_scgl" parameterType="sckabgc" resultType="sjbb">
 	select
	sbzt v_0,gydw v_1,xzqhmc v_2,lxbm v_3,lxmc v_4,qdzh v_5,zdzh v_6,qzlc v_7,qzlc v_8,yhlc v_9,gjxjnd v_10,xmnf v_11,jsxz v_12
 	from sck_abgc t join xmk_abgc on xmkid=xmk_abgc.id where 1=1
 	and sck_sbthcd &lt;=#{sck_sbthcd}
 	<if test="gydw!='' and gydw!= null "  >
		and scbmbm like  substr(#{gydw},1,instr(#{gydw},'00')-1) || '%'
	</if>
	<if test="xzqhmc!='' and xzqhmc!= null "  >
		and xzqhdm like  substr(#{xzqhmc},1,instr(#{xzqhmc},'00')-1) || '%'
	</if>
	<if test="lxmc!='' and lxmc!= null ">
		and sck_lxmc like '%'||(#{lxmc})||'%'
	</if>
	<if test="xmnf!='' and xmnf!= null ">
		and xmnf like '%'||(#{xmnf})||'%'
	</if>
	<!-- <if test="xmtype!='' and xmtype!= null ">
		and xmtype like '%'||(#{xmtype})||'%'
	</if>
	<if test="shzt!='' and shzt!= null ">
		and sck_shzt like '%'||(#{shzt})||'%'
	</if> -->
	<if test="lxjsdj!='' and lxjsdj!= null ">
		and lxjsdj like '%'||(#{lxjsdj})||'%'
	</if>
	<if test="lxbm!='' and lxbm!= null ">
		and sck_lxbm like #{lxbm}||'%'
	</if>
 </select>
  <select id="exportExcel_abgc_scsh" parameterType="sckabgc" resultType="sjbb">
 	select
	sbzt v_0,gydw v_1,xzqhmc v_2,lxbm v_3,lxmc v_4,qdzh v_5,zdzh v_6,qzlc v_7,qzlc v_8,yhlc v_9,gjxjnd v_10,xmnf v_11,jsxz v_12
 	from sck_abgc t join xmk_abgc on xmkid=xmk_abgc.id where 1=1 and sck_sbzt='已上报'
 	and sck_sbthcd &lt;=#{sck_sbthcd}
 	<if test="gydw!='' and gydw!= null "  >
		and sckbmbm like  substr(#{gydw},1,instr(#{gydw},'00')-1) || '%'
	</if>
	<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm like  substr(#{xzqhmc},1,instr(#{xzqhmc},'00')-1) || '%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and sck_lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<!-- <if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and sck_shzt like '%'||(#{shzt})||'%'
 		</if> -->
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and sck_lxbm like #{lxbm}||'%'
 		</if>
 </select>
  <select id="insertToSheet" resultType="sjbb" parameterType="hashMap">
 	select 
 	xzqhdm v_0,xzqhmc v_1,lxbm v_2,lxmc v_3,qdzh v_4,zdzh v_5,qzlc v_6,yhlc v_7,gjxjnd v_8
 	from xmk_abgc where sbzt='已上报'
 	and id not in (select xmkid from sck_abgc)
	and sbthcd &lt;=#{sck_sbthcd}  
	<if test="tbdw!=null and tbdw!=''">
		and tbbmbm like #{tbdw}||'%'
	</if>
 </select>
  <insert id="importAbgc_sc" parameterType="hashMap" >
 	insert into sck_abgc(sckid,xmkid,
 	scqdzh,sczdzh,sczlc,scyhlc,fapgdw,fascdw,faspsj,spwh,tzgs,jsxz,jsnr,scbz,sck_sbzt,sck_shzt,sck_lxbm,sck_lxmc,scbmbm,sck_sbthcd,lrjh,bzls)
	values(sys_guid(),(select ID from XMK_ABGC where lxbm=trim(#{2}) and lxmc=trim(#{3})),
	#{9},#{10},to_number(#{10})-to_number(#{9}),#{11},#{12},#{13},#{14},#{15},#{16},#{17},#{18},#{19},'未上报','未审核',#{2},#{3},#{scbmbm},#{sck_sbthcd},'未列入','无')

 </insert>
</mapper>
