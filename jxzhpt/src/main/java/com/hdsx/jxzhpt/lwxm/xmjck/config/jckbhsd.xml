<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.jckbhsd">
<insert id="insertJckbhsd"  parameterType="jckbhsd">
	insert into xmk_bhsd(id,sdmc,sddm,xzqhmc,xzqhdm,lxmc,lxbm,gydw,gydwbm,xjgjnd,jsdj,pddj,pdtime,sdzxzh,sdcd,sdkd,sdgd,
		acdfl,jswd,jsjd,bhbw,bhnr,bz,tbbmbm,xmnf,xmtype,tbsj,sbzt,shzt,sbthcd,xmmc,jsxz,jsnx,nsddm,nlxbm,nsdzxzh,nlxmc) 
		values(sys_guid(),#{sdmc,jdbcType=VARCHAR},#{sddm,jdbcType=VARCHAR},#{xzqhmc,jdbcType=VARCHAR},#{xzqhdm,jdbcType=VARCHAR},#{lxmc,jdbcType=VARCHAR},#{lxbm,jdbcType=VARCHAR},#{gydw,jdbcType=VARCHAR},#{gydwbm,jdbcType=VARCHAR},#{xjgjnd,jdbcType=VARCHAR},#{jsdj,jdbcType=VARCHAR},
		#{pddj,jdbcType=VARCHAR},#{pdtime,jdbcType=VARCHAR},#{sdzxzh,jdbcType=VARCHAR},#{sdcd,jdbcType=VARCHAR},#{sdkd,jdbcType=VARCHAR},
		#{sdgd,jdbcType=VARCHAR},#{acdfl,jdbcType=VARCHAR},#{jswd,jdbcType=VARCHAR},#{jsjd,jdbcType=VARCHAR},#{bhbw,jdbcType=VARCHAR},#{bhnr,jdbcType=VARCHAR},#{bz,jdbcType=VARCHAR},#{tbbmbm,jdbcType=VARCHAR},#{xmnf,jdbcType=VARCHAR},#{xmtype,jdbcType=VARCHAR},
		sysdate,'未上报','未审核',#{sbthcd},#{xmmc,jdbcType=VARCHAR},#{jsxz,jdbcType=VARCHAR},#{jsnx,jdbcType=VARCHAR}
		,#{nsddm},#{nlxbm},#{nsdzxzh},#{lxmc})
</insert>

 <select id="selectJckbhsd" parameterType="jckbhsd" resultType="jckbhsd">
 	select * from (
 		select rownum num ,t.*,decode(sbthcd,#{sbthcd},'未上报',sbzt) sbzt2 from xmk_bhsd t where 1=1
 			and  sbthcd &lt;=#{sbthcd} 
<!--         <if test="xtType!='' and xtType!= null "> -->
<!-- 			${xtType} -->
<!-- 		</if> -->
<!--  		<if test="tbbmbm!='' and tbbmbm!= null "> -->
<!-- 			and tbbmbm like '%'||(#{tbbmbm})||'%' -->
<!-- 		</if>	 -->
 		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="sdmc!='' and sdmc!= null ">
 			and sdmc like '%'||(#{sdmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="acdfl!='' and acdfl!= null ">
 			and acdfl=#{acdfl}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like '%'||(#{lxbm})||'%'
 		</if>
 		<if test="sddm!='' and sddm!= null ">
 			and sddm like '%'||(#{sddm})||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sbzt2,shzt desc 
 			
 </select>
 
  <select id="selectBhsdCount" parameterType="jckbhsd" resultType="int">
 		select count(*) from xmk_bhsd t where 1=1
 			and  sbthcd &lt;=#{sbthcd} 
<!--  		<if test="xtType!='' and xtType!= null "> -->
<!-- 			${xtType} -->
<!-- 		</if>	 -->
<!--  		<if test="tbbmbm!='' and tbbmbm!= null "> -->
<!-- 			and tbbmbm like '%'||(#{tbbmbm})||'%' -->
<!-- 		</if> -->
 		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="sdmc!='' and sdmc!= null ">
 			and sdmc like '%'||(#{sdmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="acdfl!='' and acdfl!= null ">
 			and acdfl=#{acdfl}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like '%'||(#{lxbm})||'%'
 		</if>
 		<if test="sddm!='' and sddm!= null ">
 			and sddm like '%'||(#{sddm})||'%'
 		</if>
 </select>
 
 <select id="selectJckbhsdById" parameterType="jckbhsd" resultType="jckbhsd">
 	select * from xmk_bhsd where id=#{id}
 </select>
 
 <update id="updateJckbhsd" parameterType="jckbhsd">
 	update xmk_bhsd set sdmc=#{sdmc,jdbcType=VARCHAR} ,sddm=#{sddm,jdbcType=VARCHAR},xzqhmc=#{xzqhmc,jdbcType=VARCHAR},xzqhdm=#{xzqhdm,jdbcType=VARCHAR},lxmc=#{lxmc,jdbcType=VARCHAR},lxbm=#{lxbm,jdbcType=VARCHAR},
 		gydw=#{gydw,jdbcType=VARCHAR},xjgjnd=#{xjgjnd,jdbcType=VARCHAR},jsdj=#{jsdj,jdbcType=VARCHAR},pddj=#{pddj,jdbcType=VARCHAR},pdtime=#{pdtime,jdbcType=VARCHAR},sdzxzh=#{sdzxzh,jdbcType=VARCHAR},sdkd=#{sdkd,jdbcType=VARCHAR},sdcd=#{sdcd,jdbcType=VARCHAR},sdgd=#{sdgd,jdbcType=VARCHAR},
 		acdfl=#{acdfl,jdbcType=VARCHAR},bhbw=#{bhbw,jdbcType=VARCHAR},bhnr=#{bhnr,jdbcType=VARCHAR},bz=#{bz,jdbcType=VARCHAR},xmnf=#{xmnf,jdbcType=VARCHAR},
 		xmmc=#{xmmc,jdbcType=VARCHAR},jswd=#{jswd},jsjd=#{jsjd},
 		jsxz=#{jsxz,jdbcType=VARCHAR},
 		nsddm=#{nsddm,jdbcType=VARCHAR},nlxbm=#{nlxbm,jdbcType=VARCHAR},nsdzxzh=#{nsdzxzh,jdbcType=VARCHAR},nlxmc=#{nlxmc,jdbcType=VARCHAR}
 		where id=#{id}
 </update>
 
  <delete id="deleteJckbhsd" parameterType="java.util.List" >
 	delete from xmk_bhsd where id =#{String}
 </delete>
 
 <update id="xgJckbhsdSbzt" parameterType="hashmap" >
 	update xmk_bhsd set sbzt='已上报',sbsj=sysdate,sbbm=#{sbbm},sbthcd=#{sbthcd},thyj='' where id =#{id}
 </update>
 
 <update id="xgJckbhsdShzt" parameterType="hashmap" >
 	update xmk_bhsd set shzt='已审核',shsj=sysdate,shbm=#{shbm} where id=#{id}
 </update>

 <update id="xgJckbhsdSdzt" parameterType="hashmap" >
 	update xmk_bhsd set sdzt='1' where id=#{id}
 </update>
 
 <select id="selectJckBhsdWsd" parameterType="jckbhsd" resultType="jckbhsd">
	  select * from xmk_bhsd where shzt='已审核' and sbthcd=2 and sdzt='0'
	  <if test="xtType!='' and xtType!= null ">
			${xtType}
		</if>
  </select>
	
  <update id="xgJckbhsdTH" parameterType="hashmap" >
 	update xmk_bhsd set sbthcd=sbthcd+2,thyj=#{thyj} where id =#{id}
 </update>
 
 <update id="xgJckbhsdTH1" parameterType="hashmap" >
 	update xmk_bhsd set sbthcd=(sbthcd+2),sbbm=#{sbbm} where id =#{id}
 </update>
 
 <select id="selectSbbmByBhsdId" parameterType="jckbhsd" resultType="jckbhsd">
 select parent as sbbm from xtgl_department where 
 id =(select tbbmbm from xmk_bhsd where id=#{id})
 </select>
 
  <select id="selectGpsroad"  parameterType="hashmap" resultType="jckbhsd">
 	select roadbm sddm,F002 sdmc,roadpos sdzxzh,F150 gydwbm,
   (select name from xtgl_xzqh where id =substr(roadcode,length(roadcode)-5,6)) xzqhmc,
     substr(roadcode,length(roadcode)-5,6) xzqhdm,
     (select name from xtgl_department where id=F150) gydw,
     (select g.roadname from  gpsroad g where g.roadcode=roadcode 
         and  roadpos >=g.roadstart  and  roadpos &lt;= g.roadends and rownum=1) lxmc,roadcode lxbm,F006 sdcd,F007 sdkd,F008 sdgd,
     (SELECT F003 FROM ROADTARGETVALUES WHERE F001 LIKE '隧道技术状况评定%' and F002=pddj) pddj,pdtime,
     decode(substr(GJXZND, 0, 4), null,substr(F029, 0, 4),substr(GJXZND, 0, 4)) xjgjnd,
     (SELECT F003 FROM ROADTARGETVALUES WHERE F001 LIKE '%隧道分类%' and F002=F004) acdfl,
     (select g.F114 from  gpsroad g where g.roadcode=roadcode 
         and  roadpos >=g.roadstart  and  roadpos &lt;= g.roadends and rownum=1) jsdj,
    (SELECT F003 FROM ROADTARGETVALUES where F001 like '%隧道病害位置%' and F002=BHWZ) bhbw, bhdesc bhnr
    from DATA52  where  roadbm like #{sddm} ||'%' 
		<if test="gydwbm!='' and gydwbm!= null ">
		and f150 in(select id from xtgl_department where id like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%' 
    or parent like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%')
		</if>
		order by roadbm,F002
 </select>
 
 
  <select id="jckbhsdRoad" parameterType="hashmap" resultType="jckbhsd">
 	select * from xmk_bhsd where shzt='已审核' 
 	and sddm like #{sddm}||'%' 
 	<if test="gydwbm!='' and gydwbm!= null ">
 	and tbbmbm in (select id from xtgl_department where id like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%' 
    or parent like '%'||substr(#{gydwbm},0,4)||'_'||substr(#{gydwbm},6)||'%')
	</if>
 	order by sddm
 </select>
 
  <select id="selectJckShbhsd" parameterType="jckbhsd" resultType="jckbhsd">
 	select * from (
 		select rownum num ,t.* from xmk_bhsd t where 
 		    sbthcd=7 
<!--  		 <if test="xtType!='' and xtType!= null "> -->
<!-- 			${xtType} -->
<!-- 		</if> -->
<!--         <if test="tbbmbm!='' and tbbmbm!= null "> -->
<!-- 		   and tbbmbm like '%'||(#{tbbmbm})||'%' -->
<!-- 		</if> -->
 		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="sdmc!='' and sdmc!= null ">
 			and sdmc like '%'||(#{sdmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="acdfl!='' and acdfl!= null ">
 			and acdfl=#{acdfl}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like '%'||(#{lxbm})||'%'
 		</if>
 		<if test="sddm!='' and sddm!= null ">
 			and sddm like '%'||(#{sddm})||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by shzt desc
 </select>
 
  <select id="selectBhsdShCount" parameterType="jckbhsd" resultType="int">
 		select count(*) from xmk_bhsd t where 
 		    sbthcd=7 
<!--         <if test="xtType!='' and xtType!= null "> -->
<!-- 			${xtType} -->
<!-- 		</if> -->
<!--         <if test="tbbmbm!='' and tbbmbm!= null "> -->
<!-- 		   and tbbmbm like '%'||(#{tbbmbm})||'%' -->
<!-- 		</if> -->
 		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="sdmc!='' and sdmc!= null ">
 			and sdmc like '%'||(#{sdmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="acdfl!='' and acdfl!= null ">
 			and acdfl=#{acdfl}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like '%'||(#{lxbm})||'%'
 		</if>
 		<if test="sddm!='' and sddm!= null ">
 			and sddm like '%'||(#{sddm})||'%'
 		</if>
 </select>

<select id="selectJckSdbhsd" parameterType="jckbhsd" resultType="jckbhsd">
 	select * from (
 		select rownum num ,t.* from xmk_bhsd t where 
 		    sbthcd=2 and shzt='已审核'
<!--  		<if test="xtType!='' and xtType!= null "> -->
<!-- 			${xtType} -->
<!-- 		</if> -->
<!--         <if test="tbbmbm!='' and tbbmbm!= null "> -->
<!-- 		   and tbbmbm like '%'||(#{tbbmbm})||'%' -->
<!-- 		</if> -->
 		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="sdmc!='' and sdmc!= null ">
 			and sdmc like '%'||(#{sdmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sdzt!='' and sdzt!= null ">
 			and sdzt like '%'||(#{sdzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="acdfl!='' and acdfl!= null ">
 			and acdfl=#{acdfl}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like '%'||(#{lxbm})||'%'
 		</if>
 		<if test="sddm!='' and sddm!= null ">
 			and sddm like '%'||(#{sddm})||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by shzt desc
 </select>
 
  <select id="selectBhsdSdCount" parameterType="jckbhsd" resultType="int">
 		select count(*) from xmk_bhsd t where 
 		    sbthcd=2 and shzt='已审核'
<!--         <if test="xtType!='' and xtType!= null "> -->
<!-- 			${xtType} -->
<!-- 		</if> -->
<!--         <if test="tbbmbm!='' and tbbmbm!= null "> -->
<!-- 		   and tbbmbm like '%'||(#{tbbmbm})||'%' -->
<!-- 		</if> -->
 		<if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
		<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="sdmc!='' and sdmc!= null ">
 			and sdmc like '%'||(#{sdmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sdzt!='' and sdzt!= null ">
 			and sdzt like '%'||(#{sdzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="acdfl!='' and acdfl!= null ">
 			and acdfl=#{acdfl}
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like '%'||(#{lxbm})||'%'
 		</if>
 		<if test="sddm!='' and sddm!= null ">
 			and sddm like '%'||(#{sddm})||'%'
 		</if>
 </select>
 
 <select id="onceBhsd" parameterType="jckbhsd" resultType="int">
 		select count(*) from xmk_bhsd where 1=1 and substr(lxbm,1,1) in('G','S')
 		<if test="sddm!='' and sddm!= null "  >
 			and sddm=#{sddm}
 		</if>
 		<if test="lxbm!='' and lxbm!= null "  >
 			or (lxbm=#{lxbm} and to_number(sdzxzh)=to_number(#{sdzxzh}))
 		</if>
 </select>
 
 <sql id="bhsd_commonsql">
 	and  sbthcd &lt;=#{sbthcd} 
<!--  	<if test="xtType!='' and xtType!= null "> -->
<!-- 			${xtType} -->
<!-- 	</if> -->
<!--  	<if test="tbbmbm!='' and tbbmbm!= null "> -->
<!-- 		   and tbbmbm like '%'||(#{tbbmbm})||'%' -->
<!-- 	</if> -->
    <if test="gydw!='' and gydw!= null ">
			${gydw}
		</if>
	<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
	</if>
	<if test="lxmc!='' and lxmc!= null ">
		and lxmc like '%'||(#{lxmc})||'%'
	</if>
	<if test="sdmc!='' and sdmc!= null ">
		and sdmc like '%'||(#{sdmc})||'%'
	</if>
	<if test="xmnf!='' and xmnf!= null ">
		and xmnf like '%'||(#{xmnf})||'%'
	</if>
	<if test="xmtype!='' and xmtype!= null ">
		and xmtype like '%'||(#{xmtype})||'%'
	</if>
	<if test="sbzt!='' and sbzt!= null ">
		and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
	</if>
	<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 	</if>
	<if test="jsdj!='' and jsdj!= null ">
		and jsdj like '%'||(#{jsdj})||'%'
	</if>
	<if test="acdfl!='' and acdfl!= null ">
 			and acdfl=#{acdfl}
 	</if>
	<if test="lxbm!='' and lxbm!= null ">
 		and lxbm like '%'||(#{lxbm})||'%'
 	</if>
 	<if test="sddm!='' and sddm!= null ">
 		and sddm like '%'||(#{sddm})||'%'
 	</if>
 	<if test="sdzt!='' and sdzt!= null ">
 			and sdzt like '%'||(#{sdzt})||'%'
 	</if>
 </sql>
 
 <select id="exportExcel_bhsd" parameterType="jckbhsd" resultType="sjbb">
 	select
	(case when thyj is not null  then decode(sbthcd,#{sbthcd},'未上报(退回)',sbzt)
	when thyj!='' then decode(sbthcd,#{sbthcd},'未上报(退回)',sbzt) 
	else decode(sbthcd,#{sbthcd},'未上报',sbzt) end) v_0,
	gydw v_1,xzqhmc v_2,sddm v_3,sdmc v_4,sdzxzh v_5,lxbm v_6,lxmc v_7,pddj v_8,xjgjnd v_9,xmnf v_10,
	xmmc v_11,jsxz v_12
 	from xmk_bhsd where 1=1
 	and  sbthcd &lt;=#{sbthcd} 
<!--      <if test="xtType!='' and xtType!= null "> -->
<!-- 			${xtType} -->
<!-- 	</if> -->
<!--  	<if test="tbbmbm!='' and tbbmbm!= null "> -->
<!-- 		   and tbbmbm like '%'||(#{tbbmbm})||'%' -->
<!-- 	</if> -->
	<if test="gydw!='' and gydw!= null ">
			${gydw}
	</if>
	<if test="xzqhdm!='' and xzqhdm!= null ">
			${xzqhdm}
	</if>
	<if test="lxmc!='' and lxmc!= null ">
		and lxmc like '%'||(#{lxmc})||'%'
	</if>
	<if test="sdmc!='' and sdmc!= null ">
		and sdmc like '%'||(#{sdmc})||'%'
	</if>
	<if test="xmnf!='' and xmnf!= null ">
		and xmnf like '%'||(#{xmnf})||'%'
	</if>
	<if test="xmtype!='' and xmtype!= null ">
		and xmtype like '%'||(#{xmtype})||'%'
	</if>
	<if test="sbzt!='' and sbzt!= null ">
		and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
	</if>
	<if test="jsdj!='' and jsdj!= null ">
		and jsdj like '%'||(#{jsdj})||'%'
	</if>
	<if test="acdfl!='' and acdfl!= null ">
 		and acdfl=#{acdfl}
 	</if>
	<if test="lxbm!='' and lxbm!= null ">
 		and lxbm like '%'||(#{lxbm})||'%'
 	</if>
 	<if test="sddm!='' and sddm!= null ">
 		and sddm like '%'||(#{sddm})||'%'
 	</if>
 </select>
 
 <insert id="importBhsd"  parameterType="hashMap">
	insert into xmk_bhsd(id,gydwbm,gydw,xzqhdm,xzqhmc,lxbm,lxmc,sddm,sdmc,sdzxzh,pddj,
		xmnf,xmmc,jsxz,xjgjnd,bhnr,bhbw,bz,tbsj,tbbmbm,sbthcd,sbzt,shzt) 
		values(sys_guid(),#{1},#{0},#{1},#{2},#{3},#{4},#{5},#{6},#{7},#{8},
		#{9},#{10},#{11},#{12},#{13},#{14},#{15},sysdate,#{tbbmbm},#{sbthcd},'未上报','未审核')
 </insert>
 
  <select id="exportExcel_bhsd_sh" parameterType="jckbhsd" resultType="sjbb">
 	select
	 shzt v_0,gydw v_1,xzqhmc v_2,sddm v_3,sdmc v_4,sdzxzh v_5,lxbm v_6,lxmc v_7,pddj v_8,xjgjnd v_9,xmnf v_10,
	xmmc v_11,jsxz v_12
 	from xmk_bhsd where sbthcd=7
 	<include refid="bhsd_commonsql"/>
 </select>
 
  <select id="exportExcel_bhsd_sd" parameterType="jckbhsd" resultType="sjbb">
 	select
	decode(sdzt,0,'未审定','已审定') v_0,gydw v_1,xzqhmc v_2,sddm v_3,sdmc v_4,sdzxzh v_5,lxbm v_6,lxmc v_7,pddj v_8,xjgjnd v_9,xmnf v_10,
	xmmc v_11,jsxz v_12
 	from xmk_bhsd where sbthcd=7
 	<include refid="bhsd_commonsql"/>
 </select>
 
   <select id="daoRubhsd"  parameterType="jckbhsd" resultType="jckbhsd">
		select roadbm sddm,F002 sdmc,roadpos sdzxzh,
   (select name from nmyhgc.xtgl_xzqh where id =substr(roadcode,length(roadcode)-5,6)) xzqhmc,
     substr(roadcode,length(roadcode)-5,6) xzqhdm,
     (select name from xtgl_department where id=substr(roadcode,length(roadcode)-5,6)) gydw,
     (select g.roadname from  gpsroad g where g.roadcode=roadcode 
         and  roadpos >=g.roadstart  and  roadpos &lt;= g.roadends and rownum=1) lxmc,roadcode lxbm,F006 sdcd,F007 sdkd,F008 sdgd,
     (SELECT F003 FROM ROADTARGETVALUES WHERE F001 LIKE '隧道技术状况评定%' and F002=pddj) pddj,pdtime,
     decode(substr(GJXZND, 0, 4), null,substr(F029, 0, 4),substr(GJXZND, 0, 4)) xjgjnd,
     (SELECT F003 FROM ROADTARGETVALUES WHERE F001 LIKE '%隧道分类%' and F002=F004) acdfl,
     (select g.F114 from  gpsroad g where g.roadcode=roadcode 
         and  roadpos >=g.roadstart  and  roadpos &lt;= g.roadends and rownum=1) jsdj,
    (SELECT F003 FROM ROADTARGETVALUES where F001 like '%隧道病害位置%' and F002=BHWZ) bhbw, bhdesc bhnr
    from DATA52  where substr(roadcode,1,1) in('G','S')
		<if test="gydwbm!='' and gydwbm!= null ">
		    and  reverse(substr(reverse(roadcode),1,6)) like '%'|| #{gydwbm}||'%'
		</if>
 			and (roadbm=#{sddm} or (roadcode=#{lxbm} and roadpos=to_number(#{sdzxzh})))
		order by roadbm,F002
 	</select>
 	
   <select id="selJsdj"  parameterType="jckbhsd" resultType="jckbhsd">
	   	select F114 jsdj from GPSROAD where 
	   		roadcode=#{lxbm}
			and roadstart  &lt;=#{qlzxzh}
	     	and roadends >#{qlzxzh}
   </select>
 
  <insert id="importBhsd2"  parameterType="hashMap">
  
	insert into xmk_bhsd(id,gydwbm ,gydw,xzqhdm,xzqhmc,lxbm,lxmc,qlbh,qlmc,qlzxzh,xjgjnd,qlqc,
		qlkd,kjzc,dkzdkj,akjfl,sbjgxs,pddj,xmnf,xmtype,bhnr,bz,tbsj,tbbmbm,sbthcd,sbzt,shzt,jsdj,xmmc,xbjgxs,jsxz,jsnx) values(
		sys_guid(),(select (select id from xtgl_department where name=#{0}) gydwbm ,#{0} gydw,#{1} xzqhdm,#{2} xzqhmc,#{3} lxbm,
		#{4} lxmc,#{5} qlbh,#{6} qlmc,#{7} qlzxzh,decode(substr(F052, 0, 4), null,substr(F051,0,4),substr(F052, 0, 4)) xjgjnd,
		to_char(F012) qlqc,to_char(F014) qlkd,to_char(F011) kjzc,to_char(F016) dkzdkj,<!-- F010 akjfl,F022 sbjgxs,F045 pddj, -->
		(SELECT F003 FROM ROADTARGETVALUES WHERE F001 LIKE '桥梁跨径分类%' and F002=F009) akjfl,
		(SELECT F003 FROM ROADTARGETVALUES WHERE F001 LIKE '上部结构形式%' and F002=F113) sbjgxs,
		(SELECT F003 FROM ROADTARGETVALUES WHERE F001 LIKE '技术状况评定%' and F002=F044) pddj,
		#{8} xmnf,'待上报' xmtype,#{14} bhnr,#{15} bz,sysdate tbsj,#{tbbmbm} tbbmbm,
		#{sbthcd} sbthcd,'未上报' sbzt,'未审核' shzt ,
		(select F114 jsdj from GPSROAD where roadcode=#{3} and roadstart  &lt;=#{7} and roadends >#{7}),
		#{9} xmmc,#{12} xbjgxs,#{10} jsxz,#{13} jsnx
		from DATA50 where roadbm =#{5}))
		
 </insert>
 
</mapper>

