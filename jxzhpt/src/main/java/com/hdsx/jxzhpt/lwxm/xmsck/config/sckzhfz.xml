<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.sckzhfz">
<insert id="insertSckzhfz"  parameterType="sckzhfz">
	insert into sck_zhfz(sckid,xmkid,scqdzh,sczdzh,sczlc,scyhlc,tzgs,spwh,fapgdw,fascdw,faspsj,jsxz,jsnr,scbz,scbmbm,sck_sbzt,sck_shzt)
		values(sys_guid(),#{xmkid},#{scqdzh},#{sczdzh},#{sczlc},#{scyhlc},#{tzgs},#{spwh},#{fapgdw},#{fascdw},#{faspsj},#{jsxz},#{jsnr},#{scbz},
		#{scbmbm},'未上报','未审核')
</insert>
 
 <select id="selectSckzhfz" parameterType="hashmap" resultType="sckzhfz">
 	select * from (
 		select rownum num ,t.* from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id) t where 1=1
  		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like #{lxbm}||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sbzt desc
 </select>
  <select id="selectZhfzCount" parameterType="hashmap" resultType="int">
 		select count(*) from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id)
 		 where 1=1
 		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
  		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like #{lxbm}||'%'
 		</if>
 </select>
 <select id="selectSckzhfzById" parameterType="sckzhfz" resultType="sckzhfz">
 	select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id where sckid=#{sckid}
 </select>
 <update id="updateSckzhfz" parameterType="sckzhfz" >
 	update sck_zhfz set scqdzh=#{scqdzh},sczdzh=#{sczdzh},sczlc=#{sczlc},scyhlc=#{scyhlc},tzgs=#{tzgs},spwh=#{spwh},
 	fapgdw=#{fapgdw},fascdw=#{fascdw},faspsj=#{faspsj},jsxz=#{jsxz},jsnr=#{jsnr},scbz=#{scbz}
 	where sckid=#{sckid}
 </update>
 
 <delete id="deleteSckZhfz" parameterType="String" >
 	delete from sck_zhfz where sckid in(#{delstr})
 </delete>
 
  <update id="xgSckZhfzShzt" parameterType="sckzhfz" >
 	update sck_zhfz set sck_shzt='已审核',sck_shsj=sysdate where sckid=#{sckid}
 </update>
  <update id="xgSckZhfzSbzt" parameterType="String" >
 	update sck_zhfz set sck_sbzt='已上报', sck_sbsj=sysdate where sckid in(#{delstr})
 </update>
 
  <select id="selectSckShzhfz" parameterType="hashmap" resultType="sckzhfz">
 	select * from (
 		select rownum num ,t.* from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id) t 
 		where sck_sbzt='已上报'
  		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and sck_shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like #{lxbm}||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sck_shzt desc
 </select>
  <select id="selectZhfzShCount" parameterType="hashmap" resultType="int">
 		select count(*) from (select * from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id)
 		 where sck_sbzt='已上报'
 		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
  		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and sck_shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like #{lxbm}||'%'
 		</if>
 </select>
  <select id="exportExcel_zhfz_scgl" parameterType="sckzhfz" resultType="sjbb">
 	select
	sbzt v_0,gydw v_1,xzqhmc v_2,lxbm v_3,lxmc v_4,qdzh v_5,zdzh v_6,qzlc v_7,qzlc v_8,yhlc v_9,gjxjnd v_10,xmnf v_11,jsxz v_12
 	from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id
 	where 1=1
 	<if test="gydw!='' and gydw!= null "  >
		and gydw like '%'||(#{gydw})||'%'
	</if>
	<if test="xzqhmc!='' and xzqhmc!= null "  >
		and xzqhmc like '%'||(#{xzqhmc})||'%'
	</if>
	<if test="lxmc!='' and lxmc!= null ">
		and lxmc like '%'||(#{lxmc})||'%'
	</if>
	<if test="xmnf!='' and xmnf!= null ">
		and xmnf like '%'||(#{xmnf})||'%'
	</if>
	<if test="xmtype!='' and xmtype!= null ">
		and xmtype like '%'||(#{xmtype})||'%'
	</if>
	<if test="shzt!='' and shzt!= null ">
		and shzt like '%'||(#{shzt})||'%'
	</if>
	<if test="lxjsdj!='' and lxjsdj!= null ">
		and lxjsdj like '%'||(#{lxjsdj})||'%'
	</if>
	<if test="lxbm!='' and lxbm!= null ">
		and lxbm like #{lxbm}||'%'
	</if>
 </select>
  <select id="exportExcel_zhfz_scsh" parameterType="sckzhfz" resultType="sjbb">
 	select
	sbzt v_0,gydw v_1,xzqhmc v_2,lxbm v_3,lxmc v_4,qdzh v_5,zdzh v_6,qzlc v_7,qzlc v_8,yhlc v_9,gjxjnd v_10,xmnf v_11,jsxz v_12
 	from sck_zhfz t join xmk_zhfz on xmkid=xmk_zhfz.id 
 	where 1=1 and sck_sbzt='已上报'
 	<if test="gydw!='' and gydw!= null "  >
		and gydw like '%'||(#{gydw})||'%'
	</if>
	<if test="xzqhmc!='' and xzqhmc!= null "  >
		and xzqhmc like '%'||(#{xzqhmc})||'%'
	</if>
	<if test="lxmc!='' and lxmc!= null ">
		and lxmc like '%'||(#{lxmc})||'%'
	</if>
	<if test="xmnf!='' and xmnf!= null ">
		and xmnf like '%'||(#{xmnf})||'%'
	</if>
	<if test="xmtype!='' and xmtype!= null ">
		and xmtype like '%'||(#{xmtype})||'%'
	</if>
	<if test="shzt!='' and shzt!= null ">
		and shzt like '%'||(#{shzt})||'%'
	</if>
	<if test="lxjsdj!='' and lxjsdj!= null ">
		and lxjsdj like '%'||(#{lxjsdj})||'%'
	</if>
	<if test="lxbm!='' and lxbm!= null ">
		and lxbm like #{lxbm}||'%'
	</if>
 </select>
 <select id="insertToSheet" resultType="sjbb">
 	select 
 	gydw v_0,xzqhdm v_0,xzqhmc v_1,lxbm v_2,lxmc v_3,qdzh v_4,zdzh v_5,zlc v_6,yhlc v_7,gjxjnd v_8
 	from xmk_zhfz where 1=1 and sbzt='已上报'
 </select>
 <insert id="importAbgc_sc" parameterType="hashMap">
 	insert into sck_zhfz(sckid,sck_sbzt,sck_shzt)
	values(sys_guid(),'未上报','未审核')
 </insert>
  <insert id="importZhfz_sc" parameterType="hashMap">
	insert into sck_zhfz(sckid,xmkid,fapgdw,fascdw,faspsj,spwh,tzgs,jsxz,jsnr,scbz,sck_sbzt,sck_shzt)
	values(sys_guid(),(select ID from XMK_Zhfz where lxbm=trim(#{2}) and lxmc=trim(#{3})),#{9},#{10},#{11},#{12},#{13},#{14},#{15},#{16},'未上报','未审核')
 </insert>
</mapper>