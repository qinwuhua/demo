<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.jckwqgz">
<insert id="insertJckwqgz"  parameterType="jckwqgz">
	insert into xmk_wqgz(id,qlmc,qlbh,xzqhmc,xzqhdm,lxmc,lxbm,gydw,gydwbm,xjgjnd,jsdj,pddj,qlzxzh,qlkd,qlqc,
		kjzc,dkzdkj,akjfl,sbjgxs,bhnr,bz,tbbmbm,xmnf,xmtype,tbsj,sbzt,shzt,sbthcd) 
		values(sys_guid(),#{qlmc},#{qlbh},#{xzqhmc},#{xzqhdm},#{lxmc},#{lxbm},#{gydw},
		(select id from xtgl_department where name=#{gydw}),#{xjgjnd},#{jsdj},
		#{pddj},#{qlzxzh},#{qlkd},#{qlqc},#{kjzc},#{dkzdkj},#{akjfl},#{sbjgxs},#{bhnr},#{bz},#{tbbmbm},#{xmnf},#{xmtype},
		sysdate,'未上报','未审核',#{sbthcd})
</insert>

 <select id="selectJckwqgz" parameterType="hashmap" resultType="jckwqgz">
 	select * from (
 		select rownum num ,t.*,decode(sbthcd,#{sbthcd},'未上报',sbzt) sbzt2 from xmk_wqgz t where 1=1
 			and  sbthcd &lt;=#{sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and tbbmbm in(select id from xtgl_department where id like #{gydw}||'%' or parent like #{gydw}||'%')
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm in(select id from xtgl_xzqh
 			where id=#{xzqhmc} or parent=#{xzqhmc})
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="qlmc!='' and qlmc!= null ">
 			and qlmc like '%'||(#{qlmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="akjfl!='' and akjfl!= null ">
 			and akjfl like '%'||(#{akjfl})||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sbzt2 
 </select>
  <select id="selectWqgzCount" parameterType="hashmap" resultType="int">
 		select count(*) from xmk_wqgz t where 1=1
 			and  sbthcd &lt;=#{sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and tbbmbm in(select id from xtgl_department where id like #{gydw}||'%' or parent like #{gydw}||'%')
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm in(select id from xtgl_xzqh
 			where id=#{xzqhmc} or parent=#{xzqhmc})
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="qlmc!='' and qlmc!= null ">
 			and qlmc like '%'||(#{qlmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="sbzt!='' and sbzt!= null ">
 			and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="akjfl!='' and akjfl!= null ">
 			and akjfl like '%'||(#{akjfl})||'%'
 		</if>
 </select>
 <select id="selectJckwqgzById" parameterType="jckwqgz" resultType="jckwqgz">
 	select * from xmk_wqgz where id=#{id}
 </select>
 <update id="updateJckwqgz" parameterType="jckwqgz">
 	update xmk_wqgz set qlmc=#{qlmc} ,qlbh=#{qlbh},xzqhmc=#{xzqhmc},xzqhdm=#{xzqhdm},lxmc=#{lxmc},lxbm=#{lxbm},
 		gydw=#{gydw} ,xjgjnd=#{xjgjnd},jsdj=#{jsdj},pddj=#{pddj},qlzxzh=#{qlzxzh},qlkd=#{qlkd},qlqc=#{qlqc},kjzc=#{kjzc},
 		dkzdkj=#{dkzdkj},akjfl=#{akjfl},sbjgxs=#{sbjgxs},bhnr=#{bhnr},bz=#{bz},xmnf=#{xmnf},xmtype=#{xmtype}
 		where id=#{id}
 </update>
 <update id="xgJckwqgzShzt" parameterType="jckwqgz" >
 	update xmk_wqgz set shzt='已审核',shsj=sysdate,shbm=#{shbm} where id=#{id}
 </update>
   <update id="xgJckwqgzSbzt" parameterType="hashmap" >
 	update xmk_wqgz set sbzt='已上报',sbsj=sysdate,sbbm=#{sbbm},sbthcd=#{sbthcd} where id in(#{delstr})
 </update>
  <update id="xgJckWqgzTH" parameterType="jckwqgz" >
 	update xmk_wqgz set sbthcd=(sbthcd+2) where id =#{id}
 </update>
 
  <select id="selectGpsroad"  parameterType="hashmap" resultType="jckwqgz">
 	select roadbm qlbh,F002 qlmc,roadpos qlzxzh,gydw,DISTNAME xzqhmc,substr(roadcode,length(roadcode)-5,6) xzqhdm,
 		roadname lxmc,roadcode lxbm,F011 kjzc,F012 qlqc,F014 qlkd,F016 dkzdkj,F045 pddj,decode(substr(F052, 0, 4), null,
 		substr(F051,0,4),substr(F052, 0, 4)) xjgjnd,F010 akjfl,F022 sbjgxs,F112 bhnr,F074 bz 
		from JXJCK_2013.DATA50 where substr(roadcode,1,1) in('G','S','X','Y') and sfxzdm='1' and F045 in('四类','五类') 
		and F010 in('中桥','大桥','特大桥') and roadbm like #{qlbh} ||'%' 
		<if test="gydwbm!='' and gydwbm!= null ">
			and gydw in(select name from xtgl_department where id like #{gydwbm}||'%' or parent like #{gydwbm}||'%') 
		</if>
<!--  		<if test="xzqhdm!='' and xzqhdm!= null ">
			and substr(roadcode,length(roadcode)-5,6) in(select id from xtgl_xzqh where id=#{xzqhdm} or parent=#{xzqhdm}) 
		</if>  -->
		order by roadbm,F002
 </select>
 
  <select id="JckWqgzRoad" parameterType="hashmap" resultType="jckwqgz">
 	select * from xmk_wqgz where shzt='已审核' and sbzt='已上报' and qlbh like #{qlbh}||'%' 
 	<if test="gydwbm!='' and gydwbm!= null ">
			and tbbmbm in(select id from xtgl_department where id like #{gydwbm} ||'%' or parent like #{gydwbm} ||'%') 
		</if>
 	order by qlbh
 </select>
 
  <select id="selectJckShwqgz" parameterType="hashmap" resultType="jckwqgz">
 	select * from (
 		select rownum num ,t.* from xmk_wqgz t where sbzt='已上报' and sbthcd=7
			and sbthcd>=#{sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and tbbmbm in(select id from xtgl_department where id like #{gydw}||'%' or parent like #{gydw}||'%') 
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm in(select id from xtgl_xzqh
 			where id=#{xzqhmc} or parent=#{xzqhmc})
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="qlmc!='' and qlmc!= null ">
 			and qlmc like '%'||(#{qlmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="akjfl!='' and akjfl!= null ">
 			and akjfl like '%'||(#{akjfl})||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by shzt desc
 </select>
  <select id="selectWqgzShCount" parameterType="hashmap" resultType="int">
 		select count(*) from xmk_wqgz t where sbzt='已上报' and sbthcd=7
			and sbthcd>=#{sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and tbbmbm in(select id from xtgl_department where id like #{gydw}||'%' or parent like #{gydw}||'%') 
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhdm in(select id from xtgl_xzqh
 			where id=#{xzqhmc} or parent=#{xzqhmc})
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="qlmc!='' and qlmc!= null ">
 			and qlmc like '%'||(#{qlmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="akjfl!='' and akjfl!= null ">
 			and akjfl like '%'||(#{akjfl})||'%'
 		</if>
 </select>
 <delete id="deleteJckWqgz" parameterType="String" >
 	delete from xmk_wqgz where id in #{delstr}
 </delete>
 <select id="onceWqgz" parameterType="jckwqgz" resultType="int">
 		select count(*) from xmk_wqgz where 1=1
 		<if test="qlbh!='' and qlbh!= null "  >
 			and qlbh=#{qlbh}
 		</if>
 		<if test="lxbm!='' and lxbm!= null "  >
 			or (lxbm=#{lxbm} and to_number(qlzxzh)=#{qlzxzh})
 		</if>
 </select>
 
 <sql id="wqgz_commonsql">
 	<if test="gydw!='' and gydw!= null "  >
		and tbbmbm in(select id from xtgl_department 
		where id=#{gydw} or parent=#{gydw})
	</if>
	<if test="xzqhmc!='' and xzqhmc!= null "  >
		and xzqhdm in(select id from xtgl_xzqh
		where id=#{xzqhmc} or parent=#{xzqhmc})
	</if>
	<if test="lxmc!='' and lxmc!= null ">
		and lxmc like '%'||(#{lxmc})||'%'
	</if>
	<if test="qlmc!='' and qlmc!= null ">
		and qlmc like '%'||(#{qlmc})||'%'
	</if>
	<if test="xmnf!='' and xmnf!= null ">
		and xmnf like '%'||(#{xmnf})||'%'
	</if>
	<if test="xmtype!='' and xmtype!= null ">
		and xmtype like '%'||(#{xmtype})||'%'
	</if>
	<if test="sbzt!='' and sbzt!= null ">
		and decode(sbthcd,#{sbthcd},'未上报',sbzt) like '%'||(#{sbzt})||'%'
	</if>
	<if test="jsdj!='' and jsdj!= null ">
		and jsdj like '%'||(#{jsdj})||'%'
	</if>
	<if test="akjfl!='' and akjfl!= null ">
		and akjfl like '%'||(#{akjfl})||'%'
	</if>
 </sql>
 <select id="exportExcel_wqgz" parameterType="jckwqgz" resultType="sjbb">
 	select
	sbzt v_0,gydw v_1,xzqhmc v_2,qlbh v_3,qlmc v_4,qlzxzh v_5,lxbm v_6,lxmc v_7,pddj v_8,xjgjnd v_9,xmnf v_10
 	from xmk_wqgz where 1=1
 	<include refid="wqgz_commonsql"/>
 </select>
 <insert id="importWqgz"  parameterType="hashMap">
	insert into xmk_wqgz(id,gydwbm,gydw,xzqhdm,xzqhmc,lxbm,lxmc,qlbh,qlmc,qlzxzh,
	<!-- ,xjgjnd,qlqc,qlkd,kjzc,dkzdkj,akjfl,sbjgxs,pddj, -->
		xmnf,<!-- xmtype, -->bhnr,bz,tbsj,tbbmbm,sbthcd,sbzt,shzt) 
		values(sys_guid(),(select id from xtgl_department where name=#{0}),#{0},#{1},#{2},#{3},#{4},#{5},#{6},#{7},#{8},
		<!-- #{9},#{10},#{11},#{12},#{13},#{14},#{15},#{16},#{17}, -->
		#{9},#{10},sysdate,#{tbbmbm},#{sbthcd},'未上报','未审核')
 </insert>
  <select id="exportExcel_wqgz_sh" parameterType="jckwqgz" resultType="sjbb">
 	select
	shzt v_0,gydw v_1,xzqhmc v_2,qlbh v_3,qlmc v_4,qlzxzh v_5,lxbm v_6,lxmc v_7,pddj v_8,xjgjnd v_9,xmnf v_10
 	from xmk_wqgz where sbzt='已上报'
 	<include refid="wqgz_commonsql"/>
 </select>
 
   <select id="daoRuwqgz"  parameterType="jckwqgz" resultType="jckwqgz">
 	select roadbm qlbh,F002 qlmc,roadpos qlzxzh,gydw,DISTNAME xzqhmc,substr(roadcode,length(roadcode)-5,6) xzqhdm,
 		roadname lxmc,roadcode lxbm,F011 kjzc,F012 qlqc,F014 qlkd,F016 dkzdkj,F045 pddj,decode(substr(F052, 0, 4), null,
 		substr(F051,0,4),substr(F052, 0, 4)) xjgjnd,F010 akjfl,F022 sbjgxs,F112 bhnr,F074 bz 
		from JXJCK_2013.DATA50 where substr(roadcode,1,1) in('G','S','X','Y') and sfxzdm='1' and F045 in('四类','五类') 
		and F010 in('中桥','大桥','特大桥') 
		<if test="gydwbm!='' and gydwbm!= null ">
			and gydw in(select name from xtgl_department where id like #{gydwbm}||'%' or parent like #{gydwbm}||'%') 
		</if>
 			and (roadbm=#{qlbh} or (roadcode=#{lxbm} and roadpos=#{qlzxzh}))
		order by roadbm,F002
 	</select>
   <select id="selJsdj"  parameterType="jckwqgz" resultType="jckwqgz">
	   	select F114 jsdj from JXJCK_2013.GPSROAD where 
	   		roadcode=#{lxbm}
			and roadstart  &lt;=#{qlzxzh}
	     	and roadends >#{qlzxzh}
   </select>
 
  <insert id="importWqgz2"  parameterType="hashMap">
	
	insert into xmk_wqgz(gydwbm ,gydw,xzqhdm,xzqhmc,lxbm,lxmc,qlbh,qlmc,qlzxzh,xjgjnd,qlqc,
		qlkd,kjzc,dkzdkj,akjfl,sbjgxs,pddj,xmnf,xmtype,bhnr,bz,tbsj,tbbmbm,sbthcd,sbzt,shzt,jsdj) 
		select (select id from xtgl_department where name=#{0}) gydwbm ,#{0} gydw,#{1} xzqhdm,#{2} xzqhmc,#{3} lxbm,
		#{4} lxmc,#{5} qlbh,#{6} qlmc,#{7} qlzxzh,decode(substr(F052, 0, 4), null,substr(F051,0,4),substr(F052, 0, 4)) xjgjnd,
		to_char(F012) qlqc,to_char(F014) qlkd,to_char(F011) kjzc,to_char(F016) dkzdkj,F010 akjfl,F022 sbjgxs,F045 pddj,
		#{8} xmnf,'待上报' xmtype,#{9} bhnr,#{10} bz,sysdate tbsj,#{tbbmbm} tbbmbm,
		#{sbthcd} sbthcd,'未上报' sbzt,'未审核' shzt ,
		(select F114 jsdj from JXJCK_2013.GPSROAD where roadcode=#{3} and roadstart  &lt;=#{7} and roadends >#{7})
		from JXJCK_2013.DATA50 where roadbm =#{5}
		
 </insert>
</mapper>

