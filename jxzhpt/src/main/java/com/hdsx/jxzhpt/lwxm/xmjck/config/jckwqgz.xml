<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.jckwqgz">
<insert id="insertJckwqgz"  parameterType="jckwqgz">
	insert into xmk_wqgz(id,qlmc,qlbh,xzqhmc,xzqhdm,lxmc,lxbm,gydw,gydwbm,xjgjnd,jsdj,pddj,qlzxzh,qlkd,qlqc,
		kjzc,dkzdkj,akjfl,sbjgxs,bhnr,bz,tbbmbm,xmnf,xmtype,tbsj,sbzt,shzt,sbthcd) 
		values(sys_guid(),#{qlmc},#{qlbh},#{xzqhmc},#{xzqhdm},#{lxmc},#{lxbm},#{gydw},
		(select id from xtgl_department where name=#{gydw}),#{xjgjnd},#{jsdj},
		#{pddj},#{qlzxzh},#{qlkd},#{qlqc},#{kjzc},#{dkzdkj},#{akjfl},#{sbjgxs},#{bhnr},#{bz},#{tbbmbm},#{xmnf},#{xmtype},
		sysdate,'未上报','未审核',#{sbthcd})
</insert>

 <select id="selectJckwqgz" parameterType="hashmap" resultType="jckwqgz">
 	select * from (
 		select rownum num ,t.*,decode(sbthcd,#{sbthcd},'未上报',sbzt) sbzt2 from xmk_wqgz t where 1=1
 			and  sbthcd &lt;=#{sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and tbbmbm in(select id from xtgl_department 
 			where id=#{gydw} or parent=#{gydw})
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="qlmc!='' and qlmc!= null ">
 			and qlmc like '%'||(#{qlmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="akjfl!='' and akjfl!= null ">
 			and akjfl like '%'||(#{akjfl})||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sbzt desc
 </select>
  <select id="selectWqgzCount" parameterType="hashmap" resultType="int">
 		select count(*) from xmk_wqgz t where 1=1
 			and  sbthcd &lt;=#{sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and tbbmbm in(select id from xtgl_department 
 			where id=#{gydw} or parent=#{gydw})
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="qlmc!='' and qlmc!= null ">
 			and qlmc like '%'||(#{qlmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="akjfl!='' and akjfl!= null ">
 			and akjfl like '%'||(#{akjfl})||'%'
 		</if>
 </select>
 <select id="selectJckwqgzById" parameterType="jckwqgz" resultType="jckwqgz">
 	select * from xmk_wqgz where id=#{id}
 </select>
 <update id="updateJckwqgz" parameterType="jckwqgz">
 	update xmk_wqgz set qlmc=#{qlmc},qlbh=#{qlbh},xzqhmc=#{xzqhmc},xzqhdm=#{xzqhdm},lxmc=#{lxmc},lxbm=#{lxbm},
 		gydw=#{gydw},gydwbm=#{gydwbm},xjgjnd=#{xjgjnd},jsdj=#{jsdj},pddj=#{pddj},qlzxzh=#{qlzxzh},qlkd=#{qlkd},qlqc=#{qlqc},
 		kjzc=#{kjzc},dkzdkj=#{dkzdkj},akjfl=#{akjfl},sbjgxs=#{sbjgxs},bhnr=#{bhnr},bz=#{bz},xmnf=#{xmnf},xmtype=#{xmtype}
 		where id=#{id}
 </update>
 <update id="xgJckwqgzShzt" parameterType="jckwqgz" >
 	update xmk_wqgz set shzt='已审核',shsj=sysdate,shbm=#{shbm} where id=#{id}
 </update>
   <update id="xgJckwqgzSbzt" parameterType="hashmap" >
 	update xmk_wqgz set sbzt='已上报',sbsj=sysdate,sbbm=#{sbbm},sbthcd=#{sbthcd} where id in(#{delstr})
 </update>
  <update id="xgJckWqgzTH" parameterType="jckwqgz" >
 	update xmk_wqgz set sbzt='未上报',sbthcd=(sbthcd+2) where id =#{id}
 </update>
 
  <select id="selectGpsroad"  parameterType="hashmap" resultType="jckwqgz">
 	select roadbm qlbh,F002 qlmc,roadpos qlzxzh,gydw,DISTNAME xzqhmc,substr(roadcode,5,7) xzqhdm,roadname lxmc,
 		roadcode lxbm,F011 kjzc,F012 qlqc,F014 qlkd,F016 dkzdkj,F045 pddj,decode(substr(F052, 0, 4), null,substr(F051,0,4),
 		substr(F052, 0, 4)) xjgjnd,F010 akjfl,F022 sbjgxs,F112 bhnr,F074 bz 
		from JXJCK_2013.DATA50 where substr(roadcode,1,1) in('G','S','X','Y') and sfxzdm='1' and F045 in('四类','五类') 
		and F010 in('中桥','大桥','特大桥') and roadbm like #{qlbh} ||'%'
		order by roadbm,F002
 </select>
 
  <select id="JckWqgzRoad" parameterType="hashmap" resultType="jckwqgz">
 	select * from xmk_wqgz where shzt='已审核' and sbzt='已上报' and qlbh like #{qlbh}||'%' 
 	order by qlbh
 </select>
 
  <select id="selectJckShwqgz" parameterType="hashmap" resultType="jckwqgz">
 	select * from (
 		select rownum num ,t.* from xmk_wqgz t where sbzt='已上报' and sbthcd=7
			and sbthcd>=#{sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="qlmc!='' and qlmc!= null ">
 			and qlmc like '%'||(#{qlmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="akjfl!='' and akjfl!= null ">
 			and akjfl like '%'||(#{akjfl})||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by shzt desc
 </select>
  <select id="selectWqgzShCount" parameterType="hashmap" resultType="int">
 		select count(*) from xmk_wqgz t where sbzt='已上报' and sbthcd=7
			and sbthcd>=#{sbthcd}
 		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="qlmc!='' and qlmc!= null ">
 			and qlmc like '%'||(#{qlmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="jsdj!='' and jsdj!= null ">
 			and jsdj like '%'||(#{jsdj})||'%'
 		</if>
 		<if test="akjfl!='' and akjfl!= null ">
 			and akjfl like '%'||(#{akjfl})||'%'
 		</if>
 </select>
 <delete id="deleteJckWqgz" parameterType="String" >
 	delete from xmk_wqgz where id in #{delstr}
 </delete>
 <select id="onceWqgz" parameterType="jckwqgz" resultType="int">
 		select count(*) from xmk_wqgz where 1=1
 		<if test="qlbh!='' and qlbh!= null "  >
 			and qlbh=#{qlbh}
 		</if>
 		<if test="lxbm!='' and lxbm!= null "  >
 			or (lxbm=#{lxbm} and qlzxzh=#{qlzxzh})
 		</if>
 </select>
 
 <sql id="wqgz_commonsql">
 	<if test="gydw!= null and gydw!='' "  >
		and gydw like '%'||(#{gydw})||'%'
	</if>
	<if test="xzqhmc!='' and xzqhmc!= null "  >
		and xzqhmc like '%'||(#{xzqhmc})||'%'
	</if>
	<if test="lxmc!='' and lxmc!= null ">
		and lxmc like '%'||(#{lxmc})||'%'
	</if>
	<if test="qlmc!='' and qlmc!= null ">
		and qlmc like '%'||(#{qlmc})||'%'
	</if>
	<if test="xmnf!='' and xmnf!= null ">
		and xmnf like '%'||(#{xmnf})||'%'
	</if>
	<if test="xmtype!='' and xmtype!= null ">
		and xmtype like '%'||(#{xmtype})||'%'
	</if>
	<if test="shzt!='' and shzt!= null ">
		and shzt like '%'||(#{shzt})||'%'
	</if>
	<if test="jsdj!='' and jsdj!= null ">
		and jsdj like '%'||(#{jsdj})||'%'
	</if>
	<if test="akjfl!='' and akjfl!= null ">
		and akjfl like '%'||(#{akjfl})||'%'
	</if>
 </sql>
 <select id="exportExcel_wqgz" parameterType="jckwqgz" resultType="sjbb">
 	select
	sbzt v_0,gydw v_1,xzqhmc v_2,qlbh v_3,qlmc v_4,qlzxzh v_5,lxbm v_6,lxmc v_7,pddj v_8,xjgjnd v_9,xmnf v_10
 	from xmk_wqgz where 1=1
 	<include refid="wqgz_commonsql"/>
 </select>
 <insert id="importWqgz"  parameterType="hashMap">
	insert into xmk_wqgz(id,gydw,xzqhdm,xzqhmc,lxbm,lxmc,qlbh,qlmc,qlzxzh,xjgjnd,qlqc,qlkd,kjzc,dkzdkj,akjfl,sbjgxs,pddj,xmnf,xmtype,bhnr,bz,tbsj) 
		values(sys_guid(),#{0},#{1},#{2},#{3},#{4},#{5},#{6},#{7},#{8},#{9},#{10},#{11},#{12},#{13},#{14},#{15},#{16},#{17},#{18},#{19},sysdate)
 </insert>
  <select id="exportExcel_wqgz_sh" parameterType="jckwqgz" resultType="sjbb">
 	select
	shzt v_0,gydw v_1,xzqhmc v_2,qlbh v_3,qlmc v_4,qlzxzh v_5,lxbm v_6,lxmc v_7,pddj v_8,xjgjnd v_9,xmnf v_10
 	from xmk_wqgz where sbzt='已上报'
 	<include refid="wqgz_commonsql"/>
 </select>
</mapper>

