<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxzhpt.jckzhfz">
<insert id="insertJckzhfz"  parameterType="jckzhfz">
	insert into xmk_zhfz(id,lxbm,lxmc,gydw,gydwbm,qdzh,zdzh,qzlc,xzqhdm,xzqhmc,gjxjnd,lxjsdj,yhlc,xmnf,xmtype,yhnr,bz,tbbmbm,tbsj,sbzt,shzt)
		values(sys_guid(),#{lxbm},#{lxmc},#{gydw},#{gydwbm},#{qdzh},#{zdzh},#{qzlc},#{xzqhdm},#{xzqhmc},#{gjxjnd},#{lxjsdj},#{yhlc},#{xmnf},
		#{xmtype},#{yhnr},#{bz},#{tbbmbm},sysdate,'未上报','未审核')
</insert>
 
 <select id="selectJckzhfz" parameterType="hashmap" resultType="jckzhfz">
 	select * from (
 		select rownum num ,t.* from xmk_zhfz t where 1=1
 		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like #{lxbm}||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by sbzt desc
 </select>
 <select id="selectZhfzCount" parameterType="hashmap" resultType="int">
	select count(*) from xmk_zhfz where 1=1
 		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like #{lxbm}||'%'
 		</if>
 </select>
 <select id="selectJckzhfzById" parameterType="jckzhfz" resultType="jckzhfz">
 	select * from xmk_zhfz where id=#{id}
 </select>
 <update id="updateJckzhfz" parameterType="jckzhfz" >
 	update xmk_zhfz set lxbm=#{lxbm},lxmc=#{lxmc},gydw=#{gydw},gydwbm=#{gydwbm},qdzh=#{qdzh},zdzh=#{zdzh},
 	qzlc=#{qzlc},xzqhdm=#{xzqhdm},xzqhmc=#{xzqhmc},gjxjnd=#{gjxjnd},lxjsdj=#{lxjsdj},yhlc=#{yhlc},xmnf=#{xmnf},xmtype=#{xmtype},
 	yhnr=#{yhnr},bz=#{bz} where id=#{id}
 </update>
 <update id="xgJckzhfzShzt" parameterType="jckzhfz" >
 	update xmk_zhfz set shzt='已审核' where id=#{id}
 </update>
 <update id="xgJckzhfzSbzt" parameterType="String" >
 	update xmk_zhfz set shzt='未审核',sbzt='已上报' where id in(#{delstr})
 </update>
 <update id="xgJckZhfzTH" parameterType="jckzhfz" >
 	update xmk_zhfz set sbzt='未上报' where id =#{id}
 </update>
  <select id="selectGpsroad"  parameterType="hashmap" resultType="jckzhfz">
 	select roadcode lxbm,roadname lxmc,min(roadstart) qdzh,max(roadends) zdzh,(max(roadends)-min(roadstart)) qzlc,
 	substr(roadcode,5,7) xzqhdm, (select name from xtgl_xzqh where id=substr(roadcode,5,7)) xzqhmc,F044 gydwbm,F045 gydw,
 	decode(max(substr(F026, 0, 4)), null, max(substr(F025,0,4)), max(substr(F026, 0, 4))) gjxjnd,F114 lxjsdj from JXJCK_2013.GPSROAD where
 	substr(roadcode,1,1) in('G','S') and F048='1' and roadcode like #{lxbm} ||'%' and <![CDATA[ROWNUM <=50]]>
 	group by roadname,roadcode,F114,F044,F045
  	order by roadcode,min(roadstart)
 </select>
  <select id="JckzhfzRoad" parameterType="hashmap" resultType="jckzhfz">
 	select id,lxbm,lxmc,gydw,qdzh,zdzh,qzlc,xzqhdm,xzqhmc,gjxjnd,lxjsdj,yhlc,xmnf,xmtype,yhnr,bz
 	from xmk_zhfz where shzt='已审核' and sbzt='已上报' and lxbm like #{lxbm}||'%' 
<!--  	group by lxmc,lxbm -->
 	order by lxbm
 </select>
 
 <delete id="deleteJckzhfz" parameterType="String" >
 	delete from xmk_zhfz where id in #{delstr}
 </delete>
 
  <select id="selectJckShzhfz" parameterType="hashmap" resultType="jckzhfz">
 	select * from (
 		select rownum num ,t.* from xmk_zhfz t where sbzt='已上报'
 		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like #{lxbm}||'%'
 		</if>
 			) t1 where t1.num &lt;=(#{page} * #{rows}) and t1.num>(#{page}-1)*#{rows} 
 			order by shzt desc
 </select>
 <select id="selectZhfzShCount" parameterType="hashmap" resultType="int">
	select count(*) from xmk_zhfz where sbzt='已上报'
 		<if test="gydw!='' and gydw!= null "  >
 			and gydw like '%'||(#{gydw})||'%'
 		</if>
 		<if test="xzqhmc!='' and xzqhmc!= null "  >
 			and xzqhmc like '%'||(#{xzqhmc})||'%'
 		</if>
 		<if test="lxmc!='' and lxmc!= null ">
 			and lxmc like '%'||(#{lxmc})||'%'
 		</if>
 		<if test="xmnf!='' and xmnf!= null ">
 			and xmnf like '%'||(#{xmnf})||'%'
 		</if>
 		<if test="xmtype!='' and xmtype!= null ">
 			and xmtype like '%'||(#{xmtype})||'%'
 		</if>
 		<if test="shzt!='' and shzt!= null ">
 			and shzt like '%'||(#{shzt})||'%'
 		</if>
 		<if test="lxjsdj!='' and lxjsdj!= null ">
 			and lxjsdj like '%'||(#{lxjsdj})||'%'
 		</if>
 		<if test="lxbm!='' and lxbm!= null ">
 			and lxbm like #{lxbm}||'%'
 		</if>
 </select>
 <sql id="zhfz_commonsql">
 	<if test="gydw!='' and gydw!= null "  >
		and gydw like '%'||(#{gydw})||'%'
	</if>
	<if test="xzqhmc!='' and xzqhmc!= null "  >
		and xzqhmc like '%'||(#{xzqhmc})||'%'
	</if>
	<if test="lxmc!='' and lxmc!= null ">
		and lxmc like '%'||(#{lxmc})||'%'
	</if>
	<if test="xmnf!='' and xmnf!= null ">
		and xmnf like '%'||(#{xmnf})||'%'
	</if>
	<if test="xmtype!='' and xmtype!= null ">
		and xmtype like '%'||(#{xmtype})||'%'
	</if>
	<if test="shzt!='' and shzt!= null ">
		and shzt like '%'||(#{shzt})||'%'
	</if>
	<if test="lxjsdj!='' and lxjsdj!= null ">
		and lxjsdj like '%'||(#{lxjsdj})||'%'
	</if>
	<if test="lxbm!='' and lxbm!= null ">
		and lxbm like #{lxbm}||'%'
	</if>
 </sql>
 <select id="exportExcel_zhfz" parameterType="jckzhfz" resultType="sjbb">
 	select
	sbzt v_0,gydw v_1,xzqhmc v_2,lxbm v_3,lxmc v_4,qdzh v_5,zdzh v_6,qzlc v_7,qzlc v_8,yhlc v_9,gjxjnd v_10,xmnf v_11
 	from xmk_zhfz where 1=1
 	<include refid="zhfz_commonsql"/>
 </select>
 <insert id="importZhfz"  parameterType="hashMap">
	insert into xmk_zhfz(id,gydw,xzqhdm,xzqhmc,lxbm,lxmc,qdzh,zdzh,zlc,yhlc,gjxjnd,yhnr,xmnf,xmtype,bz,tbsj) 
	values(sys_guid(),#{0},#{1},#{2},#{3},#{4},#{5},#{6},#{7},#{8},#{9},#{10},#{11},#{12},#{13},sysdate)
 </insert>
 <select id="exportExcel_zhfz_sh" parameterType="jckzhfz" resultType="sjbb">
 	select
	shzt v_0,gydw v_1,xzqhmc v_2,lxbm v_3,lxmc v_4,qdzh v_5,zdzh v_6,qzlc v_7,qzlc v_8,yhlc v_9,gjxjnd v_10,xmnf v_11
 	from xmk_zhfz
 	where 1=1 and sbzt='已上报'
 	<include refid="zhfz_commonsql"/>
 </select>
</mapper>