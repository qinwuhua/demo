<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxcsxm.jhcx">
	<select id="queryXmlist" parameterType="xmjbxx" resultType="xmjbxx">
		select * from (select rownum num ,t.*,xd.jhxdwh  from xmjbxx t
		left join(select xmid,replace(WMSYS.WM_CONCAT(distinct jhxdwh),',',',') jhxdwh from xm_gsd_jhxd where 1=1 <if test="jhxdwh !='' and jhxdwh != null">${jhxdwh}</if> group by xmid) xd
		on t.xmbm=xd.xmid	
		where 1=1 
		<if test="xzqh !='' and xzqh != null">${xzqh}</if>
		<if test="gydwdm !='' and gydwdm != null">${gydwdm}</if>
		<if test="xmnf !='' and xmnf != null">${xmnf}</if>
		<if test="jsxz !='' and jsxz != null">and jsxz =#{jsxz}</if>
		<if test="jhxdwh !='' and jhxdwh != null">${jhxdwh}</if>
		<if test="gcfl !='' and gcfl != null">${gcfl}</if>
		<if test="xmbm !='' and xmbm != null">and xmbm like '%'||#{xmbm}||'%'</if>
		<if test="xmmc !='' and xmmc != null">and xmmc like '%'||#{xmmc}||'%'</if>
		<if test="gydw !='' and gydw != null">and gydwdm like #{gydw}||'%'</if>
		and rownum &lt;=(#{page} * #{rows})
		) t1 
		 where t1.num>(#{page}-1)*#{rows}
		order by jhxdwh,xmnf,xmbm
	</select>
	<select id="queryXmlistCount" parameterType="xmjbxx" resultType="int">
		select count(*) from xmjbxx t
		left join(select xmid,replace(WMSYS.WM_CONCAT(distinct jhxdwh),',',',') jhxdwh from xm_gsd_jhxd where 1=1 <if test="jhxdwh !='' and jhxdwh != null">${jhxdwh}</if> group by xmid) xd
		on t.xmbm=xd.xmid	
		where 1=1 
		<if test="xzqh !='' and xzqh != null">${xzqh}</if>
		<if test="gydwdm !='' and gydwdm != null">${gydwdm}</if>
		<if test="xmnf !='' and xmnf != null">${xmnf}</if>
		<if test="jsxz !='' and jsxz != null">and jsxz =#{jsxz}</if>
		<if test="gcfl !='' and gcfl != null">${gcfl}</if>
		<if test="jhxdwh !='' and jhxdwh != null">${jhxdwh}</if>
		<if test="xmbm !='' and xmbm != null">and xmbm like '%'||#{xmbm}||'%'</if>
		<if test="xmmc !='' and xmmc != null">and xmmc like '%'||#{xmmc}||'%'</if>
		<if test="gydw !='' and gydw != null">and gydwdm like #{gydw}||'%'</if>
		
	</select>
	<select id="getTjAll" parameterType="xmjbxx" resultType="xmjbxx">
		select count(*) xmsl,sum(nvl(dwzbz,0)) dwzbz,sum(nvl(dwbb,0)) dwbb,sum(nvl(dwsb,0)) dwsb,sum(nvl(dwdf,0)) dwdf,sum(nvl(bfzbz,0)) bfzbz,sum(nvl(bfbb,0)) bfbb,sum(nvl(bfsb,0)) bfsb,sum(nvl(bfdf,0)) bfdf,sum(nvl(tjzbz,0)) tjzbz,sum(nvl(tjbb,0)) tjbb,sum(nvl(tjsb,0)) tjsb,sum(nvl(tjdf,0)) tjdf,sum(nvl(xdzbz,0)) xdzbz,sum(nvl(xdbb,0)) xdbb,sum(nvl(xdsb,0)) xdsb,sum(nvl(xddf,0)) xddf from(
        select t.*,xd.jhxdwh,nvl(dwzbz,0) dwzbz,nvl(dwbb,0) dwbb,nvl(dwsb,0) dwsb,nvl(dwdf,0) dwdf,nvl(bfzbz,0) bfzbz,nvl(bfbb,0) bfbb,nvl(bfsb,0) bfsb,nvl(bfdf,0) bfdf,nvl(tjzbz,0) tjzbz,nvl(tjbb,0) tjbb,nvl(tjsb,0) tjsb,nvl(tjdf,0) tjdf,nvl(xdzbz,0) xdzbz,nvl(xdbb,0) xdbb,nvl(xdsb,0) xdsb,nvl(xddf,0) xddf from xmjbxx t
        left join(select xmid,replace(WMSYS.WM_CONCAT(distinct jhxdwh),',',',') jhxdwh,sum(nvl(btzzj,0))+sum(nvl(gz,0))+sum(nvl(sz,0))+sum(nvl(zq,0))+sum(nvl(dk,0))+sum(nvl(jl,0))+sum(nvl(qt,0))+sum(nvl(rys,0))+sum(nvl(stz,0)+ nvl(ttc, 0) + nvl(zddzjl, 0)) xdzbz,sum(nvl(btzzj,0)) xdbb,sum(nvl(gz,0))+sum(nvl(sz,0))+sum(nvl(zq,0))+sum(nvl(dk,0))+sum(nvl(jl,0))+sum(nvl(qt,0))+sum(nvl(rys,0))+sum(nvl(stz,0)+ nvl(ttc, 0) + nvl(zddzjl, 0)) xdsb,sum(nvl(yhdk,0))+sum(nvl(dfzc,0)) xddf from xm_gsd_jhxd where 1=1 <if test="jhxdwh !='' and jhxdwh != null">${jhxdwh}</if> group by xmid) xd
        on t.xmbm=xd.xmid 
        left join(
        select xmbm xmids,sum(ztz) bfzj,sum(nvl(cgs, 0)) bfbb,sum(nvl(gz, 0) +nvl(sz, 0) + nvl(zq, 0) + nvl(tdk, 0) + nvl(jl, 0) + nvl(qt, 0) + nvl(rys, 0) + nvl(stz, 0) + nvl(ttc, 0) +nvl(zddzjl, 0)) bfsb,sum(nvl(cgs, 0) + nvl(gz, 0) +nvl(sz, 0) + nvl(zq, 0) + nvl(tdk, 0) + nvl(jl, 0) +nvl(qt, 0) + nvl(rys, 0) + nvl(stz, 0) + nvl(ttc, 0) +nvl(zddzjl, 0)) bfzbz,sum(nvl(dfzc,0)+nvl(yhdk,0)) bfdf 
        from xm_zjbf where to_number(sbthcd)&lt;=${sbthcd} group by xmbm
        ) bf on t.xmbm=bf.xmids
        left join 
        (select xmbm xmidss,sum(ztz) dwzj,sum(nvl(cgs, 0)) dwbb,sum(nvl(gz, 0) +nvl(sz, 0) + nvl(zq, 0) + nvl(tdk, 0) + nvl(jl, 0) + nvl(qt, 0) + nvl(rys, 0) + nvl(stz, 0) + nvl(ttc, 0) +nvl(zddzjl, 0)) dwsb,sum(nvl(cgs, 0) + nvl(gz, 0) +nvl(sz, 0) + nvl(zq, 0) + nvl(tdk, 0) + nvl(jl, 0) +nvl(qt, 0) + nvl(rys, 0) + nvl(stz, 0) + nvl(ttc, 0) +nvl(zddzjl, 0)) dwzbz,sum(nvl(dfzc,0)+nvl(yhdk,0)) dwdf
        from xm_zjdw where to_number(sbthcd)&lt;=${sbthcd} and trxmbm is null group by xmbm) dw on t.xmbm=dw.xmidss
        left join (select sum(nvl(cgs, 0)) tjbb,sum(nvl(gz, 0) +nvl(sz, 0) + nvl(zq, 0) + nvl(tdk, 0) + nvl(jl, 0) + nvl(qt, 0) + nvl(rys, 0) + nvl(stz, 0) + nvl(ttc, 0) +nvl(zddzjl, 0)) tjsb,sum(nvl(cgs, 0) + nvl(gz, 0) +nvl(sz, 0) + nvl(zq, 0) + nvl(tdk, 0) + nvl(jl, 0) +nvl(qt, 0) + nvl(rys, 0) + nvl(stz, 0) + nvl(ttc, 0) +nvl(zddzjl, 0)) tjzbz,sum(nvl(dfzc,0)+nvl(yhdk,0)) tjdf,xmbm xmbmsss from xm_zjtj group by xmbm) tj on t.xmbm=tj.xmbmsss
        where 1=1  
		<if test="xzqh !='' and xzqh != null">${xzqh}</if>
		<if test="gydwdm !='' and gydwdm != null">${gydwdm}</if>
		<if test="xmnf !='' and xmnf != null">${xmnf}</if>
		<if test="jsxz !='' and jsxz != null">and jsxz =#{jsxz}</if>
		<if test="jhxdwh !='' and jhxdwh != null">${jhxdwh}</if>
		<if test="gcfl !='' and gcfl != null">${gcfl}</if>
		<if test="xmbm !='' and xmbm != null">and xmbm like '%'||#{xmbm}||'%'</if>
		<if test="xmmc !='' and xmmc != null">and xmmc like '%'||#{xmmc}||'%'</if>
		<if test="gydw !='' and gydw != null">and gydwdm like #{gydw}||'%'</if>
		) where 1=1
		
		
		
	</select>
	
	<select id="getxmInfo" parameterType="xmjbxx" resultType="xmjbxx">
		select t.*,xd.jhxdwh,decode(jsxz,'路网结构改造',gcfl,jsxz) xmlx  from xmjbxx t
		left join(select xmid,replace(WMSYS.WM_CONCAT(distinct jhxdwh),',',',') jhxdwh from xm_gsd_jhxd group by xmid) xd
		on t.xmbm=xd.xmid	 where xmbm=#{xmbm}
	</select>
	
	<select id="gettjxmInfo" parameterType="xmjbxx" resultType="xmjbxx">
		select t.*,xd.jhxdwh,decode(jsxz,'路网结构改造',gcfl,jsxz) xmlx  from xmjbxx_tj t
		left join(select xmbm xmid,replace(WMSYS.WM_CONCAT(distinct jhxdwh),',',',') jhxdwh from xm_zjdw group by xmbm) xd
		on t.xmbm=xd.xmid	 where xmbm=#{xmbm}
	</select>
	
	<select id="queryZjByGydwdm" parameterType="xmjbxx" resultType="xmjbxx">
		select * from xm_gsd_jhxd z where xdnf=#{xdnf} <if test="jhxdwh !=null">and jhxdwh=#{jhxdwh}</if> and z.parent=#{gydwdm} order by gydwdm
	</select>
	<select id="queryZjByGydwdmJtj" parameterType="xmjbxx" resultType="xmjbxx">
		select * from xm_gsd_jhxd z where xdnf=#{xdnf} <if test="jhxdwh !=null">and jhxdwh=#{jhxdwh}</if> and (z.parent=#{gydwdm} or gydwdm like rtrim(#{gydwdm}, '0')||'%') order by gydwdm
	</select>
	
</mapper>
