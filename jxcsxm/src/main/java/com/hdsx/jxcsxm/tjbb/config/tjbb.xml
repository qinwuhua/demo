<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "/xsd/mybatis-3-mapper.dtd">
<mapper namespace="com.hdsx.jxcsxm.tjbb">
	<select id="createBtTree" parameterType="elist" resultType="treenode">
	select 
	value id,text,state,(case when value not like '%v_%' then substr(id,0,length(id)-1)
	else id
	end) parent,id id1,xh
	from(
	select (case when value like '%v_%' then substr(value,0,instr(value,'v')-1) else value end) id,name text,'open' state,value,xh
	from ZDYBBBT where ssbb=#{ssbb} and value like #{treeno}||'%' 
	)
	order by (case when id like '%v_%' then id1||'v_' else id end), to_number(substr(id,instr(id, 'v') + 2)), xh
	</select>
	<select id="getZdyBbzd" parameterType="elist" resultType="elist">
	  select t2.value, t2.name, t1.co, t2.hight, t2.rowxh, t2.width
	  from (select substr1 value, count(*) co
	          from zdybbbt
	         where value in
	               (${name}) and ssbb=#{ssbb}
	         group by substr1
	        union all
	        select substr2 value, count(*) co
	          from zdybbbt
	         where value in
	               (${name}) and ssbb=#{ssbb}
	           and substr2 is not null
	         group by substr2
	        union all
	        select substr3 value, count(*) co
	          from zdybbbt
	         where value in
	               (${name}) and ssbb=#{ssbb}
	           and substr3 is not null
	         group by substr3
	        union all
	        select value, count(*) co
	          from zdybbbt
	         where value in
	               (${name}) and ssbb=#{ssbb}
	         group by value) t1,
	       zdybbbt t2
	 where t1.value = t2.value and ssbb=#{ssbb}
	 order by t2.xh
	</select>
	<select id="getJhzxqkb" parameterType="elist" resultType="elist">
		select rownum v_0,bb.* from(
			select distinct
			xd.jhxdwh v_1,xm.gydw v_2,xm.xmmc v_3,xm.ztz v_4,wc.wcl v_5,wc.wctz v_6,nvl(to_char(decode(xm.ztz,null,'0','0','0',round(nvl(wc.wctz,0)/xm.ztz*100,2))),'0')||'%' v_7,
			xd.ztz v_8,xd.cgs v_9,xd.rys v_10,xd.ttc v_11,xd.dfzc v_12,
			dw.ztz v_13,dw.cgs v_14,dw.rys v_15,dw.ttc v_16,dw.dfzc v_17,
			bf.ztz v_18,bf.cgs v_19,bf.rys v_20,bf.ttc v_21,bf.dfzc v_22,
			decode(dw.ztz,null,null,to_char(decode(xd.ztz,null,0,0,0,round(dw.ztz/xd.ztz*100,2)),'fm9999999990.00')||'%') v_23,
			decode(bf.ztz,null,null,to_char(decode(dw.ztz,null,0,0,0,round(bf.ztz/dw.ztz*100,2)),'fm9999999990.00')||'%') v_24,
			xm.gydwdm,substr(xm.xzqhdm,0,4)||'00' xzqhdm
			from
			(select xmid,jhxdwh,xdnf,sum(nvl(ztz,0)) ztz,
			sum(nvl(btzzj,0)) cgs,sum(nvl(rys,0)) rys,sum(nvl(ztz,0))-sum(nvl(btzzj,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(nvl(dfzc,0)) dfzc 
			from xm_gsd_jhxd where jhxdwh is not null group by xmid,jhxdwh,xdnf) xd,
			xmjbxx xm,xm_xmwc wc,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjdw where dwyf like #{jhnf}||'%' group by xmbm,jhxdwh) dw,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjbf where bfyf like #{jhnf}||'%' group by xmbm,jhxdwh) bf
			where xd.xmid=xm.xmbm and xd.xmid=wc.xmbm(+) and xd.xmid=dw.xmbm(+) and xd.xmid=bf.xmbm(+) and xd.jhxdwh=dw.jhxdwh(+) and xd.jhxdwh=bf.jhxdwh(+) and xd.jhxdwh is not null and xd.jhxdwh!=' '
			and xm.gydwdm!='11101360000'
			<if test="jhnf != null">and xd.xdnf=#{jhnf}</if>
			<if test="xzqhdm != null">${xzqhdm}</if>
			<if test="jhxdwh != null">${jhxdwh}</if>
			<if test="xmlx != null">${xmlx}</if>
			order by xzqhdm,gydwdm
		)bb
	</select>
	
	<select id="getJhzxqkbWh" parameterType="elist" resultType="elist">
		select rownum v_0,bb.* from(
			select distinct
			xd.jhxdwh v_1,xm.gydw v_2,xm.xmmc v_3,xm.ztz v_4,wc.wcl v_5,wc.wctz v_6,nvl(to_char(decode(xm.ztz,null,'0','0','0',round(nvl(wc.wctz,0)/xm.ztz*100,2))),'0')||'%' v_7,
			xd.ztz v_8,xd.cgs v_9,xd.rys v_10,xd.ttc v_11,xd.dfzc v_12,
			dw.ztz v_13,dw.cgs v_14,dw.rys v_15,dw.ttc v_16,dw.dfzc v_17,
			bf.ztz v_18,bf.cgs v_19,bf.rys v_20,bf.ttc v_21,bf.dfzc v_22,
			decode(dw.ztz,null,null,to_char(decode(xd.ztz,null,0,0,0,round(dw.ztz/xd.ztz*100,2)),'fm9999999990.00')||'%') v_23,
			decode(bf.ztz,null,null,to_char(decode(dw.ztz,null,0,0,0,round(bf.ztz/dw.ztz*100,2)),'fm9999999990.00')||'%') v_24,
			xm.gydwdm,substr(xm.xzqhdm,0,4)||'00' xzqhdm
			from
			(select xmid,jhxdwh,xdnf,sum(nvl(ztz,0)) ztz,
			sum(nvl(btzzj,0)) cgs,sum(nvl(rys,0)) rys,sum(nvl(ztz,0))-sum(nvl(btzzj,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(nvl(dfzc,0)) dfzc 
			from xm_gsd_jhxd where jhxdwh is not null group by xmid,jhxdwh,xdnf) xd,
			xmjbxx xm,xm_xmwc wc,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjdw where dwyf like #{jhnf}||'%' group by xmbm,jhxdwh) dw,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjbf where bfyf like #{jhnf}||'%' group by xmbm,jhxdwh) bf
			where xd.xmid=xm.xmbm and xd.xmid=wc.xmbm(+) and xd.xmid=dw.xmbm(+) and xd.xmid=bf.xmbm(+) and xd.jhxdwh=dw.jhxdwh(+) and xd.jhxdwh=bf.jhxdwh(+) and xd.jhxdwh is not null and xd.jhxdwh!=' '
			and xm.gydwdm!='11101360000'
			<if test="jhnf != null">and xd.xdnf=#{jhnf}</if>
			<if test="xzqhdm != null">${xzqhdm}</if>
			<if test="jhxdwh != null">${jhxdwh}</if>
			<if test="xmlx != null">${xmlx}</if>
			order by xzqhdm,gydwdm
		)bb where xzqhdm=#{xzqh} and v_1=#{v_1}
	</select>
	
	<select id="getJhzxqkbXm" parameterType="elist" resultType="elist">
		select rownum v_0,bb.* from(
			select distinct
			xd.jhxdwh v_1,xm.gydw v_2,xm.xmmc v_3,xm.ztz v_4,wc.wcl v_5,wc.wctz v_6,nvl(to_char(decode(xm.ztz,null,'0','0','0',round(nvl(wc.wctz,0)/xm.ztz*100,2))),'0')||'%' v_7,
			xd.ztz v_8,xd.cgs v_9,xd.rys v_10,xd.ttc v_11,xd.dfzc v_12,
			dw.ztz v_13,dw.cgs v_14,dw.rys v_15,dw.ttc v_16,dw.dfzc v_17,
			bf.ztz v_18,bf.cgs v_19,bf.rys v_20,bf.ttc v_21,bf.dfzc v_22,
			decode(dw.ztz,null,null,to_char(decode(xd.ztz,null,0,0,0,round(dw.ztz/xd.ztz*100,2)),'fm9999999990.00')||'%') v_23,
			decode(bf.ztz,null,null,to_char(decode(dw.ztz,null,0,0,0,round(bf.ztz/dw.ztz*100,2)),'fm9999999990.00')||'%') v_24,
			xm.gydwdm,substr(xm.xzqhdm,0,4)||'00' xzqhdm,xm.xmbm
			from
			(select xmid,jhxdwh,xdnf,sum(nvl(ztz,0)) ztz,
			sum(nvl(btzzj,0)) cgs,sum(nvl(rys,0)) rys,sum(nvl(ztz,0))-sum(nvl(btzzj,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(nvl(dfzc,0)) dfzc 
			from xm_gsd_jhxd where jhxdwh is not null group by xmid,jhxdwh,xdnf) xd,
			xmjbxx xm,xm_xmwc wc,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjdw where dwyf like #{jhnf}||'%' group by xmbm,jhxdwh) dw,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjbf where bfyf like #{jhnf}||'%' group by xmbm,jhxdwh) bf
			where xd.xmid=xm.xmbm and xd.xmid=wc.xmbm(+) and xd.xmid=dw.xmbm(+) and xd.xmid=bf.xmbm(+) and xd.jhxdwh=dw.jhxdwh(+) and xd.jhxdwh=bf.jhxdwh(+) and xd.jhxdwh is not null and xd.jhxdwh!=' '
			and xm.gydwdm!='11101360000'
			<if test="jhnf != null">and xd.xdnf=#{jhnf}</if>
			<if test="xzqhdm != null">${xzqhdm}</if>
			<if test="jhxdwh != null">${jhxdwh}</if>
			<if test="xmlx != null">${xmlx}</if>
			order by xzqhdm,gydwdm
		)bb where xzqhdm=#{xzqh} and xmbm=#{xmbm}
	</select>
	
	
	<select id="getJhzxqkbHj" parameterType="elist" resultType="elist">
		select 
		xzqhdm,(select name from xtgl_xzqh where id=xzqhdm)||'合计' v_1,
		nvl(sum(v_4),0) v_4,nvl(sum(v_5),0) v_5,nvl(sum(v_6),0) v_6,
		nvl(to_char(decode(nvl(sum(v_4),0),null,'0','0','0',round(nvl(sum(v_6),0)/nvl(sum(v_4),0)*100,2))),'0')||'%' v_7,
		nvl(sum(v_8),0) v_8,nvl(sum(v_9),0) v_9,nvl(sum(v_10),0) v_10,
		nvl(sum(v_11),0) v_11,nvl(sum(v_12),0) v_12,nvl(sum(v_13),0) v_13,
		nvl(sum(v_14),0) v_14,nvl(sum(v_15),0) v_15,nvl(sum(v_16),0) v_16,
		nvl(sum(v_17),0) v_17,nvl(sum(v_18),0) v_18,nvl(sum(v_19),0) v_19,
		nvl(sum(v_20),0) v_20,nvl(sum(v_21),0) v_21,nvl(sum(v_22),0) v_22,
		decode(nvl(sum(v_13),0),null,null,to_char(decode(nvl(sum(v_8),0),null,0,0,0,round(nvl(sum(v_13),0)/nvl(sum(v_8),0)*100,2)),'fm9999999990.00')||'%') v_23,
		decode(nvl(sum(v_18),0),null,null,to_char(decode(nvl(sum(v_13),0),null,0,0,0,round(nvl(sum(v_18),0)/nvl(sum(v_13),0)*100,2)),'fm9999999990.00')||'%') v_24
		from 
		(
		select rownum v_0,bb.* from(
			select distinct
			xd.jhxdwh v_1,xm.gydw v_2,xm.xmmc v_3,xm.ztz v_4,wc.wcl v_5,wc.wctz v_6,nvl(to_char(decode(xm.ztz,null,'0','0','0',round(nvl(wc.wctz,0)/xm.ztz*100),2)),'0')||'%' v_7,
			xd.ztz v_8,xd.cgs v_9,xd.rys v_10,xd.ttc v_11,xd.dfzc v_12,
			dw.ztz v_13,dw.cgs v_14,dw.rys v_15,dw.ttc v_16,dw.dfzc v_17,
			bf.ztz v_18,bf.cgs v_19,bf.rys v_20,bf.ttc v_21,bf.dfzc v_22,
			decode(dw.ztz,null,null,to_char(decode(xd.ztz,null,0,0,0,round(dw.ztz/xd.ztz*100,2)),'fm9999999990.00')||'%') v_23,
			decode(bf.ztz,null,null,to_char(decode(dw.ztz,null,0,0,0,round(bf.ztz/dw.ztz*100,2)),'fm9999999990.00')||'%') v_24,
			xm.gydwdm,substr(xm.xzqhdm,0,4)||'00' xzqhdm
			from
			(select xmid,jhxdwh,xdnf,sum(nvl(ztz,0)) ztz,
			sum(nvl(btzzj,0)) cgs,sum(nvl(rys,0)) rys,sum(nvl(ztz,0))-sum(nvl(btzzj,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(nvl(dfzc,0)) dfzc 
			from xm_gsd_jhxd where jhxdwh is not null group by xmid,jhxdwh,xdnf) xd,
			xmjbxx xm,xm_xmwc wc,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjdw where dwyf like #{jhnf}||'%' group by xmbm,jhxdwh) dw,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjbf where bfyf like #{jhnf}||'%' group by xmbm,jhxdwh) bf
			where xd.xmid=xm.xmbm and xd.xmid=wc.xmbm(+) and xd.xmid=dw.xmbm(+) and xd.xmid=bf.xmbm(+) and xd.jhxdwh=dw.jhxdwh(+) and xd.jhxdwh=bf.jhxdwh(+) and xd.jhxdwh is not null and xd.jhxdwh!=' '
			and xm.gydwdm!='11101360000'
			<if test="xzqhdm != null">${xzqhdm}</if>
			<if test="jhnf != null">and xd.xdnf=#{jhnf}</if>
			<if test="jhxdwh != null">${jhxdwh}</if>
			<if test="xmlx != null">${xmlx}</if>
			order by xzqhdm,gydwdm
		)bb
		)
		group by xzqhdm order by xzqhdm
	</select>
	
	<select id="getJhzxqkbWhHj" parameterType="elist" resultType="elist">
		select 
		count(*) xmsl,xzqhdm,v_1,min(v_2) v_2,min(v_3) v_3,
		nvl(sum(v_4),0) v_4,nvl(sum(v_5),0) v_5,nvl(sum(v_6),0) v_6,
		nvl(to_char(decode(nvl(sum(v_4),0),null,'0','0','0',round(nvl(sum(v_6),0)/nvl(sum(v_4),0)*100,2))),'0')||'%' v_7,
		nvl(sum(v_8),0) v_8,nvl(sum(v_9),0) v_9,nvl(sum(v_10),0) v_10,
		nvl(sum(v_11),0) v_11,nvl(sum(v_12),0) v_12,nvl(sum(v_13),0) v_13,
		nvl(sum(v_14),0) v_14,nvl(sum(v_15),0) v_15,nvl(sum(v_16),0) v_16,
		nvl(sum(v_17),0) v_17,nvl(sum(v_18),0) v_18,nvl(sum(v_19),0) v_19,
		nvl(sum(v_20),0) v_20,nvl(sum(v_21),0) v_21,nvl(sum(v_22),0) v_22,
		decode(nvl(sum(v_13),0),null,null,to_char(decode(nvl(sum(v_8),0),null,0,0,0,round(nvl(sum(v_13),0)/nvl(sum(v_8),0)*100,2)),'fm9999999990.00')||'%') v_23,
		decode(nvl(sum(v_18),0),null,null,to_char(decode(nvl(sum(v_13),0),null,0,0,0,round(nvl(sum(v_18),0)/nvl(sum(v_13),0)*100,2)),'fm9999999990.00')||'%') v_24
		from 
		(
		select rownum v_0,bb.* from(
			select distinct
			xd.jhxdwh v_1,xm.gydw v_2,xm.xmmc v_3,xm.ztz v_4,wc.wcl v_5,wc.wctz v_6,nvl(to_char(decode(xm.ztz,null,'0','0','0',round(nvl(wc.wctz,0)/xm.ztz*100),2)),'0')||'%' v_7,
			xd.ztz v_8,xd.cgs v_9,xd.rys v_10,xd.ttc v_11,xd.dfzc v_12,
			dw.ztz v_13,dw.cgs v_14,dw.rys v_15,dw.ttc v_16,dw.dfzc v_17,
			bf.ztz v_18,bf.cgs v_19,bf.rys v_20,bf.ttc v_21,bf.dfzc v_22,
			decode(dw.ztz,null,null,to_char(decode(xd.ztz,null,0,0,0,round(dw.ztz/xd.ztz*100,2)),'fm9999999990.00')||'%') v_23,
			decode(bf.ztz,null,null,to_char(decode(dw.ztz,null,0,0,0,round(bf.ztz/dw.ztz*100,2)),'fm9999999990.00')||'%') v_24,
			xm.gydwdm,substr(xm.xzqhdm,0,4)||'00' xzqhdm
			from
			(select xmid,jhxdwh,xdnf,sum(nvl(ztz,0)) ztz,
			sum(nvl(btzzj,0)) cgs,sum(nvl(rys,0)) rys,sum(nvl(ztz,0))-sum(nvl(btzzj,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(nvl(dfzc,0)) dfzc 
			from xm_gsd_jhxd where jhxdwh is not null group by xmid,jhxdwh,xdnf) xd,
			xmjbxx xm,xm_xmwc wc,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjdw where dwyf like #{jhnf}||'%' group by xmbm,jhxdwh) dw,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjbf where bfyf like #{jhnf}||'%' group by xmbm,jhxdwh) bf
			where xd.xmid=xm.xmbm and xd.xmid=wc.xmbm(+) and xd.xmid=dw.xmbm(+) and xd.xmid=bf.xmbm(+) and xd.jhxdwh=dw.jhxdwh(+) and xd.jhxdwh=bf.jhxdwh(+) and xd.jhxdwh is not null and xd.jhxdwh!=' '
			and xm.gydwdm!='11101360000'
			<if test="xzqhdm != null">${xzqhdm}</if>
			<if test="jhnf != null">and xd.xdnf=#{jhnf}</if>
			<if test="jhxdwh != null">${jhxdwh}</if>
			<if test="xmlx != null">${xmlx}</if>
			order by xzqhdm,gydwdm
		)bb
		)
		group by xzqhdm,v_1 order by xzqhdm
	</select>
	
	<select id="getJhzxqkbXmHj" parameterType="elist" resultType="elist">
		select 
		count(*) xmsl,xzqhdm,min(v_1) v_1,min(v_2) v_2,min(v_3) v_3,xmbm,
		nvl(sum(v_4),0) v_4,nvl(sum(v_5),0) v_5,nvl(sum(v_6),0) v_6,
		nvl(to_char(decode(nvl(sum(v_4),0),null,'0','0','0',round(nvl(sum(v_6),0)/nvl(sum(v_4),0)*100,2))),'0')||'%' v_7,
		nvl(sum(v_8),0) v_8,nvl(sum(v_9),0) v_9,nvl(sum(v_10),0) v_10,
		nvl(sum(v_11),0) v_11,nvl(sum(v_12),0) v_12,nvl(sum(v_13),0) v_13,
		nvl(sum(v_14),0) v_14,nvl(sum(v_15),0) v_15,nvl(sum(v_16),0) v_16,
		nvl(sum(v_17),0) v_17,nvl(sum(v_18),0) v_18,nvl(sum(v_19),0) v_19,
		nvl(sum(v_20),0) v_20,nvl(sum(v_21),0) v_21,nvl(sum(v_22),0) v_22,
		decode(nvl(sum(v_13),0),null,null,to_char(decode(nvl(sum(v_8),0),null,0,0,0,round(nvl(sum(v_13),0)/nvl(sum(v_8),0)*100,2)),'fm9999999990.00')||'%') v_23,
		decode(nvl(sum(v_18),0),null,null,to_char(decode(nvl(sum(v_13),0),null,0,0,0,round(nvl(sum(v_18),0)/nvl(sum(v_13),0)*100,2)),'fm9999999990.00')||'%') v_24
		from 
		(
		select rownum v_0,bb.* from(
			select distinct
			xd.jhxdwh v_1,xm.gydw v_2,xm.xmmc v_3,xm.ztz v_4,wc.wcl v_5,wc.wctz v_6,nvl(to_char(decode(xm.ztz,null,'0','0','0',round(nvl(wc.wctz,0)/xm.ztz*100),2)),'0')||'%' v_7,
			xd.ztz v_8,xd.cgs v_9,xd.rys v_10,xd.ttc v_11,xd.dfzc v_12,
			dw.ztz v_13,dw.cgs v_14,dw.rys v_15,dw.ttc v_16,dw.dfzc v_17,
			bf.ztz v_18,bf.cgs v_19,bf.rys v_20,bf.ttc v_21,bf.dfzc v_22,
			decode(dw.ztz,null,null,to_char(decode(xd.ztz,null,0,0,0,round(dw.ztz/xd.ztz*100,2)),'fm9999999990.00')||'%') v_23,
			decode(bf.ztz,null,null,to_char(decode(dw.ztz,null,0,0,0,round(bf.ztz/dw.ztz*100,2)),'fm9999999990.00')||'%') v_24,
			xm.gydwdm,substr(xm.xzqhdm,0,4)||'00' xzqhdm,xm.xmbm
			from
			(select xmid,jhxdwh,xdnf,sum(nvl(ztz,0)) ztz,
			sum(nvl(btzzj,0)) cgs,sum(nvl(rys,0)) rys,sum(nvl(ztz,0))-sum(nvl(btzzj,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(nvl(dfzc,0)) dfzc 
			from xm_gsd_jhxd where jhxdwh is not null group by xmid,jhxdwh,xdnf) xd,
			xmjbxx xm,xm_xmwc wc,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjdw where dwyf like #{jhnf}||'%' group by xmbm,jhxdwh) dw,
			(select xmbm,jhxdwh,sum(ztz) ztz,sum(cgs) cgs,sum(rys) rys,sum(nvl(ztz,0))-sum(nvl(cgs,0))-sum(nvl(rys,0))-sum(nvl(dfzc,0)) ttc,sum(dfzc) dfzc from xm_zjbf where bfyf like #{jhnf}||'%' group by xmbm,jhxdwh) bf
			where xd.xmid=xm.xmbm and xd.xmid=wc.xmbm(+) and xd.xmid=dw.xmbm(+) and xd.xmid=bf.xmbm(+) and xd.jhxdwh=dw.jhxdwh(+) and xd.jhxdwh=bf.jhxdwh(+) and xd.jhxdwh is not null and xd.jhxdwh!=' '
			and xm.gydwdm!='11101360000'
			<if test="xzqhdm != null">${xzqhdm}</if>
			<if test="jhnf != null">and xd.xdnf=#{jhnf}</if>
			<if test="jhxdwh != null">${jhxdwh}</if>
			<if test="xmlx != null">${xmlx}</if>
			order by xzqhdm,gydwdm
		)bb
		)
		group by xzqhdm,xmbm order by xzqhdm
	</select>
	
	
	<select id="getTzhzb" parameterType="elist" resultType="elist">
		select rownum v_0,bb.* from
		(select xm.xmmc v_1,xd.jhxdwh v_2,xm.ztz v_3,nvl(xd.ztz,0) v_4,nvl(xd.btzzj,0) v_5,nvl(xd.rys,0) v_6,nvl(xd.ztz,0)-nvl(xd.btzzj,0)-nvl(xd.rys,0)-nvl(xd.dfzc,0) v_7,nvl(xd.dfzc,0) v_8,
		dw.sn v_9,dw.bn v_10,dw.ztz v_11,bf.sn v_12,bf.bn v_13,bf.ztz v_14,nvl(xd.ztz,0)-nvl(dw.ztz,0) v_15,nvl(dw.ztz,0)-nvl(bf.ztz,0) v_16,' ' v_17,substr(xm.xzqhdm,0,4)||'00' xzqhdm
		
		 from xmjbxx xm,xm_gsd_jhxd xd,
		(select xmbm,jhxdwh,sum(decode(substr(dwyf,0,4),to_char(${jhnf}-1),ztz,0)) sn,sum(decode(substr(dwyf,0,4),to_char(${jhnf}),ztz,0)) bn,sum(ztz) ztz  from xm_zjdw group by xmbm,jhxdwh) dw,
		(select xmbm,jhxdwh,sum(decode(substr(bfyf,0,4),to_char(${jhnf}-1),ztz,0)) sn,sum(decode(substr(bfyf,0,4),to_char(${jhnf}),ztz,0)) bn,sum(ztz) ztz  from xm_zjbf group by xmbm,jhxdwh) bf
		where xm.xmbm=xd.xmid and xd.xmid=dw.xmbm(+) and xd.xmid=bf.xmbm(+) and xd.jhxdwh=dw.jhxdwh(+) and xd.jhxdwh=bf.jhxdwh(+)
			<if test="xzqhdm != null">${xzqhdm}</if>
			<if test="jhxdwh != null">${jhxdwh}</if>
			<if test="xmmc != null">and xm.xmmc like '%'||#{xmmc}||'%'</if>
			<if test="xmlx != null">${xmlx}</if>
		and xd.jhxdwh is not null and xd.jhxdwh!=' '
		order by xzqhdm,xd.xdnf,xd.jhxdwh)bb 
	</select>
	
	<select id="getTzhzbHj" parameterType="elist" resultType="elist">
		select 
		xzqhdm,(select name from xtgl_xzqh where id=xzqhdm)||'合计' v_1,
		nvl(sum(v_3),0) v_3,nvl(sum(v_4),0) v_4,nvl(sum(v_5),0) v_5,
		nvl(sum(v_6),0) v_6,nvl(sum(v_7),0) v_7,nvl(sum(v_8),0) v_8,
		nvl(sum(v_9),0) v_9,nvl(sum(v_10),0) v_10,nvl(sum(v_11),0) v_11,
		nvl(sum(v_12),0) v_12,nvl(sum(v_13),0) v_13,nvl(sum(v_14),0) v_14,
		nvl(sum(v_15),0) v_15,nvl(sum(v_16),0) v_16
		
		from 
		(
		select rownum v_0,bb.* from
		(select xm.xmmc v_1,xd.jhxdwh v_2,xm.ztz v_3,nvl(xd.ztz,0) v_4,nvl(xd.btzzj,0) v_5,nvl(xd.rys,0) v_6,nvl(xd.ztz,0)-nvl(xd.btzzj,0)-nvl(xd.rys,0)-nvl(xd.dfzc,0) v_7,nvl(xd.dfzc,0) v_8,
		dw.sn v_9,dw.bn v_10,dw.ztz v_11,bf.sn v_12,bf.bn v_13,bf.ztz v_14,nvl(xd.ztz,0)-nvl(dw.ztz,0) v_15,nvl(dw.ztz,0)-nvl(bf.ztz,0) v_16,' ' v_17,substr(xm.xzqhdm,0,4)||'00' xzqhdm
		from xmjbxx xm,xm_gsd_jhxd xd,
		(select xmbm,jhxdwh,sum(decode(substr(dwyf,0,4),to_char(${jhnf}-1),ztz,0)) sn,sum(decode(substr(dwyf,0,4),to_char(${jhnf}),ztz,0)) bn,sum(ztz) ztz  from xm_zjdw group by xmbm,jhxdwh) dw,
		(select xmbm,jhxdwh,sum(decode(substr(bfyf,0,4),to_char(${jhnf}-1),ztz,0)) sn,sum(decode(substr(bfyf,0,4),to_char(${jhnf}),ztz,0)) bn,sum(ztz) ztz  from xm_zjbf group by xmbm,jhxdwh) bf
		where xm.xmbm=xd.xmid and xd.xmid=dw.xmbm(+) and xd.xmid=bf.xmbm(+) and xd.jhxdwh=dw.jhxdwh(+) and xd.jhxdwh=bf.jhxdwh(+)
			<if test="xzqhdm != null">${xzqhdm}</if>
			<if test="jhxdwh != null">${jhxdwh}</if>
			<if test="xmmc != null">and xm.xmmc like '%'||#{xmmc}||'%'</if>
			<if test="xmlx != null">${xmlx}</if>
		and xd.jhxdwh is not null and xd.jhxdwh!=' '
		order by xd.xdnf,xd.jhxdwh)bb
		) group by xzqhdm order by xzqhdm
		
	</select>
	
	
	<select id="queryXmlist" parameterType="xmjbxx" resultType="xmjbxx">
		select * from(select rownum num ,t1.* from (select * from(select t.*,xd.jhxdwh,xsbzt,ssbzt,shzt,nvl(xsbztstr,'未填写') xsbztstr,nvl(ssbztstr,'未填写') ssbztstr,nvl(shztstr,'未填写') shztstr  from xmjbxx t
		left join(select xmid,replace(WMSYS.WM_CONCAT(distinct jhxdwh),',',',') jhxdwh from xm_gsd_jhxd group by xmid) xd
		on t.xmbm=xd.xmid	
		left join(
	    select xmbm xmids,sum(decode(xsbzt,'未上报',1,0)) xsbzt,sum(decode(ssbzt,'未上报',1,0)) ssbzt,sum(decode(shzt,'未审核',1,0)) shzt,
		(case when replace(WMSYS.WM_CONCAT(xsbzt),',',',') like '%未上报%' then '未上报' else '已上报' end) xsbztstr,
		(case when replace(WMSYS.WM_CONCAT(ssbzt),',',',') like '%未上报%' then '未上报' else '已上报' end) ssbztstr,
		(case when replace(WMSYS.WM_CONCAT(shzt),',',',') like '%未审核%' then '未审核' else '已审核' end) shztstr
		from xm_zjdw group by xmbm) dw on t.xmbm=dw.xmids
		where 1=1 
		<if test="xzqh !='' and xzqh != null">${xzqh}</if>
		<if test="xmnf !='' and xmnf != null">${xmnf}</if>
		<if test="jsxz !='' and jsxz != null">${jsxz}</if>
		<if test="jhxdwh !='' and jhxdwh != null">${jhxdwh}</if>
		<if test="gcfl !='' and gcfl != null">${gcfl}</if>
		<if test="xmbm !='' and xmbm != null">and xmbm like '%'||#{xmbm}||'%'</if>
		<if test="xmmc !='' and xmmc != null">and xmmc like '%'||#{xmmc}||'%'</if>
		) where 1=1
		<if test="shzt !='' and shzt != null">${shzt}</if>
		<if test="ssbzt !='' and ssbzt != null">${ssbzt}</if>
		<if test="xsbzt !='' and xsbzt != null">${xsbzt}</if>
		order by decode(xsbzt,null,0,xsbzt) desc,decode(ssbzt,null,0,ssbzt) desc,decode(shzt,null,0,shzt) desc,xmnf
		) t1
		
		)t2
		where t2.num &lt;=(#{page} * #{rows}) and t2.num>(#{page}-1)*#{rows}
		
	</select>
	<select id="queryXmlistCount" parameterType="xmjbxx" resultType="int">
		select count(*) from(select t.*,xd.jhxdwh,xsbzt,ssbzt,shzt,nvl(xsbztstr,'未填写') xsbztstr,nvl(ssbztstr,'未填写') ssbztstr,nvl(shztstr,'未填写') shztstr  from xmjbxx t
		left join(select xmid,replace(WMSYS.WM_CONCAT(distinct jhxdwh),',',',') jhxdwh from xm_gsd_jhxd group by xmid) xd
		on t.xmbm=xd.xmid	
		left join(
	    select xmbm xmids,sum(decode(xsbzt,'未上报',1,0)) xsbzt,sum(decode(ssbzt,'未上报',1,0)) ssbzt,sum(decode(shzt,'未审核',1,0)) shzt,
		(case when replace(WMSYS.WM_CONCAT(xsbzt),',',',') like '%未上报%' then '未上报' else '已上报' end) xsbztstr,
		(case when replace(WMSYS.WM_CONCAT(ssbzt),',',',') like '%未上报%' then '未上报' else '已上报' end) ssbztstr,
		(case when replace(WMSYS.WM_CONCAT(shzt),',',',') like '%未审核%' then '未审核' else '已审核' end) shztstr
		from xm_zjdw group by xmbm) dw on t.xmbm=dw.xmids
		where 1=1 
		<if test="xzqh !='' and xzqh != null">${xzqh}</if>
		<if test="xmnf !='' and xmnf != null">${xmnf}</if>
		<if test="jsxz !='' and jsxz != null">${jsxz}</if>
		<if test="jhxdwh !='' and jhxdwh != null">${jhxdwh}</if>
		<if test="gcfl !='' and gcfl != null">${gcfl}</if>
		<if test="xmbm !='' and xmbm != null">and xmbm like '%'||#{xmbm}||'%'</if>
		<if test="xmmc !='' and xmmc != null">and xmmc like '%'||#{xmmc}||'%'</if>
		) where 1=1
		<if test="shzt !='' and shzt != null">${shzt}</if>
		<if test="ssbzt !='' and ssbzt != null">${ssbzt}</if>
		<if test="xsbzt !='' and xsbzt != null">${xsbzt}</if>
	</select>
	
	<select id="getTzmxbbtdw" parameterType="elist" resultType="elist">
		select distinct dwyf v_0 from xm_zjdw where 
		1=1
		and xmbm=#{xmbm} 
		and substr(dwyf,0,4)=#{jhnf}
		 order by v_0
	</select>
	<select id="getTzmxbbtbf" parameterType="elist" resultType="elist">
		select distinct bfyf v_0 from xm_zjbf where 
		1=1
		and xmbm=#{xmbm} 
		and substr(bfyf,0,4)=#{jhnf}
		 order by v_0
	</select>
	<select id="queryListBySql" parameterType="elist" resultType="elist">
	 ${sql}
	</select>
	
	<select id="getGlzcqkb" parameterType="elist" resultType="elist">
	select v_0,v_1,v_2,rownum v_3,to_char(v_4,'99990.999') v_4,to_char(v_5,'99990.999') v_5,
	to_char(v_6,'99990.999') v_6,to_char(v_7,'99990.999') v_7,to_char(v_8,'99990.9999') v_8,
	to_char(v_9,'99990.9999') v_9,to_char(v_10,'99990.9999') v_10,to_char(v_11,'99990.9999') v_11 from (	
	select 
	'合计' v_0,jsdj v_1,'公里' v_2,lcqcs v_4,
	(case when lcqms-lcqcs>0 then lcqms-lcqcs else 0 end) v_5,
	(case when lcqcs-lcqms>0 then lcqcs-lcqms else 0 end) v_6,
	lcqms v_7,zcqcs v_8,zcqms v_9,fzqcs v_10,fzqms v_11,1 px
	
	from (
	select '合计'jsdj,sum(decode(nf,'2016',lc,(select sum(lc) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) lcqcs,
	sum(lc) lcqms,
	sum(decode(nf,'2016',zcqcs,(select sum(zcqms) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) zcqcs,
	sum(zcqms) zcqms,
	sum(decode(nf,'2016',fzqcs,(select sum(fzqms) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) fzqcs,
	sum(fzqms) fzqms,
	decode(jsdj,'高速公路',1,'一级公路',2,'二级公路',3,'三级公路',4,'四级公路',5,'等外公路',6) px
	from zcgl z 
	where nf=#{nf}
	<if test="gydw != null">
	${gydw}
	</if>
	)
	
	union all
	
	select 
	'等级公路' v_0,jsdj v_1,'公里' v_2,lcqcs v_4,
	(case when lcqms-lcqcs>0 then lcqms-lcqcs else 0 end) v_5,
	(case when lcqcs-lcqms>0 then lcqcs-lcqms else 0 end) v_6,
	lcqms v_7,zcqcs v_8,zcqms v_9,fzqcs v_10,fzqms v_11,2 px
	
	from (
	select '总计'jsdj,sum(decode(nf,'2016',lc,(select sum(lc) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) lcqcs,
	sum(lc) lcqms,
	sum(decode(nf,'2016',zcqcs,(select sum(zcqms) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) zcqcs,
	sum(zcqms) zcqms,
	sum(decode(nf,'2016',fzqcs,(select sum(fzqms) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) fzqcs,
	sum(fzqms) fzqms,
	decode(jsdj,'高速公路',1,'一级公路',2,'二级公路',3,'三级公路',4,'四级公路',5,'等外公路',6) px
	from zcgl z 
	where nf=#{nf}
	and (jsdj='高速公路' or jsdj='一级公路' or jsdj='二级公路' or jsdj='三级公路' or jsdj='四级公路')
	<if test="gydw != null">
	${gydw}
	</if>
	)
	
	union all
	
	select 
	decode(jsdj,'等外公路','等外公路','等级公路') v_0,jsdj v_1,'公里' v_2,lcqcs v_4,
	(case when lcqms-lcqcs>0 then lcqms-lcqcs else 0 end) v_5,
	(case when lcqcs-lcqms>0 then lcqcs-lcqms else 0 end) v_6,
	lcqms v_7,zcqcs v_8,zcqms v_9,fzqcs v_10,fzqms v_11,px
	
	from (
	select jsdj,sum(decode(nf,'2016',lc,(select sum(lc) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) lcqcs,
	sum(lc) lcqms,
	sum(decode(nf,'2016',zcqcs,(select sum(zcqms) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) zcqcs,
	sum(zcqms) zcqms,
	sum(decode(nf,'2016',fzqcs,(select sum(fzqms) from zcgl z1 where nf=to_char(${nf}-1) and z1.jsdj=z.jsdj ))) fzqcs,
	sum(fzqms) fzqms,
	decode(jsdj,'高速公路',3,'一级公路',4,'二级公路',5,'三级公路',6,'四级公路',7,'等外公路',8) px
	from zcgl z 
	where nf=#{nf}
	<if test="gydw != null">
	${gydw}
	</if>
	group by jsdj
	)

	order by px
	) t
	</select>
	
</mapper>
